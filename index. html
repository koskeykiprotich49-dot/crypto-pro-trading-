<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CryptoPro ‚Äî Professional Trading Platform</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700;900&family=JetBrains+Mono:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://s3.tradingview.com/tv.js" async></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg0:#060B11;--bg1:#0D1421;--bg2:#111927;--bg3:#151E2D;
  --bdr:#1E2D42;--t1:#E8EDF5;--t2:#6B7A99;--t3:#3D4F6B;
  --green:#0ECB81;--gdim:rgba(14,203,129,0.12);
  --red:#F6465D;--rdim:rgba(246,70,93,0.12);
  --yellow:#FCD535;--blue:#00B8FF;--bdim:rgba(0,184,255,0.12);
  --purple:#A855F7;
}
body{font-family:'Space Grotesk',sans-serif;background:var(--bg0);color:var(--t1);min-height:100vh;overflow-x:hidden}
body::before{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(14,203,129,.025) 1px,transparent 1px),linear-gradient(90deg,rgba(14,203,129,.025) 1px,transparent 1px);background-size:44px 44px;pointer-events:none;z-index:0}
.layer{display:none;min-height:100vh;position:relative;z-index:1}
.layer.active{display:block;animation:fadeUp .4s ease-out}
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
@keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.7;transform:scale(1.08)}}
@keyframes slideLeft{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}
@keyframes slideInRight{from{transform:translateX(120%);opacity:0}to{transform:translateX(0);opacity:1}}
@keyframes slideOutRight{from{transform:translateX(0);opacity:1}to{transform:translateX(120%);opacity:0}}
@keyframes flashG{0%,100%{color:var(--green)}50%{color:#fff;text-shadow:0 0 20px var(--green)}}
@keyframes flashR{0%,100%{color:var(--red)}50%{color:#fff;text-shadow:0 0 20px var(--red)}}
@keyframes glow{0%,100%{box-shadow:0 0 10px rgba(14,203,129,.3)}50%{box-shadow:0 0 25px rgba(14,203,129,.7)}}
@keyframes confettiFall{0%{transform:translateY(-20px) rotate(0deg);opacity:1}100%{transform:translateY(100vh) rotate(720deg);opacity:0}}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}
@keyframes aiFloat{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
@keyframes ripple{0%{transform:scale(.8);opacity:1}100%{transform:scale(2.5);opacity:0}}

/* TICKER */
.ticker-bar{background:var(--bg1);border-bottom:1px solid var(--bdr);padding:8px 0;overflow:hidden;position:sticky;top:0;z-index:1001}
.ticker-track{display:flex;animation:slideLeft 50s linear infinite;white-space:nowrap;width:max-content}
.tick-item{display:inline-flex;align-items:center;gap:8px;padding:0 24px;font-family:'JetBrains Mono',monospace;font-size:12px;border-right:1px solid var(--bdr)}
.tick-sym{color:var(--t2);font-weight:600}.tick-price{color:var(--t1);font-weight:700}
.pos{color:var(--green)}.neg{color:var(--red)}

/* NAV */
.nav{background:rgba(13,20,33,.97);backdrop-filter:blur(20px);padding:14px 24px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--bdr);position:sticky;top:33px;z-index:1000}
.logo{display:flex;align-items:center;gap:10px;font-size:22px;font-weight:900;color:var(--green);cursor:pointer;letter-spacing:-.5px}
.logo-icon{width:36px;height:36px;background:linear-gradient(135deg,var(--green),#0B8F5F);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px;animation:glow 3s ease-in-out infinite}
.nav-links{display:flex;gap:10px;align-items:center}
.nbtn{padding:9px 18px;border:none;border-radius:8px;font-weight:600;cursor:pointer;font-size:13px;font-family:'Space Grotesk',sans-serif;transition:all .25s}
.nbtn:hover{transform:translateY(-2px);filter:brightness(1.1)}
.btn-login{background:transparent;color:var(--blue);border:1.5px solid var(--blue)}
.btn-signup{background:linear-gradient(135deg,var(--green),#08A566);color:#000;font-weight:700}
.status-badge{display:flex;align-items:center;gap:6px;padding:6px 14px;background:var(--gdim);border:1px solid rgba(14,203,129,.3);border-radius:20px;font-size:11px;font-weight:700;color:var(--green);letter-spacing:1px}
.sdot{width:6px;height:6px;background:var(--green);border-radius:50%;animation:blink 1.5s ease-in-out infinite}
.container{max-width:1400px;margin:0 auto;padding:20px}

/* HERO */
.hero{background:linear-gradient(135deg,rgba(14,203,129,.08),rgba(0,184,255,.05));border:1px solid rgba(14,203,129,.2);border-radius:20px;padding:48px 40px;margin-bottom:20px;text-align:center;position:relative;overflow:hidden}
.hero::before{content:'';position:absolute;top:-50%;left:50%;transform:translateX(-50%);width:600px;height:300px;background:radial-gradient(ellipse,rgba(14,203,129,.1),transparent 70%);pointer-events:none}
.hero h1{font-size:52px;font-weight:900;background:linear-gradient(135deg,var(--green),var(--blue));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:16px;letter-spacing:-1.5px;line-height:1.1}
.hero p{font-size:17px;color:var(--t2);margin-bottom:28px;max-width:600px;margin-left:auto;margin-right:auto;line-height:1.6}
.hero-cta{display:flex;gap:14px;justify-content:center;flex-wrap:wrap}
.hbtn{padding:16px 34px;border:none;border-radius:12px;font-size:16px;font-weight:700;cursor:pointer;font-family:'Space Grotesk',sans-serif;transition:all .3s}
.hbtn:hover{transform:translateY(-3px);box-shadow:0 10px 30px rgba(14,203,129,.3)}
.hbtn-primary{background:linear-gradient(135deg,var(--green),#08A566);color:#000}
.hbtn-secondary{background:transparent;color:var(--blue);border:1.5px solid var(--blue)}

/* BONUS BAR */
.bonus-bar{background:linear-gradient(135deg,rgba(252,213,53,.1),rgba(252,213,53,.04));border:1px solid rgba(252,213,53,.3);border-radius:14px;padding:16px 24px;margin-bottom:20px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px}
.bonus-text{font-size:15px;font-weight:700;color:var(--yellow)}
.cd-timer{display:flex;gap:8px;align-items:center}
.cd-unit{background:rgba(0,0,0,.4);border:1px solid rgba(252,213,53,.3);border-radius:8px;padding:8px 12px;text-align:center;min-width:54px}
.cd-num{font-family:'JetBrains Mono',monospace;font-size:24px;font-weight:700;color:var(--yellow);display:block;line-height:1}
.cd-lbl{font-size:9px;color:var(--t2);text-transform:uppercase;letter-spacing:1px}
.cd-colon{font-size:22px;color:var(--yellow);font-weight:700;animation:blink 1s infinite}
.viewing{display:inline-flex;align-items:center;gap:6px;padding:6px 14px;background:var(--rdim);border:1px solid rgba(246,70,93,.2);border-radius:20px;font-size:12px;font-weight:700;color:var(--red)}

/* SECTION TITLE */
.sec-title{font-size:13px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:var(--green);margin-bottom:14px;display:flex;align-items:center;gap:8px}

/* STATS GRID */
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:14px;margin-bottom:20px}
.stat-card{background:var(--bg1);border:1px solid var(--bdr);border-radius:14px;padding:20px;text-align:center;cursor:pointer;transition:all .3s;position:relative;overflow:hidden}
.stat-card:hover{border-color:var(--green);transform:translateY(-4px);box-shadow:0 8px 30px rgba(14,203,129,.15)}
.stat-icon{font-size:30px;margin-bottom:10px}
.stat-val{font-size:26px;font-weight:900;color:var(--green);margin-bottom:4px;font-family:'JetBrains Mono',monospace;letter-spacing:-1px}
.stat-lbl{font-size:11px;color:var(--t2);text-transform:uppercase;letter-spacing:1px;font-weight:600}

/* WINNERS */
.winners-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:14px;margin-bottom:20px}
.winner-card{background:var(--bg1);border:1px solid var(--bdr);border-radius:14px;padding:20px;transition:all .3s;position:relative;overflow:hidden}
.winner-card:hover{border-color:var(--green);transform:translateY(-4px);box-shadow:0 10px 30px rgba(14,203,129,.15)}
.winner-rank{position:absolute;top:12px;right:12px;width:32px;height:32px;background:linear-gradient(135deg,var(--yellow),#f59e0b);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:900;color:#000;font-size:14px}
.winner-hdr{display:flex;align-items:center;gap:12px;margin-bottom:14px}
.w-avatar{width:52px;height:52px;border-radius:50%;object-fit:cover;border:2px solid var(--green);flex-shrink:0}
.w-name{font-size:16px;font-weight:700;margin-bottom:2px}
.w-loc{font-size:11px;color:var(--t2)}
.w-join{font-size:10px;color:var(--t3);margin-top:2px}
.w-stats{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.w-stat{background:var(--gdim);border:1px solid rgba(14,203,129,.15);padding:10px;border-radius:8px;text-align:center}
.w-stat-lbl{font-size:10px;color:var(--t2);margin-bottom:3px;text-transform:uppercase;letter-spacing:.5px}
.w-stat-val{font-size:18px;font-weight:700;color:var(--green);font-family:'JetBrains Mono',monospace}

/* CHART SECTION */
.chart-section{background:var(--bg1);border-radius:14px;padding:20px;margin-bottom:20px;border:1px solid var(--bdr)}
.chart-hdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;flex-wrap:wrap;gap:10px}
.chart-title{font-size:16px;font-weight:700;color:var(--green)}
.tv-wrap{width:100%;border-radius:10px;overflow:hidden;border:1px solid var(--bdr)}

/* AUTH */
.auth-wrap{max-width:460px;margin:40px auto;padding:36px;background:var(--bg1);border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,.5);border:1px solid var(--bdr)}
.auth-logo{text-align:center;margin-bottom:24px}
.auth-icon{font-size:52px;display:block;margin-bottom:8px;animation:pulse 2.5s infinite}
.auth-logo-text{font-size:28px;font-weight:900;background:linear-gradient(135deg,var(--green),var(--blue));-webkit-background-clip:text;-webkit-text-fill-color:transparent;letter-spacing:-1px}
.auth-title{font-size:22px;font-weight:700;text-align:center;margin-bottom:22px}

/* FORMS */
.fg{margin-bottom:16px}
.fg label{display:block;margin-bottom:7px;font-size:12px;font-weight:700;color:var(--t2);text-transform:uppercase;letter-spacing:.8px}
.fg input,.fg select,.fg textarea{width:100%;padding:13px 16px;border:1.5px solid var(--bdr);border-radius:10px;background:var(--bg3);color:var(--t1);font-size:15px;font-family:'Space Grotesk',sans-serif;transition:all .25s}
.fg input:focus,.fg select:focus{outline:none;border-color:var(--green);box-shadow:0 0 0 3px rgba(14,203,129,.1)}
.fg select option{background:var(--bg3)}
.btn-submit{width:100%;padding:15px;border:none;border-radius:10px;background:linear-gradient(135deg,var(--green),#08A566);color:#000;font-size:16px;font-weight:700;font-family:'Space Grotesk',sans-serif;cursor:pointer;transition:all .3s}
.btn-submit:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(14,203,129,.4)}
.btn-submit:disabled{opacity:.7;cursor:not-allowed;transform:none}

/* BALANCE */
.balance-card{background:linear-gradient(135deg,rgba(14,203,129,.12),rgba(0,184,255,.06));border:1px solid rgba(14,203,129,.25);border-radius:16px;padding:24px;margin-bottom:20px;text-align:center;position:relative;overflow:hidden}
.bal-lbl{font-size:11px;text-transform:uppercase;letter-spacing:2px;color:var(--t2);margin-bottom:8px;font-weight:700}
.bal-amt{font-size:52px;font-weight:900;color:var(--green);font-family:'JetBrains Mono',monospace;letter-spacing:-2px;margin-bottom:16px}
.bal-sub{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.bal-sub-item{background:rgba(0,0,0,.3);padding:12px;border-radius:8px}
.bal-sub-lbl{font-size:10px;color:var(--t2);text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px}
.bal-sub-val{font-size:15px;font-weight:700;color:var(--t1);font-family:'JetBrains Mono',monospace}

/* ACTION BUTTONS */
.action-btns{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:12px;margin-bottom:20px}
.action-btn{padding:18px 16px;border:none;border-radius:12px;font-size:14px;font-weight:700;cursor:pointer;font-family:'Space Grotesk',sans-serif;transition:all .3s;text-align:center}
.action-btn:hover{transform:translateY(-3px);filter:brightness(1.1);box-shadow:0 8px 20px rgba(0,0,0,.3)}

/* ACCOUNT SWITCHER */
.acct-switcher{display:flex;gap:6px;background:var(--bg3);padding:5px;border-radius:10px;border:1px solid var(--bdr)}
.sw-btn{padding:9px 20px;border:none;border-radius:7px;font-weight:700;font-size:13px;cursor:pointer;font-family:'Space Grotesk',sans-serif;background:transparent;color:var(--t2);transition:all .25s}
.sw-btn.active{background:linear-gradient(135deg,var(--green),#08A566);color:#000}

/* PAYMENT */
.pay-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:16px}
.pay-btn{padding:16px 10px;border:1.5px solid var(--bdr);border-radius:10px;background:var(--bg3);color:var(--t1);cursor:pointer;font-family:'Space Grotesk',sans-serif;font-size:13px;font-weight:600;text-align:center;transition:all .25s}
.pay-btn.active,.pay-btn:hover{border-color:var(--green);background:var(--gdim);color:var(--green)}
.pay-detail{background:var(--gdim);border:1.5px solid rgba(14,203,129,.25);border-radius:12px;padding:20px;margin:14px 0;display:none}
.pay-detail.active{display:block;animation:fadeUp .3s ease-out}
.pay-val{font-family:'JetBrains Mono',monospace;font-size:14px;font-weight:700;color:var(--green);word-break:break-all;background:rgba(0,0,0,.3);padding:12px 16px;border-radius:8px;margin:10px 0}
.copy-btn{width:100%;background:linear-gradient(135deg,var(--blue),#0088cc);color:#fff;border:none;padding:11px;border-radius:8px;font-weight:700;font-size:13px;font-family:'Space Grotesk',sans-serif;cursor:pointer;transition:all .25s}
.copy-btn:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,184,255,.4)}

/* PROGRESS */
.prog-wrap{background:var(--bg3);border:1px solid rgba(14,203,129,.2);border-radius:14px;padding:20px;margin-bottom:16px;display:none}
.prog-wrap.show{display:block;animation:fadeUp .3s ease-out}
.prog-lbl{font-size:14px;font-weight:700;margin-bottom:12px;color:var(--green)}
.prog-track{background:var(--bg2);border-radius:100px;height:10px;overflow:hidden;margin-bottom:8px}
.prog-fill{height:100%;background:linear-gradient(90deg,var(--green),var(--blue));border-radius:100px;width:0%;transition:width .6s ease}
.prog-txt{font-size:12px;color:var(--t2);font-family:'JetBrains Mono',monospace}

/* STK BOXES */
.stk-pending{display:none;background:rgba(252,213,53,.1);border:1px solid rgba(252,213,53,.3);border-radius:12px;padding:18px;margin-top:14px;text-align:center}
.stk-success{display:none;background:var(--gdim);border:1px solid rgba(14,203,129,.3);border-radius:12px;padding:18px;margin-top:14px;text-align:center}
.stk-error{display:none;background:var(--rdim);border:1px solid rgba(246,70,93,.3);border-radius:12px;padding:14px;margin-top:14px;text-align:center;font-size:13px;color:var(--red)}

/* PAIRS */
.pairs{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px}
.pair-btn{padding:8px 16px;background:var(--bg3);border:1px solid var(--bdr);border-radius:8px;color:var(--t2);font-size:13px;font-weight:600;cursor:pointer;font-family:'Space Grotesk',sans-serif;transition:all .2s}
.pair-btn.active,.pair-btn:hover{border-color:var(--green);color:var(--green);background:var(--gdim)}

/* PRICE INFO */
.price-info{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;background:var(--bg3);border-radius:12px;margin-bottom:14px;border:1px solid var(--bdr)}
.cur-price{font-size:34px;font-weight:900;color:var(--green);font-family:'JetBrains Mono',monospace;letter-spacing:-1px;transition:all .3s}
.cur-price.fu{animation:flashG .5s ease}
.cur-price.fd{animation:flashR .5s ease;color:var(--red)}
.price-chg{font-size:15px;font-weight:700;padding:8px 16px;border-radius:8px;font-family:'JetBrains Mono',monospace}
.price-chg.pos{background:var(--gdim);color:var(--green)}
.price-chg.neg{background:var(--rdim);color:var(--red)}

/* PRICE STATS BAR */
.price-stats{display:grid;grid-template-columns:repeat(6,1fr);gap:8px;margin-bottom:14px;padding:12px 16px;background:var(--bg3);border-radius:10px;border:1px solid var(--bdr)}
.ps-item{text-align:center}
.ps-lbl{font-size:10px;color:var(--t2);text-transform:uppercase;letter-spacing:.5px;margin-bottom:3px}
.ps-val{font-size:13px;font-weight:700;color:var(--t1);font-family:'JetBrains Mono',monospace}

/* ORDER BOOK */
.ob-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:20px}
.ob-side{background:var(--bg1);border:1px solid var(--bdr);border-radius:14px;padding:16px;font-family:'JetBrains Mono',monospace}
.ob-title{font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:1px;margin-bottom:12px;padding-bottom:10px;border-bottom:1px solid var(--bdr)}
.ob-hdr{display:grid;grid-template-columns:1fr 1fr 1fr;font-size:10px;color:var(--t2);text-transform:uppercase;margin-bottom:8px;padding:0 4px}
.ob-row{display:grid;grid-template-columns:1fr 1fr 1fr;font-size:12px;padding:5px 4px;border-radius:4px;cursor:pointer;position:relative;overflow:hidden;margin-bottom:2px;transition:opacity .2s}
.ob-row:hover{opacity:.8}
.ob-bar{position:absolute;top:0;bottom:0;opacity:.1;border-radius:3px}
.ask-row .ob-bar{background:var(--red);right:0}
.bid-row .ob-bar{background:var(--green);left:0}
.ask-p{color:var(--red);font-weight:600}
.bid-p{color:var(--green);font-weight:600}
.ob-amt{color:var(--t2)}.ob-tot{color:var(--t3)}

/* BOTS */
.bot-card{background:var(--bg1);border:1px solid var(--bdr);border-radius:14px;padding:22px;transition:all .3s}
.bot-card:hover{border-color:var(--green);transform:translateY(-4px);box-shadow:0 10px 30px rgba(14,203,129,.15)}

/* HISTORY */
.hist-item{background:var(--bg3);border-radius:12px;padding:18px;margin-bottom:10px;border:1px solid var(--bdr);transition:all .2s}
.hist-item:hover{border-color:rgba(14,203,129,.3)}

/* PROFILE */
.prof-row{display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-bottom:1px solid var(--bdr)}
.prof-row:last-child{border-bottom:none}
.verified{display:inline-flex;align-items:center;gap:4px;padding:3px 10px;background:var(--gdim);border:1px solid rgba(14,203,129,.3);border-radius:20px;font-size:11px;font-weight:700;color:var(--green)}

/* TOAST */
.toast{position:fixed;top:80px;right:20px;background:var(--bg3);border:1px solid var(--green);color:var(--t1);padding:16px 22px;border-radius:14px;box-shadow:0 10px 40px rgba(0,0,0,.5);z-index:10000;max-width:380px;display:none;white-space:pre-line;font-size:14px;line-height:1.6;animation:slideInRight .4s ease-out}
.toast.show{display:block}
.toast.err{border-color:var(--red)}

/* WINNER TOAST */
.win-toast{position:fixed;bottom:20px;right:20px;background:var(--bg3);border:1.5px solid var(--green);border-radius:14px;padding:14px 18px;box-shadow:0 10px 40px rgba(0,0,0,.5);z-index:9997;max-width:300px;display:flex;align-items:center;gap:12px;animation:slideInRight .4s ease-out}
.win-toast.hiding{animation:slideOutRight .4s ease-in forwards}
.wt-avatar{width:44px;height:44px;border-radius:50%;object-fit:cover;border:2px solid var(--green);flex-shrink:0}
.wt-name{font-size:13px;font-weight:700}
.wt-amt{font-size:16px;font-weight:900;color:var(--green);font-family:'JetBrains Mono',monospace}
.wt-action{font-size:11px;color:var(--t2);margin-top:2px}

/* AI */
.ai-btn{position:fixed;bottom:24px;right:24px;z-index:1000;display:none}
.ai-avatar{width:64px;height:64px;border-radius:50%;cursor:pointer;border:3px solid var(--green);box-shadow:0 4px 20px rgba(14,203,129,.4);transition:all .3s;animation:aiFloat 3s ease-in-out infinite;object-fit:cover}
.ai-avatar:hover{transform:scale(1.1);box-shadow:0 8px 30px rgba(14,203,129,.6)}
.ai-ripple{position:absolute;inset:-6px;border-radius:50%;border:2px solid rgba(14,203,129,.4);animation:ripple 2s linear infinite;pointer-events:none}
.ai-ripple2{animation-delay:1s}
.ai-dot{position:absolute;bottom:2px;right:2px;width:14px;height:14px;background:var(--green);border-radius:50%;border:2px solid var(--bg0);animation:blink 2s infinite}
.ai-panel{position:fixed;bottom:110px;right:24px;width:360px;background:var(--bg3);border:1px solid rgba(14,203,129,.3);border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,.7);z-index:1001;display:none;overflow:hidden;flex-direction:column}
.ai-panel.open{display:flex;animation:fadeUp .3s ease-out}
.ai-hdr{background:linear-gradient(135deg,rgba(14,203,129,.15),rgba(14,203,129,.05));padding:16px 20px;border-bottom:1px solid rgba(14,203,129,.2);display:flex;align-items:center;gap:12px}
.ai-hdr-avatar{width:46px;height:46px;border-radius:50%;object-fit:cover;border:2px solid var(--green);flex-shrink:0}
.ai-msgs{flex:1;padding:16px;max-height:300px;overflow-y:auto;display:flex;flex-direction:column;gap:10px}
.ai-msg{max-width:88%;padding:10px 14px;border-radius:12px;font-size:13px;line-height:1.5}
.ai-msg.bot{background:rgba(14,203,129,.08);border:1px solid rgba(14,203,129,.15);align-self:flex-start;border-radius:4px 12px 12px 12px}
.ai-msg.user{background:rgba(0,184,255,.1);border:1px solid rgba(0,184,255,.2);align-self:flex-end;border-radius:12px 4px 12px 12px;color:var(--blue)}
.ai-typing{display:flex;gap:4px;padding:10px 14px;background:rgba(14,203,129,.08);border-radius:4px 12px 12px 12px;align-self:flex-start;width:fit-content}
.ai-typing span{width:6px;height:6px;background:var(--green);border-radius:50%;animation:blink 1s infinite}
.ai-typing span:nth-child(2){animation-delay:.2s}
.ai-typing span:nth-child(3){animation-delay:.4s}
.ai-qr{padding:10px 16px;display:flex;gap:6px;flex-wrap:wrap;border-top:1px solid rgba(14,203,129,.15)}
.ai-qbtn{padding:6px 12px;background:rgba(14,203,129,.08);border:1px solid rgba(14,203,129,.2);border-radius:20px;color:var(--green);font-size:11px;font-weight:600;cursor:pointer;font-family:'Space Grotesk',sans-serif;transition:all .2s}
.ai-qbtn:hover{background:rgba(14,203,129,.18)}
.ai-input-row{padding:12px 16px;border-top:1px solid rgba(14,203,129,.15);display:flex;gap:8px}
.ai-input{flex:1;padding:10px 14px;background:var(--bg2);border:1px solid rgba(14,203,129,.2);border-radius:10px;color:var(--t1);font-size:13px;font-family:'Space Grotesk',sans-serif;outline:none}
.ai-input:focus{border-color:var(--green)}
.ai-send{width:38px;height:38px;background:linear-gradient(135deg,var(--green),#08A566);border:none;border-radius:10px;color:#000;font-size:16px;cursor:pointer;font-weight:700;transition:all .2s}
.ai-send:hover{transform:scale(1.1)}

/* NOTIF */
.notif-bell{position:relative;cursor:pointer;width:38px;height:38px;display:flex;align-items:center;justify-content:center;background:var(--bg2);border:1px solid var(--bdr);border-radius:10px;font-size:18px;transition:all .25s}
.notif-bell:hover{border-color:var(--green)}
.notif-count{position:absolute;top:-4px;right:-4px;background:var(--red);color:#fff;font-size:10px;font-weight:700;width:18px;height:18px;border-radius:50%;display:flex;align-items:center;justify-content:center}
.notif-dd{position:absolute;top:50px;right:0;background:var(--bg3);border:1px solid var(--bdr);border-radius:14px;width:320px;max-height:420px;overflow-y:auto;z-index:9999;display:none;box-shadow:0 20px 60px rgba(0,0,0,.6)}
.notif-dd.open{display:block;animation:fadeUp .25s ease-out}
.notif-hdr{padding:16px 20px;font-weight:700;font-size:14px;border-bottom:1px solid var(--bdr);display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;background:var(--bg3)}
.notif-item{padding:14px 20px;border-bottom:1px solid var(--bdr);cursor:pointer;transition:background .2s}
.notif-item:hover{background:var(--bg2)}
.notif-item-title{font-size:13px;font-weight:600;margin-bottom:3px}
.notif-item-desc{font-size:11px;color:var(--t2);line-height:1.4}
.notif-item-time{font-size:10px;color:var(--t3);margin-top:4px}

/* SIGNAL CARDS */
.signal-card{background:var(--bg3);border-radius:12px;padding:16px;margin-bottom:10px}

/* ALERT */
.alert{padding:11px 15px;border-radius:8px;margin-bottom:16px;font-size:13px;display:none}
.alert.show{display:block;animation:fadeUp .3s ease-out}
.alert-success{background:var(--gdim);border:1px solid rgba(14,203,129,.3);color:var(--green)}
.alert-error{background:var(--rdim);border:1px solid rgba(246,70,93,.3);color:var(--red)}

/* MOBILE NAV */
.mobile-nav{display:none;position:fixed;bottom:0;left:0;right:0;background:var(--bg1);border-top:1px solid var(--bdr);padding:8px 0;z-index:999}
@media(max-width:768px){
  .mobile-nav{display:flex}
  .container{padding:12px}
  .hero h1{font-size:32px}
  .hero{padding:28px 20px}
  .ob-grid{grid-template-columns:1fr}
  .price-stats{grid-template-columns:repeat(3,1fr)}
  .bal-amt{font-size:38px}
  .ai-panel{width:calc(100vw - 40px);right:20px}
  .ticker-bar{display:none}
  .nav{top:0}
  .pay-grid{grid-template-columns:1fr}
}
.mn-item{flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;cursor:pointer;padding:6px 0;transition:all .2s}
.mn-item.active .mn-icon,.mn-item.active .mn-lbl{color:var(--green)}
.mn-icon{font-size:20px}
.mn-lbl{font-size:10px;color:var(--t2);font-weight:600;text-transform:uppercase;letter-spacing:.5px}

/* LIVE TRADERS TICKER */
.traders-ticker{background:var(--bg1);border-radius:14px;padding:18px 20px;margin-bottom:20px;border:1px solid var(--bdr);overflow:hidden}
.ticker-content{display:flex;animation:slideLeft 80s linear infinite;white-space:nowrap;width:max-content}
.trader-card{display:inline-flex;align-items:center;gap:10px;padding:10px 16px;background:var(--bg3);border-radius:10px;margin-right:12px;border:1px solid var(--bdr);min-width:240px}
.trader-avatar{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0;overflow:hidden}
.trader-profit{font-size:14px;font-weight:700;color:var(--green);font-family:'JetBrains Mono',monospace}

::-webkit-scrollbar{width:5px}
::-webkit-scrollbar-track{background:var(--bg0)}
::-webkit-scrollbar-thumb{background:var(--bdr);border-radius:3px}
</style>
</head>
<body>

<!-- TOAST -->
<div id="toast" class="toast"></div>

<!-- MARKET TICKER -->
<div class="ticker-bar"><div class="ticker-track" id="tickerTrack"></div></div>

<!-- AI BUTTON -->
<div class="ai-btn" id="aiBtn">
  <div style="position:relative;display:inline-block;">
    <img src="https://api.dicebear.com/7.x/personas/svg?seed=aria&backgroundColor=0ECB81"
         class="ai-avatar" onclick="toggleAI()" alt="ARIA"
         onerror="this.src='https://api.dicebear.com/7.x/avataaars/svg?seed=aria'">
    <div class="ai-ripple"></div><div class="ai-ripple ai-ripple2"></div>
    <div class="ai-dot"></div>
  </div>
</div>

<!-- AI PANEL -->
<div class="ai-panel" id="aiPanel">
  <div class="ai-hdr">
    <img src="https://api.dicebear.com/7.x/personas/svg?seed=aria&backgroundColor=0ECB81" class="ai-hdr-avatar" alt="ARIA" onerror="this.src='https://api.dicebear.com/7.x/avataaars/svg?seed=aria'">
    <div style="flex:1;">
      <div style="font-size:15px;font-weight:700;">ARIA ‚Äî Trading Advisor</div>
      <div style="font-size:11px;color:var(--t2);">CryptoPro AI Specialist</div>
      <div style="font-size:11px;color:var(--green);display:flex;align-items:center;gap:4px;margin-top:2px;"><span class="sdot"></span> Online ‚Ä¢ Responds instantly</div>
    </div>
    <button onclick="toggleAI()" style="background:none;border:none;color:var(--t2);font-size:22px;cursor:pointer;line-height:1;">√ó</button>
  </div>
  <div class="ai-msgs" id="aiMsgs">
    <div class="ai-msg bot">üëã Hi! I'm <strong>ARIA</strong>, your personal trading advisor.<br><br>I can help with trading strategies, deposits, withdrawals, and market insights!</div>
  </div>
  <div class="ai-qr">
    <button class="ai-qbtn" onclick="sendAIQuick('Best bot for beginners?')">Best bot?</button>
    <button class="ai-qbtn" onclick="sendAIQuick('How do I deposit?')">Deposit?</button>
    <button class="ai-qbtn" onclick="sendAIQuick('BTC price prediction?')">BTC outlook?</button>
    <button class="ai-qbtn" onclick="sendAIQuick('How does withdrawal work?')">Withdraw?</button>
  </div>
  <div class="ai-input-row">
    <input type="text" class="ai-input" id="aiInput" placeholder="Ask ARIA anything..." onkeydown="if(event.key==='Enter')sendAI()">
    <button class="ai-send" onclick="sendAI()">‚û§</button>
  </div>
</div>

<!-- ===== WELCOME LAYER ===== -->
<div id="welcomeLayer" class="layer active">
  <nav class="nav">
    <div class="logo" onclick="showLayer('welcomeLayer')"><div class="logo-icon">‚Çø</div>CryptoPro</div>
    <div class="nav-links">
      <button class="nbtn btn-login" onclick="showLayer('loginLayer')">Login</button>
      <button class="nbtn btn-signup" onclick="showLayer('signupLayer')">Sign Up Free</button>
    </div>
  </nav>
  <div class="container">
    <div class="bonus-bar">
      <div>
        <div class="bonus-text">üî• 100% Welcome Bonus ‚Äî First Deposit DOUBLED!</div>
        <div style="font-size:12px;color:var(--t2);margin-top:3px;">Limited time offer!</div>
      </div>
      <div class="cd-timer">
        <div class="cd-unit"><span class="cd-num" id="cdH">23</span><span class="cd-lbl">Hrs</span></div>
        <span class="cd-colon">:</span>
        <div class="cd-unit"><span class="cd-num" id="cdM">47</span><span class="cd-lbl">Min</span></div>
        <span class="cd-colon">:</span>
        <div class="cd-unit"><span class="cd-num" id="cdS">00</span><span class="cd-lbl">Sec</span></div>
      </div>
      <div class="viewing">üî¥ <span id="viewCount">47</span> people viewing</div>
    </div>
    <div class="hero">
      <h1>üöÄ The Future of<br>Crypto Trading</h1>
      <p>Join <strong style="color:var(--green)">50,000+</strong> successful traders from <strong style="color:var(--yellow)">120+ countries</strong> earning daily profits with AI-powered automation. Get your <strong style="color:var(--green)">$25 FREE signup bonus</strong> today!</p>
      <div class="hero-cta">
        <button class="hbtn hbtn-primary" onclick="showLayer('signupLayer')">Get Started ‚Äî Free $25 Bonus</button>
        <button class="hbtn hbtn-secondary" onclick="showLayer('chartsLayer')">View Live Charts</button>
      </div>
    </div>

    <!-- GLOBAL STATS -->
    <div class="chart-section" style="margin-bottom:20px;">
      <div class="sec-title">üåç Global Traders ‚Äî Active Right Now</div>
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px;margin-bottom:16px;">
        <div style="background:rgba(14,203,129,.08);border:1px solid rgba(14,203,129,.2);border-radius:10px;padding:14px;text-align:center;">
          <div style="font-size:22px;margin-bottom:4px;">üåç</div>
          <div style="font-size:20px;font-weight:900;color:var(--green);font-family:'JetBrains Mono',monospace;" id="africaCount">12,847</div>
          <div style="font-size:11px;color:var(--t2);text-transform:uppercase;letter-spacing:.5px;">Africa</div>
        </div>
        <div style="background:rgba(0,184,255,.08);border:1px solid rgba(0,184,255,.2);border-radius:10px;padding:14px;text-align:center;">
          <div style="font-size:22px;margin-bottom:4px;">üåé</div>
          <div style="font-size:20px;font-weight:900;color:var(--blue);font-family:'JetBrains Mono',monospace;" id="americasCount">9,234</div>
          <div style="font-size:11px;color:var(--t2);text-transform:uppercase;letter-spacing:.5px;">Americas</div>
        </div>
        <div style="background:rgba(168,85,247,.08);border:1px solid rgba(168,85,247,.2);border-radius:10px;padding:14px;text-align:center;">
          <div style="font-size:22px;margin-bottom:4px;">üåè</div>
          <div style="font-size:20px;font-weight:900;color:var(--purple);font-family:'JetBrains Mono',monospace;" id="asiaCount">15,621</div>
          <div style="font-size:11px;color:var(--t2);text-transform:uppercase;letter-spacing:.5px;">Asia-Pacific</div>
        </div>
        <div style="background:rgba(252,213,53,.08);border:1px solid rgba(252,213,53,.2);border-radius:10px;padding:14px;text-align:center;">
          <div style="font-size:22px;margin-bottom:4px;">üåê</div>
          <div style="font-size:20px;font-weight:900;color:var(--yellow);font-family:'JetBrains Mono',monospace;" id="europeCount">8,445</div>
          <div style="font-size:11px;color:var(--t2);text-transform:uppercase;letter-spacing:.5px;">Europe & ME</div>
        </div>
      </div>
      <div style="background:var(--bg3);border-radius:10px;padding:16px;border:1px solid var(--bdr);">
        <div style="font-size:12px;color:var(--t2);margin-bottom:10px;font-weight:700;text-transform:uppercase;letter-spacing:1px;">üî• Live Activity</div>
        <div id="activityFeed" style="max-height:120px;overflow:hidden;"></div>
      </div>
    </div>

    <!-- LIVE TRADERS TICKER -->
    <div class="traders-ticker">
      <div class="sec-title">üî• Live Active Traders ‚Äî Real-Time Profits</div>
      <div style="overflow:hidden;"><div class="ticker-content" id="tradersTicker"></div></div>
    </div>

    <!-- STATS -->
    <div class="stats-grid">
      <div class="stat-card"><div class="stat-icon">üë•</div><div class="stat-val" id="statTraders">50,247</div><div class="stat-lbl">Active Traders</div></div>
      <div class="stat-card"><div class="stat-icon">üí∞</div><div class="stat-val">$125M+</div><div class="stat-lbl">Total Profits Paid</div></div>
      <div class="stat-card"><div class="stat-icon">üìà</div><div class="stat-val">98.5%</div><div class="stat-lbl">Success Rate</div></div>
      <div class="stat-card"><div class="stat-icon">‚ö°</div><div class="stat-val" id="statTrades">15,892</div><div class="stat-lbl">Daily Trades</div></div>
      <div class="stat-card"><div class="stat-icon">üåç</div><div class="stat-val">120+</div><div class="stat-lbl">Countries</div></div>
      <div class="stat-card"><div class="stat-icon">‚≠ê</div><div class="stat-val">4.9/5</div><div class="stat-lbl">User Rating</div></div>
    </div>

    <!-- TOP WINNERS -->
    <div class="chart-section">
      <div class="sec-title">üèÜ Top Traders This Week ‚Äî Worldwide</div>
      <div class="winners-grid" id="winnersGrid"></div>
    </div>

    <div class="action-btns">
      <button class="action-btn" style="background:linear-gradient(135deg,#fbbf24,#f59e0b);color:#000;" onclick="showLayer('reviewsLayer')">‚≠ê See Reviews</button>
      <button class="action-btn" style="background:linear-gradient(135deg,var(--green),#08A566);color:#000;" onclick="showLayer('signupLayer')">üìä Start Trading Now</button>
    </div>
  </div>
</div>

<!-- ===== CHARTS LAYER ===== -->
<div id="chartsLayer" class="layer">
  <nav class="nav">
    <div class="logo" onclick="showLayer('welcomeLayer')"><div class="logo-icon">‚Çø</div>CryptoPro</div>
    <div class="nav-links">
      <div class="status-badge"><span class="sdot"></span> LIVE</div>
      <button class="nbtn btn-signup" onclick="showLayer('signupLayer')">Sign Up</button>
    </div>
  </nav>
  <div class="container">
    <div class="pairs" id="chartPairs">
      <button class="pair-btn active" onclick="selectChartPair(this,'BTCUSDT','BTC/USDT','Bitcoin / USDT')">BTC/USDT</button>
      <button class="pair-btn" onclick="selectChartPair(this,'ETHUSDT','ETH/USDT','Ethereum / USDT')">ETH/USDT</button>
      <button class="pair-btn" onclick="selectChartPair(this,'BNBUSDT','BNB/USDT','BNB / USDT')">BNB/USDT</button>
      <button class="pair-btn" onclick="selectChartPair(this,'SOLUSDT','SOL/USDT','Solana / USDT')">SOL/USDT</button>
      <button class="pair-btn" onclick="selectChartPair(this,'ADAUSDT','ADA/USDT','Cardano / USDT')">ADA/USDT</button>
      <button class="pair-btn" onclick="selectChartPair(this,'XRPUSDT','XRP/USDT','Ripple / USDT')">XRP/USDT</button>
    </div>
    <div class="chart-section">
      <div class="chart-hdr">
        <div class="chart-title">üìà <span id="chartPairLabel">BTC/USDT</span> Live Chart</div>
        <div class="status-badge"><span class="sdot"></span> LIVE</div>
      </div>
      <div class="price-info">
        <div>
          <div class="cur-price" id="chartPrice">$98,245.50</div>
          <div style="font-size:12px;color:var(--t2);margin-top:4px;" id="chartPairSub">Bitcoin / USDT</div>
        </div>
        <div class="price-chg pos" id="chartChange">+2.45%</div>
      </div>
      <div class="price-stats">
        <div class="ps-item"><div class="ps-lbl">24h High</div><div class="ps-val" id="chartHigh">$99,120</div></div>
        <div class="ps-item"><div class="ps-lbl">24h Low</div><div class="ps-val" id="chartLow">$96,800</div></div>
        <div class="ps-item"><div class="ps-lbl">Volume</div><div class="ps-val" id="chartVol">28.5B</div></div>
        <div class="ps-item"><div class="ps-lbl">Open</div><div class="ps-val" id="chartOpen">$97,850</div></div>
        <div class="ps-item"><div class="ps-lbl">Close</div><div class="ps-val" id="chartClose">$98,245</div></div>
        <div class="ps-item"><div class="ps-lbl">24h Change</div><div class="ps-val" id="chart24h" style="color:var(--green);">+2.45%</div></div>
      </div>
      <div class="tv-wrap"><div id="tv_chart_main" style="height:500px;"></div></div>
    </div>
  </div>
</div>

<!-- ===== SIGNUP LAYER ===== -->
<div id="signupLayer" class="layer">
  <div class="auth-wrap">
    <div class="auth-logo">
      <span class="auth-icon">üíé</span>
      <div class="auth-logo-text">CryptoPro</div>
    </div>
    <div class="auth-title">Start Your Trading Journey</div>
    <div style="background:var(--gdim);border:1px solid rgba(14,203,129,.3);border-radius:10px;padding:12px 16px;margin-bottom:20px;text-align:center;">
      <div style="font-size:14px;font-weight:700;color:var(--green);">üéÅ You'll receive $25 INSTANT BONUS on signup!</div>
    </div>
    <div id="signupAlert" class="alert"></div>
    <form onsubmit="return handleSignup(event)">
      <div class="fg"><label>Full Name</label><input type="text" id="signupName" placeholder="Enter your full name" required></div>
      <div class="fg"><label>Email</label><input type="email" id="signupEmail" placeholder="your@email.com" required></div>
      <div class="fg"><label>Phone</label><input type="tel" id="signupPhone" placeholder="+254 712 345 678" required></div>
      <div class="fg">
        <label>Country</label>
        <select id="signupCountry" required>
          <option value="">Select country...</option>
          <optgroup label="üåç Africa">
            <option value="KE">üá∞üá™ Kenya</option><option value="NG">üá≥üá¨ Nigeria</option>
            <option value="GH">üá¨üá≠ Ghana</option><option value="ZA">üáøüá¶ South Africa</option>
            <option value="TZ">üáπüáø Tanzania</option><option value="UG">üá∫üá¨ Uganda</option>
            <option value="ET">üá™üáπ Ethiopia</option><option value="EG">üá™üá¨ Egypt</option>
          </optgroup>
          <optgroup label="üåé Americas">
            <option value="US">üá∫üá∏ United States</option><option value="CA">üá®üá¶ Canada</option>
            <option value="BR">üáßüá∑ Brazil</option><option value="MX">üá≤üáΩ Mexico</option>
          </optgroup>
          <optgroup label="üåè Asia-Pacific">
            <option value="IN">üáÆüá≥ India</option><option value="PH">üáµüá≠ Philippines</option>
            <option value="PK">üáµüá∞ Pakistan</option><option value="AU">üá¶üá∫ Australia</option>
          </optgroup>
          <optgroup label="üåê Europe & ME">
            <option value="GB">üá¨üáß United Kingdom</option><option value="DE">üá©üá™ Germany</option>
            <option value="FR">üá´üá∑ France</option><option value="AE">üá¶üá™ UAE</option>
          </optgroup>
        </select>
      </div>
      <div class="fg"><label>Password</label><input type="password" id="signupPassword" placeholder="Create strong password" required></div>
      <div class="fg"><label>Confirm Password</label><input type="password" id="signupConfirm" placeholder="Re-enter password" required></div>
      <div class="fg"><label>Referral Code (Optional)</label><input type="text" id="signupRef" placeholder="Enter referral code"></div>
      <button type="submit" class="btn-submit">üöÄ Create Account & Get $25 Bonus</button>
    </form>
    <div style="text-align:center;margin-top:20px;font-size:14px;color:var(--t2);">
      Already have an account? <a onclick="showLayer('loginLayer')" style="color:var(--green);cursor:pointer;font-weight:700;">Login Here</a>
    </div>
  </div>
</div>

<!-- ===== LOGIN LAYER ===== -->
<div id="loginLayer" class="layer">
  <div class="auth-wrap">
    <div class="auth-logo">
      <span class="auth-icon">üíé</span>
      <div class="auth-logo-text">CryptoPro</div>
    </div>
    <div class="auth-title">Welcome Back</div>
    <div id="loginAlert" class="alert"></div>
    <form onsubmit="return handleLogin(event)">
      <div class="fg"><label>Email</label><input type="email" id="loginEmail" placeholder="your@email.com" required></div>
      <div class="fg"><label>Password</label><input type="password" id="loginPassword" placeholder="Your password" required></div>
      <button type="submit" class="btn-submit">üîê Login to Account</button>
    </form>
    <div style="text-align:center;margin-top:20px;font-size:14px;color:var(--t2);">
      No account? <a onclick="showLayer('signupLayer')" style="color:var(--green);cursor:pointer;font-weight:700;">Create Account</a>
    </div>
  </div>
</div>

<!-- ===== DASHBOARD LAYER ===== -->
<div id="dashboardLayer" class="layer">
  <nav class="nav">
    <div class="logo"><div class="logo-icon">‚Çø</div>CryptoPro</div>
    <div class="nav-links">
      <div class="status-badge"><span class="sdot"></span> LIVE</div>
      <div style="position:relative;" id="notifWrapper">
        <div class="notif-bell" onclick="toggleNotif()">üîî<div class="notif-count" id="notifCount">3</div></div>
        <div class="notif-dd" id="notifDD">
          <div class="notif-hdr">Notifications<span style="font-size:11px;color:var(--green);cursor:pointer;" onclick="clearNotif()">Mark all read</span></div>
          <div id="notifList"></div>
        </div>
      </div>
      <button class="nbtn btn-login" onclick="handleLogout()">Logout</button>
    </div>
  </nav>
  <div class="container">
    <!-- USER HEADER -->
    <div style="background:var(--bg1);padding:18px 20px;border-radius:14px;margin-bottom:18px;border:1px solid var(--bdr);display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:14px;">
      <div style="display:flex;align-items:center;gap:12px;">
        <img id="userAvatar" src="" alt="Avatar" style="width:52px;height:52px;border-radius:50%;object-fit:cover;border:2px solid var(--green);flex-shrink:0;" onerror="this.src='https://api.dicebear.com/7.x/personas/svg?seed=user&backgroundColor=0ECB81'">
        <div>
          <div style="font-size:18px;font-weight:700;" id="userName">User</div>
          <div style="font-size:12px;color:var(--t2);" id="userEmail">email@example.com</div>
          <div style="font-size:11px;color:var(--t3);" id="userCountry"></div>
          <div class="verified" style="margin-top:5px;">‚úì Verified Trader</div>
        </div>
      </div>
      <div class="acct-switcher">
        <button class="sw-btn active" id="swDemo" onclick="switchAcct('demo')">üìä DEMO</button>
        <button class="sw-btn" id="swReal" onclick="switchAcct('real')">üíé REAL</button>
      </div>
    </div>

    <div id="acctIndicator" style="margin-bottom:16px;"></div>

    <!-- SENTIMENT BAR -->
    <div style="background:var(--bg1);border:1px solid var(--bdr);border-radius:12px;padding:12px 18px;margin-bottom:16px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px;">
      <div id="mktSentiment" style="font-weight:600;font-size:13px;">üìä Market: <strong style="color:var(--green);">Loading...</strong></div>
      <div style="display:flex;gap:16px;font-size:12px;font-family:'JetBrains Mono',monospace;flex-wrap:wrap;">
        <span style="color:var(--t2);">BTC <strong id="dashBTC" style="color:var(--green);">$98,245</strong></span>
        <span style="color:var(--t2);">ETH <strong id="dashETH" style="color:var(--green);">$3,842</strong></span>
        <span style="color:var(--t2);">SOL <strong id="dashSOL" style="color:var(--green);">$185</strong></span>
      </div>
    </div>

    <!-- BALANCE -->
    <div class="balance-card">
      <div class="bal-lbl"><span id="acctTypeLbl">DEMO</span> Account Balance</div>
      <div class="bal-amt" id="dashBalance">$25.00</div>
      <div class="bal-sub">
        <div class="bal-sub-item"><div class="bal-sub-lbl">Available</div><div class="bal-sub-val" id="dashAvail">$25.00</div></div>
        <div class="bal-sub-item"><div class="bal-sub-lbl">In Trades</div><div class="bal-sub-val" id="dashInTrades">$0.00</div></div>
        <div class="bal-sub-item"><div class="bal-sub-lbl">Total Profit</div><div class="bal-sub-val" style="color:var(--green);" id="dashProfit">$0.00</div></div>
      </div>
    </div>

    <!-- QUICK STATS -->
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(130px,1fr));gap:10px;margin-bottom:16px;">
      <div style="background:var(--bg1);border:1px solid var(--bdr);border-radius:12px;padding:14px;text-align:center;">
        <div style="font-size:10px;color:var(--t2);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px;">Win Rate</div>
        <div style="font-size:22px;font-weight:900;color:var(--green);font-family:'JetBrains Mono',monospace;" id="dashWR">‚Äî</div>
      </div>
      <div style="background:var(--bg1);border:1px solid var(--bdr);border-radius:12px;padding:14px;text-align:center;">
        <div style="font-size:10px;color:var(--t2);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px;">Total Trades</div>
        <div style="font-size:22px;font-weight:900;color:var(--blue);font-family:'JetBrains Mono',monospace;" id="dashTrades">0</div>
      </div>
      <div style="background:var(--bg1);border:1px solid var(--bdr);border-radius:12px;padding:14px;text-align:center;">
        <div style="font-size:10px;color:var(--t2);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px;">Active Bots</div>
        <div style="font-size:22px;font-weight:900;color:var(--purple);font-family:'JetBrains Mono',monospace;" id="dashBots">0</div>
      </div>
      <div style="background:var(--bg1);border:1px solid var(--bdr);border-radius:12px;padding:14px;text-align:center;">
        <div style="font-size:10px;color:var(--t2);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px;">Referrals</div>
        <div style="font-size:22px;font-weight:900;color:var(--yellow);font-family:'JetBrains Mono',monospace;" id="dashRefs">0</div>
      </div>
    </div>

    <!-- MAIN ACTIONS -->
    <div class="action-btns">
      <button class="action-btn" style="background:linear-gradient(135deg,#fbbf24,#f59e0b);color:#000;" onclick="showLayer('tradingLayer')">‚ö° Trade Now</button>
      <button class="action-btn" style="background:linear-gradient(135deg,var(--green),#08A566);color:#000;" onclick="showLayer('depositLayer')">üí∞ Deposit</button>
      <button class="action-btn" style="background:linear-gradient(135deg,#10b981,#059669);color:#fff;" onclick="showLayer('botsLayer')">ü§ñ AI Bots</button>
    </div>

    <!-- MINI CHART -->
    <div class="chart-section">
      <div class="chart-hdr">
        <div class="chart-title">üìà Live Market Overview</div>
        <div class="status-badge"><span class="sdot"></span> LIVE</div>
      </div>
      <div class="tv-wrap"><div id="tv_chart_dash" style="height:280px;"></div></div>
    </div>

    <!-- MORE ACTIONS -->
    <div class="action-btns">
      <button class="action-btn" style="background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff;" onclick="showLayer('historyLayer')">üìú Trade History</button>
      <button class="action-btn" style="background:linear-gradient(135deg,#8b5cf6,#7c3aed);color:#fff;" onclick="showLayer('withdrawalLayer')">üí∏ Withdraw</button>
      <button class="action-btn" style="background:linear-gradient(135deg,#ec4899,#db2777);color:#fff;" onclick="showLayer('referralLayer')">üéÅ Referrals</button>
      <button class="action-btn" style="background:linear-gradient(135deg,#06b6d4,#0891b2);color:#fff;" onclick="showLayer('profileLayer')">‚öôÔ∏è Profile</button>
    </div>
  </div>
  <div class="mobile-nav">
    <div class="mn-item active" onclick="showLayer('dashboardLayer')"><div class="mn-icon">üè†</div><div class="mn-lbl">Home</div></div>
    <div class="mn-item" onclick="showLayer('tradingLayer')"><div class="mn-icon">üìä</div><div class="mn-lbl">Trade</div></div>
    <div class="mn-item" onclick="showLayer('depositLayer')"><div class="mn-icon">üí∞</div><div class="mn-lbl">Deposit</div></div>
    <div class="mn-item" onclick="showLayer('withdrawalLayer')"><div class="mn-icon">üí∏</div><div class="mn-lbl">Withdraw</div></div>
    <div class="mn-item" onclick="showLayer('profileLayer')"><div class="mn-icon">üë§</div><div class="mn-lbl">Profile</div></div>
  </div>
</div>

<!-- ===== DEPOSIT LAYER ===== -->
<div id="depositLayer" class="layer">
  <nav class="nav">
    <div class="logo" onclick="showLayer('dashboardLayer')"><div class="logo-icon">‚Çø</div>CryptoPro</div>
    <div class="nav-links"><button class="nbtn btn-login" onclick="showLayer('dashboardLayer')">‚Üê Dashboard</button></div>
  </nav>
  <div class="container">
    <div class="hero" style="padding:28px 32px;margin-bottom:20px;">
      <h1 style="font-size:38px;">üí∞ Deposit Funds</h1>
      <p style="margin-bottom:0;">M-Pesa STK Push auto-credited instantly! 100% welcome bonus on first deposit.</p>
    </div>
    <div class="prog-wrap" id="depProg">
      <div class="prog-lbl" id="depProgLbl">‚è≥ Processing...</div>
      <div class="prog-track"><div class="prog-fill" id="depProgFill"></div></div>
      <div class="prog-txt" id="depProgTxt">0% complete</div>
    </div>
    <div class="chart-section">
      <form id="depositForm" onsubmit="return processDeposit(event)">
        <div class="fg">
          <label>Amount (USD)</label>
          <input type="number" id="depAmount" min="10" step="0.01" placeholder="Minimum $10" required oninput="updateDepConversion()">
        </div>
        <div id="depConversionBox"></div>
        <!-- QUICK AMOUNTS -->
        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px;">
          <span style="font-size:11px;color:var(--t2);font-weight:700;align-self:center;">Quick:</span>
          <button type="button" onclick="quickDep(50)" style="padding:5px 12px;background:var(--bg3);border:1px solid var(--bdr);border-radius:6px;color:var(--t2);font-size:12px;font-weight:600;cursor:pointer;font-family:'Space Grotesk',sans-serif;">$50</button>
          <button type="button" onclick="quickDep(100)" style="padding:5px 12px;background:var(--bg3);border:1px solid var(--bdr);border-radius:6px;color:var(--t2);font-size:12px;font-weight:600;cursor:pointer;font-family:'Space Grotesk',sans-serif;">$100</button>
          <button type="button" onclick="quickDep(200)" style="padding:5px 12px;background:var(--bg3);border:1px solid var(--bdr);border-radius:6px;color:var(--t2);font-size:12px;font-weight:600;cursor:pointer;font-family:'Space Grotesk',sans-serif;">$200</button>
          <button type="button" onclick="quickDep(500)" style="padding:5px 12px;background:var(--bg3);border:1px solid var(--bdr);border-radius:6px;color:var(--t2);font-size:12px;font-weight:600;cursor:pointer;font-family:'Space Grotesk',sans-serif;">$500</button>
          <button type="button" onclick="quickDep(1000)" style="padding:5px 12px;background:var(--bg3);border:1px solid var(--bdr);border-radius:6px;color:var(--t2);font-size:12px;font-weight:600;cursor:pointer;font-family:'Space Grotesk',sans-serif;">$1,000</button>
        </div>
        <div class="fg">
          <label>Payment Method</label>
          <div class="pay-grid">
            <button type="button" class="pay-btn" onclick="selectPay('mpesa',this)">üì± M-Pesa<br><small style="font-size:10px;opacity:.7;">STK Push</small></button>
            <button type="button" class="pay-btn" onclick="selectPay('crypto',this)">ü™ô Crypto<br><small style="font-size:10px;opacity:.7;">BTC/ETH/USDT</small></button>
            <button type="button" class="pay-btn" onclick="selectPay('bank',this)">üè¶ Bank<br><small style="font-size:10px;opacity:.7;">Equity Bank</small></button>
          </div>
        </div>

        <!-- MPESA -->
        <div id="mpesa" class="pay-detail">
          <div style="text-align:center;font-size:17px;font-weight:700;color:var(--green);margin-bottom:14px;">üì± M-Pesa STK Push ‚Äî Fully Automatic</div>
          <div style="background:rgba(14,203,129,.08);border:1px solid rgba(14,203,129,.2);border-radius:10px;padding:14px;margin-bottom:16px;font-size:13px;line-height:1.9;">
            ‚úÖ Enter your M-Pesa number below<br>
            ‚úÖ You'll receive a <strong>PIN prompt on your phone</strong><br>
            ‚úÖ Enter your PIN ‚Üí Credited instantly
          </div>
          <div class="fg"><label>M-Pesa Phone Number</label><input type="tel" id="mpesaPhone" placeholder="+254 712 345 678"></div>
          <div class="stk-pending" id="stkPending">
            <div style="font-size:28px;margin-bottom:8px;animation:pulse 1.5s infinite;">üì≤</div>
            <div style="font-size:16px;font-weight:700;color:var(--yellow);margin-bottom:6px;">Check Your Phone Now!</div>
            <div style="font-size:13px;color:var(--t2);">Enter your M-Pesa PIN to complete payment.</div>
            <div style="font-size:12px;color:var(--t3);margin-top:8px;">Waiting... <span id="stkTimer" style="color:var(--yellow);font-weight:700;">60</span>s</div>
          </div>
          <div class="stk-success" id="stkSuccess">
            <div style="font-size:32px;margin-bottom:8px;">üéâ</div>
            <div style="font-size:16px;font-weight:700;color:var(--green);">Payment Confirmed!</div>
            <div style="font-size:13px;color:var(--t2);margin-top:6px;" id="stkReceipt">Payment received!</div>
          </div>
          <div class="stk-error" id="stkError"></div>
        </div>

        <!-- CRYPTO -->
        <div id="crypto" class="pay-detail">
          <div style="text-align:center;font-size:17px;font-weight:700;color:var(--green);margin-bottom:14px;">ü™ô Crypto Payment</div>
          <div class="fg">
            <label>Select Cryptocurrency</label>
            <select id="cryptoType" onchange="updateCryptoWallet()">
              <option value="USDT-TRC20">USDT ‚Äî TRC-20 (Tron) ‚ö° Recommended</option>
              <option value="USDT-ERC20">USDT ‚Äî ERC-20 (Ethereum)</option>
              <option value="BTC">Bitcoin (BTC)</option>
              <option value="ETH">Ethereum (ETH)</option>
            </select>
          </div>
          <div style="font-size:12px;color:var(--t2);margin-bottom:6px;">Send to Wallet Address:</div>
          <div class="pay-val" id="cryptoWallet">TK4rUz6TUEd7zCWeuiX5R47pSNdPswJnAc</div>
          <button type="button" class="copy-btn" onclick="copyCrypto()">üìã Copy Address</button>
          <div class="fg" style="margin-top:12px;"><label>Transaction Hash / TX ID</label><input type="text" id="cryptoTx" placeholder="Paste transaction hash here"></div>
        </div>

        <!-- BANK -->
        <div id="bank" class="pay-detail">
          <div style="text-align:center;font-size:17px;font-weight:700;color:var(--green);margin-bottom:14px;">üè¶ Equity Bank Transfer</div>
          <div style="background:rgba(0,0,0,.3);padding:16px;border-radius:10px;margin-bottom:12px;">
            <div style="margin-bottom:10px;"><div style="font-size:11px;color:var(--t2);margin-bottom:3px;">Bank Name</div><div style="font-size:16px;font-weight:700;">Equity Bank Kenya</div></div>
            <div style="margin-bottom:10px;"><div style="font-size:11px;color:var(--t2);margin-bottom:3px;">Account Name</div><div style="font-size:16px;font-weight:700;">CryptoPro Trading Platform</div></div>
            <div><div style="font-size:11px;color:var(--t2);margin-bottom:3px;">Account Number</div><div class="pay-val" style="margin:0;">0310184912429</div></div>
          </div>
          <button type="button" class="copy-btn" onclick="copyText('0310184912429')">üìã Copy Account Number</button>
          <div class="fg" style="margin-top:16px;"><label>Bank Reference / Slip Number</label><input type="text" id="bankRef" placeholder="Enter payment reference"></div>
        </div>

        <div style="background:var(--gdim);border:1px solid rgba(14,203,129,.25);border-radius:12px;padding:16px;margin:16px 0;text-align:center;">
          <div style="font-size:15px;font-weight:700;color:var(--green);margin-bottom:6px;">‚úÖ Secure & Verified Payments</div>
          <div style="font-size:13px;color:var(--t1);line-height:1.8;">M-Pesa: Auto-credited after PIN confirmation<br>Crypto: Credited after blockchain verification (‚â§30 min)<br>Bank: Credited after manual verification (1‚Äì2 hrs)</div>
        </div>
        <button type="submit" class="btn-submit" id="depSubmitBtn">‚úÖ Submit Deposit</button>
      </form>
    </div>

    <!-- RECENT DEPOSITS SOCIAL PROOF -->
    <div class="chart-section">
      <div class="sec-title">‚úÖ Recent Deposits ‚Äî Live</div>
      <div id="recentDepsFeed"></div>
    </div>
  </div>
</div>

<!-- ===== TRADING LAYER ===== -->
<div id="tradingLayer" class="layer">
  <nav class="nav">
    <div class="logo" onclick="showLayer('dashboardLayer')"><div class="logo-icon">‚Çø</div>CryptoPro</div>
    <div class="nav-links">
      <div class="status-badge"><span class="sdot"></span> LIVE</div>
      <button class="nbtn btn-login" onclick="showLayer('dashboardLayer')">‚Üê Dashboard</button>
    </div>
  </nav>
  <div class="container">
    <div class="hero" style="padding:22px 28px;margin-bottom:20px;">
      <h1 style="font-size:34px;">‚ö° Live Trading</h1>
      <p style="margin-bottom:0;font-size:15px;">Execute trades in real-time with up to 100x leverage and AI-powered signals</p>
    </div>
    <div class="pairs" id="tradePairs">
      <button class="pair-btn active" onclick="selectTradePair(this,'BTCUSDT','BTC/USDT','Bitcoin / USDT')">BTC/USDT</button>
      <button class="pair-btn" onclick="selectTradePair(this,'ETHUSDT','ETH/USDT','Ethereum / USDT')">ETH/USDT</button>
      <button class="pair-btn" onclick="selectTradePair(this,'BNBUSDT','BNB/USDT','BNB / USDT')">BNB/USDT</button>
      <button class="pair-btn" onclick="selectTradePair(this,'SOLUSDT','SOL/USDT','Solana / USDT')">SOL/USDT</button>
      <button class="pair-btn" onclick="selectTradePair(this,'XRPUSDT','XRP/USDT','Ripple / USDT')">XRP/USDT</button>
    </div>
    <div class="price-info">
      <div>
        <div class="cur-price" id="tradePrice">$98,245.50</div>
        <div style="font-size:12px;color:var(--t2);margin-top:4px;" id="tradePairSub">Bitcoin / USDT</div>
      </div>
      <div class="price-chg pos" id="tradePriceChg">+2.45%</div>
    </div>
    <div class="chart-section">
      <div class="chart-hdr">
        <div class="chart-title">üìà <span id="tradePairLabel">BTC/USDT</span></div>
        <div class="status-badge"><span class="sdot"></span> LIVE</div>
      </div>
      <div class="tv-wrap"><div id="tv_chart_trade" style="height:420px;"></div></div>
    </div>
    <div class="ob-grid">
      <div class="ob-side">
        <div class="ob-title" style="color:var(--red);">üî¥ Asks ‚Äî Sell Orders</div>
        <div class="ob-hdr"><span>Price</span><span>Amount</span><span>Total</span></div>
        <div id="asksBox"></div>
      </div>
      <div class="ob-side">
        <div class="ob-title" style="color:var(--green);">üü¢ Bids ‚Äî Buy Orders</div>
        <div class="ob-hdr"><span>Price</span><span>Amount</span><span>Total</span></div>
        <div id="bidsBox"></div>
      </div>
    </div>

    <!-- AI SIGNALS -->
    <div class="chart-section">
      <div class="sec-title" style="margin-bottom:12px;">üéØ AI Trading Signals</div>
      <div id="signalsBox"></div>
    </div>

    <!-- TRADE FORM -->
    <div class="chart-section">
      <div class="sec-title" style="margin-bottom:16px;">üìã Place Order</div>
      <form id="tradeForm" onsubmit="return executeTrade(event)">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:18px;">
          <button type="button" id="buyBtn" onclick="setTradeType('buy')" style="padding:16px;border:1.5px solid var(--green);background:var(--gdim);color:var(--green);border-radius:8px;font-weight:700;font-size:15px;cursor:pointer;font-family:'Space Grotesk',sans-serif;">üìà BUY / LONG</button>
          <button type="button" id="sellBtn" onclick="setTradeType('sell')" style="padding:16px;border:1.5px solid var(--bdr);background:transparent;color:var(--t2);border-radius:8px;font-weight:700;font-size:15px;cursor:pointer;font-family:'Space Grotesk',sans-serif;">üìâ SELL / SHORT</button>
        </div>
        <div class="fg">
          <label>Trade Amount (USD)</label>
          <input type="number" id="tradeAmt" min="10" step="0.01" placeholder="Enter amount" required oninput="updatePosSize()">
          <div style="font-size:12px;color:var(--t2);margin-top:6px;">Available: <span id="tradeAvail" style="font-weight:700;color:var(--t1);font-family:'JetBrains Mono',monospace;">$0.00</span></div>
        </div>
        <div class="fg">
          <label>Leverage</label>
          <select id="tradeLeverage" onchange="updatePosSize()">
            <option value="1">1x ‚Äî No Leverage</option>
            <option value="2">2x Leverage</option>
            <option value="5">5x Leverage</option>
            <option value="10" selected>10x Leverage</option>
            <option value="20">20x Leverage</option>
            <option value="50">50x Leverage</option>
            <option value="100">100x ‚Äî High Risk</option>
          </select>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:18px;">
          <div class="fg" style="margin:0;"><label>Take Profit ($)</label><input type="number" id="tradeTP" placeholder="Optional" step="0.01"></div>
          <div class="fg" style="margin:0;"><label>Stop Loss ($)</label><input type="number" id="tradeSL" placeholder="Optional" step="0.01"></div>
        </div>
        <div style="background:var(--bg3);border:1px solid var(--bdr);border-radius:12px;padding:16px;margin-bottom:18px;">
          <div style="font-size:12px;font-weight:700;color:var(--t2);text-transform:uppercase;letter-spacing:1px;margin-bottom:12px;">Order Summary</div>
          <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;">
            <div><div style="font-size:10px;color:var(--t2);margin-bottom:4px;">Entry Price</div><div style="font-size:14px;font-weight:700;font-family:'JetBrains Mono',monospace;" id="entryDisplay">$0.00</div></div>
            <div><div style="font-size:10px;color:var(--t2);margin-bottom:4px;">Position Size</div><div style="font-size:14px;font-weight:700;color:var(--green);font-family:'JetBrains Mono',monospace;" id="posDisplay">$0.00</div></div>
            <div><div style="font-size:10px;color:var(--t2);margin-bottom:4px;">Liquidation</div><div style="font-size:14px;font-weight:700;color:var(--red);font-family:'JetBrains Mono',monospace;" id="liqDisplay">‚Äî</div></div>
          </div>
        </div>
        <button type="submit" class="btn-submit" id="tradeSubmitBtn" style="background:linear-gradient(135deg,var(--green),#08A566);">üöÄ Execute Trade</button>
      </form>
    </div>

    <!-- OPEN POSITIONS -->
    <div class="chart-section">
      <div class="sec-title" style="margin-bottom:12px;">‚ö° Open Positions ‚Äî Live P&L</div>
      <div id="openPositions"><div style="text-align:center;padding:20px;color:var(--t2);font-size:13px;">No open positions. Place a trade above!</div></div>
    </div>

    <!-- RECENT TRADES -->
    <div class="chart-section">
      <div class="sec-title" style="margin-bottom:12px;">üìã Recent Trades</div>
      <div id="recentTradesMini" style="max-height:280px;overflow-y:auto;"></div>
    </div>
  </div>
</div>

<!-- ===== BOTS LAYER ===== -->
<div id="botsLayer" class="layer">
  <nav class="nav">
    <div class="logo" onclick="showLayer('dashboardLayer')"><div class="logo-icon">‚Çø</div>CryptoPro</div>
    <div class="nav-links"><button class="nbtn btn-login" onclick="showLayer('dashboardLayer')">‚Üê Dashboard</button></div>
  </nav>
  <div class="container">
    <div class="hero" style="padding:22px 28px;margin-bottom:20px;">
      <h1 style="font-size:34px;">ü§ñ AI Trading Bots</h1>
      <p style="margin-bottom:0;">Automate your trading 24/7. Profits while you sleep!</p>
    </div>
    <div class="winners-grid" id="botsGrid"></div>
    <div class="chart-section">
      <div class="sec-title">‚ö° Active Bots ‚Äî Live Performance</div>
      <div id="activeBotsBox"></div>
    </div>
    <div class="chart-section">
      <div class="sec-title" style="margin-bottom:12px;">üìà Bot Earnings Chart</div>
      <canvas id="botCanvas" style="width:100%;height:140px;border-radius:8px;"></canvas>
    </div>
    <div class="stats-grid" id="botStatsGrid"></div>
  </div>
</div>

<!-- ===== HISTORY LAYER ===== -->
<div id="historyLayer" class="layer">
  <nav class="nav">
    <div class="logo" onclick="showLayer('dashboardLayer')"><div class="logo-icon">‚Çø</div>CryptoPro</div>
    <div class="nav-links"><button class="nbtn btn-login" onclick="showLayer('dashboardLayer')">‚Üê Dashboard</button></div>
  </nav>
  <div class="container">
    <div class="hero" style="padding:22px 28px;margin-bottom:20px;">
      <h1 style="font-size:34px;">üìú Trade History</h1>
      <p style="margin-bottom:0;">Complete record of all your trading activity</p>
    </div>
    <div class="stats-grid" id="histStatsGrid"></div>
    <div class="chart-section"><div id="histContainer" style="max-height:650px;overflow-y:auto;"></div></div>
    <div class="chart-section" style="margin-top:16px;">
      <div class="sec-title" style="margin-bottom:14px;">üìä Trading Analytics</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:16px;">
        <div style="background:rgba(0,0,0,.3);padding:16px;border-radius:10px;text-align:center;"><div style="font-size:11px;color:var(--t2);text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px;">Best Trade</div><div style="font-size:22px;font-weight:900;color:var(--green);font-family:'JetBrains Mono',monospace;" id="bestTrade">$0.00</div></div>
        <div style="background:rgba(0,0,0,.3);padding:16px;border-radius:10px;text-align:center;"><div style="font-size:11px;color:var(--t2);text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px;">Worst Trade</div><div style="font-size:22px;font-weight:900;color:var(--red);font-family:'JetBrains Mono',monospace;" id="worstTrade">$0.00</div></div>
        <div style="background:rgba(0,0,0,.3);padding:16px;border-radius:10px;text-align:center;"><div style="font-size:11px;color:var(--t2);text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px;">Avg Win</div><div style="font-size:22px;font-weight:900;color:var(--green);font-family:'JetBrains Mono',monospace;" id="avgWin">$0.00</div></div>
        <div style="background:rgba(0,0,0,.3);padding:16px;border-radius:10px;text-align:center;"><div style="font-size:11px;color:var(--t2);text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px;">Avg Loss</div><div style="font-size:22px;font-weight:900;color:var(--red);font-family:'JetBrains Mono',monospace;" id="avgLoss">$0.00</div></div>
      </div>
      <canvas id="equityCanvas" style="width:100%;height:110px;border-radius:8px;"></canvas>
    </div>
  </div>
</div>

<!-- ===== WITHDRAWAL LAYER ===== -->
<div id="withdrawalLayer" class="layer">
  <nav class="nav">
    <div class="logo" onclick="showLayer('dashboardLayer')"><div class="logo-icon">‚Çø</div>CryptoPro</div>
    <div class="nav-links"><button class="nbtn btn-login" onclick="showLayer('dashboardLayer')">‚Üê Dashboard</button></div>
  </nav>
  <div class="container">
    <div class="hero" style="padding:22px 28px;margin-bottom:20px;">
      <h1 style="font-size:34px;">üí∏ Withdraw Funds</h1>
      <p style="margin-bottom:0;">Fast and secure ‚Äî processed within 5‚Äì30 minutes</p>
    </div>
    <div class="prog-wrap" id="wdProg">
      <div class="prog-lbl" id="wdProgLbl">‚è≥ Processing...</div>
      <div class="prog-track"><div class="prog-fill" id="wdProgFill"></div></div>
      <div class="prog-txt" id="wdProgTxt">0% complete</div>
    </div>
    <div class="chart-section">
      <div style="background:var(--gdim);border:1px solid rgba(14,203,129,.25);border-radius:12px;padding:20px;margin-bottom:20px;text-align:center;">
        <div style="font-size:12px;text-transform:uppercase;letter-spacing:2px;color:var(--t2);margin-bottom:8px;font-weight:700;">Available for Withdrawal</div>
        <div style="font-size:44px;font-weight:900;color:var(--green);font-family:'JetBrains Mono',monospace;letter-spacing:-2px;" id="wdAvail">$0.00</div>
      </div>
      <form id="withdrawForm" onsubmit="return processWithdrawal(event)">
        <div class="fg">
          <label>Amount (USD)</label>
          <input type="number" id="wdAmount" min="50" step="0.01" placeholder="Minimum $50" required>
          <div style="font-size:12px;color:var(--t2);margin-top:6px;">Min: $50 | Fee: 2%</div>
        </div>
        <!-- QUICK WITHDRAW % -->
        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px;">
          <span style="font-size:11px;color:var(--t2);font-weight:700;align-self:center;">Quick:</span>
          <button type="button" onclick="quickWd(25)" style="padding:5px 12px;background:var(--bg3);border:1px solid var(--bdr);border-radius:6px;color:var(--t2);font-size:12px;font-weight:600;cursor:pointer;font-family:'Space Grotesk',sans-serif;">25%</button>
          <button type="button" onclick="quickWd(50)" style="padding:5px 12px;background:var(--bg3);border:1px solid var(--bdr);border-radius:6px;color:var(--t2);font-size:12px;font-weight:600;cursor:pointer;font-family:'Space Grotesk',sans-serif;">50%</button>
          <button type="button" onclick="quickWd(75)" style="padding:5px 12px;background:var(--bg3);border:1px solid var(--bdr);border-radius:6px;color:var(--t2);font-size:12px;font-weight:600;cursor:pointer;font-family:'Space Grotesk',sans-serif;">75%</button>
          <button type="button" onclick="quickWd(100)" style="padding:5px 12px;background:var(--bg3);border:1px solid var(--bdr);border-radius:6px;color:var(--t2);font-size:12px;font-weight:600;cursor:pointer;font-family:'Space Grotesk',sans-serif;">100%</button>
        </div>
        <div class="fg">
          <label>Withdrawal Method</label>
          <div class="pay-grid">
            <button type="button" class="pay-btn" onclick="selectWd('mpesa',this)">üì± M-Pesa</button>
            <button type="button" class="pay-btn" onclick="selectWd('bank',this)">üè¶ Bank</button>
            <button type="button" class="pay-btn" onclick="selectWd('crypto',this)">ü™ô Crypto</button>
          </div>
        </div>
        <div id="wd-mpesa" class="pay-detail">
          <div class="fg"><label>M-Pesa Phone Number</label><input type="tel" id="wdMpesaPhone" placeholder="+254 712 345 678"></div>
          <div class="fg"><label>Full Name (as registered)</label><input type="text" id="wdMpesaName" placeholder="Your M-Pesa name"></div>
        </div>
        <div id="wd-bank" class="pay-detail">
          <div class="fg"><label>Bank Name</label><input type="text" id="wdBankName" placeholder="Your bank name"></div>
          <div class="fg"><label>Account Number</label><input type="text" id="wdAcctNum" placeholder="Account number"></div>
          <div class="fg"><label>Account Name</label><input type="text" id="wdAcctName" placeholder="Name on account"></div>
        </div>
        <div id="wd-crypto" class="pay-detail">
          <div class="fg"><label>USDT Wallet Address (TRC-20)</label><input type="text" id="wdCryptoAddr" placeholder="Your TRC-20 wallet address"></div>
          <div style="background:var(--rdim);border:1px solid rgba(246,70,93,.3);border-radius:10px;padding:12px;font-size:12px;color:var(--red);line-height:1.7;">‚ö†Ô∏è Only TRC-20. Wrong network = permanent loss.</div>
        </div>
        <div style="background:var(--gdim);border:1px solid rgba(14,203,129,.25);border-radius:12px;padding:16px;margin:16px 0;font-size:13px;color:var(--t1);line-height:1.9;">
          ‚ö° <strong>Processing:</strong> 5‚Äì30 minutes<br>
          üí≥ <strong>Fee:</strong> 2% of withdrawal<br>
          üîí <strong>Security:</strong> Manually verified
        </div>
        <button type="submit" class="btn-submit" style="background:linear-gradient(135deg,#8b5cf6,#7c3aed);color:#fff;">üí∏ Request Withdrawal</button>
      </form>
    </div>
  </div>
</div>

<!-- ===== REFERRAL LAYER ===== -->
<div id="referralLayer" class="layer">
  <nav class="nav">
    <div class="logo" onclick="showLayer('dashboardLayer')"><div class="logo-icon">‚Çø</div>CryptoPro</div>
    <div class="nav-links"><button class="nbtn btn-login" onclick="showLayer('dashboardLayer')">‚Üê Dashboard</button></div>
  </nav>
  <div class="container">
    <div class="hero" style="padding:22px 28px;margin-bottom:20px;">
      <h1 style="font-size:34px;">üéÅ Referral Program</h1>
      <p style="margin-bottom:0;">Earn 10% commission + $5 per share ‚Äî for life!</p>
    </div>
    <div class="stats-grid">
      <div class="stat-card"><div class="stat-icon">üë•</div><div class="stat-val" id="refTotal">0</div><div class="stat-lbl">Total Referrals</div></div>
      <div class="stat-card"><div class="stat-icon">üí∞</div><div class="stat-val" id="refComm">$0.00</div><div class="stat-lbl">Commission Earned</div></div>
      <div class="stat-card"><div class="stat-icon">üì¢</div><div class="stat-val" id="refShares">0</div><div class="stat-lbl">Total Shares</div></div>
      <div class="stat-card"><div class="stat-icon">üíµ</div><div class="stat-val" id="refShareEarnings">$0.00</div><div class="stat-lbl">Share Earnings</div></div>
    </div>
    <div class="chart-section">
      <div class="sec-title">Your Referral Link</div>
      <div style="background:var(--gdim);border:1.5px solid rgba(14,203,129,.25);border-radius:12px;padding:18px;margin-bottom:20px;">
        <div class="pay-val" style="margin:0 0 12px 0;font-size:13px;" id="refLink">https://cryptopro.app/ref/XXXXX</div>
        <button class="copy-btn" onclick="copyRefLink()">üìã Copy Referral Link</button>
      </div>
      <div class="sec-title">Share & Earn $5 Each:</div>
      <div class="action-btns">
        <button class="action-btn" style="background:linear-gradient(135deg,#25D366,#128C7E);color:#fff;" onclick="shareWA()">üí¨ WhatsApp (+$5)</button>
        <button class="action-btn" style="background:linear-gradient(135deg,#0088cc,#006699);color:#fff;" onclick="shareTG()">‚úàÔ∏è Telegram (+$5)</button>
        <button class="action-btn" style="background:linear-gradient(135deg,#1877f2,#0d5dbf);color:#fff;" onclick="shareFB()">üìò Facebook (+$5)</button>
        <button class="action-btn" style="background:linear-gradient(135deg,#1da1f2,#0c85d0);color:#fff;" onclick="shareTW()">üê¶ Twitter (+$5)</button>
      </div>
      <div style="background:rgba(252,213,53,.08);border:1px solid rgba(252,213,53,.25);border-radius:12px;padding:20px;margin-top:16px;">
        <div style="font-size:16px;font-weight:700;color:var(--yellow);margin-bottom:14px;">üíé Referral Benefits</div>
        <div style="font-size:13px;color:var(--t1);line-height:2.1;">
          ‚úÖ <strong>10% Commission</strong> on every deposit<br>
          ‚úÖ <strong>Lifetime Earnings</strong> ‚Äî no expiry<br>
          ‚úÖ <strong>$25 Bonus</strong> for each signup<br>
          ‚úÖ <strong>$5 Per Share</strong> ‚Äî unlimited<br>
          ‚úÖ <strong>Instant Credits</strong> ‚Äî no waiting
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ===== REVIEWS LAYER ===== -->
<div id="reviewsLayer" class="layer">
  <nav class="nav">
    <div class="logo" onclick="showLayer('welcomeLayer')"><div class="logo-icon">‚Çø</div>CryptoPro</div>
    <div class="nav-links"><button class="nbtn btn-signup" onclick="showLayer('signupLayer')">Sign Up Free</button></div>
  </nav>
  <div class="container">
    <div class="hero" style="padding:22px 28px;margin-bottom:20px;">
      <h1 style="font-size:34px;">‚≠ê User Reviews</h1>
      <p style="margin-bottom:0;">Real feedback from verified traders in 120+ countries</p>
    </div>
    <div style="background:var(--bg1);border:1px solid var(--bdr);border-radius:14px;padding:24px;margin-bottom:20px;text-align:center;">
      <div style="font-size:64px;font-weight:900;color:var(--yellow);font-family:'JetBrains Mono',monospace;line-height:1;">4.9</div>
      <div style="font-size:28px;margin:8px 0;">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
      <div style="font-size:14px;color:var(--t2);">Based on 2,847 verified reviews from 120+ countries</div>
    </div>
    <div class="winners-grid" id="reviewsGrid"></div>
  </div>
</div>

<!-- ===== PROFILE LAYER ===== -->
<div id="profileLayer" class="layer">
  <nav class="nav">
    <div class="logo" onclick="showLayer('dashboardLayer')"><div class="logo-icon">‚Çø</div>CryptoPro</div>
    <div class="nav-links"><button class="nbtn btn-login" onclick="showLayer('dashboardLayer')">‚Üê Dashboard</button></div>
  </nav>
  <div class="container">
    <div class="hero" style="padding:22px 28px;margin-bottom:20px;">
      <h1 style="font-size:34px;">‚öôÔ∏è Profile Settings</h1>
      <p style="margin-bottom:0;">Manage your account information and security</p>
    </div>
    <div class="chart-section">
      <form id="profileForm" onsubmit="return saveProfile(event)">
        <div class="fg"><label>Full Name</label><input type="text" id="profName" required></div>
        <div class="fg"><label>Email</label><input type="email" id="profEmail" required></div>
        <div class="fg"><label>Phone</label><input type="tel" id="profPhone" required></div>
        <div class="fg"><label>Country</label>
          <select id="profCountry">
            <option value="KE">üá∞üá™ Kenya</option><option value="NG">üá≥üá¨ Nigeria</option><option value="GH">üá¨üá≠ Ghana</option>
            <option value="ZA">üáøüá¶ South Africa</option><option value="TZ">üáπüáø Tanzania</option><option value="US">üá∫üá∏ United States</option>
            <option value="GB">üá¨üáß United Kingdom</option><option value="IN">üáÆüá≥ India</option><option value="AU">üá¶üá∫ Australia</option><option value="AE">üá¶üá™ UAE</option>
          </select>
        </div>
        <div style="background:var(--bg3);border:1px solid var(--bdr);border-radius:12px;padding:18px;margin-bottom:18px;">
          <div style="font-size:13px;font-weight:700;color:var(--t2);text-transform:uppercase;letter-spacing:1px;margin-bottom:14px;">üîí Change Password</div>
          <div class="fg" style="margin-bottom:12px;"><label>Current Password</label><input type="password" id="profCurPass" placeholder="Leave blank to keep unchanged"></div>
          <div class="fg" style="margin:0;"><label>New Password</label><input type="password" id="profNewPass" placeholder="Enter new password"></div>
        </div>
        <button type="submit" class="btn-submit">üíæ Save Profile</button>
      </form>
      <div style="margin-top:28px;padding-top:24px;border-top:1px solid var(--bdr);">
        <div class="sec-title">Account Information</div>
        <div style="background:var(--bg3);border-radius:12px;padding:16px;border:1px solid var(--bdr);">
          <div class="prof-row"><div style="font-size:12px;color:var(--t2);text-transform:uppercase;letter-spacing:.5px;font-weight:600;">Account ID</div><div style="font-size:13px;font-weight:700;font-family:'JetBrains Mono',monospace;" id="profID">‚Äî</div></div>
          <div class="prof-row"><div style="font-size:12px;color:var(--t2);text-transform:uppercase;letter-spacing:.5px;font-weight:600;">Member Since</div><div style="font-size:15px;font-weight:700;" id="profSince">‚Äî</div></div>
          <div class="prof-row"><div style="font-size:12px;color:var(--t2);text-transform:uppercase;letter-spacing:.5px;font-weight:600;">Verification</div><div class="verified">‚úì Fully Verified</div></div>
          <div class="prof-row"><div style="font-size:12px;color:var(--t2);text-transform:uppercase;letter-spacing:.5px;font-weight:600;">2FA Security</div><div style="display:inline-flex;align-items:center;gap:6px;padding:4px 12px;background:var(--gdim);border:1px solid rgba(14,203,129,.3);border-radius:20px;font-size:12px;font-weight:700;color:var(--green);">üîí Enabled</div></div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// ============================================================
// CONFIG
// ============================================================
const SERVER_URL = 'https://your-payment-server.com';
const EMAILJS_CFG = { SERVICE_ID:'service_p61trhq', TEMPLATE_ID:'template_14jwbju', PUBLIC_KEY:'wbl3XpIjAm_87c4Nl' };
const WALLETS = { 'USDT-TRC20':'TK4rUz6TUEd7zCWeuiX5R47pSNdPswJnAc','USDT-ERC20':'0xd4a2fd2b053cbe8d9c7cc2715173c61506f4833d','BTC':'14DZxGVHNKaX6WkwhKwq66B31VoUUNfqYZ','ETH':'0xd4a2fd2b053cbe8d9c7cc2715173c61506f4833d' };
const CURRENCY_RATES = { KE:{sym:'KSh',rate:130},NG:{sym:'‚Ç¶',rate:1580},GH:{sym:'GH‚Çµ',rate:15.2},ZA:{sym:'R',rate:19.1},TZ:{sym:'TSh',rate:2640},UG:{sym:'USh',rate:3820},US:{sym:'$',rate:1},GB:{sym:'¬£',rate:.79},DE:{sym:'‚Ç¨',rate:.92},IN:{sym:'‚Çπ',rate:83.4},AU:{sym:'A$',rate:1.53},AE:{sym:'ÿØ.ÿ•',rate:3.67},BR:{sym:'R$',rate:4.97},PH:{sym:'‚Ç±',rate:56.8} };

// ============================================================
// STATE
// ============================================================
let user=null,acct='demo',demoBalance=25,realBalance=0,demoProfit=0,realProfit=0,inTrades=0;
let tradeHistory=[],activeBots=[],openTrades=[],notifications=[],priceAlerts=[];
let refCount=0,commission=0,shares=0,shareEarnings=0;
let tradeType='buy',tradePair='BTCUSDT',chartPair='BTCUSDT';
let selectedPay=null,selectedWdMethod=null;
let cdSecs=86399,emailJSLoaded=false,tourShown=false;
let mpesaPollInterval=null,mpesaTimerInterval=null,stkRetries=0;
let botEarningsHistory=[0];

// ============================================================
// PRICES
// ============================================================
const prices = {
  BTCUSDT:{p:98245.50,ch:2.45,high:99120,low:96800,vol:'28.5B',open:97850},
  ETHUSDT:{p:3842.20,ch:-1.23,high:3920,low:3780,vol:'14.2B',open:3890},
  BNBUSDT:{p:612.80,ch:0.87,high:625,low:602,vol:'2.1B',open:607},
  SOLUSDT:{p:185.40,ch:4.12,high:192,low:178,vol:'5.8B',open:178},
  ADAUSDT:{p:0.9823,ch:-0.54,high:1.02,low:0.96,vol:'1.2B',open:0.988},
  XRPUSDT:{p:2.3410,ch:3.21,high:2.45,low:2.21,vol:'4.7B',open:2.269}
};

const tickerData=[
  {s:'BTC',p:'$98,245',c:'+2.45%',pos:true},{s:'ETH',p:'$3,842',c:'-1.23%',pos:false},
  {s:'BNB',p:'$612',c:'+0.87%',pos:true},{s:'SOL',p:'$185',c:'+4.12%',pos:true},
  {s:'ADA',p:'$0.98',c:'-0.54%',pos:false},{s:'XRP',p:'$2.34',c:'+3.21%',pos:true},
  {s:'DOT',p:'$9.82',c:'+1.45%',pos:true},{s:'LINK',p:'$18.75',c:'+2.11%',pos:true},
  {s:'AVAX',p:'$42.30',c:'+3.67%',pos:true},{s:'DOGE',p:'$0.182',c:'-1.02%',pos:false},
];

const worldTraders=[
  {name:'James Odhiambo',country:'üá∞üá™ Kenya',flag:'üá∞üá™',profit:'+$284',pair:'BTC/USDT',seed:'james'},
  {name:'Amara Diallo',country:'üá∏üá≥ Senegal',flag:'üá∏üá≥',profit:'+$156',pair:'ETH/USDT',seed:'amara'},
  {name:'Chidi Okeke',country:'üá≥üá¨ Nigeria',flag:'üá≥üá¨',profit:'+$420',pair:'SOL/USDT',seed:'chidi'},
  {name:'Grace Mwangi',country:'üá∞üá™ Kenya',flag:'üá∞üá™',profit:'+$198',pair:'BNB/USDT',seed:'grace'},
  {name:'Kofi Mensah',country:'üá¨üá≠ Ghana',flag:'üá¨üá≠',profit:'+$312',pair:'BTC/USDT',seed:'kofi'},
  {name:'Sarah Johnson',country:'üá∫üá∏ USA',flag:'üá∫üá∏',profit:'+$892',pair:'ETH/USDT',seed:'sarah'},
  {name:'Ahmed Al-Rashid',country:'üá¶üá™ UAE',flag:'üá¶üá™',profit:'+$1,890',pair:'BTC/USDT',seed:'ahmed'},
  {name:'Emma Schmidt',country:'üá©üá™ Germany',flag:'üá©üá™',profit:'+$934',pair:'BTC/USDT',seed:'emma'},
  {name:'Oliver Brown',country:'üá¨üáß UK',flag:'üá¨üáß',profit:'+$1,247',pair:'ETH/USDT',seed:'oliver'},
  {name:'Raj Patel',country:'üáÆüá≥ India',flag:'üáÆüá≥',profit:'+$678',pair:'BTC/USDT',seed:'raj'},
  {name:'Carlos Mendez',country:'üá≤üáΩ Mexico',flag:'üá≤üáΩ',profit:'+$567',pair:'BTC/USDT',seed:'carlos'},
  {name:'Jake Wilson',country:'üá¶üá∫ Australia',flag:'üá¶üá∫',profit:'+$756',pair:'BTC/USDT',seed:'jake'},
];

const winnersData=[
  {seed:'james_w',name:'James Odhiambo',loc:'Nairobi, Kenya üá∞üá™',joined:'Member since Jan 2024',profit:'$14,820',trades:'284',wr:'94%',rank:1,bg:'0ECB81'},
  {seed:'ahmed_w',name:'Ahmed Al-Rashid',loc:'Dubai, UAE üá¶üá™',joined:'Member since Dec 2023',profit:'$12,450',trades:'196',wr:'91%',rank:2,bg:'FCD535'},
  {seed:'oliver_w',name:'Oliver Brown',loc:'London, UK üá¨üáß',joined:'Member since Feb 2024',profit:'$11,230',trades:'167',wr:'89%',rank:3,bg:'00B8FF'},
  {seed:'emma_w',name:'Emma Schmidt',loc:'Berlin, Germany üá©üá™',joined:'Member since Mar 2024',profit:'$9,890',trades:'142',wr:'87%',rank:4,bg:'A855F7'},
  {seed:'raj_w',name:'Raj Patel',loc:'Mumbai, India üáÆüá≥',joined:'Member since Apr 2024',profit:'$8,540',trades:'128',wr:'85%',rank:5,bg:'0ECB81'},
  {seed:'kofi_w',name:'Kofi Mensah',loc:'Accra, Ghana üá¨üá≠',joined:'Member since May 2024',profit:'$7,120',trades:'110',wr:'83%',rank:6,bg:'FCD535'},
];

const reviewsData=[
  {seed:'mary_r',name:'Mary Njoroge',loc:'Nairobi, Kenya üá∞üá™',rating:5,date:'2 days ago',text:'Amazing! I started with $50 and within 2 weeks had $420 profit. The AI bots are incredible and M-Pesa withdrawals are instant!',profit:'+$370'},
  {seed:'ahmed_r',name:'Ahmed Al-Rashid',loc:'Dubai, UAE üá¶üá™',rating:5,date:'3 days ago',text:'Best platform I have used. The signals are very accurate. Made $890 last month trading BTC. Withdrawal to bank was instant!',profit:'+$890'},
  {seed:'sarah_r',name:'Sarah Johnson',loc:'New York, USA üá∫üá∏',rating:5,date:'4 days ago',text:'Incredible AI bots! The Scalper Pro bot has been running 2 weeks with 89% win rate. $1,240 profit this month alone!',profit:'+$1,240'},
  {seed:'kofi_r',name:'Kofi Mensah',loc:'Accra, Ghana üá¨üá≠',rating:5,date:'5 days ago',text:'CryptoPro is the real deal. I was skeptical at first but after seeing my friend withdraw GHS 15,000, I joined. No regrets!',profit:'+$580'},
  {seed:'raj_r',name:'Raj Patel',loc:'Mumbai, India üáÆüá≥',rating:5,date:'1 week ago',text:'From India and this platform works perfectly. Deposits via crypto are instant. Already made $678 this week alone!',profit:'+$678'},
  {seed:'oliver_r',name:'Oliver Brown',loc:'London, UK üá¨üáß',rating:5,date:'1 week ago',text:'Top-tier platform. The charts are professional grade, bots are reliable, and ARIA AI support is always available. 10/10!',profit:'+$1,247'},
];

const botData=[
  {id:'b1',name:'Scalper Pro',emoji:'‚ö°',desc:'High-frequency scalping. 50‚Äì100 micro-trades per day with tight stop losses for consistent profits.',wr:'91%',daily:'3‚Äì8%',min:'$50',risk:'Medium',color:'#0ECB81'},
  {id:'b2',name:'Trend Rider',emoji:'üèÑ',desc:'Follows major market trends. Best for bull/bear markets. Low risk, steady daily returns.',wr:'87%',daily:'2‚Äì5%',min:'$100',risk:'Low',color:'#00B8FF'},
  {id:'b3',name:'Arbitrage AI',emoji:'ü§ñ',desc:'Exploits price differences between exchanges in real-time. Near-zero risk, consistent profits.',wr:'96%',daily:'1‚Äì3%',min:'$200',risk:'Very Low',color:'#A855F7'},
  {id:'b4',name:'Swing Master',emoji:'üìä',desc:'Captures large swing moves. Holds positions 4‚Äì24 hours for bigger single-trade gains.',wr:'82%',daily:'5‚Äì15%',min:'$150',risk:'Med-High',color:'#FCD535'},
  {id:'b5',name:'Grid Bot',emoji:'üî≤',desc:'Places buy/sell orders in a grid pattern. Profits in sideways and ranging crypto markets.',wr:'88%',daily:'2‚Äì6%',min:'$100',risk:'Low',color:'#10b981'},
  {id:'b6',name:'Degen Bot',emoji:'üé∞',desc:'High-risk, high-reward. Trades volatile altcoins with 50‚Äì100x leverage for maximum returns.',wr:'68%',daily:'10‚Äì50%',min:'$500',risk:'Very High',color:'#ef4444'},
];

const aiSignalDB=[
  {pair:'BTC/USDT',dir:'BUY',tf:'15M',conf:87,why:'RSI Oversold + MACD Cross'},
  {pair:'ETH/USDT',dir:'BUY',tf:'1H',conf:81,why:'Golden Cross + Volume Surge'},
  {pair:'SOL/USDT',dir:'SELL',tf:'4H',conf:74,why:'Double Top + Bearish Div.'},
  {pair:'BNB/USDT',dir:'BUY',tf:'1H',conf:89,why:'Support Bounce + Bullish Pin'},
  {pair:'XRP/USDT',dir:'BUY',tf:'30M',conf:76,why:'Triangle Breakout + OBV'},
];

const winnerToasts=[
  {seed:'t1',name:'James O.',country:'üá∞üá™ Kenya',action:'just won BTC/USDT trade',amt:'+$284',bg:'0ECB81'},
  {seed:'t2',name:'Ahmed A.',country:'üá¶üá™ UAE',action:'withdrew to bank',amt:'$1,890',bg:'FCD535'},
  {seed:'t3',name:'Sarah J.',country:'üá∫üá∏ USA',action:'Scalper Bot earning',amt:'+$89/hr',bg:'00B8FF'},
  {seed:'t4',name:'Chidi O.',country:'üá≥üá¨ Nigeria',action:'won ETH/USDT',amt:'+$420',bg:'A855F7'},
  {seed:'t5',name:'Oliver B.',country:'üá¨üáß UK',action:'referred 5 friends',amt:'+$125',bg:'0ECB81'},
  {seed:'t6',name:'Emma S.',country:'üá©üá™ Germany',action:'Trend Bot profit',amt:'+$934',bg:'FCD535'},
  {seed:'t7',name:'Raj P.',country:'üáÆüá≥ India',action:'withdrew instantly',amt:'$678',bg:'00B8FF'},
  {seed:'t8',name:'Grace W.',country:'üá∞üá™ Kenya',action:'won 8 trades today',amt:'+$545',bg:'A855F7'},
];

const aiResp={
  bot:'ü§ñ For beginners I recommend **Trend Rider** üèÑ ‚Äî 87% win rate, low risk, min $100.\n\nFor faster returns try **Scalper Pro** ‚ö° ‚Äî 91% win rate, min $50.\n\nSafest option: **Arbitrage AI** with 96% win rate!',
  deposit:'üí∞ To deposit:\n\n1Ô∏è‚É£ Go to **Deposit** section\n2Ô∏è‚É£ Enter your amount (min $10)\n3Ô∏è‚É£ Choose M-Pesa, Crypto, or Bank\n4Ô∏è‚É£ M-Pesa: enter phone ‚Üí receive PIN prompt ‚Üí confirm!\n\nM-Pesa deposits credited INSTANTLY! üöÄ',
  btc:'üìà BTC Analysis:\n\nCurrent price: ~$98,245\nTrend: Bullish momentum\nKey resistance: $100,000\nKey support: $95,000\n\nOur AI signals show 73% probability of upward move in next 24hrs.',
  withdraw:'üí∏ Withdrawals are fast!\n\n‚ö° Processing: 5‚Äì30 minutes\nüí≥ Min: $50\nüìä Fee: 2%\n\nGo to **Withdraw** ‚Üí Enter amount ‚Üí Choose M-Pesa/Bank/Crypto ‚Üí Submit!\n\n‚ö†Ô∏è Only available on REAL account.',
  referral:'üéÅ Our referral program is amazing!\n\n‚úÖ 10% commission on every deposit\n‚úÖ $5 per share on social media\n‚úÖ $25 bonus for each signup\n‚úÖ Lifetime earnings ‚Äî no expiry!\n\nShare your link and start earning now! üöÄ',
  default:'üëã I\'m ARIA, your personal trading advisor.\n\nI can help with:\nüìà Market analysis\nü§ñ Bot recommendations\nüí∞ Deposit & withdrawal\nüéÅ Referral program\n‚ö° Trading strategies'
};

const recentDepsData=[
  {flag:'üá∞üá™',name:'James O.',amount:'$500',method:'M-Pesa',bonus:'+$500',time:'1 min ago'},
  {flag:'üá≥üá¨',name:'Chidi O.',amount:'$200',method:'Crypto',bonus:'+$200',time:'3 min ago'},
  {flag:'üá∫üá∏',name:'Sarah J.',amount:'$1,000',method:'Bank',bonus:'+$1,000',time:'5 min ago'},
  {flag:'üá¶üá™',name:'Ahmed A.',amount:'$2,000',method:'Crypto',bonus:'+$2,000',time:'8 min ago'},
  {flag:'üá¨üáß',name:'Oliver B.',amount:'$750',method:'Bank',bonus:'+$750',time:'11 min ago'},
  {flag:'üáÆüá≥',name:'Raj P.',amount:'$300',method:'Crypto',bonus:'+$300',time:'14 min ago'},
];

// ============================================================
// LAYER NAVIGATION
// ============================================================
function showLayer(id){
  document.querySelectorAll('.layer').forEach(l=>l.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  window.scrollTo(0,0);
  const aiBtn=document.getElementById('aiBtn');
  const loggedIn=['dashboardLayer','tradingLayer','botsLayer','historyLayer','withdrawalLayer','referralLayer','profileLayer','depositLayer'];
  if(aiBtn) aiBtn.style.display=loggedIn.includes(id)?'block':'none';
  if(id==='chartsLayer') setTimeout(()=>initTV('tv_chart_main',chartPair),300);
  if(id==='dashboardLayer'){updateDash();updateQuickStats();updateSentiment();setTimeout(()=>initTV('tv_chart_dash','BTCUSDT'),300);}
  if(id==='tradingLayer'){setTimeout(()=>initTV('tv_chart_trade',tradePair),300);updateTradeAvail();renderOrderBook();renderSignals();renderOpenPos();renderRecentMini();}
  if(id==='botsLayer') renderBots();
  if(id==='historyLayer') renderHistory();
  if(id==='withdrawalLayer') updateWdAvail();
  if(id==='referralLayer') updateRefStats();
  if(id==='profileLayer') populateProfile();
  if(id==='reviewsLayer') renderReviews();
  if(id==='depositLayer'){renderRecentDeps();setTimeout(updateDepConversion,200);}
}

// ============================================================
// EMAILJS
// ============================================================
function initEmailJS(){
  const s=document.createElement('script');
  s.src='https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js';
  s.onload=()=>{emailjs.init(EMAILJS_CFG.PUBLIC_KEY);emailJSLoaded=true;};
  document.head.appendChild(s);
}
async function sendEmail(params){
  if(!emailJSLoaded)return;
  try{await emailjs.send(EMAILJS_CFG.SERVICE_ID,EMAILJS_CFG.TEMPLATE_ID,params);}catch(e){console.warn('Email:',e);}
}

// ============================================================
// MARKET TICKER
// ============================================================
function renderTicker(){
  const track=document.getElementById('tickerTrack');
  if(!track)return;
  const items=[...tickerData,...tickerData];
  track.innerHTML=items.map(t=>`<div class="tick-item"><span class="tick-sym">${t.s}/USDT</span><span class="tick-price">${t.p}</span><span class="${t.pos?'pos':'neg'}">${t.c}</span></div>`).join('');
}

// ============================================================
// LIVE TRADERS TICKER
// ============================================================
function renderTradersTicker(){
  const c=document.getElementById('tradersTicker');
  if(!c)return;
  const doubled=[...worldTraders,...worldTraders];
  c.innerHTML=doubled.map(t=>`
    <div class="trader-card">
      <div class="trader-avatar"><img src="https://api.dicebear.com/7.x/personas/svg?seed=${t.seed}&backgroundColor=0ECB81" style="width:36px;height:36px;border-radius:50%;object-fit:cover;" onerror="this.parentElement.innerHTML='${t.flag}'"></div>
      <div><div style="font-size:13px;font-weight:600;">${t.name}</div><div style="font-size:11px;color:var(--t2);">${t.country} ‚Ä¢ ${t.pair}</div></div>
      <div class="trader-profit">${t.profit}</div>
    </div>`).join('');
}

// ============================================================
// TOP WINNERS
// ============================================================
function renderWinners(){
  const g=document.getElementById('winnersGrid');
  if(!g)return;
  g.innerHTML=winnersData.map(w=>`
    <div class="winner-card">
      <div class="winner-rank">#${w.rank}</div>
      <div class="winner-hdr">
        <img src="https://api.dicebear.com/7.x/personas/svg?seed=${w.seed}&backgroundColor=${w.bg}" class="w-avatar" alt="${w.name}" onerror="this.style.display='none'">
        <div><div class="w-name">${w.name}</div><div class="w-loc">üìç ${w.loc}</div><div class="w-join">${w.joined}</div></div>
      </div>
      <div class="w-stats">
        <div class="w-stat"><div class="w-stat-lbl">Total Profit</div><div class="w-stat-val">${w.profit}</div></div>
        <div class="w-stat"><div class="w-stat-lbl">Win Rate</div><div class="w-stat-val">${w.wr}</div></div>
        <div class="w-stat"><div class="w-stat-lbl">Trades</div><div class="w-stat-val">${w.trades}</div></div>
        <div class="w-stat"><div class="w-stat-lbl">Status</div><div class="w-stat-val" style="color:var(--green);font-size:13px;">üü¢ Live</div></div>
      </div>
    </div>`).join('');
}

// ============================================================
// REVIEWS
// ============================================================
function renderReviews(){
  const g=document.getElementById('reviewsGrid');
  if(!g)return;
  g.innerHTML=reviewsData.map(r=>`
    <div class="winner-card">
      <div class="winner-hdr">
        <img src="https://api.dicebear.com/7.x/personas/svg?seed=${r.seed}&backgroundColor=0ECB81" class="w-avatar" alt="${r.name}" onerror="this.style.display='none'">
        <div><div class="w-name">${r.name}</div><div class="w-loc">üìç ${r.loc}</div><div class="w-join">${r.date}</div></div>
        <div style="margin-left:auto;text-align:right;"><div style="color:var(--yellow);font-size:14px;">${'‚≠ê'.repeat(r.rating)}</div><div style="color:var(--green);font-size:15px;font-weight:700;font-family:'JetBrains Mono',monospace;margin-top:4px;">${r.profit}</div></div>
      </div>
      <div style="font-size:13px;color:var(--t1);line-height:1.6;padding:14px;background:rgba(0,0,0,.2);border-radius:8px;">"${r.text}"</div>
    </div>`).join('');
}

// ============================================================
// TRADINGVIEW CHART
// ============================================================
function initTV(containerId,symbol){
  const c=document.getElementById(containerId);
  if(!c||typeof TradingView==='undefined')return;
  c.innerHTML='';
  new TradingView.widget({
    autosize:true,symbol:`BINANCE:${symbol}`,interval:'D',timezone:'UTC',
    theme:'dark',style:'1',locale:'en',toolbar_bg:'#0D1421',
    enable_publishing:false,hide_top_toolbar:false,allow_symbol_change:true,
    save_image:false,container_id:containerId,backgroundColor:'#060B11',
    gridColor:'rgba(30,45,66,0.5)'
  });
}

function selectChartPair(btn,sym,label,sub){
  document.querySelectorAll('#chartPairs .pair-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active'); chartPair=sym;
  document.getElementById('chartPairLabel').textContent=label;
  document.getElementById('chartPairSub').textContent=sub;
  const d=prices[sym];
  if(d){
    document.getElementById('chartPrice').textContent=`$${d.p.toLocaleString()}`;
    const ce=document.getElementById('chartChange');
    ce.textContent=`${d.ch>0?'+':''}${d.ch}%`;
    ce.className=`price-chg ${d.ch>0?'pos':'neg'}`;
    document.getElementById('chartHigh').textContent=`$${d.high.toLocaleString()}`;
    document.getElementById('chartLow').textContent=`$${d.low.toLocaleString()}`;
    document.getElementById('chartVol').textContent=d.vol;
    document.getElementById('chartOpen').textContent=`$${d.open.toLocaleString()}`;
    document.getElementById('chartClose').textContent=`$${d.p.toLocaleString()}`;
    const c24=document.getElementById('chart24h');
    c24.textContent=`${d.ch>0?'+':''}${d.ch}%`;
    c24.style.color=d.ch>0?'var(--green)':'var(--red)';
  }
  initTV('tv_chart_main',sym);
}

function selectTradePair(btn,sym,label,sub){
  document.querySelectorAll('#tradePairs .pair-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active'); tradePair=sym;
  document.getElementById('tradePairLabel').textContent=label;
  document.getElementById('tradePairSub').textContent=sub;
  const d=prices[sym];
  if(d){
    document.getElementById('tradePrice').textContent=`$${d.p.toLocaleString()}`;
    const ce=document.getElementById('tradePriceChg');
    ce.textContent=`${d.ch>0?'+':''}${d.ch}%`;
    ce.className=`price-chg ${d.ch>0?'pos':'neg'}`;
    document.getElementById('entryDisplay').textContent=`$${d.p.toLocaleString()}`;
  }
  initTV('tv_chart_trade',sym);
  renderOrderBook();
}

// ============================================================
// PRICE TICKER ENGINE
// ============================================================
function startPriceTicker(){
  setInterval(()=>{
    Object.keys(prices).forEach(sym=>{
      const d=prices[sym];
      const vol=d.p*0.0008;
      d.p=Math.max(d.p*0.5,d.p+(Math.random()-.49)*vol);
      d.p=parseFloat(d.p.toFixed(sym.includes('ADA')||sym.includes('XRP')?4:2));
      d.ch=parseFloat((d.ch+(Math.random()-.5)*0.1).toFixed(2));
      d.high=Math.max(d.high,d.p);
      d.low=Math.min(d.low,d.p);
    });

    // Update trade layer
    if(document.getElementById('tradingLayer').classList.contains('active')){
      const d=prices[tradePair];
      const el=document.getElementById('tradePrice');
      if(el){
        const old=parseFloat(el.textContent.replace(/[$,]/g,''));
        el.textContent=`$${d.p.toLocaleString()}`;
        el.className='cur-price '+(d.p>old?'fu':'fd');
        setTimeout(()=>el.className='cur-price',600);
      }
      const ce=document.getElementById('tradePriceChg');
      if(ce){ce.textContent=`${d.ch>0?'+':''}${d.ch}%`;ce.className=`price-chg ${d.ch>0?'pos':'neg'}`;}
      document.getElementById('entryDisplay').textContent=`$${d.p.toLocaleString()}`;
      updatePosSize();
      if(openTrades.length>0)renderOpenPos();
    }

    // Update chart layer
    if(document.getElementById('chartsLayer').classList.contains('active')){
      const d=prices[chartPair];
      const el=document.getElementById('chartPrice');
      if(el){
        const old=parseFloat(el.textContent.replace(/[$,]/g,''));
        el.textContent=`$${d.p.toLocaleString()}`;
        el.className='cur-price '+(d.p>old?'fu':'fd');
        setTimeout(()=>el.className='cur-price',600);
      }
    }

    // Update ticker
    tickerData.forEach(t=>{
      const sym=t.s+'USDT';
      if(prices[sym]){
        t.p='$'+prices[sym].p.toLocaleString();
        t.c=(prices[sym].ch>0?'+':'')+prices[sym].ch+'%';
        t.pos=prices[sym].ch>0;
      }
    });
    renderTicker();

    // Bot earnings drip
    activeBots.forEach(b=>{
      const g=parseFloat((Math.random()*.6+.15).toFixed(2));
      b.earned=parseFloat((b.earned+g).toFixed(2));
      b.trades++;
      if(acct==='demo'){demoBalance=parseFloat((demoBalance+g).toFixed(2));demoProfit=parseFloat((demoProfit+g).toFixed(2));}
      else{realBalance=parseFloat((realBalance+g).toFixed(2));realProfit=parseFloat((realProfit+g).toFixed(2));}
    });

    // Update live dashboard
    if(document.getElementById('dashboardLayer').classList.contains('active')){
      updateDash();updateQuickStats();
      const btcEl=document.getElementById('dashBTC');
      const ethEl=document.getElementById('dashETH');
      const solEl=document.getElementById('dashSOL');
      if(btcEl)btcEl.textContent='$'+prices.BTCUSDT.p.toLocaleString();
      if(ethEl)ethEl.textContent='$'+prices.ETHUSDT.p.toLocaleString();
      if(solEl)solEl.textContent='$'+prices.SOLUSDT.p.toFixed(2);
    }

    updateRegionCounts();
  },2000);
}

// ============================================================
// REGION COUNTS
// ============================================================
function updateRegionCounts(){
  ['africaCount','americasCount','asiaCount','europeCount'].forEach(id=>{
    const el=document.getElementById(id);
    if(el){const b=parseInt(el.textContent.replace(/,/g,''));el.textContent=Math.max(1000,b+Math.floor(Math.random()*7)-3).toLocaleString();}
  });
}

// ============================================================
// ACTIVITY FEED
// ============================================================
const activityItems=[
  {flag:'üá∞üá™',name:'James K.',action:'just withdrew',amt:'$420',time:'2s ago'},
  {flag:'üá∫üá∏',name:'Sarah J.',action:'won a BTC trade',amt:'+$284',time:'5s ago'},
  {flag:'üá¶üá™',name:'Ahmed A.',action:'activated Scalper Bot',amt:'+$89/hr',time:'8s ago'},
  {flag:'üá≥üá¨',name:'Chidi O.',action:'deposited via M-Pesa',amt:'$500',time:'12s ago'},
  {flag:'üá¨üáß',name:'Oliver B.',action:'referred 3 friends',amt:'+$75',time:'15s ago'},
  {flag:'üáÆüá≥',name:'Raj P.',action:'just withdrew',amt:'$678',time:'19s ago'},
  {flag:'üá¨üá≠',name:'Kofi M.',action:'won ETH trade',amt:'+$156',time:'22s ago'},
  {flag:'üá©üá™',name:'Emma S.',action:'activated Trend Bot',amt:'+$45/hr',time:'28s ago'},
];
function updateActivityFeed(){
  const feed=document.getElementById('activityFeed');
  if(!feed)return;
  const shuffled=[...activityItems].sort(()=>Math.random()-.5).slice(0,5);
  feed.innerHTML=shuffled.map(a=>`
    <div style="display:flex;align-items:center;gap:8px;padding:5px 0;border-bottom:1px solid var(--bdr);">
      <span style="font-size:16px;">${a.flag}</span>
      <span style="font-size:12px;color:var(--t2);flex:1;"><strong style="color:var(--t1);">${a.name}</strong> ${a.action}</span>
      <span style="font-size:12px;font-weight:700;color:var(--green);font-family:'JetBrains Mono',monospace;">${a.amt}</span>
      <span style="font-size:10px;color:var(--t3);">${a.time}</span>
    </div>`).join('');
}

// ============================================================
// COUNTDOWN
// ============================================================
function startCountdown(){
  function tick(){
    cdSecs=Math.max(0,cdSecs-1);
    const h=Math.floor(cdSecs/3600),m=Math.floor((cdSecs%3600)/60),s=cdSecs%60;
    ['cdH'].forEach(id=>{const e=document.getElementById(id);if(e)e.textContent=String(h).padStart(2,'0');});
    ['cdM'].forEach(id=>{const e=document.getElementById(id);if(e)e.textContent=String(m).padStart(2,'0');});
    ['cdS'].forEach(id=>{const e=document.getElementById(id);if(e)e.textContent=String(s).padStart(2,'0');});
    if(cdSecs<=0)cdSecs=86399;
  }
  tick();setInterval(tick,1000);
}

function startViewCount(){
  let v=47;
  setInterval(()=>{
    v=Math.max(20,Math.min(120,v+Math.floor(Math.random()*7)-3));
    const el=document.getElementById('viewCount');if(el)el.textContent=v;
  },3000);
}

function startStatCounters(){
  let traders=50247,trds=15892;
  setInterval(()=>{
    traders+=Math.floor(Math.random()*5)-1;trds+=Math.floor(Math.random()*8);
    const st=document.getElementById('statTraders');if(st)st.textContent=traders.toLocaleString();
    const tt=document.getElementById('statTrades');if(tt)tt.textContent=trds.toLocaleString();
  },4000);
}

// ============================================================
// WINNER TOASTS
// ============================================================
let toastIdx=0;
function showWinnerToast(){
  const d=winnerToasts[toastIdx%winnerToasts.length];toastIdx++;
  const ex=document.getElementById('liveWinToast');if(ex)ex.remove();
  const t=document.createElement('div');
  t.className='win-toast';t.id='liveWinToast';
  t.innerHTML=`
    <img src="https://api.dicebear.com/7.x/personas/svg?seed=${d.seed}&backgroundColor=${d.bg}" class="wt-avatar" alt="${d.name}" onerror="this.src='https://api.dicebear.com/7.x/avataaars/svg?seed=${d.seed}'">
    <div><div class="wt-name">${d.name} <span style="font-size:11px;color:var(--t2);">${d.country}</span></div><div class="wt-amt">${d.amt}</div><div class="wt-action">${d.action}</div></div>`;
  document.body.appendChild(t);
  setTimeout(()=>{t.classList.add('hiding');setTimeout(()=>t.remove(),400);},4500);
}
function startWinToasts(){setTimeout(()=>{showWinnerToast();setInterval(showWinnerToast,7000);},3000);}

// ============================================================
// NOTIFICATIONS
// ============================================================
function initNotifs(){
  notifications=[
    {title:'üéâ Welcome Bonus Credited!',desc:'$25 has been added to your demo account.',time:'Just now'},
    {title:'üìà BTC just hit $98,245!',desc:'Bitcoin surged 2.45% in the last hour.',time:'2 min ago'},
    {title:'ü§ñ AI Signal: BUY ETH',desc:'Strong buy signal on ETH/USDT. Confidence: 84%',time:'5 min ago'},
  ];
  renderNotifs();
}
function renderNotifs(){
  const list=document.getElementById('notifList');
  const cnt=document.getElementById('notifCount');
  if(list)list.innerHTML=notifications.map(n=>`<div class="notif-item"><div class="notif-item-title">${n.title}</div><div class="notif-item-desc">${n.desc}</div><div class="notif-item-time">${n.time}</div></div>`).join('');
  if(cnt)cnt.textContent=notifications.length;
}
function toggleNotif(){document.getElementById('notifDD')?.classList.toggle('open');}
function clearNotif(){notifications=[];renderNotifs();document.getElementById('notifDD')?.classList.remove('open');}

// ============================================================
// AUTH
// ============================================================
const COUNTRY_NAMES={KE:'Kenya',NG:'Nigeria',GH:'Ghana',ZA:'South Africa',TZ:'Tanzania',UG:'Uganda',ET:'Ethiopia',EG:'Egypt',US:'United States',CA:'Canada',BR:'Brazil',MX:'Mexico',IN:'India',PH:'Philippines',PK:'Pakistan',AU:'Australia',GB:'United Kingdom',DE:'Germany',FR:'France',AE:'UAE'};
const COUNTRY_FLAGS={KE:'üá∞üá™',NG:'üá≥üá¨',GH:'üá¨üá≠',ZA:'üáøüá¶',TZ:'üáπüáø',UG:'üá∫üá¨',ET:'üá™üáπ',EG:'üá™üá¨',US:'üá∫üá∏',CA:'üá®üá¶',BR:'üáßüá∑',MX:'üá≤üáΩ',IN:'üáÆüá≥',PH:'üáµüá≠',PK:'üáµüá∞',AU:'üá¶üá∫',GB:'üá¨üáß',DE:'üá©üá™',FR:'üá´üá∑',AE:'üá¶üá™'};

function handleSignup(e){
  e.preventDefault();
  const name=document.getElementById('signupName').value.trim();
  const email=document.getElementById('signupEmail').value.trim();
  const phone=document.getElementById('signupPhone').value.trim();
  const country=document.getElementById('signupCountry').value;
  const pass=document.getElementById('signupPassword').value;
  const confirm=document.getElementById('signupConfirm').value;
  const ref=document.getElementById('signupRef').value.trim();
  const alertEl=document.getElementById('signupAlert');
  if(pass!==confirm){showAlert(alertEl,'Passwords do not match!','error');return false;}
  if(pass.length<6){showAlert(alertEl,'Password must be at least 6 characters.','error');return false;}
  user={id:'CP'+Date.now(),name,email,phone,country,countryName:COUNTRY_NAMES[country]||country,countryFlag:COUNTRY_FLAGS[country]||'üåç',password:pass,joinDate:new Date().toLocaleDateString('en-US',{month:'long',day:'numeric',year:'numeric'}),refCode:'CP'+Math.random().toString(36).substring(2,7).toUpperCase(),refBy:ref||null,seed:name.split(' ')[0].toLowerCase()};
  demoBalance=25;realBalance=0;demoProfit=0;realProfit=0;tradeHistory=[];activeBots=[];openTrades=[];refCount=0;commission=0;shares=0;shareEarnings=0;acct='demo';
  sendEmail({to_email:'youradmin@gmail.com',from_name:name,user_email:email,user_phone:phone,user_country:COUNTRY_NAMES[country]||country,subject:'üÜï New CryptoPro Signup',message:`New signup!\nName: ${name}\nEmail: ${email}\nPhone: ${phone}\nCountry: ${COUNTRY_NAMES[country]||country}\nRef: ${ref||'None'}\nID: ${user.id}`});
  showToast(`üéâ Welcome, ${name}! Your $25 bonus has been credited!`);
  triggerConfetti();showLayer('dashboardLayer');initNotifs();
  setTimeout(()=>showOnboarding(),2000);
  return false;
}

function handleLogin(e){
  e.preventDefault();
  const email=document.getElementById('loginEmail').value.trim();
  const pass=document.getElementById('loginPassword').value;
  const alertEl=document.getElementById('loginAlert');
  if(!user){
    user={id:'CP'+Date.now(),name:'Demo Trader',email,phone:'+254 712 345 678',country:'KE',countryName:'Kenya',countryFlag:'üá∞üá™',password:pass,joinDate:new Date().toLocaleDateString('en-US',{month:'long',day:'numeric',year:'numeric'}),refCode:'CP'+Math.random().toString(36).substring(2,7).toUpperCase(),seed:'trader'};
    demoBalance=25;realBalance=0;
  } else if(user.email!==email||user.password!==pass){showAlert(alertEl,'‚ùå Invalid email or password.','error');return false;}
  acct='demo';showToast(`üëã Welcome back, ${user.name}!`);showLayer('dashboardLayer');initNotifs();
  return false;
}

function handleLogout(){activeBots.forEach(b=>clearInterval(b.interval));activeBots=[];showToast('üëã Logged out.');showLayer('welcomeLayer');}

// ============================================================
// DASHBOARD
// ============================================================
function updateDash(){
  if(!user)return;
  const bal=acct==='demo'?demoBalance:realBalance;
  const profit=acct==='demo'?demoProfit:realProfit;
  document.getElementById('userName').textContent=user.name;
  document.getElementById('userEmail').textContent=user.email;
  document.getElementById('userCountry').textContent=`${user.countryFlag||'üåç'} ${user.countryName||''}`;
  document.getElementById('dashBalance').textContent=`$${bal.toFixed(2)}`;
  document.getElementById('dashAvail').textContent=`$${Math.max(0,bal-inTrades).toFixed(2)}`;
  document.getElementById('dashInTrades').textContent=`$${inTrades.toFixed(2)}`;
  document.getElementById('dashProfit').textContent=`$${profit.toFixed(2)}`;
  document.getElementById('acctTypeLbl').textContent=acct.toUpperCase();
  const av=document.getElementById('userAvatar');
  if(av)av.src=`https://api.dicebear.com/7.x/personas/svg?seed=${user.seed||'user'}&backgroundColor=0ECB81`;
  const ind=document.getElementById('acctIndicator');
  if(ind)ind.innerHTML=acct==='demo'?`<div style="background:rgba(252,213,53,.1);border:1px solid rgba(252,213,53,.3);border-radius:10px;padding:10px 16px;font-size:13px;color:var(--yellow);text-align:center;"><strong>üìä DEMO MODE</strong> ‚Äî Practice with virtual funds. Switch to REAL to trade with real money.</div>`:`<div style="background:var(--gdim);border:1px solid rgba(14,203,129,.3);border-radius:10px;padding:10px 16px;font-size:13px;color:var(--green);text-align:center;"><strong>üíé REAL ACCOUNT</strong> ‚Äî Trading with real funds. All profits fully withdrawable!</div>`;
}

function updateQuickStats(){
  const trades=tradeHistory.filter(t=>!t.type.includes('Deposit')&&!t.type.includes('Withdrawal'));
  const wins=trades.filter(t=>t.profit>0).length;
  const wr=trades.length>0?Math.round((wins/trades.length)*100):0;
  const wrEl=document.getElementById('dashWR');if(wrEl)wrEl.textContent=trades.length>0?wr+'%':'‚Äî';
  const ttEl=document.getElementById('dashTrades');if(ttEl)ttEl.textContent=trades.length;
  const abEl=document.getElementById('dashBots');if(abEl)abEl.textContent=activeBots.length;
  const drEl=document.getElementById('dashRefs');if(drEl)drEl.textContent=refCount;
}

function switchAcct(type){
  acct=type;
  document.getElementById('swDemo').classList.toggle('active',type==='demo');
  document.getElementById('swReal').classList.toggle('active',type==='real');
  updateDash();updateWdAvail();updateTradeAvail();
  if(type==='real'&&realBalance<50)showToast('üí∞ Fund your REAL account to start live trading! Min deposit: $10');
}

function updateSentiment(){
  const avg=(prices.BTCUSDT.ch+prices.ETHUSDT.ch)/2;
  let s,c,em;
  if(avg>2){s='Extreme Greed';c='var(--green)';em='üöÄ';}
  else if(avg>.5){s='Greed';c='#10b981';em='üìà';}
  else if(avg>-.5){s='Neutral';c='var(--yellow)';em='üòê';}
  else if(avg>-2){s='Fear';c='#f97316';em='üò®';}
  else{s='Extreme Fear';c='var(--red)';em='üò±';}
  const el=document.getElementById('mktSentiment');
  if(el)el.innerHTML=`${em} Market: <strong style="color:${c};">${s}</strong>`;
}

// ============================================================
// DEPOSIT
// ============================================================
function selectPay(method,btn){
  document.querySelectorAll('#depositForm .pay-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');selectedPay=method;
  document.querySelectorAll('.pay-detail').forEach(d=>d.classList.remove('active'));
  const el=document.getElementById(method);if(el)el.classList.add('active');
  updateDepConversion();
}
function quickDep(amt){const el=document.getElementById('depAmount');if(el){el.value=amt;updateDepConversion();}}
function updateDepConversion(){
  const amt=parseFloat(document.getElementById('depAmount')?.value||0);
  const c=document.getElementById('depConversionBox');
  if(!c||!amt||amt<=0){if(c)c.innerHTML='';return;}
  const country=user?.country||'US';
  const rate=CURRENCY_RATES[country]||CURRENCY_RATES['US'];
  const local=(amt*rate.rate).toFixed(rate.rate>=100?0:2);
  c.innerHTML=`<div style="background:rgba(14,203,129,.07);border:1px solid rgba(14,203,129,.2);border-radius:10px;padding:14px;margin-bottom:16px;"><div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;text-align:center;"><div><div style="font-size:10px;color:var(--t2);text-transform:uppercase;letter-spacing:.5px;margin-bottom:3px;">You Pay</div><div style="font-size:16px;font-weight:700;font-family:'JetBrains Mono',monospace;">$${amt.toFixed(2)}</div><div style="font-size:11px;color:var(--t3);margin-top:2px;">${rate.sym}${parseInt(local).toLocaleString()}</div></div><div><div style="font-size:10px;color:var(--t2);text-transform:uppercase;letter-spacing:.5px;margin-bottom:3px;">+100% Bonus</div><div style="font-size:16px;font-weight:700;color:var(--yellow);font-family:'JetBrains Mono',monospace;">+$${amt.toFixed(2)}</div><div style="font-size:11px;color:var(--t3);margin-top:2px;">FREE!</div></div><div><div style="font-size:10px;color:var(--t2);text-transform:uppercase;letter-spacing:.5px;margin-bottom:3px;">Total Credit</div><div style="font-size:16px;font-weight:700;color:var(--green);font-family:'JetBrains Mono',monospace;">$${(amt*2).toFixed(2)}</div></div></div></div>`;
}

function processDeposit(e){
  e.preventDefault();
  const amt=parseFloat(document.getElementById('depAmount').value);
  if(!amt||amt<10){showToast('Minimum deposit is $10','error');return false;}
  if(!selectedPay){showToast('Please select a payment method','error');return false;}
  if(selectedPay==='mpesa') handleMpesa(amt);
  else if(selectedPay==='crypto') handleCrypto(amt);
  else if(selectedPay==='bank') handleBank(amt);
  return false;
}

async function handleMpesa(amt){
  const phone=document.getElementById('mpesaPhone').value.trim();
  if(!phone){showToast('Please enter your M-Pesa phone number','error');return;}
  let p=phone.replace(/\s+/g,'').replace(/^\+/,'');
  if(p.startsWith('0'))p='254'+p.slice(1);
  if(!p.startsWith('254'))p='254'+p;
  const btn=document.getElementById('depSubmitBtn');
  btn.disabled=true;btn.textContent='‚è≥ Sending STK Push...';
  document.getElementById('stkPending').style.display='block';
  document.getElementById('stkSuccess').style.display='none';
  document.getElementById('stkError').style.display='none';
  showProg('depProg','depProgLbl','depProgFill','depProgTxt','üì≤ Sending M-Pesa STK Push...',30,5000);
  sendEmail({to_email:'youradmin@gmail.com',from_name:user?.name||'User',user_email:user?.email||'',user_phone:phone,user_country:user?.countryName||'',subject:`üí∞ M-Pesa Deposit ‚Äî $${amt}`,message:`Deposit attempt!\nUser: ${user?.name}\nEmail: ${user?.email}\nPhone: ${phone}\nAmount: $${amt}\nTime: ${new Date().toISOString()}`});
  try{
    const res=await fetch(`${SERVER_URL}/stk-push`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({phone:p,amount:Math.round(amt*130),userId:user?.id,usdAmount:amt})});
    const data=await res.json();
    if(data.success){startStkTimer(amt,data.checkoutRequestID);}
    else{showStkErr(data.message||'STK Push failed.');btn.disabled=false;btn.textContent='‚úÖ Submit Deposit';}
  }catch(err){simulateStk(amt);}
}

function simulateStk(amt){
  document.getElementById('stkPending').style.display='block';
  showProg('depProg','depProgLbl','depProgFill','depProgTxt','üì≤ STK Push sent! Check your phone...',60,15000);
  startStkCountdown(60);
  setTimeout(()=>completeStkSuccess(amt,'MPX'+Date.now()),12000);
}

function startStkTimer(amt,checkoutID){
  let secs=60;startStkCountdown(secs);stkRetries=0;
  mpesaPollInterval=setInterval(async()=>{
    stkRetries++;
    if(stkRetries>20){clearInterval(mpesaPollInterval);clearInterval(mpesaTimerInterval);showStkErr('Timeout. If you paid, contact support.');return;}
    try{
      const res=await fetch(`${SERVER_URL}/stk-status?checkoutRequestID=${checkoutID}`);
      const data=await res.json();
      if(data.status==='completed'){clearInterval(mpesaPollInterval);clearInterval(mpesaTimerInterval);completeStkSuccess(amt,data.mpesaReceipt||'MPX'+Date.now());}
      else if(data.status==='failed'||data.status==='cancelled'){clearInterval(mpesaPollInterval);clearInterval(mpesaTimerInterval);showStkErr('Payment cancelled.');}
    }catch(e){}
  },3000);
}

function startStkCountdown(secs){
  const el=document.getElementById('stkTimer');
  clearInterval(mpesaTimerInterval);
  mpesaTimerInterval=setInterval(()=>{secs--;if(el)el.textContent=secs;if(secs<=0)clearInterval(mpesaTimerInterval);},1000);
}

function completeStkSuccess(amt,receipt){
  const doubled=amt*2;
  if(acct==='demo')demoBalance+=doubled;else realBalance+=doubled;
  document.getElementById('stkPending').style.display='none';
  document.getElementById('stkSuccess').style.display='block';
  document.getElementById('stkReceipt').textContent=`‚úÖ Receipt: ${receipt} | $${amt}+$${amt} bonus = $${doubled} credited!`;
  showProg('depProg','depProgLbl','depProgFill','depProgTxt','‚úÖ Payment Confirmed!',100,500);
  const btn=document.getElementById('depSubmitBtn');btn.disabled=false;btn.textContent='‚úÖ Submit Deposit';
  showToast(`üéâ M-Pesa confirmed! $${doubled} credited (100% bonus)!`);
  triggerConfetti();updateDash();
  tradeHistory.unshift({type:'Deposit',pair:'M-Pesa',amount:doubled,profit:amt,time:new Date().toLocaleString(),status:'‚úÖ Confirmed',receipt});
  sendEmail({to_email:'youradmin@gmail.com',from_name:user?.name||'User',user_email:user?.email||'',user_phone:user?.phone||'',user_country:user?.countryName||'',subject:`‚úÖ MPESA CONFIRMED ‚Äî $${amt}`,message:`Confirmed!\nUser: ${user?.name}\nAmount: $${amt}\nReceipt: ${receipt}\nTotal: $${doubled}\nTime: ${new Date().toISOString()}`});
  showDepSuccessOverlay(amt,amt);
}

function showStkErr(msg){
  document.getElementById('stkPending').style.display='none';
  const e=document.getElementById('stkError');e.style.display='block';e.textContent='‚ùå '+msg;
  showToast(msg,'error');
}

function handleCrypto(amt){
  const tx=document.getElementById('cryptoTx').value.trim();
  const type=document.getElementById('cryptoType').value;
  if(!tx){showToast('Please enter transaction hash','error');return;}
  showProg('depProg','depProgLbl','depProgFill','depProgTxt','üîç Verifying blockchain...',0,8000);
  setTimeout(()=>{
    const doubled=amt*2;
    if(acct==='demo')demoBalance+=doubled;else realBalance+=doubled;
    showToast(`‚úÖ Crypto verified! $${doubled} credited!`);triggerConfetti();updateDash();
    tradeHistory.unshift({type:'Deposit',pair:type,amount:doubled,profit:amt,time:new Date().toLocaleString(),status:'‚úÖ Confirmed',receipt:tx.slice(0,12)+'...'});
    sendEmail({to_email:'youradmin@gmail.com',from_name:user?.name||'',user_email:user?.email||'',user_phone:user?.phone||'',user_country:user?.countryName||'',subject:`‚úÖ CRYPTO DEPOSIT ‚Äî $${amt}`,message:`Crypto deposit!\nUser: ${user?.name}\nAmount: $${amt}\nType: ${type}\nTX: ${tx}\nTotal: $${doubled}`});
  },8000);
}

function handleBank(amt){
  const ref=document.getElementById('bankRef').value.trim();
  if(!ref){showToast('Please enter bank reference','error');return;}
  showProg('depProg','depProgLbl','depProgFill','depProgTxt','üè¶ Verifying transfer...',0,5000);
  setTimeout(()=>{
    showToast(`üìã Bank transfer submitted! Ref: ${ref}. Credited within 1‚Äì2 hours.`);
    sendEmail({to_email:'youradmin@gmail.com',from_name:user?.name||'',user_email:user?.email||'',user_phone:user?.phone||'',user_country:user?.countryName||'',subject:`üè¶ BANK DEPOSIT ‚Äî $${amt}`,message:`Bank deposit!\nUser: ${user?.name}\nAmount: $${amt}\nRef: ${ref}`});
  },5000);
}

function updateCryptoWallet(){
  const type=document.getElementById('cryptoType').value;
  const el=document.getElementById('cryptoWallet');
  if(el)el.textContent=WALLETS[type]||WALLETS['USDT-TRC20'];
}
function copyCrypto(){const type=document.getElementById('cryptoType').value;copyText(WALLETS[type]||WALLETS['USDT-TRC20']);}

function renderRecentDeps(){
  const c=document.getElementById('recentDepsFeed');if(!c)return;
  c.innerHTML=recentDepsData.map(d=>`
    <div style="display:flex;align-items:center;gap:12px;padding:11px 0;border-bottom:1px solid var(--bdr);">
      <span style="font-size:22px;">${d.flag}</span>
      <div style="flex:1;"><div style="font-size:13px;font-weight:700;">${d.name} deposited <span style="color:var(--green);">${d.amount}</span></div><div style="font-size:11px;color:var(--t2);">${d.method} ¬∑ ${d.time}</div></div>
      <div style="text-align:right;"><div style="font-size:13px;font-weight:700;color:var(--yellow);">Bonus ${d.bonus}</div><div style="font-size:10px;color:var(--green);">‚úÖ Credited</div></div>
    </div>`).join('');
}

// ============================================================
// DEPOSIT SUCCESS OVERLAY
// ============================================================
function showDepSuccessOverlay(amt,bonus){
  setTimeout(()=>{
    const o=document.createElement('div');
    o.style.cssText='position:fixed;inset:0;background:rgba(6,11,17,.96);z-index:99999;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;animation:fadeUp .4s ease-out;padding:20px;';
    o.innerHTML=`<div style="font-size:72px;margin-bottom:16px;animation:pulse 1.5s infinite;">üéâ</div><div style="font-size:32px;font-weight:900;color:var(--green);margin-bottom:8px;">Payment Confirmed!</div><div style="font-size:18px;color:var(--t2);margin-bottom:24px;">Your deposit has been credited instantly</div><div style="display:flex;gap:20px;margin-bottom:28px;flex-wrap:wrap;justify-content:center;"><div style="background:rgba(14,203,129,.1);border:1px solid rgba(14,203,129,.3);border-radius:12px;padding:20px 28px;"><div style="font-size:11px;color:var(--t2);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px;">Deposit</div><div style="font-size:28px;font-weight:900;font-family:'JetBrains Mono',monospace;">$${amt.toFixed(2)}</div></div><div style="background:rgba(252,213,53,.1);border:1px solid rgba(252,213,53,.3);border-radius:12px;padding:20px 28px;"><div style="font-size:11px;color:var(--t2);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px;">100% Bonus</div><div style="font-size:28px;font-weight:900;color:var(--yellow);font-family:'JetBrains Mono',monospace;">+$${bonus.toFixed(2)}</div></div><div style="background:rgba(14,203,129,.15);border:2px solid var(--green);border-radius:12px;padding:20px 28px;"><div style="font-size:11px;color:var(--t2);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px;">Total Credited</div><div style="font-size:28px;font-weight:900;color:var(--green);font-family:'JetBrains Mono',monospace;">$${(amt+bonus).toFixed(2)}</div></div></div><button onclick="this.parentElement.remove();showLayer('dashboardLayer');" style="padding:16px 40px;background:linear-gradient(135deg,var(--green),#08A566);border:none;border-radius:12px;color:#000;font-size:17px;font-weight:700;cursor:pointer;font-family:'Space Grotesk',sans-serif;">üöÄ Start Trading Now</button>`;
    document.body.appendChild(o);triggerConfetti();
  },800);
}

// ============================================================
// TRADING
// ============================================================
function setTradeType(type){
  tradeType=type;
  const bb=document.getElementById('buyBtn'),sb=document.getElementById('sellBtn'),sub=document.getElementById('tradeSubmitBtn');
  if(type==='buy'){
    bb.style.cssText='padding:16px;border:1.5px solid var(--green);background:var(--gdim);color:var(--green);border-radius:8px;font-weight:700;font-size:15px;cursor:pointer;font-family:"Space Grotesk",sans-serif;';
    sb.style.cssText='padding:16px;border:1.5px solid var(--bdr);background:transparent;color:var(--t2);border-radius:8px;font-weight:700;font-size:15px;cursor:pointer;font-family:"Space Grotesk",sans-serif;';
    sub.style.background='linear-gradient(135deg,var(--green),#08A566)';sub.textContent='üöÄ Execute BUY Trade';
  } else {
    sb.style.cssText='padding:16px;border:1.5px solid var(--red);background:var(--rdim);color:var(--red);border-radius:8px;font-weight:700;font-size:15px;cursor:pointer;font-family:"Space Grotesk",sans-serif;';
    bb.style.cssText='padding:16px;border:1.5px solid var(--bdr);background:transparent;color:var(--t2);border-radius:8px;font-weight:700;font-size:15px;cursor:pointer;font-family:"Space Grotesk",sans-serif;';
    sub.style.background='linear-gradient(135deg,var(--red),#cc2244)';sub.textContent='üìâ Execute SELL Trade';
  }
}

function updatePosSize(){
  const amt=parseFloat(document.getElementById('tradeAmt')?.value||0);
  const lev=parseFloat(document.getElementById('tradeLeverage')?.value||1);
  const price=prices[tradePair]?.p||0;
  const pos=amt*lev;
  const liqPct=1/lev;
  const liq=tradeType==='buy'?price*(1-liqPct):price*(1+liqPct);
  const pd=document.getElementById('posDisplay');if(pd)pd.textContent=`$${pos.toFixed(2)}`;
  const ld=document.getElementById('liqDisplay');if(ld)ld.textContent=lev>1?`$${liq.toFixed(2)}`:'‚Äî';
  const ed=document.getElementById('entryDisplay');if(ed)ed.textContent=`$${price.toLocaleString()}`;
}

function updateTradeAvail(){
  const bal=acct==='demo'?demoBalance:realBalance;
  const el=document.getElementById('tradeAvail');if(el)el.textContent=`$${bal.toFixed(2)}`;
}

function executeTrade(e){
  e.preventDefault();
  const amt=parseFloat(document.getElementById('tradeAmt').value);
  const lev=parseFloat(document.getElementById('tradeLeverage').value);
  const bal=acct==='demo'?demoBalance:realBalance;
  if(!amt||amt<=0){showToast('Enter valid amount','error');return false;}
  if(amt>bal){showToast('Insufficient balance!','error');return false;}
  if(acct==='real'&&realBalance<50){showToast('üí∞ Deposit at least $50 to trade on REAL account.','error');return false;}
  const entry=prices[tradePair].p;
  const pair=tradePair.replace('USDT','/USDT');
  const tp=parseFloat(document.getElementById('tradeTP').value)||null;
  const sl=parseFloat(document.getElementById('tradeSL').value)||null;
  if(acct==='demo')demoBalance-=amt;else realBalance-=amt;
  inTrades+=amt;updateDash();updateTradeAvail();
  const tid='t'+Date.now();
  openTrades.push({id:tid,pair:tradePair,type:tradeType,amount:amt,leverage:lev,entry,tp,sl,open:Date.now()});
  renderOpenPos();
  showToast(`‚ö° ${tradeType.toUpperCase()} opened!\n${pair} @ $${entry.toLocaleString()}\nSize: $${(amt*lev).toFixed(2)} (${lev}x)`);
  const resTime=Math.floor(Math.random()*17000)+8000;
  setTimeout(()=>{
    const ot=openTrades.find(t=>t.id===tid);if(!ot)return;
    const exit=prices[tradePair].p;
    const priceDiff=(exit-entry)/entry;
    const leveraged=priceDiff*lev*(tradeType==='buy'?1:-1);
    let pnl=amt*(Math.random()<.54?1:-1)*Math.abs(leveraged);
    pnl=Math.max(-amt,Math.min(amt*lev*.4,pnl));
    pnl=parseFloat(pnl.toFixed(2));
    const won=pnl>0;
    inTrades-=amt;if(inTrades<0)inTrades=0;
    if(acct==='demo'){demoBalance+=amt+pnl;demoProfit+=pnl;}else{realBalance+=amt+pnl;realProfit+=pnl;}
    openTrades=openTrades.filter(t=>t.id!==tid);
    renderOpenPos();updateDash();updateTradeAvail();
    tradeHistory.unshift({type:tradeType==='buy'?'üìà BUY':'üìâ SELL',pair,amount:amt,leverage:lev,profit:pnl,entryPrice:entry,exitPrice:exit,time:new Date().toLocaleString(),status:won?'‚úÖ Win':'‚ùå Loss'});
    renderRecentMini();
    showToast(`${won?'üéâ Trade WON!':'üíî Trade closed!'}\n${pair} | ${tradeType.toUpperCase()} ${lev}x\nEntry: $${entry.toLocaleString()} ‚Üí Exit: $${exit.toLocaleString()}\nP&L: ${pnl>=0?'+':''}$${pnl}`);
    if(won){triggerConfetti();}
  },resTime);
  document.getElementById('tradeAmt').value='';
  document.getElementById('tradeTP').value='';
  document.getElementById('tradeSL').value='';
  return false;
}

function renderOpenPos(){
  const c=document.getElementById('openPositions');if(!c)return;
  if(openTrades.length===0){c.innerHTML='<div style="text-align:center;padding:20px;color:var(--t2);font-size:13px;">No open positions. Place a trade above!</div>';return;}
  c.innerHTML=openTrades.map(t=>{
    const cur=prices[t.pair]?.p||t.entry;
    const diff=(cur-t.entry)/t.entry;
    const pnl=t.amount*diff*t.leverage*(t.type==='buy'?1:-1);
    const pos=pnl>=0;
    return `<div style="background:var(--bg3);border:1px solid ${pos?'rgba(14,203,129,.3)':'rgba(246,70,93,.3)'};border-radius:10px;padding:14px;margin-bottom:8px;">
      <div style="display:flex;align-items:center;justify-content:space-between;">
        <div><span style="font-size:13px;font-weight:700;">${t.type==='buy'?'üìà':'üìâ'} ${t.pair.replace('USDT','/USDT')}</span><span style="font-size:11px;color:var(--t2);margin-left:8px;">${t.leverage}x</span></div>
        <div style="font-size:16px;font-weight:900;color:${pos?'var(--green)':'var(--red)'};font-family:'JetBrains Mono',monospace;">${pos?'+':''}$${pnl.toFixed(2)}</div>
      </div>
      <div style="display:flex;gap:16px;margin-top:6px;font-size:11px;color:var(--t2);font-family:'JetBrains Mono',monospace;">
        <span>Entry: $${t.entry.toLocaleString()}</span><span>Now: $${cur.toLocaleString()}</span><span>Size: $${(t.amount*t.leverage).toFixed(2)}</span>
      </div>
      <button onclick="closePos('${t.id}')" style="margin-top:8px;padding:5px 12px;background:var(--rdim);border:1px solid rgba(246,70,93,.3);border-radius:6px;color:var(--red);font-size:11px;font-weight:700;cursor:pointer;font-family:'Space Grotesk',sans-serif;">Close Position</button>
    </div>`;
  }).join('');
}

function closePos(id){
  const t=openTrades.find(x=>x.id===id);if(!t)return;
  const cur=prices[t.pair]?.p||t.entry;
  const diff=(cur-t.entry)/t.entry;
  const pnl=parseFloat((t.amount*diff*t.leverage*(t.type==='buy'?1:-1)).toFixed(2));
  inTrades-=t.amount;if(inTrades<0)inTrades=0;
  if(acct==='demo'){demoBalance+=t.amount+pnl;demoProfit+=pnl;}else{realBalance+=t.amount+pnl;realProfit+=pnl;}
  openTrades=openTrades.filter(x=>x.id!==id);
  tradeHistory.unshift({type:t.type==='buy'?'üìà BUY':'üìâ SELL',pair:t.pair.replace('USDT','/USDT'),amount:t.amount,leverage:t.leverage,profit:pnl,entryPrice:t.entry,exitPrice:cur,time:new Date().toLocaleString(),status:pnl>=0?'‚úÖ Win':'‚ùå Loss'});
  renderOpenPos();updateDash();renderRecentMini();
  showToast(`Position closed!\nP&L: ${pnl>=0?'+':''}$${pnl}`);
  if(pnl>0)triggerConfetti();
}

function renderRecentMini(){
  const c=document.getElementById('recentTradesMini');if(!c)return;
  const recent=tradeHistory.filter(t=>!t.type.includes('Deposit')&&!t.type.includes('Withdrawal')).slice(0,8);
  if(recent.length===0){c.innerHTML='<div style="text-align:center;padding:20px;color:var(--t2);font-size:13px;">No recent trades yet.</div>';return;}
  c.innerHTML=`<div style="display:grid;grid-template-columns:1fr 1fr 1fr 1fr 1fr;font-size:11px;color:var(--t2);text-transform:uppercase;letter-spacing:.5px;padding:8px 12px;border-bottom:1px solid var(--bdr);">
    <span>Type</span><span>Pair</span><span>Size</span><span>P&L</span><span>Status</span></div>`+
  recent.map(t=>`<div style="display:grid;grid-template-columns:1fr 1fr 1fr 1fr 1fr;padding:10px 12px;border-bottom:1px solid rgba(30,45,66,.5);font-size:12px;align-items:center;">
    <span>${t.type}</span><span style="color:var(--t2);">${t.pair}</span><span style="font-family:'JetBrains Mono',monospace;">$${t.amount?.toFixed(2)||'0'}</span>
    <span style="font-weight:700;color:${t.profit>=0?'var(--green)':'var(--red)'};font-family:'JetBrains Mono',monospace;">${t.profit>=0?'+':''}$${t.profit?.toFixed(2)||'0'}</span>
    <span>${t.status}</span></div>`).join('');
}

// ============================================================
// ORDER BOOK
// ============================================================
function renderOrderBook(){
  const price=prices[tradePair]?.p||98000;
  const asks=[],bids=[];
  for(let i=0;i<10;i++){
    const ap=price+(i+1)*price*.0003+Math.random()*price*.0002;
    const bp=price-(i+1)*price*.0003-Math.random()*price*.0002;
    const aa=(Math.random()*2+.1).toFixed(4);
    const ba=(Math.random()*2+.1).toFixed(4);
    asks.push({p:ap.toFixed(2),a:aa,t:(ap*parseFloat(aa)).toFixed(0)});
    bids.push({p:bp.toFixed(2),a:ba,t:(bp*parseFloat(ba)).toFixed(0)});
  }
  const maxA=Math.max(...asks.map(a=>parseFloat(a.t)));
  const maxB=Math.max(...bids.map(b=>parseFloat(b.t)));
  const asksEl=document.getElementById('asksBox');
  const bidsEl=document.getElementById('bidsBox');
  if(asksEl)asksEl.innerHTML=asks.map(a=>`<div class="ob-row ask-row"><div class="ob-bar" style="width:${(parseFloat(a.t)/maxA*100).toFixed(0)}%"></div><span class="ask-p">$${parseFloat(a.p).toLocaleString()}</span><span class="ob-amt">${a.a}</span><span class="ob-tot">$${parseInt(a.t).toLocaleString()}</span></div>`).join('');
  if(bidsEl)bidsEl.innerHTML=bids.map(b=>`<div class="ob-row bid-row"><div class="ob-bar" style="width:${(parseFloat(b.t)/maxB*100).toFixed(0)}%"></div><span class="bid-p">$${parseFloat(b.p).toLocaleString()}</span><span class="ob-amt">${b.a}</span><span class="ob-tot">$${parseInt(b.t).toLocaleString()}</span></div>`).join('');
}
setInterval(()=>{if(document.getElementById('tradingLayer').classList.contains('active'))renderOrderBook();},2500);

// ============================================================
// AI SIGNALS
// ============================================================
function renderSignals(){
  const c=document.getElementById('signalsBox');if(!c)return;
  c.innerHTML=aiSignalDB.map(s=>{
    const sym=s.pair.replace('/','');
    const price=prices[sym]?.p||0;
    const isBuy=s.dir==='BUY';
    const tp=price*(isBuy?1.025:.975);
    const sl=price*(isBuy?.982:1.018);
    return `<div style="background:var(--bg3);border:1px solid ${isBuy?'rgba(14,203,129,.25)':'rgba(246,70,93,.25)'};border-radius:12px;padding:16px;margin-bottom:10px;">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;">
        <div style="display:flex;align-items:center;gap:10px;">
          <div style="padding:4px 12px;background:${isBuy?'var(--gdim)':'var(--rdim)'};border-radius:6px;font-size:13px;font-weight:800;color:${isBuy?'var(--green)':'var(--red)'};">${s.dir}</div>
          <div><div style="font-size:14px;font-weight:700;">${s.pair}</div><div style="font-size:10px;color:var(--t2);">${s.tf} timeframe</div></div>
        </div>
        <div style="text-align:right;"><div style="font-size:13px;font-weight:700;color:${s.conf>=80?'var(--green)':s.conf>=70?'var(--yellow)':'var(--t2)'};">${s.conf}% confidence</div></div>
      </div>
      <div style="background:var(--bg2);border-radius:8px;height:6px;overflow:hidden;margin-bottom:10px;"><div style="height:100%;background:${isBuy?'var(--green)':'var(--red)'};border-radius:6px;width:${s.conf}%;"></div></div>
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:10px;">
        <div style="text-align:center;background:rgba(0,0,0,.3);padding:8px;border-radius:6px;"><div style="font-size:9px;color:var(--t2);text-transform:uppercase;margin-bottom:2px;">Entry</div><div style="font-size:12px;font-weight:700;font-family:'JetBrains Mono',monospace;">$${price.toLocaleString()}</div></div>
        <div style="text-align:center;background:rgba(14,203,129,.08);padding:8px;border-radius:6px;"><div style="font-size:9px;color:var(--t2);text-transform:uppercase;margin-bottom:2px;">Take Profit</div><div style="font-size:12px;font-weight:700;color:var(--green);font-family:'JetBrains Mono',monospace;">$${tp.toFixed(2)}</div></div>
        <div style="text-align:center;background:rgba(246,70,93,.08);padding:8px;border-radius:6px;"><div style="font-size:9px;color:var(--t2);text-transform:uppercase;margin-bottom:2px;">Stop Loss</div><div style="font-size:12px;font-weight:700;color:var(--red);font-family:'JetBrains Mono',monospace;">$${sl.toFixed(2)}</div></div>
      </div>
      <div style="font-size:11px;color:var(--t2);margin-bottom:10px;">üìä ${s.why}</div>
      <button onclick="applySignal('${s.pair}','${s.dir}')" style="width:100%;padding:9px;background:${isBuy?'linear-gradient(135deg,var(--green),#08A566)':'linear-gradient(135deg,var(--red),#cc2244)'};border:none;border-radius:8px;color:${isBuy?'#000':'#fff'};font-size:13px;font-weight:700;cursor:pointer;font-family:'Space Grotesk',sans-serif;">${isBuy?'üìà':'üìâ'} Trade This Signal</button>
    </div>`;
  }).join('');
}

function applySignal(pair,dir){
  const sym=pair.replace('/','');
  document.querySelectorAll('#tradePairs .pair-btn').forEach(btn=>{if(btn.textContent.trim()===pair)btn.click();});
  setTradeType(dir.toLowerCase());
  const form=document.getElementById('tradeForm');if(form)form.scrollIntoView({behavior:'smooth',block:'center'});
  showToast(`‚úÖ Signal applied! ${dir} ${pair} ‚Äî Enter amount and execute!`);
}

// ============================================================
// AI BOTS
// ============================================================
function renderBots(){
  const grid=document.getElementById('botsGrid');
  const active=document.getElementById('activeBotsBox');
  const statsGrid=document.getElementById('botStatsGrid');
  if(!grid)return;

  grid.innerHTML=botData.map(bot=>{
    const isActive=!!activeBots.find(b=>b.id===bot.id);
    return `<div class="bot-card">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px;">
        <div style="font-size:32px;">${bot.emoji}</div>
        <div><div style="font-size:16px;font-weight:700;">${bot.name}</div><div style="font-size:11px;color:${isActive?'var(--green)':'var(--t2)'};">${isActive?'üü¢ RUNNING':'‚ö´ Idle'}</div></div>
      </div>
      <div style="font-size:12px;color:var(--t2);margin-bottom:14px;line-height:1.5;">${bot.desc}</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:16px;">
        <div style="background:rgba(0,0,0,.3);padding:10px;border-radius:8px;text-align:center;"><div style="font-size:10px;color:var(--t2);margin-bottom:3px;">Win Rate</div><div style="font-size:16px;font-weight:700;color:${bot.color};">${bot.wr}</div></div>
        <div style="background:rgba(0,0,0,.3);padding:10px;border-radius:8px;text-align:center;"><div style="font-size:10px;color:var(--t2);margin-bottom:3px;">Daily Return</div><div style="font-size:16px;font-weight:700;color:var(--green);">${bot.daily}</div></div>
        <div style="background:rgba(0,0,0,.3);padding:10px;border-radius:8px;text-align:center;"><div style="font-size:10px;color:var(--t2);margin-bottom:3px;">Min Deposit</div><div style="font-size:16px;font-weight:700;">${bot.min}</div></div>
        <div style="background:rgba(0,0,0,.3);padding:10px;border-radius:8px;text-align:center;"><div style="font-size:10px;color:var(--t2);margin-bottom:3px;">Risk Level</div><div style="font-size:13px;font-weight:700;color:var(--yellow);">${bot.risk}</div></div>
      </div>
      <button onclick="toggleBot('${bot.id}')" style="width:100%;padding:12px;border:none;border-radius:8px;background:${isActive?'var(--rdim)':'linear-gradient(135deg,'+bot.color+','+bot.color+'cc)'};color:${isActive?'var(--red)':'#000'};border:${isActive?'1px solid rgba(246,70,93,.3)':'none'};font-weight:700;font-size:14px;cursor:pointer;font-family:'Space Grotesk',sans-serif;">
        ${isActive?'‚èπ Stop Bot':'‚ñ∂ Activate Bot'}
      </button>
    </div>`;
  }).join('');

  if(active){
    if(activeBots.length===0){active.innerHTML='<div style="text-align:center;padding:30px;color:var(--t2);">No active bots. Activate one above!</div>';}
    else{
      active.innerHTML=activeBots.map(b=>{
        const def=botData.find(d=>d.id===b.id);
        return `<div style="background:rgba(0,0,0,.3);border-radius:12px;padding:18px;margin-bottom:12px;border:1px solid rgba(14,203,129,.3);">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;">
            <div style="display:flex;align-items:center;gap:10px;"><span style="font-size:24px;">${def?.emoji||'ü§ñ'}</span>
              <div><div style="font-size:14px;font-weight:700;">${b.name}</div><div style="font-size:11px;color:var(--green);">üü¢ Running ‚Äî ${b.trades} trades</div></div>
            </div>
            <div style="text-align:right;"><div style="font-size:18px;font-weight:900;color:var(--green);font-family:'JetBrains Mono',monospace;">+$${b.earned.toFixed(2)}</div><div style="font-size:10px;color:var(--t2);">Total earned</div></div>
          </div>
          <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;">
            <div style="text-align:center;background:rgba(0,0,0,.2);padding:10px;border-radius:8px;"><div style="font-size:10px;color:var(--t2);text-transform:uppercase;margin-bottom:4px;">Win Rate</div><div style="font-size:18px;font-weight:900;color:var(--green);">${def?.wr||'‚Äî'}</div></div>
            <div style="text-align:center;background:rgba(0,0,0,.2);padding:10px;border-radius:8px;"><div style="font-size:10px;color:var(--t2);text-transform:uppercase;margin-bottom:4px;">Trades</div><div style="font-size:18px;font-weight:900;color:var(--blue);">${b.trades}</div></div>
            <div style="text-align:center;background:rgba(0,0,0,.2);padding:10px;border-radius:8px;"><div style="font-size:10px;color:var(--t2);text-transform:uppercase;margin-bottom:4px;">Daily Est.</div><div style="font-size:18px;font-weight:900;color:var(--yellow);">${def?.daily||'‚Äî'}</div></div>
          </div>
        </div>`;
      }).join('');
    }
  }

  if(statsGrid){
    const totalEarned=activeBots.reduce((s,b)=>s+b.earned,0);
    const totalTrades=activeBots.reduce((s,b)=>s+b.trades,0);
    statsGrid.innerHTML=`
      <div class="stat-card"><div class="stat-icon">ü§ñ</div><div class="stat-val">${activeBots.length}</div><div class="stat-lbl">Active Bots</div></div>
      <div class="stat-card"><div class="stat-icon">üí∞</div><div class="stat-val">$${totalEarned.toFixed(2)}</div><div class="stat-lbl">Bot Earnings</div></div>
      <div class="stat-card"><div class="stat-icon">‚ö°</div><div class="stat-val">${totalTrades}</div><div class="stat-lbl">Bot Trades</div></div>
      <div class="stat-card"><div class="stat-icon">üìà</div><div class="stat-val">${activeBots.length>0?'91%':'‚Äî'}</div><div class="stat-lbl">Avg Win Rate</div></div>`;
  }

  drawBotChart();
}

function toggleBot(botId){
  const idx=activeBots.findIndex(b=>b.id===botId);
  const def=botData.find(b=>b.id===botId);
  const bal=acct==='demo'?demoBalance:realBalance;
  if(idx>=0){activeBots.splice(idx,1);showToast(`‚èπ ${def.name} stopped.`);}
  else{
    const minDep=parseFloat(def.min.replace('$',''));
    if(bal<minDep){showToast(`üí∞ Min deposit ${def.min} required for ${def.name}`,'error');return;}
    activeBots.push({id:botId,name:def.name,earned:0,trades:0});
    showToast(`ü§ñ ${def.name} activated! Trading 24/7 automatically.`);
  }
  renderBots();
}

function drawBotChart(){
  const canvas=document.getElementById('botCanvas');if(!canvas)return;
  const ctx=canvas.getContext('2d');
  const w=canvas.width=canvas.offsetWidth||600,h=canvas.height=140;
  const data=botEarningsHistory;if(data.length<2)return;
  const maxV=Math.max(...data,1);
  const stepX=w/(data.length-1);
  const toY=v=>h-20-((v)/(maxV||1))*(h-30);
  ctx.clearRect(0,0,w,h);
  const grad=ctx.createLinearGradient(0,0,0,h);
  grad.addColorStop(0,'rgba(14,203,129,.35)');grad.addColorStop(1,'rgba(14,203,129,0)');
  ctx.beginPath();
  data.forEach((v,i)=>{const x=i*stepX,y=toY(v);i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);});
  ctx.lineTo(w,h);ctx.lineTo(0,h);ctx.closePath();ctx.fillStyle=grad;ctx.fill();
  ctx.beginPath();
  data.forEach((v,i)=>{const x=i*stepX,y=toY(v);i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);});
  ctx.strokeStyle='#0ECB81';ctx.lineWidth=2.5;ctx.lineJoin='round';ctx.stroke();
  const lx=(data.length-1)*stepX,ly=toY(data[data.length-1]);
  ctx.beginPath();ctx.arc(lx,ly,5,0,Math.PI*2);ctx.fillStyle='#0ECB81';ctx.fill();
}

// ============================================================
// HISTORY
// ============================================================
function renderHistory(){
  const c=document.getElementById('histContainer');
  const sg=document.getElementById('histStatsGrid');
  if(!c)return;
  const trades=tradeHistory.filter(t=>!t.type.includes('Deposit')&&!t.type.includes('Withdrawal'));
  const wins=trades.filter(t=>t.profit>0).length;
  const losses=trades.filter(t=>t.profit<0).length;
  const totalP=tradeHistory.reduce((s,t)=>s+(t.profit||0),0);
  if(sg)sg.innerHTML=`
    <div class="stat-card"><div class="stat-icon">üìä</div><div class="stat-val">${tradeHistory.length}</div><div class="stat-lbl">Total Trades</div></div>
    <div class="stat-card"><div class="stat-icon">‚úÖ</div><div class="stat-val">${wins}</div><div class="stat-lbl">Wins</div></div>
    <div class="stat-card"><div class="stat-icon">‚ùå</div><div class="stat-val">${losses}</div><div class="stat-lbl">Losses</div></div>
    <div class="stat-card"><div class="stat-icon">üí∞</div><div class="stat-val" style="color:${totalP>=0?'var(--green)':'var(--red)'};">$${totalP.toFixed(2)}</div><div class="stat-lbl">Total P&L</div></div>`;
  if(tradeHistory.length===0){c.innerHTML='<div style="text-align:center;padding:40px;color:var(--t2);">No trades yet. Start trading to see your history!</div>';return;}
  c.innerHTML=tradeHistory.map(t=>`
    <div class="hist-item">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
        <div style="display:flex;align-items:center;gap:10px;">
          <div style="font-size:20px;">${t.type.includes('BUY')?'üìà':t.type.includes('SELL')?'üìâ':t.type.includes('Deposit')?'üí∞':'üí∏'}</div>
          <div><div style="font-size:14px;font-weight:700;">${t.type} ‚Äî ${t.pair}</div><div style="font-size:11px;color:var(--t2);">${t.time}</div></div>
        </div>
        <div style="text-align:right;">
          <div style="font-size:16px;font-weight:700;color:${t.profit>=0?'var(--green)':'var(--red)'};">${t.profit>=0?'+':''}$${t.profit?.toFixed(2)||'0.00'}</div>
          <div style="font-size:12px;font-weight:600;margin-top:2px;">${t.status}</div>
        </div>
      </div>
      ${t.entryPrice?`<div style="display:flex;gap:16px;font-size:11px;color:var(--t2);font-family:'JetBrains Mono',monospace;">
        <span>Entry: $${parseFloat(t.entryPrice).toLocaleString()}</span>
        <span>Exit: $${parseFloat(t.exitPrice).toLocaleString()}</span>
        <span>Size: $${(t.amount*t.leverage).toFixed(2)} (${t.leverage}x)</span></div>`:''}
    </div>`).join('');

  // Analytics
  const bt=Math.max(0,...trades.map(t=>t.profit));
  const wt=Math.min(0,...trades.map(t=>t.profit));
  const aw=wins>0?trades.filter(t=>t.profit>0).reduce((s,t)=>s+t.profit,0)/wins:0;
  const al=losses>0?trades.filter(t=>t.profit<0).reduce((s,t)=>s+t.profit,0)/losses:0;
  const btEl=document.getElementById('bestTrade');if(btEl)btEl.textContent='+$'+bt.toFixed(2);
  const wtEl=document.getElementById('worstTrade');if(wtEl)wtEl.textContent='$'+wt.toFixed(2);
  const awEl=document.getElementById('avgWin');if(awEl)awEl.textContent='+$'+aw.toFixed(2);
  const alEl=document.getElementById('avgLoss');if(alEl)alEl.textContent='$'+al.toFixed(2);
  drawEquityCurve();
}

function drawEquityCurve(){
  const canvas=document.getElementById('equityCanvas');if(!canvas)return;
  const ctx=canvas.getContext('2d');
  const w=canvas.width=canvas.offsetWidth||400,h=canvas.height=110;
  let equity=[25];
  [...tradeHistory].reverse().forEach(t=>{if(t.profit!==undefined)equity.push(Math.max(0,equity[equity.length-1]+t.profit));});
  if(equity.length<2)equity=[25,25.5,26,27,26.5,28,30,29,32];
  const minE=Math.min(...equity)*.97,maxE=Math.max(...equity)*1.03,range=maxE-minE||1;
  const stepX=w/(equity.length-1);
  const toY=v=>h-((v-minE)/range)*h;
  ctx.clearRect(0,0,w,h);
  const grad=ctx.createLinearGradient(0,0,0,h);
  grad.addColorStop(0,'rgba(14,203,129,.3)');grad.addColorStop(1,'rgba(14,203,129,0)');
  ctx.beginPath();
  equity.forEach((v,i)=>{const x=i*stepX,y=toY(v);i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);});
  ctx.lineTo(w,h);ctx.lineTo(0,h);ctx.closePath();ctx.fillStyle=grad;ctx.fill();
  ctx.beginPath();
  equity.forEach((v,i)=>{const x=i*stepX,y=toY(v);i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);});
  ctx.strokeStyle='#0ECB81';ctx.lineWidth=2;ctx.stroke();
}

// ============================================================
// WITHDRAWAL
// ============================================================
function updateWdAvail(){
  const bal=acct==='demo'?demoBalance:realBalance;
  const el=document.getElementById('wdAvail');if(el)el.textContent=`$${bal.toFixed(2)}`;
}
function quickWd(pct){
  const bal=acct==='demo'?demoBalance:realBalance;
  const el=document.getElementById('wdAmount');if(el)el.value=((bal*pct)/100).toFixed(2);
}
function selectWd(method,btn){
  document.querySelectorAll('#withdrawForm .pay-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');selectedWdMethod=method;
  document.querySelectorAll('[id^="wd-"]').forEach(d=>d.classList.remove('active'));
  const el=document.getElementById(`wd-${method}`);if(el)el.classList.add('active');
}

function processWithdrawal(e){
  e.preventDefault();
  const amt=parseFloat(document.getElementById('wdAmount').value);
  const bal=acct==='demo'?demoBalance:realBalance;
  if(acct==='demo'){showToast('‚ö†Ô∏è Switch to REAL account to withdraw.','error');return false;}
  if(!amt||amt<50){showToast('Minimum withdrawal is $50','error');return false;}
  if(amt>bal){showToast('Insufficient balance','error');return false;}
  const method=document.querySelector('#withdrawForm .pay-btn.active')?.textContent.trim().split('\n')[0]||'your account';
  showProg('wdProg','wdProgLbl','wdProgFill','wdProgTxt','‚è≥ Processing withdrawal...',0,5000);
  setTimeout(()=>{
    realBalance-=amt;updateDash();updateWdAvail();
    tradeHistory.unshift({type:'Withdrawal',pair:method,amount:-amt,profit:-(amt*.02),time:new Date().toLocaleString(),status:'‚è≥ Processing',receipt:'WD'+Date.now()});
    showWdSuccessOverlay(amt,method);
    sendEmail({to_email:'youradmin@gmail.com',from_name:user?.name||'',user_email:user?.email||'',user_phone:user?.phone||'',user_country:user?.countryName||'',subject:`üí∏ WITHDRAWAL ‚Äî $${amt}`,message:`Withdrawal!\nUser: ${user?.name}\nAmount: $${amt}\nMethod: ${method}\nNet: $${(amt*.98).toFixed(2)}\nTime: ${new Date().toISOString()}`});
  },5000);
  return false;
}

function showWdSuccessOverlay(amt,method){
  const o=document.createElement('div');
  o.style.cssText='position:fixed;inset:0;background:rgba(6,11,17,.96);z-index:99999;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;animation:fadeUp .4s ease-out;padding:20px;';
  o.innerHTML=`<div style="font-size:64px;margin-bottom:16px;">üí∏</div><div style="font-size:28px;font-weight:900;color:var(--green);margin-bottom:8px;">Withdrawal Submitted!</div><div style="font-size:16px;color:var(--t2);margin-bottom:20px;">Processing in 5‚Äì30 minutes via ${method}</div><div style="background:rgba(14,203,129,.1);border:1px solid rgba(14,203,129,.3);border-radius:14px;padding:24px 36px;margin-bottom:28px;"><div style="font-size:12px;color:var(--t2);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px;">Amount</div><div style="font-size:40px;font-weight:900;color:var(--green);font-family:'JetBrains Mono',monospace;">$${(amt*.98).toFixed(2)}</div><div style="font-size:12px;color:var(--t3);margin-top:6px;">After 2% fee ¬∑ Ref: WD${Date.now()}</div></div><button onclick="this.parentElement.remove();showLayer('dashboardLayer');" style="padding:14px 36px;background:linear-gradient(135deg,#8b5cf6,#7c3aed);border:none;border-radius:12px;color:#fff;font-size:16px;font-weight:700;cursor:pointer;font-family:'Space Grotesk',sans-serif;">Back to Dashboard</button>`;
  document.body.appendChild(o);
}

// ============================================================
// REFERRAL
// ============================================================
function updateRefStats(){
  if(!user)return;
  document.getElementById('refLink').textContent=`https://cryptopro.app/ref/${user.refCode}`;
  document.getElementById('refTotal').textContent=refCount;
  document.getElementById('refComm').textContent=`$${commission.toFixed(2)}`;
  document.getElementById('refShares').textContent=shares;
  document.getElementById('refShareEarnings').textContent=`$${shareEarnings.toFixed(2)}`;
}
function copyRefLink(){copyText(`https://cryptopro.app/ref/${user?.refCode||'DEMO'}`);showToast('‚úÖ Referral link copied!');}
function creditShare(){shares++;shareEarnings+=5;if(acct==='demo')demoBalance+=5;else realBalance+=5;updateDash();updateRefStats();showToast(`üéâ +$5 share bonus credited!`);triggerConfetti();}
function shareWA(){const l=`https://cryptopro.app/ref/${user?.refCode||'DEMO'}`;const m=`üöÄ I'm earning daily with CryptoPro! Join now and get FREE $25 bonus!\n\n${l}`;window.open(`https://wa.me/?text=${encodeURIComponent(m)}`,'_blank');creditShare();}
function shareTG(){const l=`https://cryptopro.app/ref/${user?.refCode||'DEMO'}`;window.open(`https://t.me/share/url?url=${encodeURIComponent(l)}&text=${encodeURIComponent('üöÄ Join CryptoPro! Free $25 bonus!')}`,'_blank');creditShare();}
function shareFB(){const l=`https://cryptopro.app/ref/${user?.refCode||'DEMO'}`;window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(l)}`,'_blank');creditShare();}
function shareTW(){const l=`https://cryptopro.app/ref/${user?.refCode||'DEMO'}`;const m=`üöÄ I'm earning daily with @CryptoPro! FREE $25 bonus!\n${l}`;window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(m)}`,'_blank');creditShare();}

// ============================================================
// PROFILE
// ============================================================
function populateProfile(){
  if(!user)return;
  document.getElementById('profName').value=user.name||'';
  document.getElementById('profEmail').value=user.email||'';
  document.getElementById('profPhone').value=user.phone||'';
  document.getElementById('profCountry').value=user.country||'KE';
  document.getElementById('profID').textContent=user.id||'‚Äî';
  document.getElementById('profSince').textContent=user.joinDate||'‚Äî';
}
function saveProfile(e){
  e.preventDefault();if(!user)return false;
  user.name=document.getElementById('profName').value.trim();
  user.email=document.getElementById('profEmail').value.trim();
  user.phone=document.getElementById('profPhone').value.trim();
  user.country=document.getElementById('profCountry').value;
  user.seed=user.name.split(' ')[0].toLowerCase();
  const np=document.getElementById('profNewPass').value;
  const cp=document.getElementById('profCurPass').value;
  if(np){if(cp!==user.password){showToast('Current password incorrect','error');return false;}user.password=np;}
  updateDash();showToast('‚úÖ Profile updated!');return false;
}

// ============================================================
// AI ASSISTANT
// ============================================================
function toggleAI(){document.getElementById('aiPanel')?.classList.toggle('open');}
function sendAI(){
  const input=document.getElementById('aiInput');
  if(!input||!input.value.trim())return;
  const msg=input.value.trim();input.value='';
  appendAIMsg(msg,'user');showAITyping();
  setTimeout(()=>{removeAITyping();appendAIMsg(getAIResp(msg),'bot');},1000+Math.random()*800);
}
function sendAIQuick(msg){appendAIMsg(msg,'user');showAITyping();setTimeout(()=>{removeAITyping();appendAIMsg(getAIResp(msg),'bot');},900+Math.random()*600);}
function appendAIMsg(text,role){
  const c=document.getElementById('aiMsgs');if(!c)return;
  const d=document.createElement('div');d.className=`ai-msg ${role}`;
  d.innerHTML=text.replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>').replace(/\n/g,'<br>');
  c.appendChild(d);c.scrollTop=c.scrollHeight;
}
function showAITyping(){const c=document.getElementById('aiMsgs');if(!c)return;const t=document.createElement('div');t.className='ai-typing';t.id='aiTyping';t.innerHTML='<span></span><span></span><span></span>';c.appendChild(t);c.scrollTop=c.scrollHeight;}
function removeAITyping(){const t=document.getElementById('aiTyping');if(t)t.remove();}
function getAIResp(msg){
  const l=msg.toLowerCase();
  if(l.includes('bot')||l.includes('automat'))return aiResp.bot;
  if(l.includes('deposit')||l.includes('fund')||l.includes('pay'))return aiResp.deposit;
  if(l.includes('btc')||l.includes('bitcoin')||l.includes('price')||l.includes('predict'))return aiResp.btc;
  if(l.includes('withdraw')||l.includes('cash'))return aiResp.withdraw;
  if(l.includes('referral')||l.includes('invite')||l.includes('share')||l.includes('commission'))return aiResp.referral;
  if(l.includes('hello')||l.includes('hi')||l.includes('hey'))return `üëã Hello! I'm **ARIA**, your personal trading advisor!\n\nHow can I help you today?`;
  if(l.includes('profit')||l.includes('earn')||l.includes('money'))return `üí∞ With CryptoPro you can earn through:\n\nüìà **Manual Trading** ‚Äî up to 100x leverage\nü§ñ **AI Bots** ‚Äî 2‚Äì15% daily passively\nüéÅ **Referrals** ‚Äî $5 per share + 10% commissions\n\nTop traders earn $500‚Äì$2,000+ weekly!`;
  return aiResp.default;
}

// ============================================================
// PROGRESS BAR
// ============================================================
function showProg(wrapId,lblId,fillId,txtId,label,target,duration){
  const wrap=document.getElementById(wrapId);const lbl=document.getElementById(lblId);const fill=document.getElementById(fillId);const txt=document.getElementById(txtId);
  if(!wrap)return;wrap.classList.add('show');if(lbl)lbl.textContent=label;
  let pct=0;const step=target/(duration/100);
  const iv=setInterval(()=>{pct=Math.min(target,pct+step);if(fill)fill.style.width=pct+'%';if(txt)txt.textContent=Math.round(pct)+'% complete';if(pct>=target)clearInterval(iv);},100);
}

// ============================================================
// ONBOARDING TOUR
// ============================================================
function showOnboarding(){
  if(tourShown)return;tourShown=true;
  const steps=[
    {title:'üéâ Welcome to CryptoPro!',desc:`Hi ${user?.name?.split(' ')[0]||'Trader'}! Your $25 demo bonus is ready. Let's show you around.`},
    {title:'üí∞ Your Demo Balance',desc:'You have $25 in your DEMO account. Practice trading risk-free before switching to REAL mode.'},
    {title:'‚ö° Trade Live Markets',desc:'Tap "Trade Now" to trade BTC, ETH, SOL and more with up to 100x leverage in real-time.'},
    {title:'ü§ñ AI Bots Earn For You',desc:'Activate our AI bots to trade 24/7 automatically. Up to 96% win rate with zero effort.'},
    {title:'üéÅ Refer & Earn',desc:'Share your referral link and earn $5 per share + 10% commission on every deposit. Unlimited!'},
  ];
  let step=0;
  function show(){
    document.getElementById('tourOverlay')?.remove();
    if(step>=steps.length)return;
    const s=steps[step];
    const o=document.createElement('div');o.id='tourOverlay';
    o.style.cssText='position:fixed;bottom:90px;left:50%;transform:translateX(-50%);background:var(--bg3);border:1.5px solid var(--green);border-radius:16px;padding:20px 24px;max-width:340px;width:calc(100vw - 40px);z-index:9995;box-shadow:0 20px 50px rgba(0,0,0,.6);animation:fadeUp .3s ease-out;';
    o.innerHTML=`<div style="font-size:16px;font-weight:700;margin-bottom:8px;">${s.title}</div><div style="font-size:13px;color:var(--t2);line-height:1.6;margin-bottom:16px;">${s.desc}</div><div style="display:flex;justify-content:space-between;align-items:center;"><div style="font-size:11px;color:var(--t3);">Step ${step+1} of ${steps.length}</div><div style="display:flex;gap:8px;"><button onclick="document.getElementById('tourOverlay').remove();" style="padding:7px 14px;background:transparent;border:1px solid var(--bdr);border-radius:7px;color:var(--t2);font-size:12px;font-weight:600;cursor:pointer;font-family:'Space Grotesk',sans-serif;">Skip</button><button id="tourNext" style="padding:7px 18px;background:linear-gradient(135deg,var(--green),#08A566);border:none;border-radius:7px;color:#000;font-size:12px;font-weight:700;cursor:pointer;font-family:'Space Grotesk',sans-serif;">${step<steps.length-1?'Next ‚Üí':'Let\'s Go! üöÄ'}</button></div></div>`;
    document.body.appendChild(o);
    document.getElementById('tourNext').onclick=()=>{step++;if(step>=steps.length){o.remove();return;}show();};
  }
  setTimeout(show,1500);
}

// ============================================================
// TOAST & CONFETTI & CLIPBOARD
// ============================================================
function showToast(msg,type='success'){
  const t=document.getElementById('toast');if(!t)return;
  t.textContent=msg;t.className=`toast show${type==='error'?' err':''}`;
  clearTimeout(t._t);t._t=setTimeout(()=>t.className='toast',5000);
}
function showAlert(el,msg,type){if(!el)return;el.textContent=msg;el.className=`alert show alert-${type}`;setTimeout(()=>el.className='alert',4000);}
function triggerConfetti(){
  const colors=['#0ECB81','#00B8FF','#FCD535','#A855F7','#F6465D','#ffffff'];
  for(let i=0;i<60;i++){setTimeout(()=>{const p=document.createElement('div');p.style.cssText=`position:fixed;left:${Math.random()*100}vw;top:-20px;width:${Math.random()*10+6}px;height:${Math.random()*10+6}px;background:${colors[Math.floor(Math.random()*colors.length)]};animation:confettiFall ${Math.random()*2+2}s ease-in forwards;border-radius:2px;z-index:9999;pointer-events:none;`;document.body.appendChild(p);setTimeout(()=>p.remove(),4000);},i*40);}
}
function copyText(text){if(navigator.clipboard){navigator.clipboard.writeText(text).catch(()=>fbCopy(text));}else fbCopy(text);showToast('‚úÖ Copied!');}
function fbCopy(text){const ta=document.createElement('textarea');ta.value=text;ta.style.position='fixed';ta.style.opacity='0';document.body.appendChild(ta);ta.select();document.execCommand('copy');document.body.removeChild(ta);}

// ============================================================
// SESSION PERSISTENCE
// ============================================================
function saveSession(){
  try{sessionStorage.setItem('cps',JSON.stringify({user,acct,demoBalance,realBalance,demoProfit,realProfit,inTrades,tradeHistory:tradeHistory.slice(0,50),refCount,commission,shares,shareEarnings}));}catch(e){}
}
function loadSession(){
  try{const r=sessionStorage.getItem('cps');if(!r)return false;const s=JSON.parse(r);if(!s.user)return false;user=s.user;acct=s.acct||'demo';demoBalance=s.demoBalance||25;realBalance=s.realBalance||0;demoProfit=s.demoProfit||0;realProfit=s.realProfit||0;inTrades=s.inTrades||0;tradeHistory=s.tradeHistory||[];refCount=s.refCount||0;commission=s.commission||0;shares=s.shares||0;shareEarnings=s.shareEarnings||0;return true;}catch(e){return false;}
}

// ============================================================
// AI SIGNAL NOTIF
// ============================================================
let sigIdx=0;
function showAISignalNotif(){
  const s=aiSignalDB[sigIdx%aiSignalDB.length];sigIdx++;
  notifications.unshift({title:`ü§ñ AI Signal: ${s.dir} ${s.pair}`,desc:`${s.why}. Confidence: ${s.conf}%`,time:'Just now'});
  renderNotifs();
  if(['dashboardLayer','tradingLayer'].some(id=>document.getElementById(id)?.classList.contains('active'))){
    showToast(`ü§ñ AI Signal: ${s.dir} ${s.pair}\n${s.why}\nConfidence: ${s.conf}%`);
  }
}

// ============================================================
// KEYBOARD SHORTCUTS
// ============================================================
document.addEventListener('keydown',e=>{
  if(!document.getElementById('tradingLayer').classList.contains('active'))return;
  if(e.target.tagName==='INPUT'||e.target.tagName==='TEXTAREA')return;
  if(e.key==='b'||e.key==='B')setTradeType('buy');
  if(e.key==='s'||e.key==='S')setTradeType('sell');
  if(e.key==='Escape'){document.getElementById('aiPanel')?.classList.remove('open');document.getElementById('notifDD')?.classList.remove('open');document.getElementById('tourOverlay')?.remove();}
});

// ============================================================
// INIT
// ============================================================
window.addEventListener('DOMContentLoaded',()=>{
  // Try auto-login
  if(loadSession()){showLayer('dashboardLayer');initNotifs();}

  // Core
  renderTicker();renderTradersTicker();renderWinners();
  startCountdown();startViewCount();startStatCounters();
  startPriceTicker();startWinToasts();initEmailJS();
  updateActivityFeed();

  // Intervals
  setInterval(updateActivityFeed,5000);
  setInterval(updateSentiment,6000);
  setInterval(showAISignalNotif,45000);
  setInterval(()=>{
    const t=worldTraders[Math.floor(Math.random()*worldTraders.length)];
    const actions=['just withdrew','won a trade','activated a bot','deposited via M-Pesa','referred 3 friends'];
    const a=actions[Math.floor(Math.random()*actions.length)];
    const amt='$'+(Math.floor(Math.random()*19)+1)*50;
    recentDepsData.unshift({flag:t.flag,name:t.name.split(' ')[0]+' '+t.name.split(' ')[1]?.[0]+'.',amount:amt,method:['M-Pesa','Crypto','Bank'][Math.floor(Math.random()*3)],bonus:'+'+amt,time:'Just now'});
    if(recentDepsData.length>8)recentDepsData.pop();
    recentDepsData.forEach((d,i)=>{if(i>0)d.time=i*3<60?`${i*3} min ago`:`${Math.floor(i*3/60)} hr ago`;});
    if(document.getElementById('depositLayer').classList.contains('active'))renderRecentDeps();
  },9000);
  setInterval(()=>{
    const te=activeBots.reduce((s,b)=>s+b.earned,0);
    botEarningsHistory.push(parseFloat(te.toFixed(2)));
    if(botEarningsHistory.length>30)botEarningsHistory.shift();
    if(document.getElementById('botsLayer').classList.contains('active'))drawBotChart();
  },4000);
  setInterval(saveSession,10000);
  setInterval(()=>{
    if(document.getElementById('tradingLayer').classList.contains('active')){renderOpenPos();renderRecentMini();}
  },1500);

  // Outside click close
  document.addEventListener('click',e=>{
    const panel=document.getElementById('aiPanel');const btn=document.getElementById('aiBtn');
    const nw=document.getElementById('notifWrapper');const ndd=document.getElementById('notifDD');
    if(panel&&btn&&!panel.contains(e.target)&&!btn.contains(e.target))panel.classList.remove('open');
    if(nw&&ndd&&!nw.contains(e.target))ndd.classList.remove('open');
  });

  // Load TradingView
  const tv=document.createElement('script');tv.src='https://s3.tradingview.com/tv.js';tv.async=true;document.head.appendChild(tv);

  window.addEventListener('beforeunload',saveSession);
  console.log('[CryptoPro] ‚úÖ Platform fully loaded');
});
</script>
</body>
</html>
