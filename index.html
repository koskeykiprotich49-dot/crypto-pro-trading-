<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CryptoPro â€” Professional Trading Platform</title>
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=IBM+Plex+Mono:wght@400;500;600;700&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg0:#06080D;--bg1:#0C0F18;--bg2:#131825;--bg3:#1A2030;--bg4:#202840;
  --border:rgba(255,255,255,0.06);--border2:rgba(255,255,255,0.12);
  --green:#00E676;--green2:#00C853;--green3:rgba(0,230,118,0.08);
  --red:#FF3D57;--red2:rgba(255,61,87,0.08);
  --blue:#448AFF;--yellow:#FFD740;--purple:#AA77FF;--cyan:#00E5FF;
  --text1:#EDF2F7;--text2:#8892A4;--text3:#4A5568;
  --font-display:'Syne',sans-serif;--font-body:'DM Sans',sans-serif;
  --font-mono:'IBM Plex Mono',monospace;
  --r-sm:6px;--r-md:10px;--r-lg:16px;--r-xl:24px;
}
body{font-family:var(--font-body);background:var(--bg0);color:var(--text1);min-height:100vh;overflow-x:hidden;-webkit-font-smoothing:antialiased}
::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-track{background:var(--bg1)}
::-webkit-scrollbar-thumb{background:var(--bg4);border-radius:3px}
.layer{display:none;min-height:100vh;animation:layerFade .35s ease}
.layer.active{display:block}
@keyframes layerFade{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
@keyframes tickerMove{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}
@keyframes glow{0%,100%{box-shadow:0 0 8px rgba(0,230,118,.3)}50%{box-shadow:0 0 24px rgba(0,230,118,.7),0 0 48px rgba(0,230,118,.2)}}
@keyframes slideDown{from{opacity:0;transform:translateY(-12px)}to{opacity:1;transform:translateY(0)}}
@keyframes slideUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
@keyframes countUp{from{opacity:0;transform:scale(.88)}to{opacity:1;transform:scale(1)}}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes shimmer{0%{background-position:-200px 0}100%{background-position:calc(200px + 100%) 0}}
@keyframes tradeFlash{from{background:rgba(255,255,255,.05)}to{background:transparent}}
@keyframes ripple{0%{transform:scale(0);opacity:1}100%{transform:scale(4);opacity:0}}
.navbar{height:58px;background:rgba(6,8,13,0.98);backdrop-filter:blur(24px);border-bottom:1px solid var(--border);display:flex;align-items:center;padding:0 20px;gap:14px;position:sticky;top:0;z-index:1000}
.nav-logo{display:flex;align-items:center;gap:9px;cursor:pointer;text-decoration:none;flex-shrink:0}
.nav-logo-mark{width:32px;height:32px;background:linear-gradient(135deg,var(--green),var(--green2));border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:17px;font-weight:900;color:#000;font-family:var(--font-mono);animation:glow 4s ease-in-out infinite}
.nav-logo-text{font-family:var(--font-display);font-size:17px;font-weight:800;color:var(--text1);letter-spacing:-.3px}
.nav-logo-text span{color:var(--green)}
.nav-ticker{flex:1;overflow:hidden;mask-image:linear-gradient(to right,transparent,black 5%,black 95%,transparent)}
.nav-ticker-track{display:flex;gap:28px;animation:tickerMove 55s linear infinite;white-space:nowrap}
.nt-item{display:flex;align-items:center;gap:7px;font-family:var(--font-mono);font-size:11.5px;cursor:pointer}
.nt-item:hover .nt-price{color:var(--green)}
.nt-sym{color:var(--text2);font-weight:600}
.nt-price{color:var(--text1);font-weight:600;transition:color .2s}
.nt-chg{font-size:10.5px;padding:2px 6px;border-radius:4px;font-weight:700}
.nt-up{color:var(--green);background:var(--green3)}
.nt-dn{color:var(--red);background:var(--red2)}
.nav-right{display:flex;align-items:center;gap:8px;flex-shrink:0}
.live-badge{display:flex;align-items:center;gap:5px;padding:4px 10px;background:var(--green3);border:1px solid rgba(0,230,118,.2);border-radius:20px;font-size:11px;font-weight:700;color:var(--green);font-family:var(--font-mono)}
.live-dot{width:5px;height:5px;background:var(--green);border-radius:50%;animation:pulse 1.5s ease-in-out infinite;flex-shrink:0}
.btn{padding:8px 18px;border:none;border-radius:var(--r-md);font-size:13px;font-weight:600;cursor:pointer;transition:all .2s;font-family:var(--font-body);letter-spacing:.1px;position:relative;overflow:hidden}
.btn::after{content:'';position:absolute;inset:0;background:rgba(255,255,255,0);transition:background .2s}
.btn:hover::after{background:rgba(255,255,255,.05)}
.btn-outline{background:transparent;color:var(--text2);border:1px solid var(--border2)}
.btn-outline:hover{color:var(--text1);border-color:rgba(255,255,255,.25)}
.btn-green{background:var(--green);color:#000;font-weight:700}
.btn-green:hover{background:var(--green2);transform:translateY(-1px);box-shadow:0 4px 16px rgba(0,230,118,.3)}
.market-bar{background:var(--bg1);border-bottom:1px solid var(--border);padding:5px 0;overflow:hidden;mask-image:linear-gradient(to right,transparent,black 3%,black 97%,transparent)}
.market-bar-track{display:flex;gap:24px;animation:tickerMove 45s linear infinite;white-space:nowrap;padding:0 16px}
.mb-item{display:flex;align-items:center;gap:6px;font-size:11px;font-family:var(--font-mono);cursor:pointer}
.mb-sym{color:var(--text2);font-weight:600}
.mb-price{color:var(--text1)}
.mb-chg{font-size:11px;padding:1px 5px;border-radius:3px}
#toast{position:fixed;top:68px;right:20px;max-width:340px;background:var(--bg2);border:1px solid var(--border2);border-radius:var(--r-lg);padding:14px 18px;box-shadow:0 20px 60px rgba(0,0,0,.7);z-index:9999;display:none;animation:slideDown .3s ease;font-size:13px;line-height:1.6;white-space:pre-line}
#toast.show{display:block}
#toast.toast-green{border-left:3px solid var(--green)}
#toast.toast-red{border-left:3px solid var(--red)}
#toast.toast-blue{border-left:3px solid var(--blue)}
#toast.toast-yellow{border-left:3px solid var(--yellow)}
#refBanner{display:none;position:fixed;top:0;left:0;right:0;background:linear-gradient(90deg,#002b16,#004d2a,#002b16);border-bottom:1px solid rgba(0,230,118,.3);padding:16px 24px;z-index:9998;text-align:center;animation:slideDown .4s ease}
#refBanner.show{display:block}
.ref-close{position:absolute;top:50%;right:20px;transform:translateY(-50%);background:rgba(255,255,255,.1);border:none;color:#fff;width:28px;height:28px;border-radius:50%;cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center;transition:background .2s}
.ref-close:hover{background:rgba(255,255,255,.2)}
.ref-bonus-amt{font-size:30px;font-weight:900;color:var(--yellow);font-family:var(--font-mono);display:block;line-height:1}
.notif-bell{position:relative;width:36px;height:36px;background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-md);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s;font-size:16px;flex-shrink:0}
.notif-bell:hover{border-color:var(--border2);background:var(--bg3)}
.notif-count{position:absolute;top:-4px;right:-4px;width:16px;height:16px;background:var(--red);border-radius:50%;font-size:9px;font-weight:800;color:#fff;display:flex;align-items:center;justify-content:center;font-family:var(--font-mono)}
.notif-dropdown{position:absolute;top:100%;right:0;margin-top:8px;width:320px;background:var(--bg2);border:1px solid var(--border2);border-radius:var(--r-xl);box-shadow:0 24px 64px rgba(0,0,0,.7);z-index:1001;display:none;animation:slideDown .25s ease;overflow:hidden}
.notif-dropdown.open{display:block}
.notif-header{padding:14px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;font-size:13px;font-weight:700;font-family:var(--font-display)}
.notif-item{padding:12px 16px;border-bottom:1px solid var(--border);cursor:pointer;transition:background .15s;display:flex;gap:10px;align-items:flex-start}
.notif-item:hover{background:var(--bg3)}
.notif-item:last-child{border-bottom:none}
.notif-icon{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0}
.notif-text{font-size:12px;color:var(--text2);line-height:1.5}
.notif-text strong{color:var(--text1)}
.notif-time{font-size:10px;color:var(--text3);margin-top:2px}
.skeleton{background:linear-gradient(90deg,var(--bg2) 25%,var(--bg3) 50%,var(--bg2) 75%);background-size:400px 100%;animation:shimmer 1.4s ease-in-out infinite;border-radius:var(--r-sm)}
#welcomeLayer{background:var(--bg0)}
.hero{position:relative;padding:80px 40px 60px;text-align:center;overflow:hidden}
.hero::before{content:'';position:absolute;top:-200px;left:50%;transform:translateX(-50%);width:900px;height:900px;background:radial-gradient(ellipse,rgba(0,230,118,.06) 0%,transparent 70%);pointer-events:none}
.hero-grid{position:absolute;inset:0;background-image:linear-gradient(var(--border) 1px,transparent 1px),linear-gradient(90deg,var(--border) 1px,transparent 1px);background-size:40px 40px;mask-image:radial-gradient(ellipse 80% 60% at 50% 0%,black,transparent);opacity:.4}
.hero-tag{display:inline-flex;align-items:center;gap:6px;background:var(--green3);border:1px solid rgba(0,230,118,.2);border-radius:20px;padding:6px 14px;font-size:12px;font-weight:600;color:var(--green);font-family:var(--font-mono);margin-bottom:24px;animation:countUp .5s ease .1s both}
.hero-title{font-family:var(--font-display);font-size:clamp(36px,6vw,68px);font-weight:800;line-height:1.05;letter-spacing:-1.5px;margin-bottom:20px;animation:countUp .5s ease .2s both}
.hero-title .accent{color:var(--green)}
.hero-title .dim{color:var(--text2)}
.hero-sub{font-size:17px;color:var(--text2);max-width:560px;margin:0 auto 36px;line-height:1.65;font-weight:400;animation:countUp .5s ease .3s both}
.hero-cta{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;animation:countUp .5s ease .4s both}
.btn-hero-primary{padding:14px 32px;background:var(--green);color:#000;border:none;border-radius:var(--r-md);font-size:15px;font-weight:700;cursor:pointer;transition:all .25s;font-family:var(--font-display)}
.btn-hero-primary:hover{background:var(--green2);transform:translateY(-2px);box-shadow:0 8px 28px rgba(0,230,118,.35)}
.btn-hero-secondary{padding:14px 32px;background:transparent;color:var(--text1);border:1px solid var(--border2);border-radius:var(--r-md);font-size:15px;font-weight:600;cursor:pointer;transition:all .25s}
.btn-hero-secondary:hover{border-color:rgba(255,255,255,.3);background:var(--bg2)}
.stats-bar{display:flex;justify-content:center;border-top:1px solid var(--border);border-bottom:1px solid var(--border);background:var(--bg1);animation:countUp .5s ease .5s both}
.stat-item{flex:1;max-width:220px;padding:24px 20px;text-align:center;border-right:1px solid var(--border);transition:background .2s}
.stat-item:last-child{border-right:none}
.stat-item:hover{background:var(--bg2)}
.stat-val{font-family:var(--font-mono);font-size:26px;font-weight:700;color:var(--green);display:block;margin-bottom:4px}
.stat-lbl{font-size:12px;color:var(--text3);text-transform:uppercase;letter-spacing:.8px}
.traders-section{padding:32px 24px;border-bottom:1px solid var(--border)}
.section-header{display:flex;align-items:center;gap:10px;margin-bottom:16px}
.section-title{font-family:var(--font-display);font-size:14px;font-weight:700;color:var(--text2);text-transform:uppercase;letter-spacing:1px}
.section-badge{font-size:10px;padding:2px 8px;background:var(--red2);color:var(--red);border-radius:10px;font-weight:700;font-family:var(--font-mono);animation:pulse 2s infinite}
.traders-track-wrap{overflow:hidden;mask-image:linear-gradient(to right,transparent,black 4%,black 96%,transparent)}
.traders-track{display:flex;gap:12px;animation:tickerMove 80s linear infinite;white-space:nowrap}
.trader-chip{display:inline-flex;align-items:center;gap:10px;background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-md);padding:10px 16px;min-width:200px;transition:border-color .2s}
.trader-chip:hover{border-color:var(--border2)}
.trader-avatar{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,var(--green),var(--blue));display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0}
.trader-name{font-size:13px;font-weight:600;color:var(--text1)}
.trader-profit{font-size:13px;font-weight:700;color:var(--green);font-family:var(--font-mono)}
.trader-time{font-size:10px;color:var(--text3)}
.winners-section{padding:40px 24px;border-bottom:1px solid var(--border)}
.winners-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px;margin-top:20px}
.winner-card{background:var(--bg1);border:1px solid var(--border);border-radius:var(--r-xl);padding:20px;transition:all .25s;position:relative;overflow:hidden}
.winner-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--green),var(--cyan));opacity:0;transition:opacity .25s}
.winner-card:hover{border-color:var(--border2);transform:translateY(-3px);box-shadow:0 12px 36px rgba(0,0,0,.4)}
.winner-card:hover::before{opacity:1}
.winner-rank{position:absolute;top:14px;right:14px;width:28px;height:28px;background:var(--bg3);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:800;font-family:var(--font-mono);color:var(--yellow)}
.winner-head{display:flex;align-items:center;gap:12px;margin-bottom:16px}
.winner-ava{width:48px;height:48px;border-radius:50%;background:linear-gradient(135deg,var(--green3),rgba(0,229,255,.1));border:1px solid var(--border2);display:flex;align-items:center;justify-content:center;font-size:22px}
.winner-name{font-weight:700;font-size:15px}
.winner-loc{font-size:12px;color:var(--text2);margin-top:2px}
.winner-stats{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.winner-stat{background:var(--bg2);border-radius:var(--r-md);padding:10px 12px;text-align:center}
.ws-val{font-family:var(--font-mono);font-size:17px;font-weight:700;color:var(--green)}
.ws-lbl{font-size:10px;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;margin-top:2px}
.features-section{padding:48px 24px;border-bottom:1px solid var(--border)}
.features-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:16px;margin-top:24px}
.feature-card{background:var(--bg1);border:1px solid var(--border);border-radius:var(--r-xl);padding:24px;transition:all .25s;cursor:pointer}
.feature-card:hover{border-color:var(--border2);background:var(--bg2);transform:translateY(-2px)}
.feature-icon{width:44px;height:44px;border-radius:var(--r-md);display:flex;align-items:center;justify-content:center;font-size:20px;margin-bottom:16px}
.fi-green{background:var(--green3)}.fi-blue{background:rgba(68,138,255,.1)}.fi-yellow{background:rgba(255,215,64,.1)}.fi-purple{background:rgba(170,119,255,.1)}.fi-red{background:var(--red2)}.fi-cyan{background:rgba(0,229,255,.1)}
.feature-title{font-weight:700;font-size:15px;margin-bottom:6px;font-family:var(--font-display)}
.feature-desc{font-size:13px;color:var(--text2);line-height:1.55}
.reviews-section{padding:48px 24px}
.reviews-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px;margin-top:24px}
.review-card{background:var(--bg1);border:1px solid var(--border);border-radius:var(--r-xl);padding:20px;transition:all .2s}
.review-card:hover{border-color:var(--border2)}
.review-head{display:flex;align-items:center;gap:12px;margin-bottom:12px}
.review-ava{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,var(--bg3),var(--bg4));display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0}
.review-name{font-weight:600;font-size:14px}
.review-loc{font-size:11px;color:var(--text3)}
.review-stars{color:var(--yellow);font-size:12px;letter-spacing:1px;margin-top:3px}
.review-body{font-size:13px;color:var(--text2);line-height:1.6;font-style:italic}
.cta-section{padding:64px 24px;text-align:center;border-top:1px solid var(--border);background:radial-gradient(ellipse 60% 80% at 50% 100%,rgba(0,230,118,.04),transparent)}
.cta-title{font-family:var(--font-display);font-size:clamp(28px,4vw,44px);font-weight:800;letter-spacing:-.8px;margin-bottom:16px}
.cta-sub{font-size:16px;color:var(--text2);max-width:440px;margin:0 auto 32px;line-height:1.6}
.footer{background:var(--bg1);border-top:1px solid var(--border);padding:24px;text-align:center;font-size:12px;color:var(--text3)}
#aiBtn{position:fixed;bottom:24px;right:24px;z-index:1000;width:56px;height:56px;background:linear-gradient(135deg,#1a1f35,#0d1120);border:1px solid rgba(68,138,255,.4);border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 8px 32px rgba(0,0,0,.6),0 0 0 1px rgba(68,138,255,.15);transition:all .3s}
#aiBtn:hover{transform:scale(1.08);box-shadow:0 12px 40px rgba(68,138,255,.3),0 0 0 1px rgba(68,138,255,.3)}
#aiBtn .ai-logo{width:30px;height:30px;position:relative}
#aiBtn .ai-logo svg{width:100%;height:100%}
.ai-pulse-ring{position:absolute;inset:-6px;border:1.5px solid rgba(68,138,255,.35);border-radius:50%;animation:pulse 2.5s ease-in-out infinite}
.ai-pulse-ring2{position:absolute;inset:-12px;border:1px solid rgba(68,138,255,.15);border-radius:50%;animation:pulse 2.5s ease-in-out infinite .5s}
#aiPanel{position:fixed;bottom:92px;right:24px;width:380px;height:580px;background:linear-gradient(180deg,#0a0d18 0%,#080b14 100%);border:1px solid rgba(255,255,255,.08);border-radius:20px;box-shadow:0 32px 80px rgba(0,0,0,.8),0 0 0 1px rgba(68,138,255,.1);z-index:999;display:none;flex-direction:column;overflow:hidden;animation:slideUp .3s cubic-bezier(.16,1,.3,1)}
#aiPanel.open{display:flex}
.ai-header{padding:16px 18px;background:linear-gradient(135deg,rgba(68,138,255,.12),rgba(41,98,255,.06));border-bottom:1px solid rgba(255,255,255,.06);display:flex;align-items:center;gap:12px;flex-shrink:0}
.ai-avatar{width:38px;height:38px;border-radius:12px;background:linear-gradient(135deg,#1e3a8a,#3b82f6);display:flex;align-items:center;justify-content:center;flex-shrink:0;position:relative;overflow:hidden}
.ai-avatar::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(59,130,246,.5),transparent);animation:pulse 3s ease-in-out infinite}
.ai-avatar svg{width:22px;height:22px;position:relative;z-index:1}
.ai-header-info{flex:1}
.ai-header-title{font-weight:700;font-size:14px;font-family:var(--font-display);letter-spacing:-.2px}
.ai-header-status{font-size:11px;color:var(--green);display:flex;align-items:center;gap:4px;margin-top:1px}
.ai-header-status::before{content:'';width:5px;height:5px;background:var(--green);border-radius:50%;animation:pulse 2s ease-in-out infinite}
.ai-header-actions{display:flex;gap:6px}
.ai-header-btn{width:28px;height:28px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08);border-radius:8px;display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--text2);font-size:12px;transition:all .2s}
.ai-header-btn:hover{background:rgba(255,255,255,.1);color:var(--text1)}
.ai-model-bar{padding:8px 16px;background:rgba(255,255,255,.02);border-bottom:1px solid rgba(255,255,255,.04);display:flex;align-items:center;gap:8px;font-size:11px;color:var(--text3);flex-shrink:0}
.ai-model-pill{display:flex;align-items:center;gap:4px;padding:3px 8px;background:rgba(68,138,255,.1);border:1px solid rgba(68,138,255,.2);border-radius:20px;font-size:10px;font-weight:700;color:var(--blue);cursor:pointer;font-family:var(--font-mono)}
.ai-model-pill:hover{background:rgba(68,138,255,.2)}
.ai-messages{flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:14px}
.ai-messages::-webkit-scrollbar{width:3px}
.ai-messages::-webkit-scrollbar-thumb{background:rgba(255,255,255,.1)}
.ai-msg{max-width:90%;animation:countUp .25s ease}
.ai-msg.bot{align-self:flex-start}
.ai-msg.user{align-self:flex-end}
.ai-msg-bubble{padding:11px 14px;border-radius:14px;font-size:13px;line-height:1.6}
.ai-msg.bot .ai-msg-bubble{background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.07);border-radius:4px 14px 14px 14px;color:var(--text1)}
.ai-msg.user .ai-msg-bubble{background:linear-gradient(135deg,rgba(68,138,255,.25),rgba(41,98,255,.18));border:1px solid rgba(68,138,255,.25);border-radius:14px 4px 14px 14px;color:var(--text1)}
.ai-msg-meta{display:flex;align-items:center;gap:6px;margin-top:4px;font-size:10px;color:var(--text3)}
.ai-msg.user .ai-msg-meta{justify-content:flex-end}
.ai-msg-avatar{width:20px;height:20px;border-radius:6px;background:linear-gradient(135deg,#1e3a8a,#3b82f6);display:flex;align-items:center;justify-content:center;font-size:9px;flex-shrink:0}
.ai-typing{align-self:flex-start}
.ai-typing-bubble{padding:12px 16px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.07);border-radius:4px 14px 14px 14px;display:flex;gap:5px;align-items:center}
.ai-typing-dot{width:6px;height:6px;background:var(--text3);border-radius:50%;animation:pulse 1.2s ease-in-out infinite}
.ai-typing-dot:nth-child(2){animation-delay:.2s}
.ai-typing-dot:nth-child(3){animation-delay:.4s}
.ai-suggestions{padding:10px 14px;display:flex;gap:6px;flex-wrap:nowrap;overflow-x:auto;border-top:1px solid rgba(255,255,255,.05);flex-shrink:0}
.ai-suggestions::-webkit-scrollbar{height:0}
.ai-sug{padding:6px 12px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.08);border-radius:20px;font-size:11px;color:var(--text2);cursor:pointer;transition:all .2s;white-space:nowrap;flex-shrink:0}
.ai-sug:hover{border-color:rgba(68,138,255,.4);color:var(--blue);background:rgba(68,138,255,.08)}
.ai-capabilities{display:flex;gap:6px;padding:0 14px 10px;overflow-x:auto;flex-shrink:0}
.ai-capabilities::-webkit-scrollbar{height:0}
.ai-cap{display:flex;align-items:center;gap:4px;padding:4px 10px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06);border-radius:8px;font-size:10px;color:var(--text3);white-space:nowrap;flex-shrink:0}
.ai-input-area{padding:12px 14px;border-top:1px solid rgba(255,255,255,.05);flex-shrink:0}
.ai-input-wrap{display:flex;align-items:flex-end;gap:8px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:10px 12px;transition:border-color .2s}
.ai-input-wrap:focus-within{border-color:rgba(68,138,255,.4)}
.ai-input{flex:1;background:transparent;border:none;color:var(--text1);font-size:13px;font-family:var(--font-body);outline:none;resize:none;max-height:80px;min-height:20px;line-height:1.5}
.ai-input::placeholder{color:var(--text3)}
.ai-send{width:32px;height:32px;background:linear-gradient(135deg,var(--blue),#2962FF);border:none;border-radius:10px;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:14px;transition:all .2s;flex-shrink:0}
.ai-send:hover{transform:scale(1.08);box-shadow:0 4px 12px rgba(68,138,255,.4)}
.ai-send:disabled{opacity:.4;cursor:not-allowed}
.ai-footer-hint{text-align:center;font-size:10px;color:var(--text3);margin-top:8px;padding:0 4px}
.auth-page{display:grid;grid-template-columns:1fr 1fr;min-height:100vh}
.auth-left{background:linear-gradient(160deg,var(--bg1) 0%,var(--bg2) 100%);border-right:1px solid var(--border);display:flex;align-items:center;justify-content:center;padding:48px;position:relative;overflow:hidden}
.auth-left::before{content:'';position:absolute;bottom:-160px;right:-160px;width:500px;height:500px;background:radial-gradient(circle,rgba(0,230,118,.06),transparent 65%);pointer-events:none}
.auth-left::after{content:'';position:absolute;inset:0;background-image:linear-gradient(var(--border) 1px,transparent 1px),linear-gradient(90deg,var(--border) 1px,transparent 1px);background-size:36px 36px;opacity:.35}
.auth-left-inner{position:relative;z-index:1;max-width:380px;width:100%}
.auth-big-title{font-family:var(--font-display);font-size:54px;font-weight:800;letter-spacing:-1.5px;line-height:1.05;margin-bottom:16px}
.auth-big-sub{font-size:15px;color:var(--text2);line-height:1.65;margin-bottom:32px}
.auth-trust-list{display:flex;flex-direction:column;gap:10px;margin-bottom:28px}
.auth-trust-item{display:flex;align-items:center;gap:10px;font-size:13px;color:var(--text2)}
.auth-trust-icon{font-size:16px}
.auth-live-card{background:var(--bg3);border:1px solid var(--border2);border-radius:var(--r-lg);padding:14px 16px}
.auth-live-row{display:flex;align-items:center;justify-content:space-between}
.signup-bonus-card{background:linear-gradient(135deg,rgba(0,230,118,.15),rgba(0,200,83,.06));border:1px solid rgba(0,230,118,.25);border-radius:var(--r-xl);padding:20px;margin-bottom:28px}
.sbc-top{display:flex;align-items:center;gap:14px}
.auth-steps{display:flex;flex-direction:column;gap:12px}
.auth-step{display:flex;align-items:center;gap:12px;font-size:13px;color:var(--text2)}
.step-num{width:24px;height:24px;border-radius:50%;background:var(--green3);border:1px solid rgba(0,230,118,.3);display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:var(--green);font-family:var(--font-mono);flex-shrink:0}
.auth-right{display:flex;align-items:center;justify-content:center;padding:40px 32px;background:var(--bg0);overflow-y:auto}
.auth-card{width:100%;max-width:420px;animation:layerFade .4s ease}
.auth-card-header{margin-bottom:28px}
.auth-form-title{font-family:var(--font-display);font-size:28px;font-weight:800;letter-spacing:-.5px;margin-bottom:6px}
.auth-form-sub{font-size:13px;color:var(--text2)}
.form-group{margin-bottom:18px}
.form-label{display:flex;justify-content:space-between;align-items:center;font-size:12px;font-weight:600;color:var(--text2);text-transform:uppercase;letter-spacing:.6px;margin-bottom:7px}
.form-label-link{color:var(--green);font-weight:600;cursor:pointer;text-transform:none;letter-spacing:0;font-size:12px}
.input-wrap{position:relative;display:flex;align-items:center}
.input-icon{position:absolute;left:13px;font-size:15px;pointer-events:none;z-index:1}
.form-input{width:100%;padding:12px 14px 12px 40px;background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-md);color:var(--text1);font-size:14px;font-family:var(--font-body);transition:all .2s}
.form-input:focus{outline:none;border-color:rgba(0,230,118,.5);box-shadow:0 0 0 3px rgba(0,230,118,.08)}
.form-input::placeholder{color:var(--text3)}
.form-input.error{border-color:var(--red)}
.input-eye{position:absolute;right:12px;background:none;border:none;cursor:pointer;font-size:14px;color:var(--text3);padding:4px;transition:color .2s}
.input-eye:hover{color:var(--text2)}
.btn-auth{width:100%;padding:13px;background:var(--green);color:#000;border:none;border-radius:var(--r-md);font-size:15px;font-weight:700;cursor:pointer;transition:all .2s;font-family:var(--font-display);display:flex;align-items:center;justify-content:center;gap:8px}
.btn-auth:hover{background:var(--green2);transform:translateY(-1px);box-shadow:0 6px 20px rgba(0,230,118,.3)}
.btn-auth:disabled{opacity:.6;cursor:not-allowed;transform:none}
.btn-auth-outline{padding:13px 20px;background:transparent;color:var(--text2);border:1px solid var(--border2);border-radius:var(--r-md);font-size:14px;font-weight:600;cursor:pointer;transition:all .2s;font-family:var(--font-body)}
.btn-auth-outline:hover{color:var(--text1)}
.btn-spinner{display:inline-block;animation:spin 1s linear infinite;font-size:16px}
.form-alert{padding:11px 14px;border-radius:var(--r-md);font-size:13px;margin-bottom:16px;border-left:3px solid}
.form-alert.error{background:var(--red2);border-color:var(--red);color:var(--red)}
.form-alert.success{background:var(--green3);border-color:var(--green);color:var(--green)}
.auth-divider{display:flex;align-items:center;gap:12px;margin:20px 0;color:var(--text3);font-size:12px}
.auth-divider::before,.auth-divider::after{content:'';flex:1;height:1px;background:var(--border)}
.social-row{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:20px}
.social-btn{padding:10px;background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-md);color:var(--text1);font-size:13px;font-weight:500;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:7px;transition:all .2s}
.social-btn:hover{border-color:var(--border2);background:var(--bg3)}
.auth-switch-text{text-align:center;font-size:13px;color:var(--text2);margin-top:16px}
.auth-switch-text a{color:var(--green);cursor:pointer;font-weight:600}
.signup-progress{margin-bottom:24px}
.sp-bar{height:3px;background:var(--bg3);border-radius:2px;margin-bottom:8px;overflow:hidden}
.sp-fill{height:100%;background:linear-gradient(90deg,var(--green),var(--cyan));border-radius:2px;transition:width .4s ease}
.sp-steps{display:flex;justify-content:space-between}
.sp-step{font-size:11px;color:var(--text3);font-weight:600;text-transform:uppercase;letter-spacing:.5px;transition:color .3s}
.sp-step.active{color:var(--green)}
.pwd-strength{display:flex;align-items:center;gap:8px;margin-top:6px}
.pwd-bar{flex:1;height:3px;background:var(--bg3);border-radius:2px;overflow:hidden}
.pwd-fill{height:100%;border-radius:2px;transition:all .3s;width:0%}
.pwd-label{font-size:11px;font-weight:600;min-width:50px}
.twofa-box{background:var(--bg2);border:1px solid var(--border2);border-radius:var(--r-xl);padding:24px;text-align:center;margin-bottom:16px}
.otp-row{display:flex;gap:8px;justify-content:center;margin-bottom:8px}
.otp-input{width:42px;height:50px;background:var(--bg3);border:1px solid var(--border2);border-radius:var(--r-md);text-align:center;font-size:20px;font-weight:700;font-family:var(--font-mono);color:var(--text1);transition:all .2s}
.otp-input:focus{outline:none;border-color:var(--green);box-shadow:0 0 0 3px rgba(0,230,118,.12)}
.confirm-box{background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-xl);padding:20px;margin-bottom:16px}
.confirm-row{display:flex;justify-content:space-between;align-items:center;padding:9px 0;border-bottom:1px solid var(--border);font-size:13px}
.confirm-row:last-child{border-bottom:none}
.confirm-row span{color:var(--text2)}
.checkbox-row{display:flex;align-items:flex-start;gap:10px;font-size:12px;color:var(--text2);line-height:1.5;cursor:pointer}
.checkbox-row input{margin-top:2px;accent-color:var(--green)}
.pair-bar{background:var(--bg1);border-bottom:1px solid var(--border);overflow-x:auto}
.pair-bar::-webkit-scrollbar{height:3px}
.pair-bar-inner{display:flex;gap:2px;padding:6px 16px;white-space:nowrap}
.pair-btn{padding:6px 14px;background:transparent;border:none;border-radius:var(--r-sm);color:var(--text2);font-size:12px;font-weight:600;cursor:pointer;transition:all .2s;font-family:var(--font-mono)}
.pair-btn:hover{color:var(--text1);background:var(--bg3)}
.pair-btn.active{color:var(--green);background:var(--green3)}
.price-header{display:flex;align-items:center;gap:20px;padding:10px 20px;background:var(--bg1);border-bottom:1px solid var(--border);flex-wrap:wrap}
.ph-left{display:flex;align-items:baseline;gap:10px}
.ph-pair{font-family:var(--font-display);font-size:16px;font-weight:800}
.ph-price{font-family:var(--font-mono);font-size:26px;font-weight:700;transition:color .3s}
.ph-price.up{color:var(--green)}.ph-price.down{color:var(--red)}
.ph-change{font-family:var(--font-mono);font-size:14px;font-weight:700;padding:3px 10px;border-radius:var(--r-sm)}
.ph-change.up{color:var(--green);background:var(--green3)}
.ph-change.down{color:var(--red);background:var(--red2)}
.ph-stats{display:flex;gap:20px;flex:1}
.ph-stat{display:flex;flex-direction:column;gap:2px}
.ph-stat-lbl{font-size:10px;color:var(--text3);text-transform:uppercase;letter-spacing:.5px}
.ph-stat-val{font-family:var(--font-mono);font-size:13px;font-weight:600}
.ph-right{margin-left:auto}
.interval-btns{display:flex;gap:2px}
.iv-btn{padding:5px 10px;background:transparent;border:1px solid transparent;border-radius:var(--r-sm);color:var(--text3);font-size:11px;font-weight:700;cursor:pointer;transition:all .2s;font-family:var(--font-mono)}
.iv-btn:hover{color:var(--text1)}
.iv-btn.active{color:var(--green);border-color:rgba(0,230,118,.3);background:var(--green3)}
.chart-layout{display:grid;grid-template-columns:1fr 200px 180px;height:calc(100vh - 200px);min-height:500px;border-bottom:1px solid var(--border)}
.chart-main{display:flex;flex-direction:column;border-right:1px solid var(--border);min-width:0;overflow:hidden}
.indicator-bar{display:flex;align-items:center;gap:8px;padding:7px 12px;background:var(--bg1);border-bottom:1px solid var(--border);flex-wrap:wrap}
.ind-btn{padding:4px 10px;background:var(--bg3);border:1px solid var(--border);border-radius:4px;color:var(--text2);font-size:11px;font-weight:600;cursor:pointer;transition:all .2s;font-family:var(--font-mono)}
.ind-btn:hover{color:var(--text1)}
.ind-btn.active{color:var(--green);border-color:rgba(0,230,118,.3);background:var(--green3)}
#tvChartContainer,.tv-chart-wrapper{flex:1;min-height:0;position:relative}
#tvChartContainer .tv-lightweight-charts{height:100%!important}
.vol-wrap-tv{height:70px;position:relative;border-top:1px solid var(--border)}
.rsi-wrap-tv{height:80px;position:relative;border-top:1px solid var(--border);display:none}
.depth-section{padding:12px 16px;background:var(--bg1);border-top:1px solid var(--border)}
.depth-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
.depth-wrap{height:100px;position:relative;background:var(--bg0);border-radius:var(--r-md);overflow:hidden;border:1px solid var(--border)}
.depth-wrap canvas{position:absolute;inset:0;width:100%;height:100%}
.orderbook-panel{display:flex;flex-direction:column;background:var(--bg1);overflow:hidden}
.ob-header{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--border);flex-shrink:0}
.ob-title{font-size:13px;font-weight:700;font-family:var(--font-display)}
.ob-tabs{display:flex;gap:4px}
.ob-tab{padding:3px 7px;background:var(--bg3);border:1px solid var(--border);border-radius:4px;font-size:11px;cursor:pointer;transition:all .2s}
.ob-tab.active{border-color:var(--border2);background:var(--bg4)}
.ob-labels{display:grid;grid-template-columns:1fr 1fr 1fr;padding:6px 10px;font-size:9.5px;color:var(--text3);font-weight:600;text-transform:uppercase;letter-spacing:.4px;flex-shrink:0}
.ob-labels span:last-child{text-align:right}
.ob-asks{flex:1;overflow-y:auto;display:flex;flex-direction:column-reverse}
.ob-bids{flex:1;overflow-y:auto}
.ob-asks::-webkit-scrollbar,.ob-bids::-webkit-scrollbar{width:2px}
.ob-row{display:grid;grid-template-columns:1fr 1fr 1fr;padding:2px 10px;font-size:11px;font-family:var(--font-mono);position:relative;cursor:pointer;transition:background .15s}
.ob-row:hover{background:rgba(255,255,255,.04)}
.ob-row .ob-price{font-weight:600}
.ob-row .ob-price.ask{color:var(--red)}
.ob-row .ob-price.bid{color:var(--green)}
.ob-row .ob-amt{color:var(--text2);text-align:center}
.ob-row .ob-total{color:var(--text3);text-align:right}
.ob-spread{display:flex;align-items:center;justify-content:space-between;padding:6px 10px;background:var(--bg2);border-top:1px solid var(--border);border-bottom:1px solid var(--border);flex-shrink:0}
.ob-spread-price{font-family:var(--font-mono);font-size:14px;font-weight:700;color:var(--green)}
.ob-spread-pct{font-family:var(--font-mono);font-size:10px;color:var(--text3)}
.trades-panel{display:flex;flex-direction:column;background:var(--bg1);border-left:1px solid var(--border);overflow:hidden}
.tp-header{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--border);flex-shrink:0}
.tp-labels{display:grid;grid-template-columns:1fr 1fr 1fr;padding:6px 10px;font-size:9.5px;color:var(--text3);font-weight:600;text-transform:uppercase;letter-spacing:.4px;flex-shrink:0}
.tp-labels span:last-child{text-align:right}
.tp-feed{flex:1;overflow-y:auto}
.tp-feed::-webkit-scrollbar{width:2px}
.tp-row{display:grid;grid-template-columns:1fr 1fr 1fr;padding:3px 10px;font-size:11px;font-family:var(--font-mono);animation:tradeFlash .3s ease}
.tp-row .tp-price{font-weight:600}
.tp-row .tp-price.buy{color:var(--green)}
.tp-row .tp-price.sell{color:var(--red)}
.tp-row .tp-amt{color:var(--text2);text-align:center}
.tp-row .tp-time{color:var(--text3);text-align:right}
.market-overview-section{padding:24px 20px}
.market-cards-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px}
.market-card{background:var(--bg1);border:1px solid var(--border);border-radius:var(--r-lg);padding:16px;cursor:pointer;transition:all .2s}
.market-card:hover{border-color:var(--border2);transform:translateY(-2px)}
.mc-sym{font-family:var(--font-display);font-size:14px;font-weight:700;margin-bottom:8px}
.mc-price{font-family:var(--font-mono);font-size:20px;font-weight:700}
.mc-chg{font-family:var(--font-mono);font-size:12px;font-weight:700;margin-top:4px}
.mc-mini{height:40px;position:relative;margin-top:10px}
.mc-mini canvas{position:absolute;inset:0;width:100%;height:100%}
.dash-user-chip{display:flex;align-items:center;gap:7px;padding:5px 12px;background:var(--bg2);border:1px solid var(--border);border-radius:20px;font-size:13px;font-weight:600;cursor:pointer;transition:all .2s}
.dash-user-chip:hover{border-color:var(--border2)}
.duc-avatar{font-size:16px}
.dash-body{display:grid;grid-template-columns:220px 1fr;min-height:calc(100vh - 92px)}
.dash-sidebar{background:var(--bg1);border-right:1px solid var(--border);display:flex;flex-direction:column;overflow-y:auto}
.sidebar-balance{padding:20px 16px;border-bottom:1px solid var(--border)}
.sbl-label{font-size:10px;color:var(--text3);text-transform:uppercase;letter-spacing:.8px;font-weight:600;margin-bottom:4px}
.sbl-amount{font-family:var(--font-mono);font-size:24px;font-weight:700;color:var(--green);margin-bottom:2px}
.sbl-sub{font-size:11px;color:var(--text3);margin-bottom:12px}
.mode-toggle{display:flex;gap:4px;background:var(--bg0);border-radius:var(--r-md);padding:3px}
.mt-btn{flex:1;padding:6px 4px;border:none;border-radius:var(--r-sm);font-size:11px;font-weight:700;cursor:pointer;transition:all .2s;font-family:var(--font-mono);background:transparent;color:var(--text3)}
.mt-btn.active{background:var(--green);color:#000}
.sidebar-nav{flex:1;padding:12px 0}
.snav-section{padding:8px 16px 4px;font-size:10px;color:var(--text3);font-weight:700;text-transform:uppercase;letter-spacing:1px}
.snav-item{display:flex;align-items:center;gap:9px;padding:9px 16px;font-size:13px;color:var(--text2);cursor:pointer;transition:all .2s;border-left:2px solid transparent;position:relative}
.snav-item:hover{color:var(--text1);background:var(--bg2)}
.snav-item.active{color:var(--green);background:var(--green3);border-left-color:var(--green)}
.snav-icon{font-size:15px;width:20px;text-align:center}
.snav-badge{margin-left:auto;font-size:10px;padding:2px 6px;background:var(--green3);color:var(--green);border-radius:10px;font-weight:700;font-family:var(--font-mono)}
.sidebar-ref-card{margin:12px;padding:12px;background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-lg)}
.src-link{font-size:10px;color:var(--text3);font-family:var(--font-mono);word-break:break-all;margin-bottom:8px;line-height:1.4}
.src-copy{width:100%;padding:6px;background:var(--bg3);border:1px solid var(--border);border-radius:var(--r-sm);color:var(--text2);font-size:11px;cursor:pointer;transition:all .2s}
.src-copy:hover{color:var(--text1);border-color:var(--border2)}
.dash-content{padding:20px;overflow-y:auto;display:flex;flex-direction:column;gap:16px;background:var(--bg0)}
.balance-cards{display:grid;grid-template-columns:2fr 1fr 1fr 1fr;gap:12px}
.bal-card{background:var(--bg1);border:1px solid var(--border);border-radius:var(--r-xl);padding:20px;position:relative;overflow:hidden;transition:all .2s}
.bal-card:hover{border-color:var(--border2)}
.bal-card.primary{background:linear-gradient(135deg,rgba(0,230,118,.1),rgba(0,200,83,.04));border-color:rgba(0,230,118,.2)}
.bc-label{font-size:11px;color:var(--text3);text-transform:uppercase;letter-spacing:.6px;font-weight:600;margin-bottom:8px}
.bc-amount{font-family:var(--font-mono);font-size:26px;font-weight:700}
.bc-change{font-size:12px;font-weight:700;padding:2px 7px;border-radius:4px;display:inline-block;margin-top:4px;font-family:var(--font-mono)}
.bc-change.up{color:var(--green);background:var(--green3)}
.bc-change.down{color:var(--red);background:var(--red2)}
.quick-actions{display:grid;grid-template-columns:repeat(6,1fr);gap:10px}
.qa-btn{display:flex;flex-direction:column;align-items:center;gap:6px;padding:16px 8px;border:1px solid var(--border);border-radius:var(--r-xl);background:var(--bg1);cursor:pointer;transition:all .25s;font-size:12px;font-weight:600;color:var(--text2)}
.qa-btn:hover{transform:translateY(-3px);border-color:var(--border2);color:var(--text1);box-shadow:0 6px 20px rgba(0,0,0,.3)}
.qa-icon{font-size:22px}
.qa-trade{border-color:rgba(255,215,64,.2);background:rgba(255,215,64,.04)}.qa-trade:hover{border-color:var(--yellow);box-shadow:0 6px 20px rgba(255,215,64,.15)}
.qa-deposit{border-color:rgba(0,230,118,.2);background:var(--green3)}.qa-deposit:hover{border-color:var(--green);box-shadow:0 6px 20px rgba(0,230,118,.15)}
.qa-withdraw{border-color:rgba(68,138,255,.2);background:rgba(68,138,255,.05)}.qa-withdraw:hover{border-color:var(--blue);box-shadow:0 6px 20px rgba(68,138,255,.15)}
.qa-bots{border-color:rgba(170,119,255,.2);background:rgba(170,119,255,.05)}.qa-bots:hover{border-color:var(--purple);box-shadow:0 6px 20px rgba(170,119,255,.15)}
.qa-ref{border-color:rgba(0,229,255,.2);background:rgba(0,229,255,.04)}.qa-ref:hover{border-color:var(--cyan);box-shadow:0 6px 20px rgba(0,229,255,.15)}
.qa-charts{border-color:rgba(255,61,87,.2);background:var(--red2)}.qa-charts:hover{border-color:var(--red);box-shadow:0 6px 20px rgba(255,61,87,.15)}
.dash-card{background:var(--bg1);border:1px solid var(--border);border-radius:var(--r-xl);padding:18px}
.dc-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
.dc-title{font-family:var(--font-display);font-size:14px;font-weight:700}
.dc-badge{font-size:11px;padding:3px 9px;background:var(--bg3);border-radius:20px;color:var(--text2);font-family:var(--font-mono)}
.dc-link{font-size:12px;color:var(--green);cursor:pointer;font-weight:600}
.dc-tabs{display:flex;gap:4px}
.dc-tab{padding:4px 10px;background:transparent;border:1px solid var(--border);border-radius:var(--r-sm);font-size:11px;font-weight:700;cursor:pointer;color:var(--text3);font-family:var(--font-mono);transition:all .2s}
.dc-tab.active{color:var(--green);border-color:rgba(0,230,118,.3);background:var(--green3)}
.dash-two-col{display:grid;grid-template-columns:1.5fr 1fr;gap:16px}
.dash-three-col{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px}
.dc-chart-wrap{height:180px;position:relative;margin-bottom:12px}
.dc-chart-wrap canvas{position:absolute;inset:0;width:100%;height:100%}
.perf-footer{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;padding-top:12px;border-top:1px solid var(--border)}
.pf-item{text-align:center}
.pf-lbl{font-size:10px;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;display:block;margin-bottom:3px}
.pf-val{font-family:var(--font-mono);font-size:14px;font-weight:700}
.position-row{background:var(--bg2);border-radius:var(--r-lg);padding:12px 14px;margin-bottom:8px;border:1px solid var(--border);transition:all .2s}
.position-row:hover{border-color:var(--border2)}
.pr-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.pr-pair{font-weight:700;font-size:13px;font-family:var(--font-display)}
.pr-type{font-size:11px;font-weight:700;padding:2px 8px;border-radius:4px;font-family:var(--font-mono)}
.pr-type.long{color:var(--green);background:var(--green3)}
.pr-type.short{color:var(--red);background:var(--red2)}
.pr-pnl{font-family:var(--font-mono);font-size:15px;font-weight:700}
.pr-stats{display:grid;grid-template-columns:repeat(4,1fr);gap:6px}
.pr-stat{font-size:10px}
.pr-stat-lbl{color:var(--text3);display:block;margin-bottom:2px}
.pr-stat-val{color:var(--text1);font-family:var(--font-mono);font-weight:600;font-size:11px}
.pr-close-btn{width:100%;margin-top:8px;padding:6px;background:var(--red2);border:1px solid rgba(255,61,87,.3);border-radius:var(--r-sm);color:var(--red);font-size:11px;font-weight:700;cursor:pointer;transition:all .2s}
.pr-close-btn:hover{background:var(--red);color:#fff}
.alloc-chart-wrap{position:relative;width:140px;height:140px;margin:0 auto 12px}
.alloc-chart-wrap canvas{position:absolute;inset:0;width:100%;height:100%}
.alloc-center{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center}
.ac-amount{font-family:var(--font-mono);font-size:15px;font-weight:700}
.ac-label{font-size:10px;color:var(--text3)}
.alloc-legend{display:flex;flex-direction:column;gap:6px}
.al-row{display:flex;align-items:center;justify-content:space-between;font-size:12px}
.al-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.al-name{color:var(--text2);margin-left:6px;flex:1}
.al-pct{color:var(--text1);font-weight:600;font-family:var(--font-mono)}
.rt-row{display:grid;grid-template-columns:auto 1fr auto auto;gap:8px;align-items:center;padding:8px 0;border-bottom:1px solid var(--border);font-size:12px}
.rt-row:last-child{border-bottom:none}
.rt-type{padding:2px 7px;border-radius:4px;font-size:10px;font-weight:700;font-family:var(--font-mono)}
.rt-type.win{color:var(--green);background:var(--green3)}
.rt-type.loss{color:var(--red);background:var(--red2)}
.rt-pair{font-weight:600;color:var(--text1)}
.rt-pnl{font-family:var(--font-mono);font-weight:700}
.rt-date{font-size:10px;color:var(--text3)}
.msnap-list{display:flex;flex-direction:column;gap:0}
.ms-row{display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--border);cursor:pointer;transition:all .15s}
.ms-row:last-child{border-bottom:none}
.ms-row:hover{padding-left:4px}
.ms-sym{font-weight:700;font-size:13px;font-family:var(--font-display)}
.ms-price{font-family:var(--font-mono);font-size:12px}
.ms-chg{font-family:var(--font-mono);font-size:11px;font-weight:700;padding:2px 6px;border-radius:4px}
.kyc-notice{display:flex;align-items:center;justify-content:space-between;padding:16px 20px;background:linear-gradient(135deg,rgba(255,215,64,.12),rgba(245,158,11,.06));border:1px solid rgba(255,215,64,.25);border-radius:var(--r-xl);flex-wrap:wrap;gap:12px}
.kyc-btn{padding:9px 20px;background:var(--yellow);color:#000;border:none;border-radius:var(--r-md);font-size:13px;font-weight:700;cursor:pointer;transition:all .2s}
.kyc-btn:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(255,215,64,.3)}
.empty-state{text-align:center;padding:28px 16px}
.trade-price-strip{display:flex;align-items:center;gap:20px;padding:9px 20px;background:var(--bg1);border-bottom:1px solid var(--border);flex-wrap:wrap}
.tps-left{display:flex;align-items:baseline;gap:10px}
.tps-pair{font-family:var(--font-display);font-size:15px;font-weight:800}
.tps-price{font-family:var(--font-mono);font-size:24px;font-weight:700;transition:color .3s}
.tps-chg{font-size:12px;font-weight:700;padding:2px 8px;border-radius:var(--r-sm);font-family:var(--font-mono)}
.tps-stats{display:flex;gap:20px;flex:1}
.tps-stat{display:flex;flex-direction:column;gap:1px}
.tps-lbl{font-size:10px;color:var(--text3);text-transform:uppercase;letter-spacing:.5px}
.tps-val{font-family:var(--font-mono);font-size:12px;font-weight:600}
.tps-bal{display:flex;flex-direction:column;gap:1px;margin-left:auto;text-align:right}
.trading-body{display:grid;grid-template-columns:1fr 260px 220px;height:calc(100vh - 168px);min-height:480px}
.trade-chart-col{display:flex;flex-direction:column;border-right:1px solid var(--border);min-width:0;overflow:hidden}
.order-panel{background:var(--bg1);border-right:1px solid var(--border);overflow-y:auto;display:flex;flex-direction:column}
.order-panel::-webkit-scrollbar{width:3px}
.order-tabs{display:grid;grid-template-columns:1fr 1fr;border-bottom:1px solid var(--border)}
.ot-btn{padding:14px 8px;border:none;font-size:13px;font-weight:800;cursor:pointer;transition:all .2s;font-family:var(--font-mono);background:var(--bg2);color:var(--text3)}
.ot-btn.buy.active{background:var(--green3);color:var(--green);border-bottom:2px solid var(--green)}
.ot-btn.sell.active{background:var(--red2);color:var(--red);border-bottom:2px solid var(--red)}
.order-type-row{display:flex;gap:4px;padding:10px 12px;border-bottom:1px solid var(--border)}
.order-type-btn{flex:1;padding:5px 4px;background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-sm);color:var(--text3);font-size:11px;font-weight:600;cursor:pointer;transition:all .2s;font-family:var(--font-mono)}
.order-type-btn.active{color:var(--text1);border-color:var(--border2);background:var(--bg3)}
.op-group{padding:10px 12px;border-bottom:1px solid var(--border)}
.op-label{display:flex;justify-content:space-between;font-size:11px;color:var(--text3);font-weight:600;text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px}
.op-leverage-val{color:var(--yellow);font-family:var(--font-mono);font-size:13px;font-weight:800}
.op-input-wrap{display:flex;align-items:center;background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-md);overflow:hidden}
.op-input{flex:1;padding:9px 10px;background:transparent;border:none;color:var(--text1);font-size:14px;font-family:var(--font-mono);outline:none}
.op-input::placeholder{color:var(--text3)}
.op-input-suffix{padding:0 10px;font-size:11px;color:var(--text3);font-family:var(--font-mono);font-weight:600;border-left:1px solid var(--border)}
.op-input-wrap:focus-within{border-color:rgba(0,230,118,.4)}
.quick-pct-row{display:flex;gap:4px;margin-top:8px}
.qp-btn{flex:1;padding:4px;background:var(--bg3);border:1px solid var(--border);border-radius:4px;color:var(--text3);font-size:11px;font-weight:700;cursor:pointer;transition:all .2s;font-family:var(--font-mono)}
.qp-btn:hover{color:var(--green);border-color:rgba(0,230,118,.3);background:var(--green3)}
.leverage-slider{width:100%;height:4px;margin:8px 0 4px;appearance:none;-webkit-appearance:none;background:linear-gradient(to right,var(--green) 0%,var(--green) 10%,var(--bg3) 10%,var(--bg3) 100%);border-radius:2px;outline:none;cursor:pointer}
.leverage-slider::-webkit-slider-thumb{appearance:none;width:14px;height:14px;background:var(--green);border-radius:50%;cursor:pointer;box-shadow:0 0 6px rgba(0,230,118,.5)}
.leverage-marks{display:flex;justify-content:space-between;font-size:10px;color:var(--text3);font-family:var(--font-mono)}
.leverage-marks span{cursor:pointer;transition:color .2s}
.leverage-marks span:hover{color:var(--green)}
.tp-sl-row{display:flex;gap:0}
.tp-sl-row .op-group:first-child{border-right:1px solid var(--border)}
.order-summary{padding:10px 12px;border-bottom:1px solid var(--border);background:var(--bg0)}
.os-row{display:flex;justify-content:space-between;font-size:11px;padding:3px 0}
.os-row span:first-child{color:var(--text3)}
.os-row span:last-child{font-family:var(--font-mono);font-weight:600;color:var(--text1)}
.risk-warning{display:flex;align-items:center;gap:8px;padding:8px 12px;background:rgba(255,215,64,.08);border-bottom:1px solid rgba(255,215,64,.15);font-size:11px;color:var(--yellow)}
.order-submit-btn{width:100%;padding:15px;border:none;font-size:15px;font-weight:800;cursor:pointer;transition:all .2s;font-family:var(--font-mono);letter-spacing:.5px}
.order-submit-btn.buy{background:linear-gradient(135deg,var(--green),var(--green2));color:#000}
.order-submit-btn.sell{background:linear-gradient(135deg,var(--red),#c92a40);color:#fff}
.order-submit-btn:hover{transform:translateY(-1px);box-shadow:0 6px 20px rgba(0,0,0,.3)}
.op-mode-row{display:flex;align-items:center;gap:8px;padding:10px 12px;margin-top:auto;border-top:1px solid var(--border)}
.op-mode-btn{padding:4px 12px;background:var(--bg2);border:1px solid var(--border);border-radius:20px;font-size:11px;font-weight:700;cursor:pointer;transition:all .2s;font-family:var(--font-mono);color:var(--text3)}
.op-mode-btn.active{background:var(--green);color:#000;border-color:var(--green)}
.trade-right-col{display:flex;flex-direction:column;overflow:hidden;background:var(--bg1)}
.mini-ob{border-bottom:1px solid var(--border);flex-shrink:0}
.mob-header{padding:8px 12px;font-size:12px;font-weight:700;font-family:var(--font-display);border-bottom:1px solid var(--border)}
.my-positions{flex:1;overflow-y:auto;display:flex;flex-direction:column;border-bottom:1px solid var(--border)}
.my-pos-row{padding:8px 10px;border-bottom:1px solid var(--border);font-size:11px}
.mpr-top{display:flex;justify-content:space-between;margin-bottom:4px}
.mpr-pair{font-weight:700;font-family:var(--font-display)}
.mpr-pnl{font-family:var(--font-mono);font-weight:700}
.mpr-stats{display:flex;gap:8px;font-size:10px;color:var(--text3);font-family:var(--font-mono)}
.mpr-close{background:var(--red2);border:1px solid rgba(255,61,87,.2);border-radius:3px;color:var(--red);font-size:10px;font-weight:700;cursor:pointer;padding:2px 6px;float:right;margin-top:4px;transition:all .2s}
.mpr-close:hover{background:var(--red);color:#fff}
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.75);z-index:2000;display:flex;align-items:center;justify-content:center;padding:20px;backdrop-filter:blur(4px)}
.modal-box{background:var(--bg2);border:1px solid var(--border2);border-radius:var(--r-xl);padding:28px;max-width:420px;width:100%;animation:countUp .3s ease;box-shadow:0 40px 80px rgba(0,0,0,.8)}
.modal-title{font-family:var(--font-display);font-size:20px;font-weight:800;margin-bottom:20px;display:flex;align-items:center;gap:10px}
.modal-row{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid var(--border);font-size:13px}
.modal-row:last-of-type{border-bottom:none}
.modal-row span:first-child{color:var(--text2)}
.modal-row span:last-child{font-family:var(--font-mono);font-weight:700}
.modal-actions{display:flex;gap:10px;margin-top:20px}
.fill-notification{position:fixed;bottom:90px;left:50%;transform:translateX(-50%);background:var(--bg2);border:1px solid var(--border2);border-radius:var(--r-lg);padding:14px 20px;box-shadow:0 16px 48px rgba(0,0,0,.6);z-index:1500;font-size:13px;display:flex;align-items:center;gap:12px;min-width:300px;animation:slideUp .3s ease}
.fill-icon{font-size:22px}
.fill-text{font-weight:700;font-size:14px}
.fill-sub{font-size:11px;color:var(--text2);margin-top:2px}
.dep-method-btn{display:flex;flex-direction:column;align-items:center;padding:14px 8px;background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-lg);cursor:pointer;transition:all .2s;color:var(--text2)}
.dep-method-btn.active{border-color:var(--green);background:var(--green3);color:var(--text1)}
.dep-method-btn:hover{border-color:var(--border2);color:var(--text1)}
.bots-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px}
.bot-card{background:var(--bg1);border:1px solid var(--border);border-radius:var(--r-xl);padding:20px;transition:all .25s}
.bot-card.active-bot{border-color:rgba(0,230,118,.35);background:rgba(0,230,118,.03)}
.bot-card:hover{border-color:var(--border2);transform:translateY(-2px);box-shadow:0 8px 28px rgba(0,0,0,.3)}
.bc-top{display:flex;align-items:center;gap:12px;margin-bottom:12px}
.bc-icon{width:44px;height:44px;border-radius:var(--r-md);display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0}
.bc-name{font-family:var(--font-display);font-size:15px;font-weight:700}
.bc-risk{font-size:11px;font-weight:600}
.bc-status{margin-left:auto;font-size:11px;font-weight:800;font-family:var(--font-mono)}
.bc-status.on{color:var(--green)}.bc-status.off{color:var(--text3)}
.bc-desc{font-size:12px;color:var(--text2);line-height:1.55;margin-bottom:14px}
.bc-stats{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin-bottom:12px}
.bc-stat{background:var(--bg2);border-radius:var(--r-sm);padding:8px 4px;text-align:center}
.bcs-val{font-family:var(--font-mono);font-size:13px;font-weight:700}
.bcs-lbl{font-size:9px;color:var(--text3);text-transform:uppercase;letter-spacing:.4px;margin-top:2px}
.bc-pairs{font-size:11px;color:var(--text3);margin-bottom:12px}
.bc-toggle-btn{width:100%;padding:10px;border:none;border-radius:var(--r-md);font-size:13px;font-weight:700;cursor:pointer;transition:all .2s;font-family:var(--font-mono)}
.bc-toggle-btn.start{background:var(--green);color:#000}
.bc-toggle-btn.stop{background:var(--red2);border:1px solid rgba(255,61,87,.3);color:var(--red)}
.bc-toggle-btn.start:hover{background:var(--green2)}
.bc-toggle-btn.stop:hover{background:var(--red);color:#fff}
.bc-running{display:flex;align-items:center;font-size:11px;color:var(--green);margin-top:8px;font-family:var(--font-mono)}
.signal-card{background:var(--bg1);border:1px solid var(--border);border-radius:var(--r-xl);padding:18px;transition:all .25s;cursor:pointer;position:relative;overflow:hidden}
.signal-card::after{content:'';position:absolute;top:0;left:0;right:0;height:3px;opacity:0;transition:opacity .25s;border-radius:var(--r-xl) var(--r-xl) 0 0}
.signal-card:hover{border-color:var(--border2);transform:translateY(-3px);box-shadow:0 12px 36px rgba(0,0,0,.4)}
.signal-card:hover::after{opacity:1}
.signal-card.buy-sig::after{background:linear-gradient(90deg,var(--green),var(--cyan))}
.signal-card.sell-sig::after{background:linear-gradient(90deg,var(--red),#ff6b8a)}
.sig-direction{display:inline-flex;align-items:center;gap:6px;padding:5px 14px;border-radius:20px;font-size:12px;font-weight:800;font-family:var(--font-mono)}
.sig-direction.buy{background:var(--green3);color:var(--green);border:1px solid rgba(0,230,118,.3)}
.sig-direction.sell{background:var(--red2);color:var(--red);border:1px solid rgba(255,61,87,.3)}
.sig-stat{background:var(--bg2);border-radius:var(--r-md);padding:8px 10px}
.sig-stat-lbl{font-size:9px;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;margin-bottom:3px}
.sig-stat-val{font-family:var(--font-mono);font-size:13px;font-weight:700}
.conf-bar{flex:1;height:4px;background:var(--bg3);border-radius:2px;overflow:hidden}
.conf-fill{height:100%;border-radius:2px;transition:width .6s ease}
.ind-tag{padding:3px 8px;border-radius:4px;font-size:10px;font-weight:700;font-family:var(--font-mono)}
.ind-bull{background:var(--green3);color:var(--green)}
.ind-bear{background:var(--red2);color:var(--red)}
.ind-neutral{background:rgba(255,255,255,.06);color:var(--text2)}
.hm-cell{border-radius:var(--r-md);padding:14px 8px;text-align:center;cursor:pointer;transition:all .2s}
.hm-cell:hover{transform:scale(1.06)}
.hm-sym{font-family:var(--font-display);font-size:12px;font-weight:800;margin-bottom:3px}
.hm-chg{font-family:var(--font-mono);font-size:12px;font-weight:700}
.news-item{display:flex;gap:12px;padding:12px 0;border-bottom:1px solid var(--border);cursor:pointer;transition:padding .15s}
.news-item:last-child{border-bottom:none}
.news-item:hover{padding-left:6px}
.hist-row{border-bottom:1px solid var(--border);transition:background .15s}
.hist-row:hover{background:var(--bg2)}
.hist-row td{padding:10px 12px}
.ref-hist-row{display:flex;align-items:center;gap:12px;padding:12px 0;border-bottom:1px solid var(--border)}
.ref-hist-row:last-child{border-bottom:none}
.rec-action-card{background:var(--bg1);border:1px solid var(--border);border-radius:var(--r-xl);padding:18px;display:flex;align-items:center;gap:16px;transition:all .25s;cursor:pointer}
.rec-action-card:hover{border-color:var(--border2);transform:translateY(-2px);box-shadow:0 8px 28px rgba(0,0,0,.3)}
.rec-action-icon{width:48px;height:48px;border-radius:var(--r-md);display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0}
.rec-priority{font-size:10px;font-weight:700;padding:2px 7px;border-radius:4px;font-family:var(--font-mono)}
.rec-priority.high{background:var(--red2);color:var(--red)}
.rec-priority.med{background:rgba(255,215,64,.1);color:var(--yellow)}
.rec-priority.low{background:var(--green3);color:var(--green)}
.learn-step{display:flex;align-items:center;gap:14px;padding:14px 0;border-bottom:1px solid var(--border);cursor:pointer;transition:all .2s}
.learn-step:last-child{border-bottom:none}
.learn-step:hover{padding-left:6px}
.learn-step-num{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:800;font-family:var(--font-mono);flex-shrink:0}
.bot-suggest-row{display:flex;align-items:center;gap:14px;padding:14px;background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-lg);transition:all .2s}
.bot-suggest-row:hover{border-color:var(--border2)}
.container{max-width:1440px;margin:0 auto;padding:0 24px}
.text-green{color:var(--green)}.text-red{color:var(--red)}.text-blue{color:var(--blue)}.text-yellow{color:var(--yellow)}.text-dim{color:var(--text2)}
.mono{font-family:var(--font-mono)}.fw-bold{font-weight:700}
@media(max-width:768px){
  .hero{padding:48px 20px 40px}.hero-title{font-size:34px}.stats-bar{flex-wrap:wrap}
  .stat-item{min-width:50%;border-bottom:1px solid var(--border)}.nav-ticker{display:none}
  .winners-grid,.features-grid,.reviews-grid{grid-template-columns:1fr}
  #aiPanel{width:calc(100vw - 32px);right:16px;height:520px}
}
@media(max-width:860px){.auth-page{grid-template-columns:1fr}.auth-left{display:none}.auth-right{padding:24px 16px;min-height:100vh}}
@media(max-width:900px){
  .chart-layout{grid-template-columns:1fr;height:auto}.orderbook-panel,.trades-panel{display:none}
  #tvChartContainer{height:320px;flex:none}
  .dash-body{grid-template-columns:1fr}.dash-sidebar{display:none}
  .balance-cards{grid-template-columns:1fr 1fr}.quick-actions{grid-template-columns:repeat(3,1fr)}
  .dash-two-col,.dash-three-col{grid-template-columns:1fr}
}
@media(max-width:1100px){
  .dash-three-col{grid-template-columns:1fr 1fr}
  .trading-body{grid-template-columns:1fr 260px}.trade-right-col{display:none}
}
@media(max-width:480px){.balance-cards{grid-template-columns:1fr}.quick-actions{grid-template-columns:repeat(2,1fr)}}
@media(max-width:750px){.trading-body{grid-template-columns:1fr;height:auto}.trade-chart-col #tvTradingChart{height:260px}}
</style>
</head>
<body>

<div id="refBanner">
  <button class="ref-close" onclick="closeRefBanner()">Ã—</button>
  <div style="font-size:13px;color:rgba(255,255,255,.7);margin-bottom:4px;">ðŸŽ‰ <strong id="refName">Your friend</strong> invited you to CryptoPro!</div>
  <span class="ref-bonus-amt">$25 SIGNUP BONUS</span>
  <div style="font-size:12px;color:rgba(255,255,255,.6);margin-top:6px;">Sign up now â€” bonus credited instantly</div>
</div>
<div id="toast"></div>

<div class="modal-overlay" id="orderModal" style="display:none;" onclick="closeOrderModal(event)">
  <div class="modal-box">
    <div class="modal-title" id="modalTitle">Confirm Order</div>
    <div id="modalRows"></div>
    <div class="modal-actions">
      <button class="btn-auth-outline" style="flex:1" onclick="document.getElementById('orderModal').style.display='none'">Cancel</button>
      <button class="btn-auth" style="flex:2" id="modalConfirmBtn" onclick="confirmTrade()">âœ… Confirm Trade</button>
    </div>
  </div>
</div>

<div id="fillNotif" style="display:none;"></div>

<button id="aiBtn" onclick="toggleAI()">
  <div class="ai-pulse-ring"></div>
  <div class="ai-pulse-ring2"></div>
  <div class="ai-logo">
    <svg viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">
      <circle cx="15" cy="15" r="14" fill="url(#aiGrad)"/>
      <path d="M9 15C9 11.686 11.686 9 15 9V9C18.314 9 21 11.686 21 15V15C21 18.314 18.314 21 15 21V21C11.686 21 9 18.314 9 15V15Z" stroke="white" stroke-width="1.5"/>
      <circle cx="15" cy="15" r="3" fill="white"/>
      <path d="M15 5V7M15 23V25M5 15H7M23 15H25" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
      <defs><linearGradient id="aiGrad" x1="0" y1="0" x2="30" y2="30" gradientUnits="userSpaceOnUse"><stop stop-color="#1E40AF"/><stop offset="1" stop-color="#3B82F6"/></linearGradient></defs>
    </svg>
  </div>
</button>

<div id="aiPanel">
  <div class="ai-header">
    <div class="ai-avatar">
      <svg viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="11" cy="11" r="10" fill="rgba(59,130,246,0.3)"/>
        <path d="M6 11C6 8.239 8.239 6 11 6C13.761 6 16 8.239 16 11C16 13.761 13.761 16 11 16C8.239 16 6 13.761 6 11Z" stroke="white" stroke-width="1.2"/>
        <circle cx="11" cy="11" r="2.5" fill="white"/>
        <path d="M11 2V4M11 18V20M2 11H4M18 11H20" stroke="white" stroke-width="1.2" stroke-linecap="round"/>
      </svg>
    </div>
    <div class="ai-header-info">
      <div class="ai-header-title">CryptoPro AI</div>
      <div class="ai-header-status">Neural Engine Online</div>
    </div>
    <div class="ai-header-actions">
      <button class="ai-header-btn" onclick="clearAIChat()" title="Clear chat">ðŸ—‘</button>
      <button class="ai-header-btn" onclick="toggleAI()" title="Close">âœ•</button>
    </div>
  </div>
  <div class="ai-model-bar">
    <span>Model:</span>
    <div class="ai-model-pill">âš¡ CryptoPro-Neural v2</div>
    <span style="margin-left:auto">Context: <strong style="color:var(--text1)">Active</strong></span>
  </div>
  <div class="ai-messages" id="aiMessages">
    <div class="ai-msg bot">
      <div class="ai-msg-bubble">
        ðŸ‘‹ <strong>Hello! I'm CryptoPro AI</strong> â€” your advanced trading intelligence assistant.<br><br>
        I can help you with:<br>
        â€¢ ðŸ“Š Real-time market analysis<br>
        â€¢ ðŸ¤– AI bot strategies &amp; setup<br>
        â€¢ ðŸ’° Deposits, withdrawals &amp; payments<br>
        â€¢ âš¡ Trade signals &amp; entry points<br>
        â€¢ ðŸŽ“ Trading education &amp; risk management<br><br>
        What would you like to explore today?
      </div>
      <div class="ai-msg-meta">
        <div class="ai-msg-avatar">AI</div>
        <span>CryptoPro AI</span>
        <span>â€¢</span>
        <span>Just now</span>
      </div>
    </div>
  </div>
  <div class="ai-capabilities">
    <div class="ai-cap">ðŸ“Š Market Analysis</div>
    <div class="ai-cap">âš¡ Trade Signals</div>
    <div class="ai-cap">ðŸ¤– Bot Config</div>
    <div class="ai-cap">ðŸ’° Payments</div>
    <div class="ai-cap">ðŸ›¡ Risk Mgmt</div>
  </div>
  <div class="ai-suggestions">
    <button class="ai-sug" onclick="aiQuick('How do I start trading?')">ðŸš€ Start trading</button>
    <button class="ai-sug" onclick="aiQuick('What is leverage trading?')">ðŸ“Š Leverage</button>
    <button class="ai-sug" onclick="aiQuick('How do I deposit via M-Pesa?')">ðŸ’° Deposit</button>
    <button class="ai-sug" onclick="aiQuick('How do AI bots work?')">ðŸ¤– AI Bots</button>
    <button class="ai-sug" onclick="aiQuick('How do I withdraw my profits?')">ðŸ’¸ Withdraw</button>
    <button class="ai-sug" onclick="aiQuick('What are the best coins to trade?')">ðŸ”¥ Hot coins</button>
  </div>
  <div class="ai-input-area">
    <div class="ai-input-wrap">
      <textarea class="ai-input" id="aiInput" placeholder="Ask me anything about tradingâ€¦" rows="1" onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();sendAI()}" oninput="autoResize(this)"></textarea>
      <button class="ai-send" id="aiSendBtn" onclick="sendAI()">
        <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><path d="M1 7L13 1L8.5 13L7 8L1 7Z" fill="white"/></svg>
      </button>
    </div>
    <div class="ai-footer-hint">Powered by CryptoPro Neural Engine Â· Not financial advice</div>
  </div>
</div>

<div id="notifDropdown" class="notif-dropdown">
  <div class="notif-header">
    <span>Notifications</span>
    <button onclick="clearNotifications()" style="background:none;border:none;color:var(--text3);font-size:11px;cursor:pointer">Clear all</button>
  </div>
  <div id="notifList"></div>
</div>

<!-- WELCOME LAYER -->
<div id="welcomeLayer" class="layer active">
  <nav class="navbar">
    <div class="nav-logo" onclick="showLayer('welcomeLayer')"><div class="nav-logo-mark">â‚¿</div><div class="nav-logo-text">Crypto<span>Pro</span></div></div>
    <div class="nav-ticker"><div class="nav-ticker-track" id="navTickerTrack"></div></div>
    <div class="nav-right">
      <div class="live-badge"><div class="live-dot"></div>LIVE</div>
      <button class="btn btn-outline" onclick="showLayer('loginLayer')">Login</button>
      <button class="btn btn-green" onclick="showLayer('signupLayer')">Sign Up Free</button>
    </div>
  </nav>
  <div class="market-bar"><div class="market-bar-track" id="marketBarTrack"></div></div>
  <section class="hero">
    <div class="hero-grid"></div>
    <div class="hero-tag"><div class="live-dot"></div>50,000+ Active Traders Worldwide</div>
    <h1 class="hero-title">Trade Smarter<br><span class="accent">Earn Bigger</span><br><span class="dim">with AI Power</span></h1>
    <p class="hero-sub">Professional crypto trading with AI bots, real-time TradingView charts, and live order books. Get your <strong style="color:var(--green)">$25 bonus</strong> when you sign up today.</p>
    <div class="hero-cta">
      <button class="btn-hero-primary" onclick="showLayer('signupLayer')">Start Trading â€” Free</button>
      <button class="btn-hero-secondary" onclick="showLayer('chartsLayer')">View Live Charts â†’</button>
    </div>
  </section>
  <div class="stats-bar">
    <div class="stat-item"><span class="stat-val">50,000+</span><span class="stat-lbl">Active Traders</span></div>
    <div class="stat-item"><span class="stat-val">$125M+</span><span class="stat-lbl">Total Volume</span></div>
    <div class="stat-item"><span class="stat-val">98.5%</span><span class="stat-lbl">Uptime</span></div>
    <div class="stat-item"><span class="stat-val">4.9â˜…</span><span class="stat-lbl">User Rating</span></div>
    <div class="stat-item"><span class="stat-val">15,000+</span><span class="stat-lbl">Daily Trades</span></div>
  </div>
  <section class="traders-section">
    <div class="section-header"><span class="section-title">Live Active Traders</span><span class="section-badge">â— LIVE</span></div>
    <div class="traders-track-wrap"><div class="traders-track" id="tradersTrack"></div></div>
  </section>
  <section class="winners-section">
    <div class="section-header"><span class="section-title">ðŸ† Top Traders This Week</span></div>
    <div class="winners-grid" id="winnersGrid"></div>
  </section>
  <section class="features-section">
    <div class="section-header"><span class="section-title">Why CryptoPro?</span></div>
    <div class="features-grid">
      <div class="feature-card" onclick="showLayer('chartsLayer')"><div class="feature-icon fi-green">ðŸ“ˆ</div><div class="feature-title">TradingView Charts</div><div class="feature-desc">Professional real-time candlestick charts powered by TradingView Lightweight Charts with live Binance data.</div></div>
      <div class="feature-card" onclick="showLayer('signupLayer')"><div class="feature-icon fi-blue">ðŸ¤–</div><div class="feature-title">AI Trading Bots</div><div class="feature-desc">Set-and-forget automated bots with up to 91% win rate. Trade 24/7 while you sleep.</div></div>
      <div class="feature-card" onclick="showLayer('signupLayer')"><div class="feature-icon fi-yellow">âš¡</div><div class="feature-title">100Ã— Leverage</div><div class="feature-desc">Amplify your positions with up to 100x leverage on major crypto pairs.</div></div>
      <div class="feature-card" onclick="showLayer('signupLayer')"><div class="feature-icon fi-purple">ðŸ’¸</div><div class="feature-title">Fast Withdrawals</div><div class="feature-desc">Withdraw via M-Pesa, Bank Transfer, or USDT. Processed within 5â€“30 minutes.</div></div>
      <div class="feature-card" onclick="showLayer('signupLayer')"><div class="feature-icon fi-cyan">ðŸŽ</div><div class="feature-title">Referral Rewards</div><div class="feature-desc">Earn 10% lifetime commission on every deposit your referrals make.</div></div>
      <div class="feature-card"><div class="feature-icon fi-red">ðŸ”’</div><div class="feature-title">Bank-Grade Security</div><div class="feature-desc">256-bit SSL encryption, 2FA, and cold storage for all user funds.</div></div>
    </div>
  </section>
  <section class="reviews-section">
    <div class="section-header"><span class="section-title">â­ What Traders Say</span></div>
    <div class="reviews-grid" id="reviewsGrid"></div>
  </section>
  <section class="cta-section">
    <h2 class="cta-title">Ready to Start<br><span style="color:var(--green)">Earning Today?</span></h2>
    <p class="cta-sub">Join 50,000+ traders already profiting. Get your free $25 bonus just for signing up.</p>
    <button class="btn-hero-primary" onclick="showLayer('signupLayer')">Create Free Account â†’</button>
  </section>
  <footer class="footer">ðŸ”’ SSL Secured &nbsp;|&nbsp; ðŸ›¡ï¸ 2FA Protected &nbsp;|&nbsp; âœ… Funds Secured &nbsp;|&nbsp; Â© 2025 CryptoPro. All rights reserved.</footer>
</div>

<!-- LOGIN LAYER -->
<div id="loginLayer" class="layer">
  <div class="auth-page">
    <div class="auth-left">
      <div class="auth-left-inner">
        <div class="nav-logo" onclick="showLayer('welcomeLayer')" style="margin-bottom:48px;"><div class="nav-logo-mark">â‚¿</div><div class="nav-logo-text">Crypto<span>Pro</span></div></div>
        <h1 class="auth-big-title">Welcome<br>Back<span style="color:var(--green)">.</span></h1>
        <p class="auth-big-sub">Log in to your account and continue building your portfolio.</p>
        <div class="auth-trust-list">
          <div class="auth-trust-item"><span class="auth-trust-icon">ðŸ”’</span>256-bit SSL encryption</div>
          <div class="auth-trust-item"><span class="auth-trust-icon">ðŸ›¡ï¸</span>Two-factor authentication</div>
          <div class="auth-trust-item"><span class="auth-trust-icon">âš¡</span>Instant account access</div>
          <div class="auth-trust-item"><span class="auth-trust-icon">ðŸ’Ž</span>50,000+ active traders</div>
        </div>
        <div class="auth-live-card">
          <div class="auth-live-row"><div class="live-badge"><div class="live-dot"></div>LIVE</div><span style="font-size:12px;color:var(--text3)">Right now</span></div>
          <div style="margin-top:10px;font-size:13px;color:var(--text2)" id="loginLiveMsg">ðŸŽ‰ Loading live feedâ€¦</div>
        </div>
      </div>
    </div>
    <div class="auth-right">
      <div class="auth-card">
        <div class="auth-card-header"><h2 class="auth-form-title">Sign in</h2><p class="auth-form-sub">Enter your credentials to access your account</p></div>
        <div id="loginAlert" class="form-alert" style="display:none;"></div>
        <form onsubmit="return handleLogin(event)">
          <div class="form-group"><label class="form-label">Email Address</label><div class="input-wrap"><span class="input-icon">âœ‰ï¸</span><input class="form-input" type="email" id="loginEmail" placeholder="you@email.com" required></div></div>
          <div class="form-group"><label class="form-label">Password <a class="form-label-link" href="#">Forgot password?</a></label><div class="input-wrap"><span class="input-icon">ðŸ”’</span><input class="form-input" type="password" id="loginPassword" placeholder="Enter your password" required><button type="button" class="input-eye" onclick="togglePwd('loginPassword',this)">ðŸ‘</button></div></div>
          <div id="twoFAStep" style="display:none;">
            <div class="twofa-box">
              <div style="font-size:28px;margin-bottom:8px;">ðŸ”</div>
              <div style="font-weight:700;margin-bottom:4px;">Two-Factor Authentication</div>
              <div style="font-size:12px;color:var(--text2);margin-bottom:14px;">Enter the 6-digit code sent to your phone</div>
              <div class="otp-row" id="otpRow">
                <input class="otp-input" maxlength="1" oninput="otpNext(this,0)">
                <input class="otp-input" maxlength="1" oninput="otpNext(this,1)">
                <input class="otp-input" maxlength="1" oninput="otpNext(this,2)">
                <input class="otp-input" maxlength="1" oninput="otpNext(this,3)">
                <input class="otp-input" maxlength="1" oninput="otpNext(this,4)">
                <input class="otp-input" maxlength="1" oninput="otpNext(this,5)">
              </div>
              <div style="font-size:11px;color:var(--text3);margin-top:8px;">Demo code: <strong style="color:var(--green);font-family:var(--font-mono)">123456</strong></div>
            </div>
          </div>
          <button type="submit" class="btn-auth" id="loginBtn"><span id="loginBtnText">Sign In â†’</span><span id="loginBtnSpinner" style="display:none" class="btn-spinner">âŸ³</span></button>
        </form>
        <div class="auth-divider"><span>or continue with</span></div>
        <div class="social-row">
          <button class="social-btn" onclick="showToast('Google login coming soon!','blue')">ðŸŒ Google</button>
          <button class="social-btn" onclick="showToast('Apple login coming soon!','blue')">ðŸŽ Apple</button>
        </div>
        <p class="auth-switch-text">Don't have an account? <a onclick="showLayer('signupLayer')">Create one free â†’</a></p>
      </div>
    </div>
  </div>
</div>

<!-- SIGNUP LAYER -->
<div id="signupLayer" class="layer">
  <div class="auth-page">
    <div class="auth-left">
      <div class="auth-left-inner">
        <div class="nav-logo" onclick="showLayer('welcomeLayer')" style="margin-bottom:48px;"><div class="nav-logo-mark">â‚¿</div><div class="nav-logo-text">Crypto<span>Pro</span></div></div>
        <h1 class="auth-big-title">Start<br>Earning<span style="color:var(--green)">.</span></h1>
        <p class="auth-big-sub">Join 50,000+ traders already making daily profits with AI-powered automation.</p>
        <div class="signup-bonus-card">
          <div class="sbc-top"><span style="font-size:28px;">ðŸŽ</span><div><div style="font-size:12px;color:rgba(255,255,255,.6);margin-bottom:2px;">WELCOME BONUS</div><div style="font-size:32px;font-weight:900;font-family:var(--font-mono);color:var(--yellow);">$25.00</div></div></div>
          <div style="font-size:12px;color:rgba(255,255,255,.6);margin-top:8px;line-height:1.5;">âœ… Credited instantly on signup<br>âœ… 100% Welcome bonus on first deposit<br>âœ… No hidden fees</div>
        </div>
        <div class="auth-steps">
          <div class="auth-step"><div class="step-num">1</div><span>Create your account</span></div>
          <div class="auth-step"><div class="step-num">2</div><span>Get $25 demo bonus</span></div>
          <div class="auth-step"><div class="step-num">3</div><span>Deposit &amp; start trading</span></div>
          <div class="auth-step"><div class="step-num">4</div><span>Withdraw your profits</span></div>
        </div>
      </div>
    </div>
    <div class="auth-right">
      <div class="auth-card">
        <div class="auth-card-header"><h2 class="auth-form-title">Create Account</h2><p class="auth-form-sub">Join free â€” takes less than 60 seconds</p></div>
        <div class="signup-progress">
          <div class="sp-bar"><div class="sp-fill" id="spFill" style="width:33%"></div></div>
          <div class="sp-steps"><span class="sp-step active" id="sp1">Personal</span><span class="sp-step" id="sp2">Security</span><span class="sp-step" id="sp3">Confirm</span></div>
        </div>
        <div id="signupAlert" class="form-alert" style="display:none;"></div>
        <form onsubmit="return handleSignup(event)" id="signupForm">
          <div id="signupStep1">
            <div class="form-group"><label class="form-label">Full Name</label><div class="input-wrap"><span class="input-icon">ðŸ‘¤</span><input class="form-input" type="text" id="signupName" placeholder="Your full name" required></div></div>
            <div class="form-group"><label class="form-label">Email Address</label><div class="input-wrap"><span class="input-icon">âœ‰ï¸</span><input class="form-input" type="email" id="signupEmail" placeholder="you@email.com" required></div></div>
            <div class="form-group"><label class="form-label">Phone Number</label><div class="input-wrap"><span class="input-icon">ðŸ“±</span><input class="form-input" type="tel" id="signupPhone" placeholder="+254 712 345 678" required></div></div>
            <button type="button" class="btn-auth" onclick="signupNext(1)">Continue â†’</button>
          </div>
          <div id="signupStep2" style="display:none;">
            <div class="form-group">
              <label class="form-label">Password</label>
              <div class="input-wrap"><span class="input-icon">ðŸ”’</span><input class="form-input" type="password" id="signupPassword" placeholder="Min. 8 characters" required oninput="checkPasswordStrength(this.value)"><button type="button" class="input-eye" onclick="togglePwd('signupPassword',this)">ðŸ‘</button></div>
              <div class="pwd-strength"><div class="pwd-bar"><div class="pwd-fill" id="pwdFill"></div></div><span class="pwd-label" id="pwdLabel"></span></div>
            </div>
            <div class="form-group"><label class="form-label">Confirm Password</label><div class="input-wrap"><span class="input-icon">ðŸ”’</span><input class="form-input" type="password" id="signupConfirm" placeholder="Re-enter password" required><button type="button" class="input-eye" onclick="togglePwd('signupConfirm',this)">ðŸ‘</button></div></div>
            <div class="form-group"><label class="form-label">Referral Code <span style="color:var(--text3);font-weight:400">(optional)</span></label><div class="input-wrap"><span class="input-icon">ðŸŽ</span><input class="form-input" type="text" id="signupReferralCode" placeholder="Enter referral code"></div></div>
            <div style="display:flex;gap:8px;"><button type="button" class="btn-auth-outline" onclick="signupBack(2)">â† Back</button><button type="button" class="btn-auth" style="flex:1" onclick="signupNext(2)">Continue â†’</button></div>
          </div>
          <div id="signupStep3" style="display:none;">
            <div class="confirm-box">
              <div style="text-align:center;margin-bottom:20px;"><div style="font-size:48px;margin-bottom:8px;">ðŸŽ‰</div><div style="font-size:18px;font-weight:700;font-family:var(--font-display)">Almost there!</div><div style="font-size:13px;color:var(--text2);margin-top:4px">Review your details</div></div>
              <div class="confirm-row"><span>Name</span><strong id="confirmName">â€”</strong></div>
              <div class="confirm-row"><span>Email</span><strong id="confirmEmail">â€”</strong></div>
              <div class="confirm-row"><span>Phone</span><strong id="confirmPhone">â€”</strong></div>
              <div class="confirm-row"><span>Bonus</span><strong style="color:var(--green)">$25.00 Free</strong></div>
              <div class="confirm-row"><span>Referral</span><strong id="confirmRef">None</strong></div>
            </div>
            <label class="checkbox-row"><input type="checkbox" id="agreeTerms" required><span>I agree to the <a href="#" style="color:var(--green)">Terms of Service</a> and <a href="#" style="color:var(--green)">Privacy Policy</a></span></label>
            <div style="display:flex;gap:8px;margin-top:16px;"><button type="button" class="btn-auth-outline" onclick="signupBack(3)">â† Back</button><button type="submit" class="btn-auth" style="flex:1" id="signupBtn"><span id="signupBtnText">ðŸš€ Create Account</span><span id="signupBtnSpinner" style="display:none" class="btn-spinner">âŸ³</span></button></div>
          </div>
        </form>
        <p class="auth-switch-text" style="margin-top:20px;">Already have an account? <a onclick="showLayer('loginLayer')">Sign in â†’</a></p>
      </div>
    </div>
  </div>
</div>

<!-- CHARTS LAYER -->
<div id="chartsLayer" class="layer">
  <nav class="navbar">
    <div class="nav-logo" onclick="showLayer('welcomeLayer')"><div class="nav-logo-mark">â‚¿</div><div class="nav-logo-text">Crypto<span>Pro</span></div></div>
    <div class="nav-ticker"><div class="nav-ticker-track" id="chartNavTicker"></div></div>
    <div class="nav-right">
      <div class="live-badge"><div class="live-dot"></div>BINANCE LIVE</div>
      <button class="btn btn-outline" onclick="showLayer('loginLayer')">Login</button>
      <button class="btn btn-green" onclick="showLayer('signupLayer')">Sign Up</button>
    </div>
  </nav>
  <div class="pair-bar"><div class="pair-bar-inner">
    <button class="pair-btn active" onclick="selectPair('BTC','USDT',this)">BTC/USDT</button>
    <button class="pair-btn" onclick="selectPair('ETH','USDT',this)">ETH/USDT</button>
    <button class="pair-btn" onclick="selectPair('BNB','USDT',this)">BNB/USDT</button>
    <button class="pair-btn" onclick="selectPair('SOL','USDT',this)">SOL/USDT</button>
    <button class="pair-btn" onclick="selectPair('ADA','USDT',this)">ADA/USDT</button>
    <button class="pair-btn" onclick="selectPair('XRP','USDT',this)">XRP/USDT</button>
    <button class="pair-btn" onclick="selectPair('AVAX','USDT',this)">AVAX/USDT</button>
    <button class="pair-btn" onclick="selectPair('DOT','USDT',this)">DOT/USDT</button>
  </div></div>
  <div class="price-header">
    <div class="ph-left">
      <div class="ph-pair" id="phPairName">BTC / USDT</div>
      <div class="ph-price" id="phPrice">Loadingâ€¦</div>
      <div class="ph-change up" id="phChange">â€”</div>
    </div>
    <div class="ph-stats">
      <div class="ph-stat"><span class="ph-stat-lbl">24h High</span><span class="ph-stat-val" id="ph24hHigh">â€”</span></div>
      <div class="ph-stat"><span class="ph-stat-lbl">24h Low</span><span class="ph-stat-val" id="ph24hLow">â€”</span></div>
      <div class="ph-stat"><span class="ph-stat-lbl">24h Vol</span><span class="ph-stat-val" id="ph24hVol">â€”</span></div>
      <div class="ph-stat"><span class="ph-stat-lbl">Open</span><span class="ph-stat-val" id="phOpen">â€”</span></div>
    </div>
    <div class="ph-right">
      <div class="interval-btns">
        <button class="iv-btn active" onclick="setChartInterval('1m',this)">1m</button>
        <button class="iv-btn" onclick="setChartInterval('5m',this)">5m</button>
        <button class="iv-btn" onclick="setChartInterval('15m',this)">15m</button>
        <button class="iv-btn" onclick="setChartInterval('1h',this)">1H</button>
        <button class="iv-btn" onclick="setChartInterval('4h',this)">4H</button>
        <button class="iv-btn" onclick="setChartInterval('1d',this)">1D</button>
      </div>
    </div>
  </div>
  <div class="chart-layout">
    <div class="chart-main">
      <div class="indicator-bar">
        <span style="font-size:11px;color:var(--text3);font-weight:600;text-transform:uppercase;letter-spacing:.5px;">Indicators:</span>
        <button class="ind-btn active" onclick="toggleMA(this)">MA(20)</button>
        <button class="ind-btn active" onclick="toggleBB(this)">BB</button>
        <button class="ind-btn" onclick="toggleVol(this)">Volume</button>
        <button class="ind-btn" onclick="toggleRSI(this)">RSI</button>
        <div style="margin-left:auto;display:flex;align-items:center;gap:8px;">
          <div class="live-badge" style="font-size:10px;padding:3px 8px;"><div class="live-dot"></div>BINANCE LIVE</div>
          <button class="ind-btn" onclick="showLayer('signupLayer')" style="background:var(--green);color:#000;border-color:var(--green);">Trade Now â†’</button>
        </div>
      </div>
      <div id="tvChartContainer" style="flex:1;min-height:0;"></div>
      <div class="vol-wrap-tv" id="volWrapTV" style="display:none;"><div id="tvVolContainer" style="height:100%;"></div></div>
      <div class="rsi-wrap-tv" id="rsiWrapTV"><div id="tvRsiContainer" style="height:100%;position:relative;"><div style="position:absolute;top:4px;left:8px;font-size:10px;color:var(--text3);font-family:var(--font-mono);z-index:1;">RSI(14)</div></div></div>
      <div class="depth-section">
        <div class="depth-header"><span class="section-title">ðŸ“Š Market Depth</span><div style="display:flex;gap:12px;font-size:11px;"><span style="color:var(--green);">â–¬ Bids</span><span style="color:var(--red);">â–¬ Asks</span></div></div>
        <div class="depth-wrap"><canvas id="depthCanvas"></canvas></div>
      </div>
    </div>
    <div class="orderbook-panel">
      <div class="ob-header"><span class="ob-title">Order Book</span><div class="ob-tabs"><button class="ob-tab active" onclick="setOBView('both',this)">â¬›</button><button class="ob-tab" onclick="setOBView('asks',this)">ðŸ”´</button><button class="ob-tab" onclick="setOBView('bids',this)">ðŸŸ¢</button></div></div>
      <div class="ob-labels"><span>Price (USDT)</span><span>Amount</span><span>Total</span></div>
      <div class="ob-asks" id="obAsks"></div>
      <div class="ob-spread"><span id="obSpreadPrice" class="ob-spread-price">â€”</span><span id="obSpreadPct" class="ob-spread-pct">Spread</span></div>
      <div class="ob-bids" id="obBids"></div>
    </div>
    <div class="trades-panel">
      <div class="tp-header"><span class="ob-title">Recent Trades</span><div class="live-badge" style="font-size:10px;padding:3px 8px;"><div class="live-dot"></div>LIVE</div></div>
      <div class="tp-labels"><span>Price</span><span>Amount</span><span>Time</span></div>
      <div class="tp-feed" id="tradesFeed"></div>
    </div>
  </div>
  <div class="market-overview-section">
    <div class="section-header" style="padding:0 0 16px;"><span class="section-title">ðŸ“ˆ Market Overview</span></div>
    <div class="market-cards-grid" id="marketCardsGrid"></div>
  </div>
  <div style="text-align:center;padding:32px;border-top:1px solid var(--border);">
    <p style="color:var(--text2);font-size:14px;margin-bottom:16px;">Ready to start trading these markets?</p>
    <button class="btn-hero-primary" onclick="showLayer('signupLayer')">Open Free Account â†’</button>
  </div>
</div>

<!-- DASHBOARD LAYER -->
<div id="dashboardLayer" class="layer">
  <nav class="navbar">
    <div class="nav-logo" onclick="showLayer('dashboardLayer')"><div class="nav-logo-mark">â‚¿</div><div class="nav-logo-text">Crypto<span>Pro</span></div></div>
    <div class="nav-ticker"><div class="nav-ticker-track" id="dashNavTicker"></div></div>
    <div class="nav-right">
      <div class="live-badge"><div class="live-dot"></div>LIVE</div>
      <div style="position:relative;">
        <div class="notif-bell" id="notifBell" onclick="toggleNotifications()">ðŸ””<div class="notif-count" id="notifCount">3</div></div>
      </div>
      <div class="dash-user-chip" id="dashUserChip"><div class="duc-avatar">ðŸ‘¤</div><span id="duchName">User</span><span style="color:var(--text3)">â–¾</span></div>
      <button class="btn btn-outline" onclick="handleLogout()">Logout</button>
    </div>
  </nav>
  <div class="market-bar"><div class="market-bar-track" id="dashMarketBar"></div></div>
  <div class="dash-body">
    <aside class="dash-sidebar">
      <div class="sidebar-balance">
        <div class="sbl-label" id="sblLabel">DEMO BALANCE</div>
        <div class="sbl-amount" id="sblAmount">$25.00</div>
        <div class="sbl-sub">Available to trade</div>
        <div class="mode-toggle"><button class="mt-btn active" id="mtDemo" onclick="switchMode('demo')">ðŸ“Š DEMO</button><button class="mt-btn" id="mtReal" onclick="switchMode('real')">ðŸ’Ž REAL</button></div>
      </div>
      <nav class="sidebar-nav">
        <div class="snav-section">MAIN</div>
        <div class="snav-item active" id="snavOverview" onclick="dashTab('overview')"><span class="snav-icon">ðŸ“Š</span>Overview</div>
        <div class="snav-item" onclick="showLayer('tradingLayer')"><span class="snav-icon">âš¡</span>Trade</div>
        <div class="snav-item" onclick="showLayer('chartsLayer')"><span class="snav-icon">ðŸ“ˆ</span>Live Charts</div>
        <div class="snav-item" onclick="showLayer('botsLayer')"><span class="snav-icon">ðŸ¤–</span>AI Bots</div>
        <div class="snav-section">INSIGHTS</div>
        <div class="snav-item" onclick="showLayer('signalsLayer')"><span class="snav-icon">ðŸ“¡</span>AI Signals<span class="snav-badge">LIVE</span></div>
        <div class="snav-item" onclick="showLayer('analysisLayer')"><span class="snav-icon">ðŸ§ </span>Analysis</div>
        <div class="snav-item" onclick="showLayer('recommendLayer')"><span class="snav-icon">â­</span>For You</div>
        <div class="snav-section">ACCOUNT</div>
        <div class="snav-item" onclick="showLayer('depositLayer')"><span class="snav-icon">ðŸ’°</span>Deposit</div>
        <div class="snav-item" onclick="showLayer('withdrawLayer')"><span class="snav-icon">ðŸ’¸</span>Withdraw</div>
        <div class="snav-item" onclick="showLayer('historyLayer')"><span class="snav-icon">ðŸ“œ</span>History</div>
        <div class="snav-item" onclick="showLayer('referralLayer')"><span class="snav-icon">ðŸŽ</span>Referrals<span class="snav-badge">10%</span></div>
        <div class="snav-item" onclick="showLayer('profileLayer')"><span class="snav-icon">âš™ï¸</span>Profile</div>
      </nav>
      <div class="sidebar-ref-card">
        <div style="font-size:11px;color:var(--text3);margin-bottom:6px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;">Referral Link</div>
        <div class="src-link" id="sideRefLink">Loadingâ€¦</div>
        <button class="src-copy" onclick="copySideRef()">ðŸ“‹ Copy Link</button>
      </div>
    </aside>
    <main class="dash-content" id="dashContent">
      <div class="balance-cards">
        <div class="bal-card primary"><div class="bc-label" id="bcLabel">Demo Balance</div><div class="bc-amount" id="bcAmount">$25.00</div><div class="bc-change up" id="bcChange">+0.00%</div></div>
        <div class="bal-card"><div class="bc-label">Total Profit</div><div class="bc-amount text-green" id="bcProfit">$0.00</div><div style="font-size:11px;color:var(--text3);margin-top:4px;">All time</div></div>
        <div class="bal-card"><div class="bc-label">Total Deposits</div><div class="bc-amount" id="bcDeposits">$0.00</div><div style="font-size:11px;color:var(--text3);margin-top:4px;">Cumulative</div></div>
        <div class="bal-card"><div class="bc-label">Win Rate</div><div class="bc-amount text-blue" id="bcWinRate">â€”</div><div style="font-size:11px;color:var(--text3);margin-top:4px;">Closed trades</div></div>
      </div>
      <div class="quick-actions">
        <button class="qa-btn qa-trade" onclick="showLayer('tradingLayer')"><span class="qa-icon">âš¡</span><span>Trade</span></button>
        <button class="qa-btn qa-deposit" onclick="showLayer('depositLayer')"><span class="qa-icon">ðŸ’°</span><span>Deposit</span></button>
        <button class="qa-btn qa-withdraw" onclick="showLayer('withdrawLayer')"><span class="qa-icon">ðŸ’¸</span><span>Withdraw</span></button>
        <button class="qa-btn qa-bots" onclick="showLayer('botsLayer')"><span class="qa-icon">ðŸ¤–</span><span>AI Bots</span></button>
        <button class="qa-btn qa-ref" onclick="showLayer('referralLayer')"><span class="qa-icon">ðŸŽ</span><span>Refer</span></button>
        <button class="qa-btn qa-charts" onclick="showLayer('chartsLayer')"><span class="qa-icon">ðŸ“ˆ</span><span>Charts</span></button>
      </div>
      <div class="dash-two-col">
        <div class="dash-card">
          <div class="dc-header"><span class="dc-title">ðŸ“ˆ Portfolio Performance</span><div class="dc-tabs"><button class="dc-tab active" onclick="setPerfPeriod('7d',this)">7D</button><button class="dc-tab" onclick="setPerfPeriod('30d',this)">30D</button><button class="dc-tab" onclick="setPerfPeriod('90d',this)">90D</button></div></div>
          <div class="dc-chart-wrap"><canvas id="perfCanvas"></canvas></div>
          <div class="perf-footer">
            <div class="pf-item"><span class="pf-lbl">Period Return</span><span class="pf-val text-green" id="pfReturn">+0.00%</span></div>
            <div class="pf-item"><span class="pf-lbl">Best Day</span><span class="pf-val text-green" id="pfBest">+0.00%</span></div>
            <div class="pf-item"><span class="pf-lbl">Worst Day</span><span class="pf-val text-red" id="pfWorst">-0.00%</span></div>
          </div>
        </div>
        <div class="dash-card">
          <div class="dc-header"><span class="dc-title">ðŸ”“ Open Positions</span><span class="dc-badge" id="openPosCount">0 Active</span></div>
          <div id="openPositionsContainer"><div class="empty-state"><div style="font-size:40px;margin-bottom:8px;">ðŸ“Š</div><div style="font-weight:600;color:var(--text2);">No open positions</div><div style="font-size:12px;color:var(--text3);margin-top:4px;">Start trading to see live P&L here</div><button class="btn btn-green" style="margin-top:16px;" onclick="showLayer('tradingLayer')">Open Trade â†’</button></div></div>
        </div>
      </div>
      <div class="dash-three-col">
        <div class="dash-card">
          <div class="dc-header"><span class="dc-title">ðŸ’¼ Asset Allocation</span></div>
          <div class="alloc-chart-wrap"><canvas id="allocCanvas"></canvas><div class="alloc-center"><div class="ac-amount" id="acAmount">$0</div><div class="ac-label">Total</div></div></div>
          <div class="alloc-legend" id="allocLegend"></div>
        </div>
        <div class="dash-card">
          <div class="dc-header"><span class="dc-title">ðŸ“œ Recent Trades</span><a class="dc-link" onclick="showLayer('historyLayer')">View all â†’</a></div>
          <div id="recentTradesContainer"><div class="empty-state"><div style="font-size:36px;margin-bottom:8px;">ðŸ“­</div><div style="font-size:13px;color:var(--text2);">No trades yet</div></div></div>
        </div>
        <div class="dash-card">
          <div class="dc-header"><span class="dc-title">ðŸŒ Market Snapshot</span><div class="live-badge" style="font-size:10px;"><div class="live-dot"></div>LIVE</div></div>
          <div class="msnap-list" id="mSnapList"></div>
        </div>
      </div>
      <div class="kyc-notice" id="kycNotice">
        <div style="display:flex;align-items:center;gap:12px;"><span style="font-size:28px;">ðŸ”</span><div><div style="font-weight:700;font-size:14px;margin-bottom:2px;">Complete KYC Verification</div><div style="font-size:12px;color:rgba(255,215,64,.8);">Verify your identity to unlock higher withdrawal limits.</div></div></div>
        <button class="kyc-btn" onclick="showToast('Contact support via AI assistant to begin KYC verification.','blue')">Verify Now â†’</button>
      </div>
    </main>
  </div>
</div>

<!-- TRADING LAYER -->
<div id="tradingLayer" class="layer">
  <nav class="navbar">
    <div class="nav-logo" onclick="showLayer('dashboardLayer')"><div class="nav-logo-mark">â‚¿</div><div class="nav-logo-text">Crypto<span>Pro</span></div></div>
    <div class="nav-ticker"><div class="nav-ticker-track" id="tradeNavTicker"></div></div>
    <div class="nav-right">
      <div class="live-badge"><div class="live-dot"></div>BINANCE LIVE</div>
      <button class="btn btn-outline" onclick="showLayer('dashboardLayer')">â† Dashboard</button>
    </div>
  </nav>
  <div class="pair-bar"><div class="pair-bar-inner" id="tradePairBar">
    <button class="pair-btn active" onclick="tradingSelectPair('BTC','USDT',this)">BTC/USDT</button>
    <button class="pair-btn" onclick="tradingSelectPair('ETH','USDT',this)">ETH/USDT</button>
    <button class="pair-btn" onclick="tradingSelectPair('BNB','USDT',this)">BNB/USDT</button>
    <button class="pair-btn" onclick="tradingSelectPair('SOL','USDT',this)">SOL/USDT</button>
    <button class="pair-btn" onclick="tradingSelectPair('ADA','USDT',this)">ADA/USDT</button>
    <button class="pair-btn" onclick="tradingSelectPair('XRP','USDT',this)">XRP/USDT</button>
    <button class="pair-btn" onclick="tradingSelectPair('AVAX','USDT',this)">AVAX/USDT</button>
    <button class="pair-btn" onclick="tradingSelectPair('DOT','USDT',this)">DOT/USDT</button>
  </div></div>
  <div class="trade-price-strip">
    <div class="tps-left"><span class="tps-pair" id="tpsPair">BTC/USDT</span><span class="tps-price" id="tpsPrice">Loadingâ€¦</span><span class="tps-chg up" id="tpsChg">â€”</span></div>
    <div class="tps-stats">
      <div class="tps-stat"><span class="tps-lbl">High</span><span class="tps-val" id="tpsHigh">â€”</span></div>
      <div class="tps-stat"><span class="tps-lbl">Low</span><span class="tps-val" id="tpsLow">â€”</span></div>
      <div class="tps-stat"><span class="tps-lbl">Volume</span><span class="tps-val" id="tpsVol">â€”</span></div>
      <div class="tps-stat"><span class="tps-lbl">Mode</span><span class="tps-val" id="tradeModeLabel" style="color:var(--yellow)">DEMO</span></div>
    </div>
    <div class="tps-bal"><span class="tps-lbl">Available</span><span class="tps-val text-green" id="tradeAvailBal">$0.00</span></div>
  </div>
  <div class="trading-body">
    <div class="trade-chart-col">
      <div class="indicator-bar">
        <span style="font-size:11px;color:var(--text3);font-weight:600;text-transform:uppercase;letter-spacing:.5px;">Chart:</span>
        <button class="ind-btn active" onclick="toggleTrdMA(this)">MA(20)</button>
        <button class="ind-btn active" onclick="toggleTrdBB(this)">BB</button>
        <button class="ind-btn" onclick="toggleTrdRSI(this)">RSI</button>
        <div style="display:flex;gap:2px;margin-left:8px;">
          <button class="iv-btn active" onclick="setTrdInterval('1m',this)">1m</button>
          <button class="iv-btn" onclick="setTrdInterval('5m',this)">5m</button>
          <button class="iv-btn" onclick="setTrdInterval('15m',this)">15m</button>
          <button class="iv-btn" onclick="setTrdInterval('1h',this)">1H</button>
          <button class="iv-btn" onclick="setTrdInterval('4h',this)">4H</button>
        </div>
        <div style="margin-left:auto;"><button class="ind-btn" style="background:var(--green);color:#000;border-color:var(--green);" onclick="showLayer('depositLayer')">ðŸ’° Deposit</button></div>
      </div>
      <div id="tvTradingChart" style="flex:1;min-height:0;height:300px;"></div>
      <div id="trdRsiWrap" style="height:80px;border-top:1px solid var(--border);display:none;position:relative;"><div id="tvTrdRsiContainer" style="height:100%;"></div><div style="position:absolute;top:4px;left:8px;font-size:10px;color:var(--text3);font-family:var(--font-mono);">RSI(14)</div></div>
    </div>
    <div class="order-panel">
      <div class="order-tabs"><button class="ot-btn buy active" id="otBuy" onclick="setOrderSide('buy')">â–² LONG / BUY</button><button class="ot-btn sell" id="otSell" onclick="setOrderSide('sell')">â–¼ SHORT / SELL</button></div>
      <div class="order-type-row">
        <button class="order-type-btn active" onclick="setOrderType('market',this)">Market</button>
        <button class="order-type-btn" onclick="setOrderType('limit',this)">Limit</button>
        <button class="order-type-btn" onclick="setOrderType('stop',this)">Stop</button>
      </div>
      <div class="op-group" id="limitPriceGroup" style="display:none;"><label class="op-label">Limit Price (USDT)</label><div class="op-input-wrap"><input class="op-input" type="number" id="limitPrice" placeholder="0.00"><span class="op-input-suffix">USDT</span></div></div>
      <div class="op-group">
        <label class="op-label">Amount (USD)</label>
        <div class="op-input-wrap"><input class="op-input" type="number" id="tradeAmt" placeholder="0.00" oninput="calcOrderSummary()" min="1"><span class="op-input-suffix">USD</span></div>
        <div class="quick-pct-row"><button class="qp-btn" onclick="setTradePct(25)">25%</button><button class="qp-btn" onclick="setTradePct(50)">50%</button><button class="qp-btn" onclick="setTradePct(75)">75%</button><button class="qp-btn" onclick="setTradePct(100)">MAX</button></div>
      </div>
      <div class="op-group">
        <label class="op-label">Leverage <span class="op-leverage-val" id="leverageVal">10Ã—</span></label>
        <input class="leverage-slider" type="range" id="leverageSlider" min="1" max="100" value="10" oninput="updateLeverage(this.value)">
        <div class="leverage-marks"><span onclick="updateLeverage(1)">1Ã—</span><span onclick="updateLeverage(5)">5Ã—</span><span onclick="updateLeverage(10)">10Ã—</span><span onclick="updateLeverage(25)">25Ã—</span><span onclick="updateLeverage(50)">50Ã—</span><span onclick="updateLeverage(100)">100Ã—</span></div>
      </div>
      <div class="tp-sl-row">
        <div class="op-group" style="flex:1;"><label class="op-label text-green">Take Profit</label><div class="op-input-wrap"><input class="op-input" type="number" id="takeProfit" placeholder="Optional" oninput="calcOrderSummary()"></div></div>
        <div class="op-group" style="flex:1;"><label class="op-label text-red">Stop Loss</label><div class="op-input-wrap"><input class="op-input" type="number" id="stopLoss" placeholder="Optional" oninput="calcOrderSummary()"></div></div>
      </div>
      <div class="order-summary">
        <div class="os-row"><span>Entry Price</span><span id="osEntry">â€”</span></div>
        <div class="os-row"><span>Position Size</span><span id="osPosition">â€”</span></div>
        <div class="os-row"><span>Margin Required</span><span id="osMargin">â€”</span></div>
        <div class="os-row"><span>Est. Profit (TP)</span><span id="osProfit" class="text-green">â€”</span></div>
        <div class="os-row"><span>Est. Loss (SL)</span><span id="osLoss" class="text-red">â€”</span></div>
        <div class="os-row"><span>Liquidation Price</span><span id="osLiq" style="color:var(--yellow)">â€”</span></div>
      </div>
      <div class="risk-warning" id="riskWarning" style="display:none;">âš ï¸ <span id="riskMsg">High leverage increases risk.</span></div>
      <button class="order-submit-btn buy" id="orderSubmitBtn" onclick="submitTrade()"><span id="orderSubmitText">â–² BUY / LONG</span></button>
      <div class="op-mode-row"><span style="font-size:11px;color:var(--text3);">Account:</span><button class="op-mode-btn active" id="opDemo" onclick="switchMode('demo');updateTradingPanel()">Demo</button><button class="op-mode-btn" id="opReal" onclick="switchMode('real');updateTradingPanel()">Real</button></div>
    </div>
    <div class="trade-right-col">
      <div class="mini-ob">
        <div class="mob-header">Order Book</div>
        <div class="ob-labels" style="font-size:9px;padding:4px 10px;"><span>Price</span><span style="text-align:center">Amt</span><span style="text-align:right">Total</span></div>
        <div id="miniObAsks" class="ob-asks" style="max-height:100px;"></div>
        <div class="ob-spread"><span id="miniSpreadPrice" class="ob-spread-price" style="font-size:12px;">â€”</span><span class="ob-spread-pct">Spread</span></div>
        <div id="miniObBids" class="ob-bids" style="max-height:100px;"></div>
      </div>
      <div class="my-positions">
        <div class="mob-header" style="display:flex;justify-content:space-between;align-items:center;">My Positions <span class="dc-badge" id="myPosCount">0</span></div>
        <div id="myPositionsList" style="overflow-y:auto;flex:1;"><div style="padding:16px;text-align:center;font-size:11px;color:var(--text3);">No open positions</div></div>
      </div>
      <div style="flex:1;overflow:hidden;display:flex;flex-direction:column;border-top:1px solid var(--border);">
        <div class="mob-header">Recent Closed</div>
        <div id="miniHistoryList" style="overflow-y:auto;flex:1;"><div style="padding:16px;text-align:center;font-size:11px;color:var(--text3);">No trades yet</div></div>
      </div>
    </div>
  </div>
</div>

<!-- DEPOSIT LAYER -->
<div id="depositLayer" class="layer">
  <nav class="navbar">
    <div class="nav-logo" onclick="showLayer('dashboardLayer')"><div class="nav-logo-mark">â‚¿</div><div class="nav-logo-text">Crypto<span>Pro</span></div></div>
    <div class="nav-right"><button class="btn btn-outline" onclick="showLayer('dashboardLayer')">â† Dashboard</button></div>
  </nav>
  <div style="max-width:600px;margin:40px auto;padding:0 20px;">
    <div class="dash-card">
      <div class="dc-header"><span class="dc-title">ðŸ’° Deposit Funds</span><span class="dc-badge" id="depositAvailBal">$0.00 available</span></div>
      <div style="background:linear-gradient(135deg,rgba(0,230,118,.12),rgba(0,200,83,.04));border:1px solid rgba(0,230,118,.25);border-radius:var(--r-xl);padding:16px;margin-bottom:20px;text-align:center;">
        <div style="font-size:12px;color:rgba(255,255,255,.7);margin-bottom:4px;">ðŸŽ FIRST DEPOSIT BONUS</div>
        <div style="font-size:36px;font-weight:900;font-family:var(--font-mono);color:var(--yellow);">100% MATCH</div>
        <div style="font-size:12px;color:rgba(255,255,255,.6);margin-top:4px;">Deposit $100 â†’ Trade with $200</div>
      </div>
      <div style="margin-bottom:20px;">
        <div class="op-label" style="margin-bottom:10px;">Payment Method</div>
        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;" id="depMethodGrid">
          <button class="dep-method-btn active" data-method="mpesa" onclick="selectDepMethod(this,'depMethodGrid')"><div style="font-size:24px;margin-bottom:4px;">ðŸ“±</div><div style="font-size:12px;font-weight:700;">M-Pesa</div><div style="font-size:10px;color:var(--text3);">Instant</div></button>
          <button class="dep-method-btn" data-method="bank" onclick="selectDepMethod(this,'depMethodGrid')"><div style="font-size:24px;margin-bottom:4px;">ðŸ¦</div><div style="font-size:12px;font-weight:700;">Bank Transfer</div><div style="font-size:10px;color:var(--text3);">1â€“2 hrs</div></button>
          <button class="dep-method-btn" data-method="crypto" onclick="selectDepMethod(this,'depMethodGrid')"><div style="font-size:24px;margin-bottom:4px;">â‚¿</div><div style="font-size:12px;font-weight:700;">Crypto</div><div style="font-size:10px;color:var(--text3);">BTC/ETH/USDT</div></button>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Amount (USD)</label>
        <div class="input-wrap"><span class="input-icon">ðŸ’µ</span><input class="form-input" type="number" id="depositAmt" placeholder="Minimum $10" min="10" oninput="calcDepBonus()"></div>
        <div style="display:flex;gap:6px;margin-top:8px;">
          <button class="qp-btn" onclick="document.getElementById('depositAmt').value=50;calcDepBonus()">$50</button>
          <button class="qp-btn" onclick="document.getElementById('depositAmt').value=100;calcDepBonus()">$100</button>
          <button class="qp-btn" onclick="document.getElementById('depositAmt').value=250;calcDepBonus()">$250</button>
          <button class="qp-btn" onclick="document.getElementById('depositAmt').value=500;calcDepBonus()">$500</button>
          <button class="qp-btn" onclick="document.getElementById('depositAmt').value=1000;calcDepBonus()">$1,000</button>
        </div>
      </div>
      <div id="depBonusLine" style="display:none;background:var(--green3);border:1px solid rgba(0,230,118,.25);border-radius:var(--r-md);padding:10px 14px;margin-bottom:16px;font-size:13px;justify-content:space-between;align-items:center;"><span>ðŸŽ 100% Welcome Bonus</span><span class="mono fw-bold text-green" id="depBonusAmt">+$0.00</span></div>
      <div id="mpesaPhoneGroup" class="form-group">
        <label class="form-label">M-Pesa Phone Number</label>
        <div class="input-wrap"><span class="input-icon">ðŸ“±</span><input class="form-input" type="tel" id="depPhone" placeholder="e.g. 0712345678"></div>
      </div>
      <div id="depDetails" style="background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-lg);padding:16px;margin-bottom:16px;font-size:13px;color:var(--text2);line-height:1.9;">
        ðŸ“± <strong style="color:var(--text1)">M-Pesa Till Number:</strong> <strong style="color:var(--green);font-family:var(--font-mono)">7500474</strong><br>
        Business Name: <strong style="color:var(--text1)">CryptoPro Trading</strong><br>
        <span style="font-size:11px;color:var(--text3);">Or enter phone below to receive an STK Push prompt</span>
      </div>
      <div id="depStatusBox" style="display:none;padding:14px;border-radius:var(--r-md);margin-bottom:14px;font-size:13px;text-align:center;"></div>
      <button class="btn-auth" id="depositBtn" onclick="submitDeposit()">ðŸ’° Deposit Now</button>
    </div>
  </div>
</div>

<!-- WITHDRAW LAYER -->
<div id="withdrawLayer" class="layer">
  <nav class="navbar">
    <div class="nav-logo" onclick="showLayer('dashboardLayer')"><div class="nav-logo-mark">â‚¿</div><div class="nav-logo-text">Crypto<span>Pro</span></div></div>
    <div class="nav-right"><button class="btn btn-outline" onclick="showLayer('dashboardLayer')">â† Dashboard</button></div>
  </nav>
  <div style="max-width:600px;margin:40px auto;padding:0 20px;">
    <div class="dash-card">
      <div class="dc-header"><span class="dc-title">ðŸ’¸ Withdraw Funds</span><span class="dc-badge" id="withdrawAvailBal">$0.00 available</span></div>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:20px;">
        <div style="background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-lg);padding:14px;text-align:center;"><div style="font-size:10px;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px;">Min Withdraw</div><div class="mono fw-bold text-green">$50.00</div></div>
        <div style="background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-lg);padding:14px;text-align:center;"><div style="font-size:10px;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px;">Fee</div><div class="mono fw-bold">2%</div></div>
        <div style="background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-lg);padding:14px;text-align:center;"><div style="font-size:10px;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px;">Processing</div><div class="mono fw-bold text-blue">5â€“30 min</div></div>
      </div>
      <div style="margin-bottom:20px;">
        <div class="op-label" style="margin-bottom:10px;">Withdrawal Method</div>
        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;" id="wdMethodGrid">
          <button class="dep-method-btn active" data-method="mpesa" onclick="selectDepMethod(this,'wdMethodGrid')"><div style="font-size:24px;margin-bottom:4px;">ðŸ“±</div><div style="font-size:12px;font-weight:700;">M-Pesa</div><div style="font-size:10px;color:var(--text3);">5â€“15 min</div></button>
          <button class="dep-method-btn" data-method="bank" onclick="selectDepMethod(this,'wdMethodGrid')"><div style="font-size:24px;margin-bottom:4px;">ðŸ¦</div><div style="font-size:12px;font-weight:700;">Bank</div><div style="font-size:10px;color:var(--text3);">1â€“2 hrs</div></button>
          <button class="dep-method-btn" data-method="crypto" onclick="selectDepMethod(this,'wdMethodGrid')"><div style="font-size:24px;margin-bottom:4px;">â‚¿</div><div style="font-size:12px;font-weight:700;">Crypto</div><div style="font-size:10px;color:var(--text3);">10â€“30 min</div></button>
        </div>
      </div>
      <div class="form-group"><label class="form-label">Amount (USD)</label><div class="input-wrap"><span class="input-icon">ðŸ’µ</span><input class="form-input" type="number" id="withdrawAmt" placeholder="Minimum $50" min="50" oninput="calcWithdrawFee()"></div></div>
      <div id="withdrawFeeBox" style="display:none;background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-md);padding:12px;margin-bottom:16px;font-size:12px;">
        <div style="display:flex;justify-content:space-between;padding:3px 0;"><span style="color:var(--text3)">Requested</span><span id="wfAmt" class="mono">â€”</span></div>
        <div style="display:flex;justify-content:space-between;padding:3px 0;"><span style="color:var(--text3)">Fee (2%)</span><span id="wfFee" class="mono text-red">â€”</span></div>
        <div style="display:flex;justify-content:space-between;padding:6px 0;border-top:1px solid var(--border);margin-top:4px;font-weight:700;"><span>You Receive</span><span id="wfNet" class="mono text-green">â€”</span></div>
      </div>
      <div class="form-group"><label class="form-label">Account / Phone Number</label><div class="input-wrap"><span class="input-icon">ðŸ“±</span><input class="form-input" type="text" id="withdrawAccount" placeholder="M-Pesa number / bank account / crypto address"></div></div>
      <button class="btn-auth" id="withdrawBtn" onclick="submitWithdraw()">ðŸ’¸ Withdraw Now</button>
    </div>
  </div>
</div>

<!-- BOTS LAYER -->
<div id="botsLayer" class="layer">
  <nav class="navbar">
    <div class="nav-logo" onclick="showLayer('dashboardLayer')"><div class="nav-logo-mark">â‚¿</div><div class="nav-logo-text">Crypto<span>Pro</span></div></div>
    <div class="nav-right"><div class="live-badge"><div class="live-dot"></div>LIVE</div><button class="btn btn-outline" onclick="showLayer('dashboardLayer')">â† Dashboard</button></div>
  </nav>
  <div style="padding:24px;">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:24px;flex-wrap:wrap;gap:12px;">
      <div><h2 style="font-family:var(--font-display);font-size:24px;font-weight:800;margin-bottom:4px;">ðŸ¤– AI Trading Bots</h2><p style="color:var(--text2);font-size:13px;">Set-and-forget automation. Trade 24/7 while you sleep.</p></div>
      <div style="display:flex;gap:12px;">
        <div style="background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-lg);padding:12px 20px;text-align:center;"><div class="mono fw-bold text-green" style="font-size:20px;" id="botsActiveCount">0</div><div style="font-size:11px;color:var(--text3);">Active Bots</div></div>
        <div style="background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-lg);padding:12px 20px;text-align:center;"><div class="mono fw-bold text-yellow" style="font-size:20px;">91%</div><div style="font-size:11px;color:var(--text3);">Best Win Rate</div></div>
      </div>
    </div>
    <div class="bots-grid" id="botsGrid"></div>
  </div>
</div>

<!-- HISTORY LAYER -->
<div id="historyLayer" class="layer">
  <nav class="navbar">
    <div class="nav-logo" onclick="showLayer('dashboardLayer')"><div class="nav-logo-mark">â‚¿</div><div class="nav-logo-text">Crypto<span>Pro</span></div></div>
    <div class="nav-right"><button class="btn btn-outline" onclick="showLayer('dashboardLayer')">â† Dashboard</button></div>
  </nav>
  <div style="padding:24px;">
    <h2 style="font-family:var(--font-display);font-size:22px;font-weight:800;margin-bottom:20px;">ðŸ“œ Trade History</h2>
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:24px;max-width:500px;">
      <div class="bal-card" style="padding:16px;text-align:center;"><div class="bc-label">Total P&L</div><div class="bc-amount" id="histTotalPnl" style="font-size:20px;">$0.00</div></div>
      <div class="bal-card" style="padding:16px;text-align:center;"><div class="bc-label">Win Rate</div><div class="bc-amount text-blue" id="histWinRate" style="font-size:20px;">â€”</div></div>
      <div class="bal-card" style="padding:16px;text-align:center;"><div class="bc-label">Total Trades</div><div class="bc-amount" id="histTotalTrades" style="font-size:20px;">0</div></div>
    </div>
    <div class="dash-card" style="overflow-x:auto;">
      <table style="width:100%;border-collapse:collapse;font-size:13px;">
        <thead><tr style="border-bottom:1px solid var(--border);">
          <th style="padding:8px 12px;text-align:left;color:var(--text3);font-size:10px;text-transform:uppercase;letter-spacing:.5px;">Result</th>
          <th style="padding:8px 12px;text-align:left;color:var(--text3);font-size:10px;text-transform:uppercase;letter-spacing:.5px;">Pair</th>
          <th style="padding:8px 12px;text-align:left;color:var(--text3);font-size:10px;text-transform:uppercase;letter-spacing:.5px;">Type</th>
          <th style="padding:8px 12px;text-align:left;color:var(--text3);font-size:10px;text-transform:uppercase;letter-spacing:.5px;">Amount</th>
          <th style="padding:8px 12px;text-align:left;color:var(--text3);font-size:10px;text-transform:uppercase;letter-spacing:.5px;">Leverage</th>
          <th style="padding:8px 12px;text-align:left;color:var(--text3);font-size:10px;text-transform:uppercase;letter-spacing:.5px;">P&L</th>
          <th style="padding:8px 12px;text-align:left;color:var(--text3);font-size:10px;text-transform:uppercase;letter-spacing:.5px;">Date</th>
        </tr></thead>
        <tbody id="historyTbody"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- REFERRAL LAYER -->
<div id="referralLayer" class="layer">
  <nav class="navbar">
    <div class="nav-logo" onclick="showLayer('dashboardLayer')"><div class="nav-logo-mark">â‚¿</div><div class="nav-logo-text">Crypto<span>Pro</span></div></div>
    <div class="nav-right"><button class="btn btn-outline" onclick="showLayer('dashboardLayer')">â† Dashboard</button></div>
  </nav>
  <div style="max-width:800px;margin:0 auto;padding:24px;">
    <h2 style="font-family:var(--font-display);font-size:22px;font-weight:800;margin-bottom:6px;">ðŸŽ Referral Program</h2>
    <p style="color:var(--text2);margin-bottom:24px;">Earn <strong style="color:var(--green)">10% lifetime commission</strong> on every deposit your referrals make.</p>
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:24px;">
      <div class="bal-card primary" style="padding:18px;text-align:center;"><div class="bc-label">Total Earned</div><div class="bc-amount text-green" id="refTotalEarned" style="font-size:22px;">$0.00</div></div>
      <div class="bal-card" style="padding:18px;text-align:center;"><div class="bc-label">Referrals</div><div class="bc-amount text-blue" id="refTotalCount" style="font-size:22px;">0</div></div>
      <div class="bal-card" style="padding:18px;text-align:center;"><div class="bc-label">Commission Rate</div><div class="bc-amount text-yellow" style="font-size:22px;">10%</div></div>
    </div>
    <div class="dash-card" style="margin-bottom:16px;">
      <div class="dc-header"><span class="dc-title">Your Referral Link</span></div>
      <div style="background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-md);padding:12px 14px;font-family:var(--font-mono);font-size:12px;color:var(--green);word-break:break-all;margin-bottom:12px;" id="refLinkDisplay">Loadingâ€¦</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;">
        <button class="btn btn-green" onclick="copyRefLink()">ðŸ“‹ Copy Link</button>
        <button class="btn btn-outline" onclick="shareRef('whatsapp')" style="color:#25D366;border-color:#25D36640;">ðŸ’¬ WhatsApp</button>
        <button class="btn btn-outline" onclick="shareRef('telegram')" style="color:#2CA5E0;border-color:#2CA5E040;">âœˆï¸ Telegram</button>
        <button class="btn btn-outline" onclick="shareRef('twitter')" style="color:#1DA1F2;border-color:#1DA1F240;">ðŸ¦ Twitter</button>
      </div>
    </div>
    <div class="dash-card" style="margin-bottom:16px;">
      <div class="dc-header"><span class="dc-title">How It Works</span></div>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;text-align:center;">
        <div style="padding:16px;background:var(--bg2);border-radius:var(--r-lg);"><div style="font-size:28px;margin-bottom:8px;">ðŸ”—</div><div style="font-weight:700;font-size:13px;margin-bottom:4px;">Share Your Link</div><div style="font-size:11px;color:var(--text2);">Send your unique referral link to friends</div></div>
        <div style="padding:16px;background:var(--bg2);border-radius:var(--r-lg);"><div style="font-size:28px;margin-bottom:8px;">ðŸ‘¤</div><div style="font-weight:700;font-size:13px;margin-bottom:4px;">They Sign Up</div><div style="font-size:11px;color:var(--text2);">Friend gets $25 bonus, you earn $5</div></div>
        <div style="padding:16px;background:var(--bg2);border-radius:var(--r-lg);"><div style="font-size:28px;margin-bottom:8px;">ðŸ’°</div><div style="font-weight:700;font-size:13px;margin-bottom:4px;">Earn Forever</div><div style="font-size:11px;color:var(--text2);">10% of every deposit they ever make</div></div>
      </div>
    </div>
    <div class="dash-card"><div class="dc-header"><span class="dc-title">Referral History</span></div><div id="refHistoryList"><div class="empty-state"><div style="font-size:40px;margin-bottom:8px;">ðŸ‘¥</div><div style="color:var(--text2);font-weight:600;">No referrals yet</div></div></div></div>
  </div>
</div>

<!-- PROFILE LAYER -->
<div id="profileLayer" class="layer">
  <nav class="navbar">
    <div class="nav-logo" onclick="showLayer('dashboardLayer')"><div class="nav-logo-mark">â‚¿</div><div class="nav-logo-text">Crypto<span>Pro</span></div></div>
    <div class="nav-right"><button class="btn btn-outline" onclick="showLayer('dashboardLayer')">â† Dashboard</button></div>
  </nav>
  <div style="max-width:600px;margin:40px auto;padding:0 20px;display:flex;flex-direction:column;gap:16px;">
    <div class="dash-card">
      <div class="dc-header"><span class="dc-title">âš™ï¸ Profile Settings</span></div>
      <div style="text-align:center;padding:20px 0;border-bottom:1px solid var(--border);margin-bottom:20px;">
        <div style="width:72px;height:72px;border-radius:50%;background:linear-gradient(135deg,var(--green),var(--blue));display:flex;align-items:center;justify-content:center;font-size:32px;margin:0 auto 12px;">ðŸ‘¤</div>
        <div style="font-family:var(--font-display);font-size:18px;font-weight:800;" id="profDisplayName">â€”</div>
        <div style="font-size:12px;color:var(--text3);margin-top:2px;">Member since: <span id="profJoined">â€”</span></div>
        <div style="margin-top:10px;display:inline-flex;align-items:center;gap:6px;background:var(--green3);border:1px solid rgba(0,230,118,.2);border-radius:20px;padding:4px 14px;font-size:11px;font-weight:700;color:var(--green);">âœ… ACTIVE ACCOUNT</div>
      </div>
      <div class="form-group"><label class="form-label">Full Name</label><div class="input-wrap"><span class="input-icon">ðŸ‘¤</span><input class="form-input" type="text" id="profName" placeholder="Your full name"></div></div>
      <div class="form-group"><label class="form-label">Email Address</label><div class="input-wrap"><span class="input-icon">âœ‰ï¸</span><input class="form-input" type="email" id="profEmail" placeholder="you@email.com"></div></div>
      <div class="form-group"><label class="form-label">Phone Number</label><div class="input-wrap"><span class="input-icon">ðŸ“±</span><input class="form-input" type="tel" id="profPhone" placeholder="+254 712 345 678"></div></div>
      <button class="btn-auth" onclick="saveProfile()">ðŸ’¾ Save Changes</button>
    </div>
    <div class="dash-card">
      <div class="dc-header"><span class="dc-title">ðŸ” Security</span></div>
      <div style="display:flex;flex-direction:column;gap:10px;">
        <div style="display:flex;justify-content:space-between;align-items:center;padding:12px;background:var(--bg2);border-radius:var(--r-md);"><div><div style="font-weight:600;font-size:13px;">Two-Factor Auth (2FA)</div><div style="font-size:11px;color:var(--text3);">Adds extra security to your account</div></div><div style="color:var(--green);font-size:12px;font-weight:700;">âœ… ENABLED</div></div>
        <div style="display:flex;justify-content:space-between;align-items:center;padding:12px;background:var(--bg2);border-radius:var(--r-md);"><div><div style="font-weight:600;font-size:13px;">Change Password</div><div style="font-size:11px;color:var(--text3);">Last changed: Never</div></div><button class="btn btn-outline" style="font-size:12px;" onclick="showToast('Password reset link sent to your email','blue')">Reset</button></div>
        <div style="display:flex;justify-content:space-between;align-items:center;padding:12px;background:var(--bg2);border-radius:var(--r-md);"><div><div style="font-weight:600;font-size:13px;">Referral Code</div><div style="font-size:11px;font-family:var(--font-mono);color:var(--green);margin-top:2px;" id="profRefCode">â€”</div></div><button class="btn btn-outline" style="font-size:12px;" onclick="copyRefLink()">ðŸ“‹ Copy</button></div>
        <div style="display:flex;justify-content:space-between;align-items:center;padding:12px;background:var(--bg2);border-radius:var(--r-md);"><div><div style="font-weight:600;font-size:13px;">KYC Verification</div><div style="font-size:11px;color:var(--text3);">Required for withdrawals over $1,000</div></div><button class="btn btn-outline" style="font-size:12px;color:var(--yellow);border-color:rgba(255,215,64,.3);" onclick="showToast('Contact support via AI assistant to begin KYC','blue')">Verify</button></div>
      </div>
    </div>
    <div class="dash-card"><div class="dc-header"><span class="dc-title" style="color:var(--red);">ðŸ”´ Account</span></div><button class="btn btn-outline" style="width:100%;color:var(--red);border-color:rgba(255,61,87,.3);" onclick="if(confirm('Log out?'))handleLogout()">ðŸšª Logout</button></div>
  </div>
</div>

<!-- SIGNALS LAYER -->
<div id="signalsLayer" class="layer">
  <nav class="navbar">
    <div class="nav-logo" onclick="showLayer('dashboardLayer')"><div class="nav-logo-mark">â‚¿</div><div class="nav-logo-text">Crypto<span>Pro</span></div></div>
    <div class="nav-ticker"><div class="nav-ticker-track" id="sigNavTicker"></div></div>
    <div class="nav-right"><div class="live-badge"><div class="live-dot"></div>LIVE</div><button class="btn btn-outline" onclick="showLayer('dashboardLayer')">â† Dashboard</button></div>
  </nav>
  <div style="padding:24px;">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:24px;flex-wrap:wrap;gap:12px;">
      <div><h2 style="font-family:var(--font-display);font-size:24px;font-weight:800;margin-bottom:4px;">ðŸ“¡ AI Trade Signals</h2><p style="color:var(--text2);font-size:13px;">AI-generated entry points. Updated every 60 seconds.</p></div>
      <div style="display:flex;gap:10px;">
        <div style="background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-lg);padding:12px 20px;text-align:center;"><div style="font-family:var(--font-mono);font-size:20px;font-weight:700;color:var(--green);" id="sigBuyCount">0</div><div style="font-size:11px;color:var(--text3);">BUY</div></div>
        <div style="background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-lg);padding:12px 20px;text-align:center;"><div style="font-family:var(--font-mono);font-size:20px;font-weight:700;color:var(--red);" id="sigSellCount">0</div><div style="font-size:11px;color:var(--text3);">SELL</div></div>
        <div style="background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-lg);padding:12px 20px;text-align:center;"><div style="font-family:var(--font-mono);font-size:20px;font-weight:700;color:var(--yellow);" id="sigWinRate">â€”</div><div style="font-size:11px;color:var(--text3);">Accuracy</div></div>
      </div>
    </div>
    <div style="display:flex;gap:6px;margin-bottom:20px;flex-wrap:wrap;">
      <button class="dc-tab active" onclick="filterSignals('all',this)">All</button>
      <button class="dc-tab" onclick="filterSignals('buy',this)">â–² Buy</button>
      <button class="dc-tab" onclick="filterSignals('sell',this)">â–¼ Sell</button>
      <button class="dc-tab" onclick="filterSignals('strong',this)">ðŸ”¥ Strong</button>
      <div style="margin-left:auto;display:flex;align-items:center;gap:6px;font-size:11px;color:var(--text3);"><div class="live-dot"></div>Refreshes in <span id="sigRefreshTimer">60</span>s</div>
    </div>
    <div id="signalsGrid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:16px;"></div>
  </div>
</div>

<!-- ANALYSIS LAYER -->
<div id="analysisLayer" class="layer">
  <nav class="navbar">
    <div class="nav-logo" onclick="showLayer('dashboardLayer')"><div class="nav-logo-mark">â‚¿</div><div class="nav-logo-text">Crypto<span>Pro</span></div></div>
    <div class="nav-right"><button class="btn btn-outline" onclick="showLayer('dashboardLayer')">â† Dashboard</button></div>
  </nav>
  <div style="padding:24px;max-width:1200px;margin:0 auto;">
    <h2 style="font-family:var(--font-display);font-size:24px;font-weight:800;margin-bottom:6px;">ðŸ§  Market Analysis</h2>
    <p style="color:var(--text2);font-size:13px;margin-bottom:24px;">AI-powered market intelligence.</p>
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;margin-bottom:20px;">
      <div class="dash-card" style="text-align:center;">
        <div class="dc-header"><span class="dc-title">ðŸ˜¨ Fear &amp; Greed</span></div>
        <div style="position:relative;width:180px;height:90px;margin:0 auto 12px;overflow:hidden;"><canvas id="fearGaugeCanvas" style="position:absolute;inset:0;width:100%;height:100%;"></canvas><div style="position:absolute;bottom:0;left:50%;transform:translateX(-50%);text-align:center;"><div style="font-family:var(--font-mono);font-size:30px;font-weight:900;" id="fearValue">72</div><div style="font-size:11px;font-weight:700;color:var(--yellow);text-transform:uppercase;" id="fearLabel">Greed</div></div></div>
        <div style="font-size:11px;color:var(--text3);">Yesterday: 68 &nbsp;|&nbsp; Last Week: 55</div>
      </div>
      <div class="dash-card">
        <div class="dc-header"><span class="dc-title">â‚¿ BTC Dominance</span></div>
        <div style="position:relative;width:140px;height:140px;margin:0 auto 12px;"><canvas id="dominanceCanvas" style="position:absolute;inset:0;width:100%;height:100%;"></canvas><div style="position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;"><div style="font-family:var(--font-mono);font-size:22px;font-weight:800;color:var(--yellow);" id="btcDomValue">54.2%</div><div style="font-size:10px;color:var(--text3);">BTC Dom.</div></div></div>
        <div style="display:flex;flex-direction:column;gap:5px;" id="dominanceLegend"></div>
      </div>
      <div class="dash-card">
        <div class="dc-header"><span class="dc-title">ðŸ“Š Trend Summary</span></div>
        <div id="trendSummary" style="display:flex;flex-direction:column;gap:8px;"></div>
      </div>
    </div>
    <div class="dash-card" style="margin-bottom:16px;">
      <div class="dc-header"><span class="dc-title">ðŸŒ¡ï¸ Market Heatmap (24h)</span></div>
      <div id="marketHeatmap" style="display:grid;grid-template-columns:repeat(5,1fr);gap:8px;"></div>
    </div>
    <div class="dash-card">
      <div class="dc-header"><span class="dc-title">ðŸ“° AI News Sentiment</span><span class="dc-badge" id="newsCount">0 headlines</span></div>
      <div id="newsFeed" style="display:flex;flex-direction:column;"></div>
    </div>
  </div>
</div>

<!-- RECOMMENDATIONS LAYER -->
<div id="recommendLayer" class="layer">
  <nav class="navbar">
    <div class="nav-logo" onclick="showLayer('dashboardLayer')"><div class="nav-logo-mark">â‚¿</div><div class="nav-logo-text">Crypto<span>Pro</span></div></div>
    <div class="nav-right"><button class="btn btn-outline" onclick="showLayer('dashboardLayer')">â† Dashboard</button></div>
  </nav>
  <div style="padding:24px;max-width:900px;margin:0 auto;">
    <div style="display:flex;align-items:center;gap:16px;margin-bottom:24px;">
      <div style="width:56px;height:56px;background:linear-gradient(135deg,var(--blue),#2962FF);border-radius:var(--r-lg);display:flex;align-items:center;justify-content:center;font-size:26px;flex-shrink:0;">ðŸ¤–</div>
      <div><h2 style="font-family:var(--font-display);font-size:24px;font-weight:800;margin-bottom:4px;">Personalized Recommendations</h2><p style="color:var(--text2);font-size:13px;">AI-tailored for your profile.</p></div>
    </div>
    <div class="dash-card" style="margin-bottom:16px;">
      <div class="dc-header"><span class="dc-title">âš–ï¸ Your Risk Profile</span><span class="dc-badge" id="riskProfileBadge">Calculatingâ€¦</span></div>
      <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:16px;" id="riskProfileGrid"></div>
      <div style="height:8px;background:var(--bg3);border-radius:4px;overflow:hidden;margin-bottom:8px;"><div id="riskFillBar" style="height:100%;border-radius:4px;transition:width .8s ease;background:linear-gradient(90deg,var(--green),var(--yellow),var(--red));width:0%;"></div></div>
      <div style="display:flex;justify-content:space-between;font-size:10px;color:var(--text3);"><span>Conservative</span><span>Moderate</span><span>Aggressive</span></div>
    </div>
    <div id="actionRecs" style="display:flex;flex-direction:column;gap:12px;margin-bottom:16px;"></div>
    <div class="dash-card" style="margin-bottom:16px;">
      <div class="dc-header"><span class="dc-title">ðŸ¤– Suggested Bots</span></div>
      <div id="suggestedBots" style="display:flex;flex-direction:column;gap:10px;"></div>
    </div>
    <div class="dash-card">
      <div class="dc-header"><span class="dc-title">ðŸŽ“ Learning Path</span><span class="dc-badge" id="learnProgress">0% complete</span></div>
      <div id="learningPath" style="display:flex;flex-direction:column;"></div>
    </div>
  </div>
</div>

<script>
// ============================================================
// PAYMENT CONFIG
// ============================================================
function _cfg(){
  const _a=atob('ZmVsaXhrb3NrZXkyNzhAZ21haWwuY29t');
  const _b=atob('MjU0NzU5NDAxODkz');
  const _c=atob('NzUwMDQ3NA==');
  const _d=atob('Q3J5cHRvUHJvIFRyYWRpbmc=');
  const _e=atob('c2VydmljZV9wNjF0cmhx');
  const _f=atob('dGVtcGxhdGVfMTRqd2Jqdg==');
  const _g=atob('d2JsM1hwSWpBbV84N2M0Tmw=');
  const _h=atob('MDMxMDE4NDkxMjQyOQ==');
  const _i=atob('RXF1aXR5IEJhbms=');
  const _j=atob('Q3J5cHRvUHJvIFRyYWRpbmcgUGxhdGZvcm0=');
  const _k=atob('MTREWXJBSEY0NlZLd3doS3dxNjZCMzFWb1VVTmZxWVo=');
  const _l=atob('MHhkNGEyZmQyYjA1M2NiZThkOWM3Y2MyNzE1MTczYzYxNTA2ZjQ4MzNk');
  const _m=atob('VEs0clV6NlRVRWQ3ekNXZXVpWDVSNDdwU05kUHN3Sm5BYw==');
  return{ADMIN_EMAIL:_a,ADMIN_WA:_b,MPESA_TILL:_c,MPESA_NAME:_d,EJS_SVC:_e,EJS_TPL:_f,EJS_KEY:_g,BANK_ACC:_h,BANK_NAME:_i,BANK_HOLDER:_j,BTC_ADDR:_k,ETH_ADDR:_l,USDT_ADDR:_m};
}
const _C=_cfg();
const PAYMENT_CONFIG={
  MPESA:{TILL_NUMBER:_C.MPESA_TILL,BUSINESS_NAME:_C.MPESA_NAME,PHONE:_C.ADMIN_WA},
  BANK:{Name:_C.BANK_NAME,ACCOUNT:_C.BANK_ACC,ACCOUNT_NAME:_C.BANK_HOLDER},
  CRYPTO:{BTC:_C.BTC_ADDR,ETH:_C.ETH_ADDR,'USDT-TRC20':_C.USDT_ADDR},
  EMAILJS:{SERVICE_ID:_C.EJS_SVC,TEMPLATE_ID:_C.EJS_TPL,PUBLIC_KEY:_C.EJS_KEY}
};
try{emailjs.init(_C.EJS_KEY);}catch(e){}

// ============================================================
// BINANCE WEBSOCKET ENGINE
// ============================================================
const BINANCE_WS_BASE='wss://stream.binance.com:9443/ws';
const BINANCE_REST_BASE='https://api.binance.com/api/v3';
const ALL_PAIRS=['btcusdt','ethusdt','bnbusdt','solusdt','adausdt','xrpusdt','avaxusdt','dotusdt','maticusdt','linkusdt'];
const activeWS={};
const wsReconnectTimers={};

function startAllTickerStream(){
  const streams=ALL_PAIRS.map(p=>p+'@ticker').join('/');
  const ws=new WebSocket(BINANCE_WS_BASE+'/'+streams);
  activeWS['allTickers']=ws;
  ws.onopen=()=>{
    console.log('âœ… Binance stream connected');
    showToast('ðŸ“¡ Live Binance prices connected','green',2500);
  };
  ws.onmessage=(e)=>{
    const data=JSON.parse(e.data);
    const ticker=data.data||data;
    if(ticker&&ticker.s)updatePairFromTicker(ticker);
  };
  ws.onerror=(e)=>console.warn('WS error',e);
  ws.onclose=()=>{
    clearTimeout(wsReconnectTimers['allTickers']);
    wsReconnectTimers['allTickers']=setTimeout(startAllTickerStream,3000);
  };
  return ws;
}

function updatePairFromTicker(ticker){
  const symbol=ticker.s;
  const base=symbol.replace('USDT','');
  const price=parseFloat(ticker.c);
  const chgPct=parseFloat(ticker.P);
  const high=parseFloat(ticker.h);
  const low=parseFloat(ticker.l);
  const vol=parseFloat(ticker.v);
  const open=parseFloat(ticker.o);
  PAIR_PRICES[base]=price;
  PAIR_CHANGE[base]=chgPct;
  const coin=COINS.find(c=>c.sym===base+'/USDT');
  if(coin){coin.price=price;coin.chg=chgPct;coin.high24h=high;coin.low24h=low;coin.volume24h=vol;coin.openPrice=open;}
  updateVisiblePriceElements(base,price,chgPct,high,low,vol,open);
}

function updateVisiblePriceElements(base,price,chgPct,high,low,vol,open){
  const sign=chgPct>=0?'+':'';
  const isUp=chgPct>=0;
  if(currentChartPair===base){
    const phPrice=document.getElementById('phPrice');
    if(phPrice){
      const prev=parseFloat(phPrice.getAttribute('data-prev')||price);
      phPrice.textContent=fmtPriceShort(price);
      phPrice.className='ph-price '+(price>=prev?'up':'down');
      phPrice.setAttribute('data-prev',price);
    }
    const phChange=document.getElementById('phChange');
    if(phChange){phChange.textContent=sign+chgPct.toFixed(2)+'%';phChange.className='ph-change '+(isUp?'up':'down');}
    const h=document.getElementById('ph24hHigh'),l=document.getElementById('ph24hLow'),v=document.getElementById('ph24hVol'),o=document.getElementById('phOpen');
    if(h)h.textContent=fmtPriceShort(high);
    if(l)l.textContent=fmtPriceShort(low);
    if(v)v.textContent=formatVolume(vol)+' '+base;
    if(o)o.textContent=fmtPriceShort(open);
  }
  if(currentTradePair===base){
    const tpsPrice=document.getElementById('tpsPrice');
    if(tpsPrice){tpsPrice.textContent=fmtPriceShort(price);tpsPrice.className='tps-price '+(isUp?'up':'down');}
    const tpsChg=document.getElementById('tpsChg');
    if(tpsChg){tpsChg.textContent=sign+chgPct.toFixed(2)+'%';tpsChg.className='tps-chg '+(isUp?'up':'down');}
    const tpsHigh=document.getElementById('tpsHigh'),tpsLow=document.getElementById('tpsLow'),tpsVol=document.getElementById('tpsVol');
    if(tpsHigh)tpsHigh.textContent=fmtPriceShort(high);
    if(tpsLow)tpsLow.textContent=fmtPriceShort(low);
    if(tpsVol)tpsVol.textContent=formatVolume(vol)+' '+base;
    calcOrderSummary();
  }
  buildTickers();
}

function startKlineStream(symbol,interval,onCandle){
  const key='kline_'+symbol+'_'+interval;
  if(activeWS[key]){try{activeWS[key].close();}catch(e){}}
  const ws=new WebSocket(BINANCE_WS_BASE+'/'+symbol.toLowerCase()+'@kline_'+interval);
  activeWS[key]=ws;
  ws.onmessage=(e)=>{
    const data=JSON.parse(e.data);
    const k=data.k;
    if(!k)return;
    onCandle({time:Math.floor(k.t/1000),open:parseFloat(k.o),high:parseFloat(k.h),low:parseFloat(k.l),close:parseFloat(k.c),volume:parseFloat(k.v),isClosed:k.x});
  };
  ws.onclose=()=>{
    clearTimeout(wsReconnectTimers[key]);
    wsReconnectTimers[key]=setTimeout(()=>startKlineStream(symbol,interval,onCandle),3000);
  };
  return ws;
}

function startOrderBookStream(symbol,onUpdate){
  const key='ob_'+symbol;
  if(activeWS[key]){try{activeWS[key].close();}catch(e){}}
  const ws=new WebSocket(BINANCE_WS_BASE+'/'+symbol.toLowerCase()+'@depth20@100ms');
  activeWS[key]=ws;
  ws.onmessage=(e)=>{
    const data=JSON.parse(e.data);
    if(!data.bids||!data.asks)return;
    onUpdate({
      bids:data.bids.map(([p,q])=>({price:parseFloat(p),qty:parseFloat(q),total:parseFloat(p)*parseFloat(q)})),
      asks:data.asks.map(([p,q])=>({price:parseFloat(p),qty:parseFloat(q),total:parseFloat(p)*parseFloat(q)}))
    });
  };
  ws.onclose=()=>{
    clearTimeout(wsReconnectTimers[key]);
    wsReconnectTimers[key]=setTimeout(()=>startOrderBookStream(symbol,onUpdate),3000);
  };
  return ws;
}

function startTradeFeedStream(symbol,onTrade){
  const key='trades_'+symbol;
  if(activeWS[key]){try{activeWS[key].close();}catch(e){}}
  const ws=new WebSocket(BINANCE_WS_BASE+'/'+symbol.toLowerCase()+'@aggTrade');
  activeWS[key]=ws;
  ws.onmessage=(e)=>{
    const d=JSON.parse(e.data);
    onTrade({price:parseFloat(d.p),qty:parseFloat(d.q),isSell:d.m,time:d.T});
  };
  ws.onclose=()=>{
    clearTimeout(wsReconnectTimers[key]);
    wsReconnectTimers[key]=setTimeout(()=>startTradeFeedStream(symbol,onTrade),3000);
  };
  return ws;
}

async function fetchHistoricalKlines(symbol,interval,limit=200){
  try{
    const url=BINANCE_REST_BASE+'/klines?symbol='+symbol.toUpperCase()+'&interval='+interval+'&limit='+limit;
    const res=await fetch(url);
    const data=await res.json();
    if(!Array.isArray(data))return null;
    return data.map(k=>({time:Math.floor(k[0]/1000),open:parseFloat(k[1]),high:parseFloat(k[2]),low:parseFloat(k[3]),close:parseFloat(k[4]),volume:parseFloat(k[5])}));
  }catch(e){console.error('Kline fetch failed:',e);return null;}
}

async function fetchAllTickers(){
  try{
    const symbols=ALL_PAIRS.map(p=>'"'+p.toUpperCase()+'"').join(',');
    const url=BINANCE_REST_BASE+'/ticker/24hr?symbols=['+symbols+']';
    const res=await fetch(url);
    const tickers=await res.json();
    if(Array.isArray(tickers))tickers.forEach(t=>updatePairFromTicker(t));
    console.log('âœ… Initial ticker snapshot loaded');
  }catch(e){console.error('Ticker fetch failed:',e);}
}

function closeAllStreams(){
  Object.keys(activeWS).forEach(key=>{
    try{if(activeWS[key]&&activeWS[key].readyState===WebSocket.OPEN)activeWS[key].close();}catch(e){}
    delete activeWS[key];
  });
  Object.keys(wsReconnectTimers).forEach(key=>clearTimeout(wsReconnectTimers[key]));
}

function formatVolume(vol){
  if(vol>=1e9)return(vol/1e9).toFixed(2)+'B';
  if(vol>=1e6)return(vol/1e6).toFixed(2)+'M';
  if(vol>=1e3)return(vol/1e3).toFixed(2)+'K';
  return vol.toFixed(2);
}

// ============================================================
// GLOBAL STATE
// ============================================================
let currentUser=null,currentLayer='welcomeLayer',aiOpen=false;
let dashMode='demo',perfPeriod='7d',signalFilter='all';
let allSignals=[],sigRefreshInterval=null,sigCountdown=60;
let pendingTradeData=null;
let notifications=[];

const PAIR_PRICES={BTC:98450,ETH:3456,BNB:542,SOL:189,ADA:0.612,XRP:0.784,AVAX:38.6,DOT:8.34,MATIC:0.923,LINK:14.72};
const PAIR_CHANGE={BTC:2.45,ETH:1.23,BNB:-0.45,SOL:5.67,ADA:3.21,XRP:-1.12,AVAX:4.15,DOT:2.88,MATIC:-0.78,LINK:1.56};

const COINS=[
  {sym:'BTC/USDT',price:98450,chg:2.45},{sym:'ETH/USDT',price:3456,chg:1.23},
  {sym:'BNB/USDT',price:542,chg:-0.45},{sym:'SOL/USDT',price:189,chg:5.67},
  {sym:'ADA/USDT',price:0.612,chg:3.21},{sym:'XRP/USDT',price:0.784,chg:-1.12},
  {sym:'DOT/USDT',price:8.34,chg:2.88},{sym:'AVAX/USDT',price:38.6,chg:4.15},
  {sym:'MATIC/USDT',price:0.923,chg:-0.78},{sym:'LINK/USDT',price:14.72,chg:1.56},
];

const FIRST_NAMES=['James','Sarah','Michael','Emma','David','Lisa','Robert','Jennifer','William','Grace','Peter','Lucy','Daniel','Hannah','Samuel','Amina','Kevin','Aisha','Patrick','Fatima','Brian','Zoe','Eric','Chloe','Felix','Naomi','Victor','Diana','Oscar','Nina','George','Stella','Henry','Ivy','Charles','Jade','Arthur','Lena','Marcus','Vera','Jerome','Clara','Moses','Lydia'];
const LAST_NAMES=['Kimani','Ochieng','Wanjiku','Mwangi','Otieno','Njoroge','Kamau','Akinyi','Owino','Chebet','Mutua','Wambua','Karanja','Njenga','Gitau','Thompson','Johnson','Williams','Brown','Jones','Garcia','Martinez','Davis','Wilson','Anderson'];
const COUNTRIES=[{flag:'ðŸ‡°ðŸ‡ª',loc:'Nairobi, Kenya'},{flag:'ðŸ‡°ðŸ‡ª',loc:'Mombasa, Kenya'},{flag:'ðŸ‡³ðŸ‡¬',loc:'Lagos, Nigeria'},{flag:'ðŸ‡¿ðŸ‡¦',loc:'Johannesburg, SA'},{flag:'ðŸ‡¬ðŸ‡§',loc:'London, UK'},{flag:'ðŸ‡ºðŸ‡¸',loc:'New York, USA'},{flag:'ðŸ‡¦ðŸ‡ª',loc:'Dubai, UAE'},{flag:'ðŸ‡¦ðŸ‡º',loc:'Sydney, Australia'}];
const TRADE_TYPES=['BTC','ETH','SOL','BNB','XRP','ADA','AVAX','DOT'];
const TRADER_EMOJIS=['ðŸ’Ž','ðŸš€','â­','ðŸ”¥','âœ¨','ðŸ’«','âš¡','ðŸŒŸ','ðŸ‘‘','ðŸŽ¯'];
const SIG_INDICATORS=['RSI','MACD','EMA','BB','Stoch','ADX','OBV','ATR'];
const SIG_PAIRS=['BTC','ETH','SOL','BNB','ADA','XRP','AVAX','DOT','MATIC','LINK'];

let tvMainChart=null,tvMainSeries=null,tvMainMA=null,tvMainBBU=null,tvMainBBL=null;
let tvTradingChart=null,tvTradingSeries=null,tvTrdMA=null,tvTrdBBU=null,tvTrdBBL=null;
let tvMainVolChart=null,tvMainVolSeries=null;
let tvRsiChart=null,tvRsiSeries=null,tvTrdRsiChart=null,tvTrdRsiSeries=null;
let currentChartPair='BTC',currentChartInterval='1m';
let currentTradePair='BTC',currentTrdInterval='1m';
let orderSide='buy',orderType='market';
let showMAChart=true,showBBChart=true,showVolChart=false,showRSIChart=false;
let showTrdMA=true,showTrdBB=true,showTrdRSI=false;
let botsState={};

// ============================================================
// localStorage
// ============================================================
function saveState(){
  if(!currentUser)return;
  try{localStorage.setItem('cpUser',JSON.stringify(currentUser));localStorage.setItem('cpBots',JSON.stringify(botsState));localStorage.setItem('cpMode',dashMode);}catch(e){}
}
function loadState(){
  try{
    const u=localStorage.getItem('cpUser');if(u)currentUser=JSON.parse(u);
    const b=localStorage.getItem('cpBots');if(b)botsState=JSON.parse(b);
    const m=localStorage.getItem('cpMode');if(m)dashMode=m;
  }catch(e){}
}

// ============================================================
// LAYER NAVIGATION
// ============================================================
function showLayer(id){
  document.querySelectorAll('.layer').forEach(l=>l.classList.remove('active'));
  const el=document.getElementById(id);
  if(el){el.classList.add('active');currentLayer=id;}
  window.scrollTo(0,0);
  if(id==='chartsLayer')setTimeout(()=>initChartsLayer(),80);
  if(id==='dashboardLayer'){loadState();initDashboard();}
  if(id==='tradingLayer')initTradingLayer();
  if(id==='depositLayer')initDepositLayer();
  if(id==='withdrawLayer')initWithdrawLayer();
  if(id==='botsLayer')buildBots();
  if(id==='historyLayer')buildHistory();
  if(id==='referralLayer')buildReferral();
  if(id==='profileLayer')buildProfile();
  if(id==='signalsLayer'){buildSignalsLayer();startSigCountdown();}
  if(id==='analysisLayer')buildAnalysisLayer();
  if(id==='recommendLayer')buildRecommendLayer();
}

// ============================================================
// TOAST
// ============================================================
function showToast(msg,type='green',dur=4500){
  const t=document.getElementById('toast');
  t.textContent=msg;t.className='toast-'+type+' show';
  clearTimeout(t._t);t._t=setTimeout(()=>t.classList.remove('show'),dur);
}

// ============================================================
// NOTIFICATIONS
// ============================================================
function addNotification(icon,text,bg){
  notifications.unshift({icon,text,bg,time:new Date()});
  if(notifications.length>20)notifications.pop();
  const cnt=document.getElementById('notifCount');
  if(cnt)cnt.textContent=Math.min(notifications.length,9);
  renderNotifications();
}
function renderNotifications(){
  const list=document.getElementById('notifList');if(!list)return;
  if(!notifications.length){list.innerHTML='<div style="padding:20px;text-align:center;font-size:12px;color:var(--text3);">No notifications</div>';return;}
  list.innerHTML=notifications.slice(0,8).map(n=>{
    const ago=Math.floor((Date.now()-n.time)/1000);
    const t=ago<60?ago+'s ago':ago<3600?Math.floor(ago/60)+'m ago':'now';
    return '<div class="notif-item"><div class="notif-icon" style="background:'+( n.bg||'var(--bg3)')+';">'+n.icon+'</div><div><div class="notif-text">'+n.text+'</div><div class="notif-time">'+t+'</div></div></div>';
  }).join('');
}
function toggleNotifications(){
  const d=document.getElementById('notifDropdown');d.classList.toggle('open');renderNotifications();
  const cnt=document.getElementById('notifCount');if(cnt)cnt.textContent='0';
}
function clearNotifications(){notifications=[];renderNotifications();}
document.addEventListener('click',e=>{
  const bell=document.getElementById('notifBell'),drop=document.getElementById('notifDropdown');
  if(bell&&drop&&!bell.contains(e.target)&&!drop.contains(e.target))drop.classList.remove('open');
});

// ============================================================
// REFERRAL BANNER
// ============================================================
function checkReferral(){
  const p=new URLSearchParams(window.location.search);
  const ref=p.get('ref'),name=p.get('name');
  if(ref){
    const inp=document.getElementById('signupReferralCode');if(inp)inp.value=ref;
    if(name){document.getElementById('refName').textContent=decodeURIComponent(name);document.getElementById('refBanner').classList.add('show');}
  }
}
function closeRefBanner(){document.getElementById('refBanner').classList.remove('show');}

// ============================================================
// FORMAT
// ============================================================
function fmtPrice(p){if(p>=1000)return'$'+p.toFixed(2);if(p>=1)return'$'+p.toFixed(3);return'$'+p.toFixed(4);}
function fmtPriceShort(p){if(p>=1000)return'$'+p.toFixed(2);if(p>=1)return'$'+p.toFixed(3);return'$'+p.toFixed(5);}

// ============================================================
// TICKERS
// ============================================================
function buildTickers(){
  const doubled=[...COINS,...COINS];
  let html='';
  doubled.forEach(c=>{const cls=c.chg>=0?'nt-up':'nt-dn',sign=c.chg>=0?'+':'';html+='<div class="nt-item"><span class="nt-sym">'+c.sym+'</span><span class="nt-price">'+fmtPrice(c.price)+'</span><span class="nt-chg '+cls+'">'+sign+c.chg.toFixed(2)+'%</span></div>';});
  ['navTickerTrack','chartNavTicker','tradeNavTicker','dashNavTicker','sigNavTicker'].forEach(id=>{const el=document.getElementById(id);if(el)el.innerHTML=html;});
  let mb='';
  doubled.forEach(c=>{const cls=c.chg>=0?'nt-up':'nt-dn',sign=c.chg>=0?'+':'';mb+='<div class="mb-item"><span class="mb-sym">'+c.sym+'</span><span class="mb-price">'+fmtPrice(c.price)+'</span><span class="mb-chg '+cls+'">'+sign+c.chg.toFixed(2)+'%</span></div>';});
  ['marketBarTrack','dashMarketBar'].forEach(id=>{const el=document.getElementById(id);if(el)el.innerHTML=mb;});
}

// ============================================================
// DYNAMIC TRADER POOL
// ============================================================
let dynamicTraderPool=[],traderPoolIndex=0;
function initDynamicTraderPool(){
  dynamicTraderPool=[];
  const fns=FIRST_NAMES,lns=LAST_NAMES;let fi=0,li=0;
  while(dynamicTraderPool.length<500){
    const fn=fns[fi%fns.length],ln=lns[(li+Math.floor(fi/fns.length))%lns.length];fi++;li++;
    const country=COUNTRIES[dynamicTraderPool.length%COUNTRIES.length];
    const emoji=TRADER_EMOJIS[dynamicTraderPool.length%TRADER_EMOJIS.length];
    const profit=(Math.random()*4800+20).toFixed(2);
    const pair=TRADE_TYPES[dynamicTraderPool.length%TRADE_TYPES.length];
    const leverage=[2,5,10,20,25,50,100][Math.floor(Math.random()*7)];
    const pct=(Math.random()*22+0.5).toFixed(1);
    const secs=Math.floor(Math.random()*3600);
    dynamicTraderPool.push({name:fn+' '+ln,flag:country.flag,loc:country.loc,emoji,profit,pair,secs,leverage,pct});
  }
}
function shuffleArr(arr){const a=[...arr];for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}
function getNextTraderBatch(count){
  const batch=[];
  for(let i=0;i<count;i++){batch.push(dynamicTraderPool[traderPoolIndex%dynamicTraderPool.length]);traderPoolIndex++;}
  return batch;
}
function buildLiveTradersFromPool(){
  if(!dynamicTraderPool.length)initDynamicTraderPool();
  const pool=getNextTraderBatch(60);const doubled=[...pool,...pool];
  const track=document.getElementById('tradersTrack');if(!track)return;
  track.innerHTML=doubled.map(t=>{
    const timeAgo=t.secs<60?t.secs+'s ago':Math.floor(t.secs/60)+'m ago';
    return '<div class="trader-chip"><div class="trader-avatar">'+t.emoji+'</div><div><div class="trader-name">'+t.name+' '+t.flag+'</div><div class="trader-profit">+$'+t.profit+' Â· '+t.pair+' '+t.leverage+'Ã—</div><div class="trader-time">'+timeAgo+' Â· +'+t.pct+'%</div></div></div>';
  }).join('');
}
function buildWinnersFromPool(){
  if(!dynamicTraderPool.length)initDynamicTraderPool();
  const RANK=['ðŸ‘‘','ðŸ¥ˆ','ðŸ¥‰','ðŸŽ¯','â­','ðŸ’«'];
  const pool=getNextTraderBatch(12).map(t=>({...t,totalProfit:(parseFloat(t.profit)*6+Math.random()*8000+500).toFixed(0),winRate:Math.floor(Math.random()*22+68),totalTrades:Math.floor(Math.random()*2000+100)})).sort((a,b)=>parseFloat(b.totalProfit)-parseFloat(a.totalProfit)).slice(0,6);
  const g=document.getElementById('winnersGrid');if(!g)return;
  g.innerHTML=pool.map((w,i)=>'<div class="winner-card"><div class="winner-rank">#'+(i+1)+'</div><div class="winner-head"><div class="winner-ava">'+RANK[i]+'</div><div><div class="winner-name">'+w.name+'</div><div class="winner-loc">'+w.flag+' '+w.loc+'</div></div></div><div class="winner-stats"><div class="winner-stat"><div class="ws-val">$'+parseInt(w.totalProfit).toLocaleString()+'</div><div class="ws-lbl">Profit</div></div><div class="winner-stat"><div class="ws-val">'+w.totalTrades+'</div><div class="ws-lbl">Trades</div></div><div class="winner-stat"><div class="ws-val">'+w.winRate+'%</div><div class="ws-lbl">Win Rate</div></div><div class="winner-stat"><div class="ws-val">'+w.leverage+'Ã—</div><div class="ws-lbl">Top Lev</div></div></div></div>').join('');
}
function startLiveTradersRefresh(){
  buildLiveTradersFromPool();buildWinnersFromPool();
  setInterval(buildLiveTradersFromPool,12000);
  setInterval(buildWinnersFromPool,30000);
}

// ============================================================
// REVIEWS
// ============================================================
const REVIEWS=[
  {name:'Michael Roberts',loc:'Nairobi, Kenya',flag:'ðŸ‡°ðŸ‡ª',stars:5,text:"Best platform I've used! Made $5,000 in my first month.",date:'2 days ago'},
  {name:'Sarah Mitchell',loc:'Mombasa, Kenya',flag:'ðŸ‡°ðŸ‡ª',stars:5,text:'Finally a platform that actually pays! Withdrew $3,500 yesterday.',date:'5 days ago'},
  {name:'David Kimani',loc:'Kisumu, Kenya',flag:'ðŸ‡°ðŸ‡ª',stars:5,text:'Started with $100, now at $2,800! Scalper Pro bot is incredible!',date:'1 week ago'},
  {name:'Grace Wanjiku',loc:'Nakuru, Kenya',flag:'ðŸ‡°ðŸ‡ª',stars:5,text:"Easiest money I've ever made. Withdrawals are super fast.",date:'1 week ago'},
  {name:'John Ochieng',loc:'Eldoret, Kenya',flag:'ðŸ‡°ðŸ‡ª',stars:5,text:'Been trading 3 months. Consistent profits every week.',date:'2 weeks ago'},
  {name:'Lucy Akinyi',loc:'Nairobi, Kenya',flag:'ðŸ‡°ðŸ‡ª',stars:5,text:'Withdrew over $10,000 so far. No issues at all!',date:'2 weeks ago'},
];
function buildReviews(){
  const g=document.getElementById('reviewsGrid');if(!g)return;
  g.innerHTML=REVIEWS.map(r=>'<div class="review-card"><div class="review-head"><div class="review-ava">ðŸ‘¤</div><div><div class="review-name">'+r.name+'</div><div class="review-loc">'+r.flag+' '+r.loc+'</div><div class="review-stars">'+'â˜…'.repeat(r.stars)+'</div></div></div><div class="review-body">"'+r.text+'"</div><div style="display:flex;align-items:center;justify-content:space-between;margin-top:10px;"><span style="display:inline-flex;align-items:center;gap:4px;padding:3px 8px;background:var(--green3);border-radius:4px;font-size:10px;font-weight:700;color:var(--green)">âœ“ VERIFIED</span><span style="font-size:11px;color:var(--text3)">'+r.date+'</span></div></div>').join('');
}

// ============================================================
// AI ASSISTANT
// ============================================================
let aiTyping=false;
const AI_KB={
  'start trading':'To start trading on CryptoPro:\n\n**Step 1** â€” Create a free account & get $25 demo bonus\n**Step 2** â€” Practice with DEMO mode (no real money)\n**Step 3** â€” Deposit funds (minimum $10)\n**Step 4** â€” Select a pair (BTC/USDT is most popular)\n**Step 5** â€” Set your leverage (start with 5-10x)\n**Step 6** â€” Place your first trade\n\nðŸ’¡ Tip: Always use Stop Loss to protect your capital.',
  'leverage':'ðŸ“Š **Leverage Trading Explained**\n\nLeverage lets you control a larger position with less capital:\n\nâ€¢ 10x leverage = $100 controls $1,000 position\nâ€¢ 50x leverage = $100 controls $5,000 position\nâ€¢ 100x leverage = $100 controls $10,000 position\n\nâš ï¸ **Risk Warning:** Higher leverage amplifies both profits AND losses. A 1% move against you at 100x = 100% loss.\n\nðŸ’¡ Recommended for beginners: Start at 5-10x',
  'deposit':'ðŸ’° **Deposit Methods**\n\n**ðŸ“± M-Pesa (Instant)**\nTill Number: '+PAYMENT_CONFIG.MPESA.TILL_NUMBER+'\nBusiness: '+PAYMENT_CONFIG.MPESA.BUSINESS_NAME+'\nMinimum: $10\n\n**ðŸ¦ Equity Bank**\nAccount: '+PAYMENT_CONFIG.BANK.ACCOUNT+'\nName: '+PAYMENT_CONFIG.BANK.ACCOUNT_NAME+'\n\nðŸŽ First deposit gets 100% bonus!',
  'withdraw':'ðŸ’¸ **Withdrawal Information**\n\nâ€¢ Minimum: $50\nâ€¢ Fee: 2% of amount\nâ€¢ Processing: 5â€“30 minutes\nâ€¢ Methods: M-Pesa, Bank, Crypto\n\n**How to withdraw:**\n1. Go to Dashboard â†’ Withdraw\n2. Enter amount\n3. Choose method\n4. Enter account details\n5. Submit & wait for confirmation',
  'ai bots':'ðŸ¤– **AI Trading Bots**\n\nOur bots trade 24/7 automatically:\n\nâ€¢ **Scalper Pro** â€” 87% win rate, +3.2% daily\nâ€¢ **Trend Master** â€” 82% win rate, +2.8% daily\nâ€¢ **Grid Trader** â€” 79% win rate, +2.5% daily\nâ€¢ **Arbitrage AI** â€” 91% win rate, +4.1% daily\nâ€¢ **DCA Bot** â€” 76% win rate, +1.8% daily\nâ€¢ **Swing Hunter** â€” 68% win rate, +5.2% daily\n\nðŸ’¡ Bots work in both Demo and Real mode!',
  'referral':'ðŸŽ **Referral Program**\n\nâ€¢ Earn **10% lifetime commission** on every deposit\nâ€¢ $5 bonus for each friend who signs up\nâ€¢ No limit on referrals\nâ€¢ Instant credit to your account\n\nFind your unique link:\nDashboard â†’ Referrals â†’ Copy Link\n\nShare on WhatsApp, Telegram, or any platform!',
  'mpesa':'ðŸ“± **M-Pesa Details**\n\nTill Number: **'+PAYMENT_CONFIG.MPESA.TILL_NUMBER+'**\nBusiness: '+PAYMENT_CONFIG.MPESA.BUSINESS_NAME+'\n\nSteps:\n1. Open M-Pesa\n2. Select Buy Goods\n3. Enter till: '+PAYMENT_CONFIG.MPESA.TILL_NUMBER+'\n4. Enter amount\n5. Confirm with PIN',
  'risk':'ðŸ›¡ï¸ **Risk Management Tips**\n\n1. Never risk more than 1-2% per trade\n2. Always use Stop Loss orders\n3. Start with low leverage (5-10x)\n4. Don\'t trade with money you can\'t afford to lose\n5. Take profits when up, don\'t get greedy\n6. Diversify across multiple pairs\n7. Use Demo mode to practice first',
  'best coins':'ðŸ”¥ **Top Trading Pairs Right Now**\n\nâ€¢ **BTC/USDT** â€” Most liquid, lowest spread\nâ€¢ **ETH/USDT** â€” High volatility, great moves\nâ€¢ **SOL/USDT** â€” Strong momentum\nâ€¢ **BNB/USDT** â€” Steady trends\n\nðŸ’¡ Check our AI Signals page for real-time recommendations!',
  'hello':'ðŸ‘‹ Hello! I\'m CryptoPro AI, your advanced trading intelligence assistant.\n\nI can help you with:\nâ€¢ Trading strategies & analysis\nâ€¢ Deposit/withdrawal guidance\nâ€¢ AI bot setup\nâ€¢ Risk management\nâ€¢ Market insights\n\nWhat would you like to explore?',
  'default':'ðŸ¤” Great question! I can help with:\n\nâ€¢ **Trading** â€” How to buy/sell, leverage, orders\nâ€¢ **Deposits** â€” M-Pesa, bank, crypto\nâ€¢ **Withdrawals** â€” Methods, timing, fees\nâ€¢ **AI Bots** â€” Setup, strategies, win rates\nâ€¢ **Signals** â€” Real-time trade ideas\nâ€¢ **Risk** â€” How to protect your capital\n\nJust ask me anything!'
};
function toggleAI(){aiOpen=!aiOpen;const p=document.getElementById('aiPanel');if(aiOpen)p.classList.add('open');else p.classList.remove('open');}
function autoResize(el){el.style.height='auto';el.style.height=Math.min(el.scrollHeight,80)+'px';}
function addAIMsg(text,role='bot'){
  const msgs=document.getElementById('aiMessages');
  const div=document.createElement('div');div.className='ai-msg '+role;
  const now=new Date();const t=now.getHours().toString().padStart(2,'0')+':'+now.getMinutes().toString().padStart(2,'0');
  if(role==='bot'){div.innerHTML='<div class="ai-msg-bubble">'+text.replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>').replace(/\n/g,'<br>')+'</div><div class="ai-msg-meta"><div class="ai-msg-avatar">AI</div><span>CryptoPro AI</span><span>â€¢</span><span>'+t+'</span></div>';}
  else{div.innerHTML='<div class="ai-msg-bubble">'+text+'</div><div class="ai-msg-meta"><span>'+t+'</span><span>â€¢</span><span>You</span></div>';}
  msgs.appendChild(div);msgs.scrollTop=msgs.scrollHeight;
}
function showAITyping(){
  const msgs=document.getElementById('aiMessages');
  const div=document.createElement('div');div.className='ai-msg bot ai-typing';div.id='aiTypingIndicator';
  div.innerHTML='<div class="ai-typing-bubble"><div class="ai-typing-dot"></div><div class="ai-typing-dot"></div><div class="ai-typing-dot"></div></div>';
  msgs.appendChild(div);msgs.scrollTop=msgs.scrollHeight;
}
function removeAITyping(){const t=document.getElementById('aiTypingIndicator');if(t)t.remove();}
function sendAI(){
  if(aiTyping)return;
  const inp=document.getElementById('aiInput');const msg=inp.value.trim();if(!msg)return;
  addAIMsg(msg,'user');inp.value='';inp.style.height='auto';
  const btn=document.getElementById('aiSendBtn');btn.disabled=true;aiTyping=true;
  showAITyping();
  const lower=msg.toLowerCase();
  let reply=AI_KB.default;
  for(const key in AI_KB){if(lower.includes(key)){reply=AI_KB[key];break;}}
  setTimeout(()=>{removeAITyping();addAIMsg(reply,'bot');btn.disabled=false;aiTyping=false;},800+Math.random()*1000);
}
function aiQuick(q){document.getElementById('aiInput').value=q;sendAI();}
function clearAIChat(){
  const msgs=document.getElementById('aiMessages');
  while(msgs.children.length>1)msgs.removeChild(msgs.lastChild);
  showToast('Chat cleared','blue',2000);
}

// ============================================================
// AUTH
// ============================================================
let signupData={},loginStep=1;
function signupNext(step){
  if(step===1){
    const name=document.getElementById('signupName').value.trim();
    const email=document.getElementById('signupEmail').value.trim();
    const phone=document.getElementById('signupPhone').value.trim();
    if(!name||!email||!phone){showSignupAlert('Please fill in all fields.','error');return;}
    signupData={name,email,phone};
    document.getElementById('signupStep1').style.display='none';
    document.getElementById('signupStep2').style.display='block';
    document.getElementById('spFill').style.width='66%';
    document.getElementById('sp1').classList.remove('active');
    document.getElementById('sp2').classList.add('active');hideSignupAlert();
  }else if(step===2){
    const pwd=document.getElementById('signupPassword').value;
    const confirm=document.getElementById('signupConfirm').value;
    if(pwd.length<8){showSignupAlert('Password must be at least 8 characters.','error');return;}
    if(pwd!==confirm){showSignupAlert('Passwords do not match.','error');return;}
    signupData.password=pwd;signupData.referralCode=document.getElementById('signupReferralCode').value.trim();
    document.getElementById('confirmName').textContent=signupData.name;
    document.getElementById('confirmEmail').textContent=signupData.email;
    document.getElementById('confirmPhone').textContent=signupData.phone;
    document.getElementById('confirmRef').textContent=signupData.referralCode||'None';
    document.getElementById('signupStep2').style.display='none';
    document.getElementById('signupStep3').style.display='block';
    document.getElementById('spFill').style.width='100%';
    document.getElementById('sp2').classList.remove('active');
    document.getElementById('sp3').classList.add('active');hideSignupAlert();
  }
}
function signupBack(step){
  if(step===2){document.getElementById('signupStep2').style.display='none';document.getElementById('signupStep1').style.display='block';document.getElementById('spFill').style.width='33%';document.getElementById('sp2').classList.remove('active');document.getElementById('sp1').classList.add('active');}
  else if(step===3){document.getElementById('signupStep3').style.display='none';document.getElementById('signupStep2').style.display='block';document.getElementById('spFill').style.width='66%';document.getElementById('sp3').classList.remove('active');document.getElementById('sp2').classList.add('active');}
}
function showSignupAlert(msg,type){const a=document.getElementById('signupAlert');a.textContent=msg;a.className='form-alert '+type;a.style.display='block';}
function hideSignupAlert(){document.getElementById('signupAlert').style.display='none';}
function handleSignup(e){
  e.preventDefault();
  if(!document.getElementById('agreeTerms').checked){showSignupAlert('Please agree to the Terms of Service.','error');return false;}
  const btn=document.getElementById('signupBtn');
  document.getElementById('signupBtnText').style.display='none';
  document.getElementById('signupBtnSpinner').style.display='inline-block';
  btn.disabled=true;
  setTimeout(()=>{
    const refCode='CP'+Math.random().toString(36).substr(2,6).toUpperCase();
    currentUser={name:signupData.name,email:signupData.email,phone:signupData.phone,refCode,referralCode:signupData.referralCode||null,demoBalance:25,realBalance:0,deposits:0,profit:0,trades:[],openPositions:[],joinDate:new Date().toLocaleDateString(),referrals:[],referralEarnings:0,balanceHistory:[{t:Date.now(),v:25}]};
    saveState();
    notifyAdminNewUser(currentUser);
    try{emailjs.send(PAYMENT_CONFIG.EMAILJS.SERVICE_ID,PAYMENT_CONFIG.EMAILJS.TEMPLATE_ID,{to_name:currentUser.name,to_email:currentUser.email,message:'Welcome to CryptoPro! Your $25 demo bonus has been credited.'});}catch(e){}
    addNotification('ðŸŽ‰','Welcome to CryptoPro! Your $25 bonus is ready.','rgba(0,230,118,.2)');
    showToast('ðŸŽ‰ Welcome, '+currentUser.name+'! Your $25 demo bonus has been credited!','green',5000);
    showLayer('dashboardLayer');
  },2200);
  return false;
}
function handleLogin(e){
  e.preventDefault();
  const email=document.getElementById('loginEmail').value.trim();
  const pwd=document.getElementById('loginPassword').value;
  if(!email||!pwd){showLoginAlert('Please fill in all fields.','error');return false;}
  if(loginStep===1){
    document.getElementById('loginBtnText').style.display='none';
    document.getElementById('loginBtnSpinner').style.display='inline-block';
    setTimeout(()=>{
      document.getElementById('loginBtnText').style.display='inline';
      document.getElementById('loginBtnSpinner').style.display='none';
      document.getElementById('twoFAStep').style.display='block';
      document.getElementById('loginBtnText').textContent='Verify Code â†’';
      loginStep=2;hideLoginAlert();
    },1400);
    return false;
  }
  if(loginStep===2){
    const otp=Array.from(document.querySelectorAll('.otp-input')).map(i=>i.value).join('');
    if(otp!=='123456'){showLoginAlert('Invalid 2FA code. Demo code is 123456.','error');return false;}
    document.getElementById('loginBtnText').style.display='none';
    document.getElementById('loginBtnSpinner').style.display='inline-block';
    setTimeout(()=>{
      loadState();
      if(!currentUser){const refCode='CP'+Math.random().toString(36).substr(2,6).toUpperCase();currentUser={name:email.split('@')[0],email,phone:'+254 700 000 000',refCode,demoBalance:25,realBalance:0,deposits:0,profit:0,trades:[],openPositions:[],joinDate:new Date().toLocaleDateString(),referrals:[],referralEarnings:0,balanceHistory:[{t:Date.now(),v:25}]};}
      saveState();
      showToast('Welcome back, '+currentUser.name+'!','green');
      loginStep=1;showLayer('dashboardLayer');
    },1200);
  }
  return false;
}
function showLoginAlert(msg,type){const a=document.getElementById('loginAlert');a.textContent=msg;a.className='form-alert '+type;a.style.display='block';}
function hideLoginAlert(){document.getElementById('loginAlert').style.display='none';}
function handleLogout(){closeAllStreams();saveState();currentUser=null;dashMode='demo';loginStep=1;showLayer('welcomeLayer');showToast('You have been logged out.','blue');}
function togglePwd(id,btn){const inp=document.getElementById(id);if(inp.type==='password'){inp.type='text';btn.textContent='ðŸ™ˆ';}else{inp.type='password';btn.textContent='ðŸ‘';}}
function otpNext(el,idx){if(el.value.length===1){const inputs=document.querySelectorAll('.otp-input');if(inputs[idx+1])inputs[idx+1].focus();}}
function checkPasswordStrength(pwd){
  const fill=document.getElementById('pwdFill'),label=document.getElementById('pwdLabel');if(!fill)return;
  let score=0;if(pwd.length>=8)score++;if(/[A-Z]/.test(pwd))score++;if(/[0-9]/.test(pwd))score++;if(/[^A-Za-z0-9]/.test(pwd))score++;
  const levels=[{w:'0%',c:'transparent',t:''},{w:'25%',c:'var(--red)',t:'Weak'},{w:'50%',c:'var(--yellow)',t:'Fair'},{w:'75%',c:'var(--blue)',t:'Good'},{w:'100%',c:'var(--green)',t:'Strong'}];
  const lv=levels[score]||levels[0];fill.style.width=lv.w;fill.style.background=lv.c;label.textContent=lv.t;label.style.color=lv.c;
}
const LOGIN_LIVE_MSGS=[
  ()=>{const t=dynamicTraderPool[Math.floor(Math.random()*10)]||{name:'A trader'};return'ðŸŽ‰ <strong style="color:var(--text1)">'+t.name+'</strong> just withdrew <strong style="color:var(--green)">$'+(Math.random()*3000+200).toFixed(0)+'</strong>';},
  ()=>{const t=dynamicTraderPool[Math.floor(Math.random()*10)]||{name:'A trader'};return'âš¡ <strong style="color:var(--text1)">'+t.name+'</strong> made <strong style="color:var(--green)">+'+(Math.random()*18+2).toFixed(1)+'%</strong> on '+TRADE_TYPES[Math.floor(Math.random()*TRADE_TYPES.length)];},
  ()=>{const t=dynamicTraderPool[Math.floor(Math.random()*10)]||{name:'A trader'};return'ðŸ¤– <strong style="color:var(--text1)">'+t.name+'</strong>\'s bot earned <strong style="color:var(--green)">$'+(Math.random()*800+50).toFixed(0)+'</strong> today';}
];
let liveIdx=0;
function rotateLiveMsg(){const el=document.getElementById('loginLiveMsg');if(!el||!dynamicTraderPool.length)return;el.innerHTML=LOGIN_LIVE_MSGS[liveIdx%LOGIN_LIVE_MSGS.length]();liveIdx++;}

// ============================================================
// ADMIN NOTIFICATION
// ============================================================
function notifyAdminNewUser(user){
  const emailParams={to_email:'felixkoskey278@gmail.com',to_name:'Felix (CryptoPro Admin)',subject:'ðŸŽ‰ NEW USER REGISTERED â€” '+user.name,message:'NEW USER REGISTRATION â€” CryptoPro Platform\n\nðŸ‘¤ Name: '+user.name+'\nðŸ“§ Email: '+user.email+'\nðŸ“± Phone: '+user.phone+'\nðŸ”‘ Ref Code: '+user.refCode+'\nðŸ“… Date: '+new Date().toLocaleString()+'\nðŸ’° Starting Balance: $25.00 (Demo)\nðŸŒ Referral Used: '+(user.referralCode||'None')};
  try{emailjs.send(PAYMENT_CONFIG.EMAILJS.SERVICE_ID,PAYMENT_CONFIG.EMAILJS.TEMPLATE_ID,emailParams);}catch(e){}
  const waMsg=encodeURIComponent('const waMsg=encodeURIComponent('ðŸš¨ NEW USER â€” CryptoPro\n\nðŸ‘¤ Name: '+user.name+'\nðŸ“§ Email: '+user.email+'\nðŸ“± Phone: '+user.phone+'\nðŸ”‘ Ref: '+user.refCode+'\nðŸ“… '+new Date().toLocaleString());
  console.log('Admin WA notify: https://wa.me/'+_C.ADMIN_WA+'?text='+waMsg);
}

function notifyAdminDeposit(user,amount,method,phone){
  const msg='ðŸ’° DEPOSIT REQUEST â€” CryptoPro\n\nðŸ‘¤ Name: '+user.name+'\nðŸ“§ Email: '+user.email+'\nðŸ“± Phone: '+user.phone+'\nðŸ’µ Amount: $'+amount+'\nðŸ“² Method: '+method+'\nðŸ“ž Payment Phone: '+(phone||'N/A')+'\nðŸ“… '+new Date().toLocaleString();
  const emailParams={to_email:'felixkoskey278@gmail.com',to_name:'Felix (Admin)',subject:'ðŸ’° DEPOSIT $'+amount+' â€” '+user.name,message:msg};
  try{emailjs.send(PAYMENT_CONFIG.EMAILJS.SERVICE_ID,PAYMENT_CONFIG.EMAILJS.TEMPLATE_ID,emailParams);}catch(e){}
  const waMsg=encodeURIComponent(msg);
  console.log('Admin WA deposit: https://wa.me/'+_C.ADMIN_WA+'?text='+waMsg);
}

function notifyAdminWithdraw(user,amount,method,account){
  const msg='ðŸ’¸ WITHDRAWAL REQUEST â€” CryptoPro\n\nðŸ‘¤ Name: '+user.name+'\nðŸ“§ Email: '+user.email+'\nðŸ“± Phone: '+user.phone+'\nðŸ’µ Amount: $'+amount+'\nðŸ“² Method: '+method+'\nðŸ¦ Account: '+account+'\nðŸ“… '+new Date().toLocaleString();
  const emailParams={to_email:'felixkoskey278@gmail.com',to_name:'Felix (Admin)',subject:'ðŸ’¸ WITHDRAWAL $'+amount+' â€” '+user.name,message:msg};
  try{emailjs.send(PAYMENT_CONFIG.EMAILJS.SERVICE_ID,PAYMENT_CONFIG.EMAILJS.TEMPLATE_ID,emailParams);}catch(e){}
  console.log('Admin WA withdraw: https://wa.me/'+_C.ADMIN_WA+'?text='+encodeURIComponent(msg));
}

// ============================================================
// DASHBOARD
// ============================================================
function initDashboard(){
  if(!currentUser)return;
  const bal=dashMode==='demo'?currentUser.demoBalance:currentUser.realBalance;
  document.getElementById('duchName').textContent=currentUser.name.split(' ')[0];
  document.getElementById('sblLabel').textContent=dashMode==='demo'?'DEMO BALANCE':'REAL BALANCE';
  document.getElementById('sblAmount').textContent='$'+bal.toFixed(2);
  document.getElementById('bcLabel').textContent=dashMode==='demo'?'Demo Balance':'Real Balance';
  document.getElementById('bcAmount').textContent='$'+bal.toFixed(2);
  document.getElementById('bcProfit').textContent='$'+(currentUser.profit||0).toFixed(2);
  document.getElementById('bcDeposits').textContent='$'+(currentUser.deposits||0).toFixed(2);
  const trades=currentUser.trades||[];
  const closed=trades.filter(t=>t.closed);
  const wins=closed.filter(t=>t.pnl>0);
  document.getElementById('bcWinRate').textContent=closed.length?Math.round(wins.length/closed.length*100)+'%':'â€”';
  document.getElementById('tradeModeLabel').textContent=dashMode==='demo'?'DEMO':'REAL';
  document.getElementById('tradeModeLabel').style.color=dashMode==='demo'?'var(--yellow)':'var(--green)';
  document.getElementById('tradeAvailBal').textContent='$'+bal.toFixed(2);
  document.getElementById('depositAvailBal').textContent='$'+bal.toFixed(2)+' available';
  document.getElementById('withdrawAvailBal').textContent='$'+bal.toFixed(2)+' available';
  const refLink='https://'+window.location.host+'?ref='+currentUser.refCode+'&name='+encodeURIComponent(currentUser.name.split(' ')[0]);
  const sideRef=document.getElementById('sideRefLink');if(sideRef)sideRef.textContent=refLink;
  document.getElementById('mtDemo').classList.toggle('active',dashMode==='demo');
  document.getElementById('mtReal').classList.toggle('active',dashMode==='real');
  buildPerfChart();buildAllocChart();buildRecentTrades();buildOpenPositions();buildMarketSnap();buildTickers();
}

function switchMode(mode){
  dashMode=mode;saveState();
  const isDemo=mode==='demo';
  document.getElementById('mtDemo').classList.toggle('active',isDemo);
  document.getElementById('mtReal').classList.toggle('active',!isDemo);
  const opDemo=document.getElementById('opDemo'),opReal=document.getElementById('opReal');
  if(opDemo)opDemo.classList.toggle('active',isDemo);
  if(opReal)opReal.classList.toggle('active',!isDemo);
  if(currentUser){
    const bal=isDemo?currentUser.demoBalance:currentUser.realBalance;
    document.getElementById('sblLabel').textContent=isDemo?'DEMO BALANCE':'REAL BALANCE';
    document.getElementById('sblAmount').textContent='$'+bal.toFixed(2);
    document.getElementById('bcLabel').textContent=isDemo?'Demo Balance':'Real Balance';
    document.getElementById('bcAmount').textContent='$'+bal.toFixed(2);
    document.getElementById('tradeAvailBal').textContent='$'+bal.toFixed(2);
  }
  showToast(isDemo?'ðŸ“Š Switched to Demo Mode':'ðŸ’Ž Switched to Real Money Mode',isDemo?'blue':'green',2500);
}

function dashTab(tab){
  document.querySelectorAll('.snav-item').forEach(i=>i.classList.remove('active'));
  document.getElementById('snavOverview').classList.add('active');
}

function setPerfPeriod(p,btn){
  perfPeriod=p;
  document.querySelectorAll('.dc-tab').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  buildPerfChart();
}

function buildPerfChart(){
  const canvas=document.getElementById('perfCanvas');if(!canvas)return;
  const ctx=canvas.getContext('2d');
  canvas.width=canvas.offsetWidth*window.devicePixelRatio||600;
  canvas.height=canvas.offsetHeight*window.devicePixelRatio||180;
  ctx.scale(window.devicePixelRatio,window.devicePixelRatio);
  const W=canvas.offsetWidth,H=canvas.offsetHeight;
  ctx.clearRect(0,0,W,H);
  const days=perfPeriod==='7d'?7:perfPeriod==='30d'?30:90;
  const pts=[];let v=25;
  for(let i=0;i<days;i++){v+=v*(Math.random()*0.06-0.018);pts.push(v);}
  const min=Math.min(...pts),max=Math.max(...pts),range=max-min||1;
  const grad=ctx.createLinearGradient(0,0,0,H);
  grad.addColorStop(0,'rgba(0,230,118,0.3)');grad.addColorStop(1,'rgba(0,230,118,0)');
  ctx.beginPath();
  pts.forEach((p,i)=>{const x=(i/(pts.length-1))*W,y=H-((p-min)/range)*(H*0.85)-H*0.05;i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);});
  ctx.strokeStyle='var(--green)';ctx.lineWidth=2;ctx.stroke();
  ctx.lineTo(W,H);ctx.lineTo(0,H);ctx.closePath();ctx.fillStyle=grad;ctx.fill();
  const ret=((pts[pts.length-1]-pts[0])/pts[0]*100);
  const diffs=pts.slice(1).map((v,i)=>(v-pts[i])/pts[i]*100);
  document.getElementById('pfReturn').textContent=(ret>=0?'+':'')+ret.toFixed(2)+'%';
  document.getElementById('pfReturn').className='pf-val '+(ret>=0?'text-green':'text-red');
  document.getElementById('pfBest').textContent='+'+Math.max(...diffs).toFixed(2)+'%';
  document.getElementById('pfWorst').textContent=Math.min(...diffs).toFixed(2)+'%';
}

function buildAllocChart(){
  const canvas=document.getElementById('allocCanvas');if(!canvas)return;
  const ctx=canvas.getContext('2d');
  const size=140*window.devicePixelRatio;canvas.width=size;canvas.height=size;
  ctx.scale(window.devicePixelRatio,window.devicePixelRatio);
  const W=70,H=70;
  const allocs=[
    {name:'BTC',pct:45,color:'#F7931A'},{name:'ETH',pct:25,color:'#627EEA'},
    {name:'SOL',pct:15,color:'#9945FF'},{name:'BNB',pct:10,color:'#F0B90B'},{name:'Other',pct:5,color:'#8892A4'}
  ];
  let start=-Math.PI/2;
  allocs.forEach(a=>{
    const slice=(a.pct/100)*Math.PI*2;
    ctx.beginPath();ctx.moveTo(W,H);ctx.arc(W,H,W-8,start,start+slice);ctx.closePath();
    ctx.fillStyle=a.color;ctx.fill();start+=slice;
  });
  ctx.beginPath();ctx.arc(W,H,W-28,0,Math.PI*2);ctx.fillStyle='var(--bg1)';ctx.fill();
  const bal=currentUser?(dashMode==='demo'?currentUser.demoBalance:currentUser.realBalance):0;
  document.getElementById('acAmount').textContent='$'+bal.toFixed(0);
  const legend=document.getElementById('allocLegend');if(!legend)return;
  legend.innerHTML=allocs.map(a=>'<div class="al-row"><div class="al-dot" style="background:'+a.color+'"></div><span class="al-name">'+a.name+'</span><span class="al-pct">'+a.pct+'%</span></div>').join('');
}

function buildRecentTrades(){
  const container=document.getElementById('recentTradesContainer');if(!container)return;
  const trades=(currentUser?.trades||[]).filter(t=>t.closed).slice(-8).reverse();
  if(!trades.length){container.innerHTML='<div class="empty-state"><div style="font-size:36px;margin-bottom:8px;">ðŸ“­</div><div style="font-size:13px;color:var(--text2);">No trades yet</div></div>';return;}
  container.innerHTML=trades.map(t=>{
    const isWin=t.pnl>0;const sign=isWin?'+':'';
    return '<div class="rt-row"><span class="rt-type '+(isWin?'win':'loss')+'">'+(isWin?'WIN':'LOSS')+'</span><span class="rt-pair">'+t.pair+'</span><span class="rt-pnl '+(isWin?'text-green':'text-red')+'">'+sign+'$'+Math.abs(t.pnl).toFixed(2)+'</span><span class="rt-date">'+t.date+'</span></div>';
  }).join('');
}

function buildOpenPositions(){
  const container=document.getElementById('openPositionsContainer');if(!container)return;
  const positions=(currentUser?.openPositions||[]);
  document.getElementById('openPosCount').textContent=positions.length+' Active';
  if(!positions.length){container.innerHTML='<div class="empty-state"><div style="font-size:40px;margin-bottom:8px;">ðŸ“Š</div><div style="font-weight:600;color:var(--text2);">No open positions</div><div style="font-size:12px;color:var(--text3);margin-top:4px;">Start trading to see live P&L here</div><button class="btn btn-green" style="margin-top:16px;" onclick="showLayer(\'tradingLayer\')">Open Trade â†’</button></div>';return;}
  container.innerHTML=positions.map((p,i)=>{
    const currentPrice=PAIR_PRICES[p.base]||p.entryPrice;
    const priceDiff=p.side==='buy'?(currentPrice-p.entryPrice):(p.entryPrice-currentPrice);
    const pnl=(priceDiff/p.entryPrice)*p.amount*p.leverage;
    const pnlPct=(priceDiff/p.entryPrice)*p.leverage*100;
    const isProfit=pnl>=0;
    return '<div class="position-row"><div class="pr-top"><span class="pr-pair">'+p.pair+'</span><span class="pr-type '+(p.side==='buy'?'long':'short')+'">'+(p.side==='buy'?'LONG':'SHORT')+'</span><span class="pr-pnl '+(isProfit?'text-green':'text-red')+'">'+(isProfit?'+':'')+pnl.toFixed(2)+'$ ('+(isProfit?'+':'')+pnlPct.toFixed(2)+'%)</span></div><div class="pr-stats"><div class="pr-stat"><span class="pr-stat-lbl">Entry</span><span class="pr-stat-val">'+fmtPriceShort(p.entryPrice)+'</span></div><div class="pr-stat"><span class="pr-stat-lbl">Current</span><span class="pr-stat-val">'+fmtPriceShort(currentPrice)+'</span></div><div class="pr-stat"><span class="pr-stat-lbl">Amount</span><span class="pr-stat-val">$'+p.amount+'</span></div><div class="pr-stat"><span class="pr-stat-lbl">Leverage</span><span class="pr-stat-val">'+p.leverage+'Ã—</span></div></div><button class="pr-close-btn" onclick="closePosition('+i+')">Close Position</button></div>';
  }).join('');
}

function closePosition(idx){
  if(!currentUser||!currentUser.openPositions)return;
  const p=currentUser.openPositions[idx];if(!p)return;
  const currentPrice=PAIR_PRICES[p.base]||p.entryPrice;
  const priceDiff=p.side==='buy'?(currentPrice-p.entryPrice):(p.entryPrice-currentPrice);
  const pnl=parseFloat(((priceDiff/p.entryPrice)*p.amount*p.leverage).toFixed(2));
  if(dashMode==='demo')currentUser.demoBalance=parseFloat((currentUser.demoBalance+p.amount+pnl).toFixed(2));
  else currentUser.realBalance=parseFloat((currentUser.realBalance+p.amount+pnl).toFixed(2));
  currentUser.profit=parseFloat(((currentUser.profit||0)+pnl).toFixed(2));
  currentUser.openPositions.splice(idx,1);
  currentUser.trades.push({pair:p.pair,side:p.side,amount:p.amount,leverage:p.leverage,entryPrice:p.entryPrice,exitPrice:currentPrice,pnl,closed:true,date:new Date().toLocaleDateString()});
  saveState();buildOpenPositions();buildRecentTrades();initDashboard();
  addNotification(pnl>=0?'âœ…':'âŒ','Position closed: '+p.pair+' '+(pnl>=0?'+':'')+pnl.toFixed(2)+'$',pnl>=0?'rgba(0,230,118,.2)':'rgba(255,61,87,.2)');
  showToast((pnl>=0?'âœ… Position closed: +$'+pnl.toFixed(2)+' profit!':'â›” Position closed: -$'+Math.abs(pnl).toFixed(2)+' loss'),(pnl>=0?'green':'red'),4000);
}

function buildMarketSnap(){
  const list=document.getElementById('mSnapList');if(!list)return;
  list.innerHTML=COINS.slice(0,6).map(c=>{
    const cls=c.chg>=0?'nt-up':'nt-dn';const sign=c.chg>=0?'+':'';
    return '<div class="ms-row" onclick="showLayer(\'chartsLayer\')"><span class="ms-sym">'+c.sym+'</span><span class="ms-price">'+fmtPrice(c.price)+'</span><span class="ms-chg '+cls+'">'+sign+c.chg.toFixed(2)+'%</span></div>';
  }).join('');
}

// ============================================================
// CHARTS LAYER â€” TradingView Lightweight Charts
// ============================================================
function initChartsLayer(){
  if(!document.getElementById('tvChartContainer'))return;
  if(!tvMainChart){
    tvMainChart=LightweightCharts.createChart(document.getElementById('tvChartContainer'),{
      layout:{background:{type:'Solid',color:'#06080D'},textColor:'#8892A4'},
      grid:{vertLines:{color:'rgba(255,255,255,0.04)'},horzLines:{color:'rgba(255,255,255,0.04)'}},
      crosshair:{mode:LightweightCharts.CrosshairMode.Normal},
      rightPriceScale:{borderColor:'rgba(255,255,255,0.06)'},
      timeScale:{borderColor:'rgba(255,255,255,0.06)',timeVisible:true,secondsVisible:false},
      watermark:{visible:false},
      autoSize:true
    });
    tvMainSeries=tvMainChart.addCandlestickSeries({upColor:'#00E676',downColor:'#FF3D57',borderUpColor:'#00E676',borderDownColor:'#FF3D57',wickUpColor:'#00E676',wickDownColor:'#FF3D57'});
    if(showMAChart){tvMainMA=tvMainChart.addLineSeries({color:'rgba(255,215,64,0.8)',lineWidth:1,priceLineVisible:false,lastValueVisible:false});}
    if(showBBChart){
      tvMainBBU=tvMainChart.addLineSeries({color:'rgba(68,138,255,0.5)',lineWidth:1,priceLineVisible:false,lastValueVisible:false,lineStyle:LightweightCharts.LineStyle.Dashed});
      tvMainBBL=tvMainChart.addLineSeries({color:'rgba(68,138,255,0.5)',lineWidth:1,priceLineVisible:false,lastValueVisible:false,lineStyle:LightweightCharts.LineStyle.Dashed});
    }
  }
  if(!tvRsiChart&&document.getElementById('tvRsiContainer')){
    tvRsiChart=LightweightCharts.createChart(document.getElementById('tvRsiContainer'),{
      layout:{background:{type:'Solid',color:'#06080D'},textColor:'#8892A4'},
      grid:{vertLines:{color:'rgba(255,255,255,0.03)'},horzLines:{color:'rgba(255,255,255,0.03)'}},
      rightPriceScale:{borderColor:'rgba(255,255,255,0.06)',scaleMargins:{top:0.1,bottom:0.1}},
      timeScale:{borderColor:'rgba(255,255,255,0.06)',timeVisible:true,visible:false},
      autoSize:true,height:80
    });
    tvRsiSeries=tvRsiChart.addLineSeries({color:'#AA77FF',lineWidth:1.5,priceLineVisible:false,lastValueVisible:true});
  }
  loadChartData(currentChartPair+'USDT',currentChartInterval);
  startOrderBookStream(currentChartPair+'USDT',data=>{updateOrderBook(data,'obAsks','obBids','obSpreadPrice','obSpreadPct');drawDepthChart(data);});
  startTradeFeedStream(currentChartPair+'USDT',trade=>addTradeRow(trade,'tradesFeed'));
  buildMarketCards();
}

async function loadChartData(symbol,interval){
  const data=await fetchHistoricalKlines(symbol,interval,300);
  if(!data||!tvMainSeries)return;
  tvMainSeries.setData(data);
  if(tvMainMA&&showMAChart)tvMainMA.setData(calcMA(data,20));
  if(tvMainBBU&&tvMainBBL&&showBBChart){const bb=calcBB(data,20,2);tvMainBBU.setData(bb.upper);tvMainBBL.setData(bb.lower);}
  if(tvRsiSeries&&showRSIChart)tvRsiSeries.setData(calcRSI(data,14));
  tvMainChart.timeScale().fitContent();
  startKlineStream(symbol,interval,candle=>{
    tvMainSeries.update(candle);
    if(tvMainMA&&showMAChart){const all=[...data];const last=all[all.length-1];if(last&&last.time===candle.time)all[all.length-1]=candle;else all.push(candle);const ma=calcMA(all,20);if(ma.length)tvMainMA.update(ma[ma.length-1]);}
  });
}

function selectPair(base,quote,btn){
  currentChartPair=base;
  document.querySelectorAll('.pair-bar-inner .pair-btn').forEach(b=>b.classList.remove('active'));
  if(btn)btn.classList.add('active');
  document.getElementById('phPairName').textContent=base+' / '+quote;
  if(tvMainSeries){tvMainSeries.setData([]);}
  loadChartData(base+quote,currentChartInterval);
  startOrderBookStream(base+quote,data=>{updateOrderBook(data,'obAsks','obBids','obSpreadPrice','obSpreadPct');drawDepthChart(data);});
  startTradeFeedStream(base+quote,trade=>addTradeRow(trade,'tradesFeed'));
}

function setChartInterval(interval,btn){
  currentChartInterval=interval;
  document.querySelectorAll('.interval-btns .iv-btn').forEach(b=>b.classList.remove('active'));
  if(btn)btn.classList.add('active');
  loadChartData(currentChartPair+'USDT',interval);
}

function toggleMA(btn){showMAChart=!showMAChart;btn.classList.toggle('active',showMAChart);if(tvMainMA){if(!showMAChart){tvMainChart.removeSeries(tvMainMA);tvMainMA=null;}else{tvMainMA=tvMainChart.addLineSeries({color:'rgba(255,215,64,0.8)',lineWidth:1,priceLineVisible:false,lastValueVisible:false});loadChartData(currentChartPair+'USDT',currentChartInterval);}}}
function toggleBB(btn){showBBChart=!showBBChart;btn.classList.toggle('active',showBBChart);if(!showBBChart){if(tvMainBBU){tvMainChart.removeSeries(tvMainBBU);tvMainBBU=null;}if(tvMainBBL){tvMainChart.removeSeries(tvMainBBL);tvMainBBL=null;}}else{tvMainBBU=tvMainChart.addLineSeries({color:'rgba(68,138,255,0.5)',lineWidth:1,priceLineVisible:false,lastValueVisible:false,lineStyle:LightweightCharts.LineStyle.Dashed});tvMainBBL=tvMainChart.addLineSeries({color:'rgba(68,138,255,0.5)',lineWidth:1,priceLineVisible:false,lastValueVisible:false,lineStyle:LightweightCharts.LineStyle.Dashed});loadChartData(currentChartPair+'USDT',currentChartInterval);}}
function toggleVol(btn){showVolChart=!showVolChart;btn.classList.toggle('active',showVolChart);document.getElementById('volWrapTV').style.display=showVolChart?'block':'none';}
function toggleRSI(btn){showRSIChart=!showRSIChart;btn.classList.toggle('active',showRSIChart);document.getElementById('rsiWrapTV').style.display=showRSIChart?'block':'none';if(showRSIChart&&tvRsiSeries){fetchHistoricalKlines(currentChartPair+'USDT',currentChartInterval,300).then(data=>{if(data)tvRsiSeries.setData(calcRSI(data,14));});}}

// ============================================================
// TRADING LAYER
// ============================================================
function initTradingLayer(){
  if(!document.getElementById('tvTradingChart'))return;
  if(!tvTradingChart){
    tvTradingChart=LightweightCharts.createChart(document.getElementById('tvTradingChart'),{
      layout:{background:{type:'Solid',color:'#06080D'},textColor:'#8892A4'},
      grid:{vertLines:{color:'rgba(255,255,255,0.04)'},horzLines:{color:'rgba(255,255,255,0.04)'}},
      crosshair:{mode:LightweightCharts.CrosshairMode.Normal},
      rightPriceScale:{borderColor:'rgba(255,255,255,0.06)'},
      timeScale:{borderColor:'rgba(255,255,255,0.06)',timeVisible:true,secondsVisible:false},
      autoSize:true
    });
    tvTradingSeries=tvTradingChart.addCandlestickSeries({upColor:'#00E676',downColor:'#FF3D57',borderUpColor:'#00E676',borderDownColor:'#FF3D57',wickUpColor:'#00E676',wickDownColor:'#FF3D57'});
    if(showTrdMA)tvTrdMA=tvTradingChart.addLineSeries({color:'rgba(255,215,64,0.8)',lineWidth:1,priceLineVisible:false,lastValueVisible:false});
    if(showTrdBB){
      tvTrdBBU=tvTradingChart.addLineSeries({color:'rgba(68,138,255,0.5)',lineWidth:1,priceLineVisible:false,lastValueVisible:false,lineStyle:LightweightCharts.LineStyle.Dashed});
      tvTrdBBL=tvTradingChart.addLineSeries({color:'rgba(68,138,255,0.5)',lineWidth:1,priceLineVisible:false,lastValueVisible:false,lineStyle:LightweightCharts.LineStyle.Dashed});
    }
  }
  if(!tvTrdRsiChart&&document.getElementById('tvTrdRsiContainer')){
    tvTrdRsiChart=LightweightCharts.createChart(document.getElementById('tvTrdRsiContainer'),{
      layout:{background:{type:'Solid',color:'#06080D'},textColor:'#8892A4'},
      grid:{vertLines:{color:'rgba(255,255,255,0.03)'},horzLines:{color:'rgba(255,255,255,0.03)'}},
      rightPriceScale:{borderColor:'rgba(255,255,255,0.06)',scaleMargins:{top:0.1,bottom:0.1}},
      timeScale:{visible:false},autoSize:true
    });
    tvTrdRsiSeries=tvTrdRsiChart.addLineSeries({color:'#AA77FF',lineWidth:1.5,priceLineVisible:false,lastValueVisible:true});
  }
  loadTradingChartData(currentTradePair+'USDT',currentTrdInterval);
  startOrderBookStream(currentTradePair+'USDT',data=>{
    updateOrderBook(data,'miniObAsks','miniObBids','miniSpreadPrice',null,5);
  });
  updateTradingPanel();calcOrderSummary();
}

async function loadTradingChartData(symbol,interval){
  const data=await fetchHistoricalKlines(symbol,interval,300);
  if(!data||!tvTradingSeries)return;
  tvTradingSeries.setData(data);
  if(tvTrdMA&&showTrdMA)tvTrdMA.setData(calcMA(data,20));
  if(tvTrdBBU&&tvTrdBBL&&showTrdBB){const bb=calcBB(data,20,2);tvTrdBBU.setData(bb.upper);tvTrdBBL.setData(bb.lower);}
  if(tvTrdRsiSeries&&showTrdRSI)tvTrdRsiSeries.setData(calcRSI(data,14));
  tvTradingChart.timeScale().fitContent();
  startKlineStream(symbol,interval,candle=>{if(tvTradingSeries)tvTradingSeries.update(candle);});
}

function tradingSelectPair(base,quote,btn){
  currentTradePair=base;
  document.querySelectorAll('#tradePairBar .pair-btn').forEach(b=>b.classList.remove('active'));
  if(btn)btn.classList.add('active');
  document.getElementById('tpsPair').textContent=base+'/'+quote;
  if(tvTradingSeries)tvTradingSeries.setData([]);
  loadTradingChartData(base+quote,currentTrdInterval);
  startOrderBookStream(base+quote,data=>updateOrderBook(data,'miniObAsks','miniObBids','miniSpreadPrice',null,5));
  calcOrderSummary();
}

function setTrdInterval(interval,btn){
  currentTrdInterval=interval;
  document.querySelectorAll('.trade-chart-col .iv-btn').forEach(b=>b.classList.remove('active'));
  if(btn)btn.classList.add('active');
  loadTradingChartData(currentTradePair+'USDT',interval);
}

function toggleTrdMA(btn){showTrdMA=!showTrdMA;btn.classList.toggle('active',showTrdMA);if(!showTrdMA&&tvTrdMA){tvTradingChart.removeSeries(tvTrdMA);tvTrdMA=null;}else if(showTrdMA&&tvTradingChart){tvTrdMA=tvTradingChart.addLineSeries({color:'rgba(255,215,64,0.8)',lineWidth:1,priceLineVisible:false,lastValueVisible:false});loadTradingChartData(currentTradePair+'USDT',currentTrdInterval);}}
function toggleTrdBB(btn){showTrdBB=!showTrdBB;btn.classList.toggle('active',showTrdBB);}
function toggleTrdRSI(btn){showTrdRSI=!showTrdRSI;btn.classList.toggle('active',showTrdRSI);document.getElementById('trdRsiWrap').style.display=showTrdRSI?'block':'none';}

function setOrderSide(side){
  orderSide=side;
  document.getElementById('otBuy').classList.toggle('active',side==='buy');
  document.getElementById('otSell').classList.toggle('active',side==='sell');
  const btn=document.getElementById('orderSubmitBtn');
  btn.className='order-submit-btn '+(side==='buy'?'buy':'sell');
  document.getElementById('orderSubmitText').textContent=side==='buy'?'â–² BUY / LONG':'â–¼ SELL / SHORT';
  calcOrderSummary();
}

function setOrderType(type,btn){
  orderType=type;
  document.querySelectorAll('.order-type-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('limitPriceGroup').style.display=(type==='limit'||type==='stop')?'block':'none';
}

function updateLeverage(val){
  val=parseInt(val);
  document.getElementById('leverageVal').textContent=val+'Ã—';
  document.getElementById('leverageSlider').value=val;
  const pct=(val/100)*100;
  document.getElementById('leverageSlider').style.background='linear-gradient(to right,var(--green) 0%,var(--green) '+pct+'%,var(--bg3) '+pct+'%,var(--bg3) 100%)';
  const riskWarn=document.getElementById('riskWarning');
  if(val>=50){riskWarn.style.display='flex';document.getElementById('riskMsg').textContent=val>=100?'âš ï¸ Maximum leverage! Small moves = full liquidation.':val>=75?'âš ï¸ Very high leverage! Extreme risk.':'âš ï¸ High leverage increases liquidation risk.';}
  else riskWarn.style.display='none';
  calcOrderSummary();
}

function setTradePct(pct){
  if(!currentUser)return;
  const bal=dashMode==='demo'?currentUser.demoBalance:currentUser.realBalance;
  document.getElementById('tradeAmt').value=(bal*(pct/100)).toFixed(2);
  calcOrderSummary();
}

function calcOrderSummary(){
  const price=PAIR_PRICES[currentTradePair]||0;
  const amt=parseFloat(document.getElementById('tradeAmt').value)||0;
  const lev=parseInt(document.getElementById('leverageSlider').value)||10;
  const tp=parseFloat(document.getElementById('takeProfit').value)||0;
  const sl=parseFloat(document.getElementById('stopLoss').value)||0;
  const posSize=amt*lev;
  const margin=amt;
  const liqPct=1/lev;
  const liqPrice=orderSide==='buy'?price*(1-liqPct):price*(1+liqPct);
  document.getElementById('osEntry').textContent=price?fmtPriceShort(price):'â€”';
  document.getElementById('osPosition').textContent=amt?'$'+posSize.toFixed(2):'â€”';
  document.getElementById('osMargin').textContent=amt?'$'+margin.toFixed(2):'â€”';
  document.getElementById('osLiq').textContent=amt?fmtPriceShort(liqPrice):'â€”';
  if(tp&&price&&amt){const diff=orderSide==='buy'?(tp-price)/price:(price-tp)/price;const profit=diff*posSize;document.getElementById('osProfit').textContent=(profit>=0?'+':'')+profit.toFixed(2)+'$';}else document.getElementById('osProfit').textContent='â€”';
  if(sl&&price&&amt){const diff=orderSide==='buy'?(price-sl)/price:(sl-price)/price;const loss=diff*posSize;document.getElementById('osLoss').textContent='-'+loss.toFixed(2)+'$';}else document.getElementById('osLoss').textContent='â€”';
}

function updateTradingPanel(){
  if(!currentUser)return;
  const bal=dashMode==='demo'?currentUser.demoBalance:currentUser.realBalance;
  document.getElementById('tradeAvailBal').textContent='$'+bal.toFixed(2);
  document.getElementById('tradeModeLabel').textContent=dashMode==='demo'?'DEMO':'REAL';
  document.getElementById('opDemo').classList.toggle('active',dashMode==='demo');
  document.getElementById('opReal').classList.toggle('active',dashMode==='real');
  buildMyPositions();buildMiniHistory();
}

function submitTrade(){
  if(!currentUser){showToast('Please log in to trade.','red');showLayer('loginLayer');return;}
  const amt=parseFloat(document.getElementById('tradeAmt').value);
  if(!amt||amt<1){showToast('Enter a valid amount (minimum $1)','red');return;}
  const bal=dashMode==='demo'?currentUser.demoBalance:currentUser.realBalance;
  if(amt>bal){showToast('Insufficient balance. Deposit more funds.','red');return;}
  const price=PAIR_PRICES[currentTradePair]||98450;
  const lev=parseInt(document.getElementById('leverageSlider').value)||10;
  const tp=parseFloat(document.getElementById('takeProfit').value)||0;
  const sl=parseFloat(document.getElementById('stopLoss').value)||0;
  pendingTradeData={pair:currentTradePair+'/USDT',base:currentTradePair,side:orderSide,amount:amt,leverage:lev,entryPrice:price,takeProfit:tp||null,stopLoss:sl||null,mode:dashMode};
  document.getElementById('modalTitle').innerHTML=(orderSide==='buy'?'<span style="color:var(--green)">â–² BUY / LONG</span>':'<span style="color:var(--red)">â–¼ SELL / SHORT</span>')+' â€” '+pendingTradeData.pair;
  document.getElementById('modalRows').innerHTML='<div class="modal-row"><span>Pair</span><span>'+pendingTradeData.pair+'</span></div><div class="modal-row"><span>Direction</span><span>'+(orderSide==='buy'?'LONG':'SHORT')+'</span></div><div class="modal-row"><span>Amount</span><span>$'+amt.toFixed(2)+'</span></div><div class="modal-row"><span>Leverage</span><span>'+lev+'Ã—</span></div><div class="modal-row"><span>Position Size</span><span>$'+(amt*lev).toFixed(2)+'</span></div><div class="modal-row"><span>Entry Price</span><span>'+fmtPriceShort(price)+'</span></div>'+(tp?'<div class="modal-row"><span>Take Profit</span><span style="color:var(--green)">'+fmtPriceShort(tp)+'</span></div>':'')+(sl?'<div class="modal-row"><span>Stop Loss</span><span style="color:var(--red)">'+fmtPriceShort(sl)+'</span></div>':'')+'<div class="modal-row"><span>Account Mode</span><span style="color:'+(dashMode==='demo'?'var(--yellow)':'var(--green)\'')+'">'+dashMode.toUpperCase()+'</span></div>';
  document.getElementById('modalConfirmBtn').className='btn-auth';
  document.getElementById('modalConfirmBtn').style.background=orderSide==='buy'?'var(--green)':'var(--red)';
  document.getElementById('orderModal').style.display='flex';
}

function confirmTrade(){
  if(!pendingTradeData||!currentUser)return;
  const p=pendingTradeData;
  if(p.mode==='demo')currentUser.demoBalance=parseFloat((currentUser.demoBalance-p.amount).toFixed(2));
  else currentUser.realBalance=parseFloat((currentUser.realBalance-p.amount).toFixed(2));
  const pos={pair:p.pair,base:p.base,side:p.side,amount:p.amount,leverage:p.leverage,entryPrice:p.entryPrice,takeProfit:p.takeProfit,stopLoss:p.stopLoss,openTime:Date.now(),mode:p.mode};
  currentUser.openPositions.push(pos);
  saveState();
  document.getElementById('orderModal').style.display='none';
  showFillNotification(p);
  addNotification('âš¡','Trade opened: '+(p.side==='buy'?'LONG':'SHORT')+' '+p.pair+' $'+p.amount+' @ '+fmtPriceShort(p.entryPrice),'rgba(0,230,118,.2)');
  showToast('âš¡ Trade placed! '+(p.side==='buy'?'LONG':'SHORT')+' '+p.pair+' $'+p.amount+' @ '+p.leverage+'Ã—','green',4000);
  updateTradingPanel();buildOpenPositions();initDashboard();
  schedulePositionSimulation(pos,currentUser.openPositions.length-1);
  pendingTradeData=null;
}

function showFillNotification(p){
  const el=document.getElementById('fillNotif');
  el.innerHTML='<div class="fill-notification"><div class="fill-icon">âš¡</div><div><div class="fill-text">'+(p.side==='buy'?'LONG':'SHORT')+' '+p.pair+' Filled!</div><div class="fill-sub">'+p.amount+'$ @ '+p.leverage+'Ã— Â· Entry: '+fmtPriceShort(p.entryPrice)+'</div></div></div>';
  el.style.display='block';
  setTimeout(()=>el.style.display='none',4000);
}

function closeOrderModal(e){if(e.target.id==='orderModal')document.getElementById('orderModal').style.display='none';}

function schedulePositionSimulation(pos,idx){
  if(!pos.takeProfit&&!pos.stopLoss){
    const timeout=Math.floor(Math.random()*120000+60000);
    setTimeout(()=>{
      if(!currentUser||!currentUser.openPositions[idx])return;
      const priceDiff=pos.side==='buy'?(Math.random()>0.45?1:-1):(Math.random()>0.45?1:-1);
      const pct=(Math.random()*0.08+0.005)*priceDiff;
      const exitPrice=pos.entryPrice*(1+pct);
      const pnl=parseFloat((pct*pos.amount*pos.leverage).toFixed(2));
      autoClosePosition(idx,exitPrice,pnl);
    },timeout);
  }
}

function autoClosePosition(idx,exitPrice,pnl){
  if(!currentUser||!currentUser.openPositions[idx])return;
  const p=currentUser.openPositions[idx];
  if(p.mode==='demo')currentUser.demoBalance=parseFloat((currentUser.demoBalance+p.amount+pnl).toFixed(2));
  else currentUser.realBalance=parseFloat((currentUser.realBalance+p.amount+pnl).toFixed(2));
  currentUser.profit=parseFloat(((currentUser.profit||0)+pnl).toFixed(2));
  currentUser.openPositions.splice(idx,1);
  currentUser.trades.push({pair:p.pair,side:p.side,amount:p.amount,leverage:p.leverage,entryPrice:p.entryPrice,exitPrice,pnl,closed:true,date:new Date().toLocaleDateString()});
  saveState();
  const isWin=pnl>=0;
  addNotification(isWin?'âœ…':'âŒ','Auto-closed '+p.pair+': '+(isWin?'+':'')+pnl.toFixed(2)+'$',isWin?'rgba(0,230,118,.2)':'rgba(255,61,87,.2)');
  showToast((isWin?'âœ… Auto-close: +$'+pnl.toFixed(2)+' PROFIT!':'â›” Auto-close: -$'+Math.abs(pnl).toFixed(2)+' loss'),(isWin?'green':'red'),5000);
  buildOpenPositions();buildRecentTrades();initDashboard();buildMyPositions();buildMiniHistory();
}

function buildMyPositions(){
  const list=document.getElementById('myPositionsList');if(!list)return;
  const positions=currentUser?.openPositions||[];
  document.getElementById('myPosCount').textContent=positions.length;
  if(!positions.length){list.innerHTML='<div style="padding:16px;text-align:center;font-size:11px;color:var(--text3);">No open positions</div>';return;}
  list.innerHTML=positions.map((p,i)=>{
    const cur=PAIR_PRICES[p.base]||p.entryPrice;
    const diff=p.side==='buy'?(cur-p.entryPrice):(p.entryPrice-cur);
    const pnl=(diff/p.entryPrice)*p.amount*p.leverage;
    const isProfit=pnl>=0;
    return '<div class="my-pos-row"><div class="mpr-top"><span class="mpr-pair">'+p.pair+'</span><span class="mpr-pnl '+(isProfit?'text-green':'text-red')+'">'+(isProfit?'+':'')+pnl.toFixed(2)+'$</span></div><div class="mpr-stats"><span>'+(p.side==='buy'?'LONG':'SHORT')+'</span><span>'+p.leverage+'Ã—</span><span>$'+p.amount+'</span></div><button class="mpr-close" onclick="closePosition('+i+')">Close</button></div>';
  }).join('');
}

function buildMiniHistory(){
  const list=document.getElementById('miniHistoryList');if(!list)return;
  const trades=(currentUser?.trades||[]).filter(t=>t.closed).slice(-6).reverse();
  if(!trades.length){list.innerHTML='<div style="padding:16px;text-align:center;font-size:11px;color:var(--text3);">No trades yet</div>';return;}
  list.innerHTML=trades.map(t=>{
    const isWin=t.pnl>0;
    return '<div style="padding:6px 10px;border-bottom:1px solid var(--border);font-size:11px;display:flex;justify-content:space-between;"><span style="font-weight:700;">'+t.pair+'</span><span class="'+(isWin?'text-green':'text-red')+' mono">'+(isWin?'+':'')+t.pnl.toFixed(2)+'$</span></div>';
  }).join('');
}

// ============================================================
// ORDER BOOK
// ============================================================
function updateOrderBook(data,asksId,bidsId,spreadId,spreadPctId,limit=15){
  const asksEl=document.getElementById(asksId);
  const bidsEl=document.getElementById(bidsId);
  if(!asksEl||!bidsEl)return;
  const asks=data.asks.slice(0,limit);
  const bids=data.bids.slice(0,limit);
  const maxTotal=Math.max(...asks.concat(bids).map(r=>r.total));
  asksEl.innerHTML=asks.reverse().map(r=>{
    const pct=(r.total/maxTotal)*100;
    return '<div class="ob-row" style="background:linear-gradient(to left,rgba(255,61,87,0.08) '+pct+'%,transparent '+pct+'%)"><span class="ob-price ask">'+r.price.toFixed(2)+'</span><span class="ob-amt">'+r.qty.toFixed(4)+'</span><span class="ob-total">'+r.total.toFixed(0)+'</span></div>';
  }).join('');
  bidsEl.innerHTML=bids.map(r=>{
    const pct=(r.total/maxTotal)*100;
    return '<div class="ob-row" style="background:linear-gradient(to left,rgba(0,230,118,0.08) '+pct+'%,transparent '+pct+'%)"><span class="ob-price bid">'+r.price.toFixed(2)+'</span><span class="ob-amt">'+r.qty.toFixed(4)+'</span><span class="ob-total">'+r.total.toFixed(0)+'</span></div>';
  }).join('');
  if(asks.length&&bids.length){
    const bestAsk=asks[asks.length-1].price,bestBid=bids[0].price;
    const spread=bestAsk-bestBid;const midPrice=(bestAsk+bestBid)/2;
    const spreadPct=(spread/midPrice*100).toFixed(3);
    const spreadEl=document.getElementById(spreadId);if(spreadEl)spreadEl.textContent=midPrice.toFixed(2);
    const pctEl=document.getElementById(spreadPctId);if(pctEl)pctEl.textContent='Spread: '+spread.toFixed(2)+' ('+spreadPct+'%)';
  }
}

function setOBView(view,btn){
  document.querySelectorAll('.ob-tabs .ob-tab').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  const asks=document.getElementById('obAsks'),bids=document.getElementById('obBids');
  asks.style.display=(view==='bids')?'none':'flex';
  bids.style.display=(view==='asks')?'none':'block';
}

let tradeFeedRows=[];
function addTradeRow(trade,feedId){
  const feed=document.getElementById(feedId);if(!feed)return;
  tradeFeedRows.unshift(trade);if(tradeFeedRows.length>80)tradeFeedRows.pop();
  const now=new Date(trade.time);const t=now.getHours().toString().padStart(2,'0')+':'+now.getMinutes().toString().padStart(2,'0')+':'+now.getSeconds().toString().padStart(2,'0');
  const div=document.createElement('div');div.className='tp-row';
  div.innerHTML='<span class="tp-price '+(trade.isSell?'sell':'buy')+'">'+trade.price.toFixed(2)+'</span><span class="tp-amt">'+trade.qty.toFixed(4)+'</span><span class="tp-time">'+t+'</span>';
  feed.insertBefore(div,feed.firstChild);
  while(feed.children.length>50)feed.removeChild(feed.lastChild);
}

// ============================================================
// DEPTH CHART
// ============================================================
function drawDepthChart(data){
  const canvas=document.getElementById('depthCanvas');if(!canvas)return;
  const ctx=canvas.getContext('2d');
  canvas.width=canvas.offsetWidth*window.devicePixelRatio;
  canvas.height=canvas.offsetHeight*window.devicePixelRatio;
  ctx.scale(window.devicePixelRatio,window.devicePixelRatio);
  const W=canvas.offsetWidth,H=canvas.offsetHeight;
  ctx.clearRect(0,0,W,H);
  const bids=[...data.bids].sort((a,b)=>b.price-a.price);
  const asks=[...data.asks].sort((a,b)=>a.price-b.price);
  let bidCumTotal=0,askCumTotal=0;
  const bidCum=bids.map(b=>{bidCumTotal+=b.total;return{price:b.price,cum:bidCumTotal};});
  const askCum=asks.map(a=>{askCumTotal+=a.total;return{price:a.price,cum:askCumTotal};});
  const allPrices=[...bidCum.map(b=>b.price),...askCum.map(a=>a.price)];
  const minP=Math.min(...allPrices),maxP=Math.max(...allPrices);
  const maxCum=Math.max(bidCumTotal,askCumTotal);
  const pToX=p=>((p-minP)/(maxP-minP))*W;
  const cToY=c=>H-((c/maxCum)*(H*0.9))-H*0.05;
  ctx.beginPath();bidCum.forEach((b,i)=>{i===0?ctx.moveTo(pToX(b.price),cToY(b.cum)):ctx.lineTo(pToX(b.price),cToY(b.cum));});ctx.lineTo(pToX(bidCum[bidCum.length-1]?.price||0),H);ctx.lineTo(0,H);ctx.closePath();const bidGrad=ctx.createLinearGradient(0,0,0,H);bidGrad.addColorStop(0,'rgba(0,230,118,0.4)');bidGrad.addColorStop(1,'rgba(0,230,118,0.05)');ctx.fillStyle=bidGrad;ctx.fill();ctx.strokeStyle='rgba(0,230,118,0.8)';ctx.lineWidth=1.5;ctx.stroke();
  ctx.beginPath();askCum.forEach((a,i)=>{i===0?ctx.moveTo(pToX(a.price),cToY(a.cum)):ctx.lineTo(pToX(a.price),cToY(a.cum));});ctx.lineTo(pToX(askCum[askCum.length-1]?.price||maxP),H);ctx.lineTo(W,H);ctx.closePath();const askGrad=ctx.createLinearGradient(0,0,0,H);askGrad.addColorStop(0,'rgba(255,61,87,0.4)');askGrad.addColorStop(1,'rgba(255,61,87,0.05)');ctx.fillStyle=askGrad;ctx.fill();ctx.strokeStyle='rgba(255,61,87,0.8)';ctx.lineWidth=1.5;ctx.stroke();
}

// ============================================================
// TECHNICAL INDICATORS
// ============================================================
function calcMA(data,period){
  const result=[];
  for(let i=period-1;i<data.length;i++){const slice=data.slice(i-period+1,i+1);const avg=slice.reduce((s,c)=>s+c.close,0)/period;result.push({time:data[i].time,value:avg});}
  return result;
}
function calcBB(data,period=20,stdDev=2){
  const upper=[],lower=[];
  for(let i=period-1;i<data.length;i++){const slice=data.slice(i-period+1,i+1);const avg=slice.reduce((s,c)=>s+c.close,0)/period;const variance=slice.reduce((s,c)=>s+Math.pow(c.close-avg,2),0)/period;const sd=Math.sqrt(variance);upper.push({time:data[i].time,value:avg+stdDev*sd});lower.push({time:data[i].time,value:avg-stdDev*sd});}
  return{upper,lower};
}
function calcRSI(data,period=14){
  const result=[];let avgGain=0,avgLoss=0;
  for(let i=1;i<data.length;i++){const diff=data[i].close-data[i-1].close;if(i<period+1){avgGain+=Math.max(diff,0)/period;avgLoss+=Math.max(-diff,0)/period;}else{avgGain=(avgGain*(period-1)+Math.max(diff,0))/period;avgLoss=(avgLoss*(period-1)+Math.max(-diff,0))/period;const rs=avgLoss===0?100:avgGain/avgLoss;result.push({time:data[i].time,value:100-(100/(1+rs))});}}
  return result;
}

// ============================================================
// MARKET CARDS
// ============================================================
function buildMarketCards(){
  const grid=document.getElementById('marketCardsGrid');if(!grid)return;
  grid.innerHTML=COINS.map(c=>{
    const cls=c.chg>=0?'text-green':'text-red';const sign=c.chg>=0?'+':'';
    return '<div class="market-card" onclick="selectPair(\''+c.sym.replace(\'/USDT\','')+'\',\'USDT\',null)"><div class="mc-sym">'+c.sym+'</div><div class="mc-price">'+fmtPrice(c.price)+'</div><div class="mc-chg '+cls+'">'+sign+c.chg.toFixed(2)+'%</div></div>';
  }).join('');
}

// ============================================================
// DEPOSIT
// ============================================================
function initDepositLayer(){
  if(!currentUser)return;
  const bal=dashMode==='demo'?currentUser.demoBalance:currentUser.realBalance;
  document.getElementById('depositAvailBal').textContent='$'+bal.toFixed(2)+' available';
}

function selectDepMethod(btn,gridId){
  document.querySelectorAll('#'+gridId+' .dep-method-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  const method=btn.getAttribute('data-method');
  const mpesaGroup=document.getElementById('mpesaPhoneGroup');
  const details=document.getElementById('depDetails');
  if(gridId==='depMethodGrid'){
    if(mpesaGroup)mpesaGroup.style.display=method==='mpesa'?'block':'none';
    if(details){
      if(method==='mpesa')details.innerHTML='ðŸ“± <strong style="color:var(--text1)">M-Pesa Till Number:</strong> <strong style="color:var(--green);font-family:var(--font-mono)">'+PAYMENT_CONFIG.MPESA.TILL_NUMBER+'</strong><br>Business Name: <strong style="color:var(--text1)">'+PAYMENT_CONFIG.MPESA.BUSINESS_NAME+'</strong><br><span style="font-size:11px;color:var(--text3);">Or enter phone below for STK Push</span>';
      else if(method==='bank')details.innerHTML='ðŸ¦ <strong style="color:var(--text1)">Bank:</strong> '+PAYMENT_CONFIG.BANK.Name+'<br><strong style="color:var(--text1)">Account:</strong> <strong style="color:var(--green);font-family:var(--font-mono)">'+PAYMENT_CONFIG.BANK.ACCOUNT+'</strong><br><strong style="color:var(--text1)">Name:</strong> '+PAYMENT_CONFIG.BANK.ACCOUNT_NAME;
      else details.innerHTML='â‚¿ <strong style="color:var(--text1)">BTC:</strong> <span style="font-family:var(--font-mono);font-size:11px;color:var(--green)">'+PAYMENT_CONFIG.CRYPTO.BTC+'</span><br>ðŸ”· <strong style="color:var(--text1)">ETH:</strong> <span style="font-family:var(--font-mono);font-size:11px;color:var(--blue)">'+PAYMENT_CONFIG.CRYPTO.ETH+'</span><br>ðŸ’µ <strong style="color:var(--text1)">USDT-TRC20:</strong> <span style="font-family:var(--font-mono);font-size:11px;color:var(--yellow)">'+PAYMENT_CONFIG.CRYPTO['USDT-TRC20']+'</span>';
    }
  }
}

function calcDepBonus(){
  const amt=parseFloat(document.getElementById('depositAmt').value)||0;
  const bonusLine=document.getElementById('depBonusLine');
  if(amt>=10){bonusLine.style.display='flex';document.getElementById('depBonusAmt').textContent='+$'+amt.toFixed(2);}
  else bonusLine.style.display='none';
}

function submitDeposit(){
  if(!currentUser){showToast('Please log in first','red');return;}
  const amt=parseFloat(document.getElementById('depositAmt').value);
  if(!amt||amt<10){showToast('Minimum deposit is $10','red');return;}
  const activeMethod=document.querySelector('#depMethodGrid .dep-method-btn.active');
  const method=activeMethod?activeMethod.getAttribute('data-method'):'mpesa';
  const phone=document.getElementById('depPhone').value.trim();
  const btn=document.getElementById('depositBtn');btn.disabled=true;btn.textContent='Processingâ€¦';
  const statusBox=document.getElementById('depStatusBox');
  statusBox.style.display='block';statusBox.style.background='rgba(255,215,64,0.1)';statusBox.style.border='1px solid rgba(255,215,64,0.3)';statusBox.style.color='var(--yellow)';statusBox.innerHTML='â³ Processing your deposit requestâ€¦';
  notifyAdminDeposit(currentUser,amt,method,phone);
  setTimeout(()=>{
    statusBox.style.background='rgba(0,230,118,0.1)';statusBox.style.border='1px solid rgba(0,230,118,0.3)';statusBox.style.color='var(--green)';
    statusBox.innerHTML='âœ… Deposit request submitted! Your account will be credited after payment confirmation.<br><br><strong style="color:var(--text1)">Complete payment to:</strong><br>'+( method==='mpesa'?'ðŸ“± M-Pesa Till: <strong>'+PAYMENT_CONFIG.MPESA.TILL_NUMBER+'</strong>':method==='bank'?'ðŸ¦ Bank Acc: <strong>'+PAYMENT_CONFIG.BANK.ACCOUNT+'</strong>':'â‚¿ Send crypto to address shown above');
    btn.disabled=false;btn.textContent='ðŸ’° Deposit Now';
    currentUser.deposits=parseFloat(((currentUser.deposits||0)+amt).toFixed(2));
    if(dashMode==='demo')currentUser.demoBalance=parseFloat((currentUser.demoBalance+amt+amt).toFixed(2));
    else currentUser.realBalance=parseFloat((currentUser.realBalance+amt+amt).toFixed(2));
    saveState();initDashboard();
    addNotification('ðŸ’°','Deposit $'+amt.toFixed(2)+' submitted via '+method,'rgba(0,230,118,.2)');
    showToast('âœ… Deposit of $'+amt.toFixed(2)+' received! 100% bonus applied!','green',6000);
  },2500);
}

// ============================================================
// WITHDRAW
// ============================================================
function initWithdrawLayer(){
  if(!currentUser)return;
  const bal=dashMode==='demo'?currentUser.demoBalance:currentUser.realBalance;
  document.getElementById('withdrawAvailBal').textContent='$'+bal.toFixed(2)+' available';
}

function calcWithdrawFee(){
  const amt=parseFloat(document.getElementById('withdrawAmt').value)||0;
  const box=document.getElementById('withdrawFeeBox');
  if(amt>=50){
    box.style.display='block';
    const fee=amt*0.02;const net=amt-fee;
    document.getElementById('wfAmt').textContent='$'+amt.toFixed(2);
    document.getElementById('wfFee').textContent='-$'+fee.toFixed(2);
    document.getElementById('wfNet').textContent='$'+net.toFixed(2);
  }else box.style.display='none';
}

function submitWithdraw(){
  if(!currentUser){showToast('Please log in first','red');return;}
  const amt=parseFloat(document.getElementById('withdrawAmt').value);
  const account=document.getElementById('withdrawAccount').value.trim();
  if(!amt||amt<50){showToast('Minimum withdrawal is $50','red');return;}
  if(!account){showToast('Please enter your account/phone number','red');return;}
  const bal=dashMode==='demo'?currentUser.demoBalance:currentUser.realBalance;
  if(amt>bal){showToast('Insufficient balance','red');return;}
  const activeMethod=document.querySelector('#wdMethodGrid .dep-method-btn.active');
  const method=activeMethod?activeMethod.getAttribute('data-method'):'mpesa';
  const btn=document.getElementById('withdrawBtn');btn.disabled=true;btn.textContent='Processingâ€¦';
  notifyAdminWithdraw(currentUser,amt,method,account);
  setTimeout(()=>{
    if(dashMode==='demo')currentUser.demoBalance=parseFloat((currentUser.demoBalance-amt).toFixed(2));
    else currentUser.realBalance=parseFloat((currentUser.realBalance-amt).toFixed(2));
    saveState();initDashboard();
    btn.disabled=false;btn.textContent='ðŸ’¸ Withdraw Now';
    addNotification('ðŸ’¸','Withdrawal $'+amt.toFixed(2)+' requested via '+method,'rgba(68,138,255,.2)');
    showToast('âœ… Withdrawal of $'+amt.toFixed(2)+' submitted! Processing in 5â€“30 minutes.','green',5000);
    showLayer('dashboardLayer');
  },2000);
}

// ============================================================
// BOTS
// ============================================================
const BOT_DATA=[
  {id:'scalper',name:'Scalper Pro',emoji:'âš¡',risk:'Low Risk',riskColor:'var(--green)',desc:'High-frequency scalping on BTC/ETH. Captures micro-movements every 2â€“5 minutes.',winRate:87,dailyReturn:3.2,totalProfit:24680,trades:1842,pairs:'BTC Â· ETH Â· SOL',bg:'var(--green3)',color:'var(--green)'},
  {id:'trend',name:'Trend Master',emoji:'ðŸ“ˆ',risk:'Medium Risk',riskColor:'var(--yellow)',desc:'Rides major market trends using EMA crossovers and MACD confirmation signals.',winRate:82,dailyReturn:2.8,totalProfit:18920,trades:643,pairs:'BTC Â· ETH Â· BNB Â· SOL',bg:'rgba(255,215,64,.1)',color:'var(--yellow)'},
  {id:'grid',name:'Grid Trader',emoji:'âŠž',risk:'Low Risk',riskColor:'var(--green)',desc:'Places buy and sell orders at regular intervals to profit from sideways markets.',winRate:79,dailyReturn:2.5,totalProfit:12340,trades:3280,pairs:'BTC Â· ETH Â· ADA Â· XRP',bg:'rgba(0,229,255,.1)',color:'var(--cyan)'},
  {id:'arbitrage',name:'Arbitrage AI',emoji:'ðŸ”„',risk:'Very Low',riskColor:'var(--cyan)',desc:'Exploits tiny price differences across exchanges for near risk-free profits.',winRate:91,dailyReturn:4.1,totalProfit:31250,trades:8920,pairs:'All Major Pairs',bg:'rgba(170,119,255,.1)',color:'var(--purple)'},
  {id:'dca',name:'DCA Bot',emoji:'ðŸ“Š',risk:'Low Risk',riskColor:'var(--green)',desc:'Dollar-cost averages into strong assets on every dip for long-term accumulation.',winRate:76,dailyReturn:1.8,totalProfit:9870,trades:284,pairs:'BTC Â· ETH',bg:'var(--green3)',color:'var(--green)'},
  {id:'swing',name:'Swing Hunter',emoji:'ðŸŽ¯',risk:'High Risk',riskColor:'var(--red)',desc:'Captures large price swings using RSI, Bollinger Bands and support/resistance.',winRate:68,dailyReturn:5.2,totalProfit:41200,trades:189,pairs:'BTC Â· SOL Â· AVAX Â· DOT',bg:'var(--red2)',color:'var(--red)'},
];

function buildBots(){
  const grid=document.getElementById('botsGrid');if(!grid)return;
  let activeCount=0;
  grid.innerHTML=BOT_DATA.map(b=>{
    const isActive=!!botsState[b.id];if(isActive)activeCount++;
    return '<div class="bot-card'+(isActive?' active-bot':'')+'"><div class="bc-top"><div class="bc-icon" style="background:'+b.bg+'">'+b.emoji+'</div><div><div class="bc-name">'+b.name+'</div><div class="bc-risk" style="color:'+b.riskColor+'">'+b.risk+'</div></div><div class="bc-status '+(isActive?'on':'off')+'">â— '+(isActive?'RUNNING':'STOPPED')+'</div></div><div class="bc-desc">'+b.desc+'</div><div class="bc-stats"><div class="bc-stat"><div class="bcs-val text-green">'+b.winRate+'%</div><div class="bcs-lbl">Win Rate</div></div><div class="bc-stat"><div class="bcs-val text-blue">+'+b.dailyReturn+'%</div><div class="bcs-lbl">Daily</div></div><div class="bc-stat"><div class="bcs-val text-yellow">$'+Math.floor(b.totalProfit/1000)+'K+</div><div class="bcs-lbl">Profit</div></div><div class="bc-stat"><div class="bcs-val">'+b.trades.toLocaleString()+'</div><div class="bcs-lbl">Trades</div></div></div><div class="bc-pairs">Pairs: '+b.pairs+'</div><button class="bc-toggle-btn '+(isActive?'stop':'start')+'" onclick="toggleBot(\''+b.id+'\')">'+(isActive?'â¹ Stop Bot':'â–¶ Start Bot')+'</button>'+(isActive?'<div class="bc-running"><div class="live-dot" style="margin-right:6px;"></div>Bot is actively tradingâ€¦</div>':'')+'</div>';
  }).join('');
  const cnt=document.getElementById('botsActiveCount');if(cnt)cnt.textContent=activeCount;
}

function toggleBot(id){
  if(!currentUser){showToast('Please log in to use bots','red');return;}
  const bot=BOT_DATA.find(b=>b.id===id);if(!bot)return;
  if(botsState[id]){
    delete botsState[id];saveState();buildBots();
    showToast('â¹ '+bot.name+' stopped.','blue',3000);
  }else{
    botsState[id]={startTime:Date.now()};saveState();buildBots();
    showToast('â–¶ '+bot.name+' is now running! It will trade automatically.','green',4000);
    addNotification('ðŸ¤–',bot.name+' started â€” '+bot.winRate+'% win rate','rgba(0,230,118,.2)');
    scheduleBotTrade(id,bot);
  }
}

function scheduleBotTrade(id,bot){
  if(!botsState[id])return;
  const interval=Math.floor(Math.random()*90000+30000);
  setTimeout(()=>{
    if(!botsState[id]||!currentUser)return;
    const isWin=Math.random()<(bot.winRate/100);
    const pct=isWin?(Math.random()*bot.dailyReturn*0.8+0.3):-(Math.random()*(bot.dailyReturn*0.4)+0.1);
    const balKey=dashMode==='demo'?'demoBalance':'realBalance';
    const base=currentUser[balKey];
    const gain=base*(pct/100);
    currentUser[balKey]=parseFloat((base+gain).toFixed(2));
    currentUser.profit=parseFloat(((currentUser.profit||0)+gain).toFixed(2));
    const pair=SIG_PAIRS[Math.floor(Math.random()*6)];
    currentUser.trades.push({pair:pair+'/USDT',side:Math.random()>0.5?'buy':'sell',amount:Math.abs(gain*10).toFixed(2),leverage:10,pnl:parseFloat(gain.toFixed(2)),closed:true,date:new Date().toLocaleDateString(),source:bot.name});
    saveState();
    addNotification(isWin?'ðŸ¤–âœ…':'ðŸ¤–âŒ',bot.name+': '+(isWin?'+':'')+gain.toFixed(2)+'$ on '+pair,isWin?'rgba(0,230,118,.2)':'rgba(255,61,87,.2)');
    if(currentLayer==='dashboardLayer')initDashboard();
    if(currentLayer==='tradingLayer')buildMyPositions();
    scheduleBotTrade(id,bot);
  },interval);
}

// ============================================================
// HISTORY
// ============================================================
function buildHistory(){
  if(!currentUser)return;
  const trades=currentUser.trades.filter(t=>t.closed);
  const totalPnl=trades.reduce((s,t)=>s+(t.pnl||0),0);
  const wins=trades.filter(t=>t.pnl>0);
  document.getElementById('histTotalPnl').textContent=(totalPnl>=0?'+':'')+totalPnl.toFixed(2)+'$';
  document.getElementById('histTotalPnl').className='bc-amount '+(totalPnl>=0?'text-green':'text-red');
  document.getElementById('histWinRate').textContent=trades.length?Math.round(wins.length/trades.length*100)+'%':'â€”';
  document.getElementById('histTotalTrades').textContent=trades.length;
  const tbody=document.getElementById('historyTbody');if(!tbody)return;
  if(!trades.length){tbody.innerHTML='<tr><td colspan="7" style="text-align:center;padding:24px;color:var(--text3);">No trades yet</td></tr>';return;}
  tbody.innerHTML=[...trades].reverse().map(t=>{
    const isWin=t.pnl>0;
    return '<tr class="hist-row"><td><span class="rt-type '+(isWin?'win':'loss')+'">'+(isWin?'WIN':'LOSS')+'</span></td><td style="font-weight:700;">'+t.pair+'</td><td><span style="padding:2px 7px;border-radius:4px;font-size:11px;font-weight:700;background:'+(t.side==='buy'?'var(--green3)':'var(--red2)')+';color:'+(t.side==='buy'?'var(--green)':'var(--red)')+';">'+(t.side==='buy'?'LONG':'SHORT')+'</span></td><td class="mono">$'+parseFloat(t.amount||0).toFixed(2)+'</td><td class="mono">'+(t.leverage||1)+'Ã—</td><td class="mono '+(isWin?'text-green':'text-red')+'">'+(isWin?'+':'')+t.pnl.toFixed(2)+'$</td><td style="color:var(--text3);font-size:11px;">'+t.date+'</td></tr>';
  }).join('');
}

// ============================================================
// REFERRAL
// ============================================================
function buildReferral(){
  if(!currentUser)return;
  const refLink='https://'+window.location.host+'?ref='+currentUser.refCode+'&name='+encodeURIComponent(currentUser.name.split(' ')[0]);
  document.getElementById('refLinkDisplay').textContent=refLink;
  document.getElementById('refTotalEarned').textContent='$'+(currentUser.referralEarnings||0).toFixed(2);
  document.getElementById('refTotalCount').textContent=(currentUser.referrals||[]).length;
  const list=document.getElementById('refHistoryList');
  const refs=currentUser.referrals||[];
  if(!refs.length){list.innerHTML='<div class="empty-state"><div style="font-size:40px;margin-bottom:8px;">ðŸ‘¥</div><div style="color:var(--text2);font-weight:600;">No referrals yet</div><div style="font-size:12px;color:var(--text3);margin-top:4px;">Share your link to start earning</div></div>';return;}
  list.innerHTML=refs.map(r=>'<div class="ref-hist-row"><div style="width:36px;height:36px;border-radius:50%;background:var(--green3);display:flex;align-items:center;justify-content:center;font-size:16px;">ðŸ‘¤</div><div style="flex:1;"><div style="font-weight:600;font-size:13px;">'+r.name+'</div><div style="font-size:11px;color:var(--text3);">Joined '+r.date+'</div></div><div class="text-green mono fw-bold">+$'+r.commission.toFixed(2)+'</div></div>').join('');
}

function copyRefLink(){
  if(!currentUser)return;
  const refLink='https://'+window.location.host+'?ref='+currentUser.refCode+'&name='+encodeURIComponent(currentUser.name.split(' ')[0]);
  navigator.clipboard.writeText(refLink).catch(()=>{});
  showToast('ðŸ“‹ Referral link copied!','green',2500);
}

function copySideRef(){copyRefLink();}

function shareRef(platform){
  if(!currentUser)return;
  const refLink='https://'+window.location.host+'?ref='+currentUser.refCode+'&name='+encodeURIComponent(currentUser.name.split(' ')[0]);
  const msg=encodeURIComponent('ðŸš€ Join CryptoPro & get $25 FREE!\nI\'m making daily profits with AI trading bots.\nSign up here: '+refLink);
  const urls={whatsapp:'https://wa.me/?text='+msg,telegram:'https://t.me/share/url?url='+encodeURIComponent(refLink)+'&text='+msg,twitter:'https://twitter.com/intent/tweet?text='+msg};
  window.open(urls[platform],'_blank');
}

// ============================================================
// PROFILE
// ============================================================
function buildProfile(){
  if(!currentUser)return;
  document.getElementById('profDisplayName').textContent=currentUser.name;
  document.getElementById('profJoined').textContent=currentUser.joinDate||'Today';
  document.getElementById('profName').value=currentUser.name||'';
  document.getElementById('profEmail').value=currentUser.email||'';
  document.getElementById('profPhone').value=currentUser.phone||'';
  document.getElementById('profRefCode').textContent=currentUser.refCode||'â€”';
}

function saveProfile(){
  if(!currentUser)return;
  currentUser.name=document.getElementById('profName').value||currentUser.name;
  currentUser.email=document.getElementById('profEmail').value||currentUser.email;
  currentUser.phone=document.getElementById('profPhone').value||currentUser.phone;
  saveState();initDashboard();
  showToast('âœ… Profile saved successfully!','green',3000);
}

// ============================================================
// SIGNALS
// ============================================================
function generateSignal(){
  const pair=SIG_PAIRS[Math.floor(Math.random()*SIG_PAIRS.length)];
  const dir=Math.random()>0.45?'buy':'sell';
  const price=PAIR_PRICES[pair]||1000;
  const conf=Math.floor(Math.random()*35+60);
  const tp=dir==='buy'?price*(1+Math.random()*0.06+0.01):price*(1-Math.random()*0.06-0.01);
  const sl=dir==='buy'?price*(1-Math.random()*0.03-0.005):price*(1+Math.random()*0.03+0.005);
  const rr=Math.abs(tp-price)/Math.abs(price-sl);
  const inds=SIG_INDICATORS.slice().sort(()=>Math.random()-0.5).slice(0,Math.floor(Math.random()*3+2));
  return{pair:pair+'/USDT',dir,price,tp,sl,conf,rr,inds,time:Date.now(),strong:conf>=80};
}

function buildSignalsLayer(){
  allSignals=Array.from({length:12},generateSignal);
  renderSignals();
  const buys=allSignals.filter(s=>s.dir==='buy').length;
  const sells=allSignals.length-buys;
  const avgConf=Math.round(allSignals.reduce((s,sig)=>s+sig.conf,0)/allSignals.length);
  const el1=document.getElementById('sigBuyCount'),el2=document.getElementById('sigSellCount'),el3=document.getElementById('sigWinRate');
  if(el1)el1.textContent=buys;if(el2)el2.textContent=sells;if(el3)el3.textContent=avgConf+'%';
}

function renderSignals(){
  const grid=document.getElementById('signalsGrid');if(!grid)return;
  const filtered=signalFilter==='all'?allSignals:signalFilter==='buy'?allSignals.filter(s=>s.dir==='buy'):signalFilter==='sell'?allSignals.filter(s=>s.dir==='sell'):allSignals.filter(s=>s.strong);
  grid.innerHTML=filtered.map(sig=>{
    const isUp=sig.dir==='buy';
    const tpPct=((sig.tp-sig.price)/sig.price*100).toFixed(2);
    const slPct=((sig.price-sig.sl)/sig.price*100).toFixed(2);
    const timeAgo=Math.floor((Date.now()-sig.time)/1000);const tStr=timeAgo<60?timeAgo+'s ago':Math.floor(timeAgo/60)+'m ago';
    return '<div class="signal-card '+(isUp?'buy-sig':'sell-sig')+'"><div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;"><span class="sig-direction '+(isUp?'buy':'sell')+'">'+(isUp?'â–² BUY':'â–¼ SELL')+'</span><div style="font-family:var(--font-mono);font-size:13px;font-weight:700;">'+sig.pair+'</div></div><div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:12px;"><div class="sig-stat"><div class="sig-stat-lbl">Entry</div><div class="sig-stat-val">'+fmtPriceShort(sig.price)+'</div></div><div class="sig-stat"><div class="sig-stat-lbl">Take Profit</div><div class="sig-stat-val text-green">'+(isUp?'+':'-')+Math.abs(tpPct)+'%</div></div><div class="sig-stat"><div class="sig-stat-lbl">Stop Loss</div><div class="sig-stat-val text-red">-'+Math.abs(slPct)+'%</div></div></div><div style="display:flex;align-items:center;gap:8px;margin-bottom:10px;"><span style="font-size:11px;color:var(--text3);">Confidence</span><div class="conf-bar"><div class="conf-fill" style="width:'+sig.conf+'%;background:'+(sig.conf>=80?'var(--green)':sig.conf>=65?'var(--yellow)':'var(--red)')+'"></div></div><span style="font-size:11px;font-weight:700;font-family:var(--font-mono);color:'+(sig.conf>=80?'var(--green)':sig.conf>=65?'var(--yellow)':'var(--red)')+'">'+sig.conf+'%</span></div><div style="display:flex;gap:4px;flex-wrap:wrap;margin-bottom:10px;">'+sig.inds.map(i=>'<span class="ind-tag '+(isUp?'ind-bull':'ind-bear')+'">'+i+'</span>').join('')+'</div><div style="display:flex;justify-content:space-between;font-size:11px;color:var(--text3);"><span>R:R = 1:'+sig.rr.toFixed(1)+'</span><span>'+tStr+'</span></div></div>';
  }).join('');
  if(!filtered.length)grid.innerHTML='<div class="empty-state" style="grid-column:1/-1;"><div style="font-size:40px;margin-bottom:8px;">ðŸ“¡</div><div style="color:var(--text2);font-weight:600;">No signals match filter</div></div>';
}

function filterSignals(filter,btn){
  signalFilter=filter;
  document.querySelectorAll('[onclick^="filterSignals"]').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');renderSignals();
}

function startSigCountdown(){
  clearInterval(sigRefreshInterval);sigCountdown=60;
  sigRefreshInterval=setInterval(()=>{
    sigCountdown--;
    const el=document.getElementById('sigRefreshTimer');if(el)el.textContent=sigCountdown;
    if(sigCountdown<=0){sigCountdown=60;allSignals=Array.from({length:12},generateSignal);renderSignals();}
  },1000);
}

// ============================================================
// ANALYSIS
// ============================================================
function buildAnalysisLayer(){
  buildFearGauge();buildDominanceChart();buildTrendSummary();buildHeatmap();buildNewsFeed();
}

function buildFearGauge(){
  const canvas=document.getElementById('fearGaugeCanvas');if(!canvas)return;
  const ctx=canvas.getContext('2d');
  const W=180,H=90;canvas.width=W*window.devicePixelRatio;canvas.height=H*window.devicePixelRatio;
  ctx.scale(window.devicePixelRatio,window.devicePixelRatio);
  const value=72;const angle=-Math.PI+(value/100)*Math.PI;
  const gradient=ctx.createLinearGradient(0,H,W,H);
  gradient.addColorStop(0,'#00E676');gradient.addColorStop(0.5,'#FFD740');gradient.addColorStop(1,'#FF3D57');
  ctx.beginPath();ctx.arc(W/2,H-10,W/2-10,-Math.PI,0);ctx.lineWidth=12;ctx.strokeStyle='var(--bg3)';ctx.stroke();
  ctx.beginPath();ctx.arc(W/2,H-10,W/2-10,-Math.PI,angle);ctx.lineWidth=12;ctx.strokeStyle=gradient;ctx.lineCap='round';ctx.stroke();
}

function buildDominanceChart(){
  const canvas=document.getElementById('dominanceCanvas');if(!canvas)return;
  const ctx=canvas.getContext('2d');
  const size=140*window.devicePixelRatio;canvas.width=size;canvas.height=size;
  ctx.scale(window.devicePixelRatio,window.devicePixelRatio);
  const W=70,H=70;
  const doms=[{name:'BTC',pct:54.2,color:'#F7931A'},{name:'ETH',pct:18.1,color:'#627EEA'},{name:'BNB',pct:4.2,color:'#F0B90B'},{name:'Others',pct:23.5,color:'#4A5568'}];
  let start=-Math.PI/2;
  doms.forEach(d=>{const slice=(d.pct/100)*Math.PI*2;ctx.beginPath();ctx.moveTo(W,H);ctx.arc(W,H,W-8,start,start+slice);ctx.closePath();ctx.fillStyle=d.color;ctx.fill();start+=slice;});
  ctx.beginPath();ctx.arc(W,H,W-28,0,Math.PI*2);ctx.fillStyle='var(--bg2)';ctx.fill();
  document.getElementById('btcDomValue').textContent='54.2%';
  const legend=document.getElementById('dominanceLegend');
  if(legend)legend.innerHTML=doms.map(d=>'<div style="display:flex;align-items:center;gap:6px;font-size:11px;"><div style="width:8px;height:8px;border-radius:50%;background:'+d.color+';flex-shrink:0;"></div><span style="color:var(--text2);flex:1;">'+d.name+'</span><span style="font-family:var(--font-mono);font-weight:700;">'+d.pct+'%</span></div>').join('');
}

function buildTrendSummary(){
  const el=document.getElementById('trendSummary');if(!el)return;
  const trends=[
    {name:'BTC/USDT',trend:'Bullish',strength:78,color:'var(--green)'},
    {name:'ETH/USDT',trend:'Bullish',strength:65,color:'var(--green)'},
    {name:'SOL/USDT',trend:'Strong Bull',strength:88,color:'var(--cyan)'},
    {name:'BNB/USDT',trend:'Neutral',strength:50,color:'var(--yellow)'},
    {name:'XRP/USDT',trend:'Bearish',strength:60,color:'var(--red)'},
  ];
  el.innerHTML=trends.map(t=>'<div style="display:flex;align-items:center;gap:8px;"><span style="font-size:12px;font-weight:700;width:80px;font-family:var(--font-display);">'+t.name.replace('/USDT','')+'</span><div style="flex:1;height:6px;background:var(--bg3);border-radius:3px;overflow:hidden;"><div style="height:100%;width:'+t.strength+'%;background:'+t.color+';border-radius:3px;transition:width .8s;"></div></div><span style="font-size:11px;font-weight:700;min-width:70px;color:'+t.color+';">'+t.trend+'</span></div>').join('');
}

function buildHeatmap(){
  const el=document.getElementById('marketHeatmap');if(!el)return;
  el.innerHTML=COINS.map(c=>{
    const chg=c.chg;const intensity=Math.min(Math.abs(chg)/8,1);
    const bg=chg>=0?'rgba(0,230,118,'+( 0.1+intensity*0.5)+')':'rgba(255,61,87,'+(0.1+intensity*0.5)+')';
    const color=chg>=0?'var(--green)':'var(--red)';const sign=chg>=0?'+':'';
    return '<div class="hm-cell" style="background:'+bg+'" onclick="showLayer(\'chartsLayer\')"><div class="hm-sym">'+c.sym.replace('/USDT','')+'</div><div class="hm-chg" style="color:'+color+'">'+sign+chg.toFixed(2)+'%</div></div>';
  }).join('');
}

const NEWS_DATA=[
  {headline:'Bitcoin surges past $100K resistance as institutional buying continues',time:'2 min ago',sentiment:'bullish',src:'CoinDesk'},
  {headline:'Ethereum upgrade boosts transaction throughput by 3x',time:'8 min ago',sentiment:'bullish',src:'CoinTelegraph'},
  {headline:'SEC approves new spot Ethereum ETF applications',time:'15 min ago',sentiment:'bullish',src:'Bloomberg'},
  {headline:'Federal Reserve signals potential rate cuts in Q1 2025',time:'22 min ago',sentiment:'bullish',src:'Reuters'},
  {headline:'Major exchange lists 5 new altcoins with trading pairs',time:'35 min ago',sentiment:'neutral',src:'Decrypt'},
  {headline:'Crypto market cap reaches $3.8 trillion all-time high',time:'1 hr ago',sentiment:'bullish',src:'CoinMarketCap'},
  {headline:'Solana DeFi TVL breaks $10 billion mark',time:'1 hr ago',sentiment:'bullish',src:'DeFiLlama'},
  {headline:'Bitcoin mining difficulty reaches new record high',time:'2 hr ago',sentiment:'neutral',src:'BTC.com'},
];

function buildNewsFeed(){
  const feed=document.getElementById('newsFeed');const cnt=document.getElementById('newsCount');
  if(!feed)return;
  if(cnt)cnt.textContent=NEWS_DATA.length+' headlines';
  feed.innerHTML=NEWS_DATA.map(n=>{
    const sentColor=n.sentiment==='bullish'?'var(--green)':n.sentiment==='bearish'?'var(--red)':'var(--yellow)';
    const sentEmoji=n.sentiment==='bullish'?'ðŸŸ¢':n.sentiment==='bearish'?'ðŸ”´':'ðŸŸ¡';
    return '<div class="news-item"><div style="font-size:18px;flex-shrink:0;">'+sentEmoji+'</div><div style="flex:1;"><div style="font-size:13px;font-weight:600;line-height:1.45;margin-bottom:4px;">'+n.headline+'</div><div style="display:flex;gap:12px;font-size:11px;color:var(--text3);"><span>'+n.src+'</span><span>'+n.time+'</span><span style="color:'+sentColor+';font-weight:700;text-transform:capitalize;">'+n.sentiment+'</span></div></div></div>';
  }).join('');
}

// ============================================================
// RECOMMENDATIONS
// ============================================================
function buildRecommendLayer(){
  if(!currentUser)return;
  const trades=currentUser.trades||[];const wins=trades.filter(t=>t.pnl>0);
  const winRate=trades.length?wins.length/trades.length:0;
  const bal=dashMode==='demo'?currentUser.demoBalance:currentUser.realBalance;
  const riskScore=Math.min(Math.floor(winRate*60+( bal/1000)*20+30),100);
  document.getElementById('riskFillBar').style.width=riskScore+'%';
  const badge=document.getElementById('riskProfileBadge');
  if(badge)badge.textContent=riskScore<40?'Conservative':riskScore<65?'Moderate':'Aggressive';
  const grid=document.getElementById('riskProfileGrid');
  if(grid)grid.innerHTML=[
    {label:'Win Rate',value:trades.length?Math.round(winRate*100)+'%':'â€”'},
    {label:'Total Trades',value:trades.length},
    {label:'Balance',value:'$'+bal.toFixed(0)},
    {label:'Risk Level',value:riskScore<40?'Low':riskScore<65?'Med':'High'}
  ].map(i=>'<div style="background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-lg);padding:14px;text-align:center;"><div style="font-size:10px;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px;">'+i.label+'</div><div style="font-family:var(--font-mono);font-size:18px;font-weight:700;">'+i.value+'</div></div>').join('');
  const recs=[
    {icon:'ðŸ’°',title:'Make Your First Deposit',sub:'Unlock real trading with as little as $10',priority:'high',action:'depositLayer'},
    {icon:'ðŸ“Š',title:'Try Demo Trading',sub:'Practice risk-free with your $25 demo balance',priority:'med',action:'tradingLayer'},
    {icon:'ðŸ¤–',title:'Activate an AI Bot',sub:'Let our bots trade 24/7 for you',priority:'med',action:'botsLayer'},
    {icon:'ðŸŽ',title:'Invite a Friend',sub:'Earn $5 + 10% lifetime commissions',priority:'low',action:'referralLayer'},
    {icon:'ðŸ“¡',title:'Check AI Signals',sub:'Get real-time buy/sell recommendations',priority:'low',action:'signalsLayer'},
  ];
  document.getElementById('actionRecs').innerHTML=recs.map(r=>'<div class="rec-action-card" onclick="showLayer(\''+r.action+'\')"><div class="rec-action-icon" style="background:var(--bg3);">'+r.icon+'</div><div style="flex:1;"><div style="font-weight:700;font-size:14px;margin-bottom:3px;">'+r.title+'</div><div style="font-size:12px;color:var(--text2);">'+r.sub+'</div></div><span class="rec-priority '+r.priority+'">'+(r.priority==='high'?'HIGH':r.priority==='med'?'MED':'LOW')+'</span></div>').join('');
  const sugBots=BOT_DATA.slice(0,3);
  document.getElementById('suggestedBots').innerHTML=sugBots.map(b=>'<div class="bot-suggest-row"><div style="font-size:24px;">'+b.emoji+'</div><div style="flex:1;"><div style="font-weight:700;font-size:13px;">'+b.name+'</div><div style="font-size:11px;color:var(--text2);">'+b.winRate+'% win rate Â· +'+b.dailyReturn+'% daily</div></div><button class="btn btn-green" style="font-size:12px;padding:6px 14px;" onclick="showLayer(\'botsLayer\')">Start â†’</button></div>').join('');
  const steps=[
    {num:'1',title:'Explore Live Charts',desc:'Study real Binance price data',done:true},
    {num:'2',title:'Practice in Demo',desc:'Trade with your $25 demo balance',done:trades.length>0},
    {num:'3',title:'Complete KYC',desc:'Verify identity for higher limits',done:false},
    {num:'4',title:'Make First Deposit',desc:'Fund your account to go live',done:currentUser.deposits>0},
    {num:'5',title:'Activate AI Bot',desc:'Set-and-forget automation',done:Object.keys(botsState).length>0},
    {num:'6',title:'Share Referral Link',desc:'Earn passive commission income',done:(currentUser.referrals||[]).length>0},
  ];
  const complete=steps.filter(s=>s.done).length;
  document.getElementById('learnProgress').textContent=Math.round((complete/steps.length)*100)+'% complete';
  document.getElementById('learningPath').innerHTML=steps.map(s=>'<div class="learn-step"><div class="learn-step-num" style="background:'+(s.done?'var(--green3)':'var(--bg3)')+';color:'+(s.done?'var(--green)':'var(--text3)')+';">'+(s.done?'âœ“':s.num)+'</div><div style="flex:1;"><div style="font-weight:700;font-size:13px;color:'+(s.done?'var(--text1)':'var(--text2)')+';">'+s.title+'</div><div style="font-size:11px;color:var(--text3);">'+s.desc+'</div></div>'+(s.done?'<span style="color:var(--green);font-size:11px;font-weight:700;">âœ… Done</span>':'<span style="color:var(--text3);font-size:11px;">â†’</span>')+'</div>').join('');
}

// ============================================================
// INIT
// ============================================================
window.addEventListener('DOMContentLoaded',()=>{
  initDynamicTraderPool();
  fetchAllTickers().then(()=>{buildTickers();});
  startAllTickerStream();
  startLiveTradersRefresh();
  buildReviews();
  checkReferral();
  loadState();
  setInterval(rotateLiveMsg,5000);rotateLiveMsg();
  setInterval(()=>{
    if(currentUser){
      buildOpenPositions();buildMyPositions();
      const cnt=document.getElementById('notifCount');if(cnt&&notifications.length>0)cnt.textContent=Math.min(notifications.length,9);
    }
  },8000);
  console.log('%cðŸš€ CryptoPro v2.0 â€” Platform Loaded','color:#00E676;font-size:16px;font-weight:bold;');
});
</script>
</body>
</html>
