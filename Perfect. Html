<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CryptoPro — Professional Trading Platform</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=IBM+Plex+Mono:wght@400;500;600;700&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg0:#06080D;--bg1:#0C0F18;--bg2:#131825;--bg3:#1A2030;--bg4:#202840;
  --border:rgba(255,255,255,0.06);--border2:rgba(255,255,255,0.12);
  --green:#00E676;--green2:#00C853;--green3:rgba(0,230,118,0.08);
  --red:#FF3D57;--red2:rgba(255,61,87,0.08);
  --blue:#448AFF;--yellow:#FFD740;--purple:#AA77FF;--cyan:#00E5FF;
  --text1:#EDF2F7;--text2:#8892A4;--text3:#4A5568;
  --font-display:'Syne',sans-serif;--font-body:'DM Sans',sans-serif;
  --font-mono:'IBM Plex Mono',monospace;
  --r-sm:6px;--r-md:10px;--r-lg:16px;--r-xl:24px;
}
body{font-family:var(--font-body);background:var(--bg0);color:var(--text1);min-height:100vh;overflow-x:hidden;-webkit-font-smoothing:antialiased}
::-webkit-scrollbar{width:6px}
::-webkit-scrollbar-track{background:var(--bg1)}
::-webkit-scrollbar-thumb{background:var(--bg4);border-radius:3px}
.layer{display:none;min-height:100vh;animation:layerFade .35s ease}
.layer.active{display:block}
@keyframes layerFade{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
@keyframes tickerMove{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}
@keyframes glow{0%,100%{box-shadow:0 0 8px rgba(0,230,118,.3)}50%{box-shadow:0 0 24px rgba(0,230,118,.7),0 0 48px rgba(0,230,118,.2)}}
@keyframes slideDown{from{opacity:0;transform:translateY(-12px)}to{opacity:1;transform:translateY(0)}}
@keyframes countUp{from{opacity:0;transform:scale(.85)}to{opacity:1;transform:scale(1)}}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes tradeFlash{from{background:rgba(255,255,255,.06)}to{background:transparent}}

/* ── NAVBAR ── */
.navbar{height:56px;background:rgba(12,15,24,0.95);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);display:flex;align-items:center;padding:0 24px;gap:16px;position:sticky;top:0;z-index:1000}
.nav-logo{display:flex;align-items:center;gap:9px;cursor:pointer;text-decoration:none;flex-shrink:0}
.nav-logo-mark{width:30px;height:30px;background:linear-gradient(135deg,var(--green),var(--green2));border-radius:7px;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:900;color:#000;font-family:var(--font-mono);animation:glow 4s ease-in-out infinite}
.nav-logo-text{font-family:var(--font-display);font-size:17px;font-weight:800;color:var(--text1);letter-spacing:-.3px}
.nav-logo-text span{color:var(--green)}
.nav-ticker{flex:1;overflow:hidden;mask-image:linear-gradient(to right,transparent,black 5%,black 95%,transparent)}
.nav-ticker-track{display:flex;gap:32px;animation:tickerMove 55s linear infinite;white-space:nowrap}
.nt-item{display:flex;align-items:center;gap:7px;font-family:var(--font-mono);font-size:11.5px}
.nt-sym{color:var(--text2);font-weight:600}
.nt-price{color:var(--text1);font-weight:600}
.nt-chg{font-size:10.5px;padding:2px 6px;border-radius:4px;font-weight:700}
.nt-up{color:var(--green);background:var(--green3)}
.nt-dn{color:var(--red);background:var(--red2)}
.nav-right{display:flex;align-items:center;gap:8px;flex-shrink:0}
.live-badge{display:flex;align-items:center;gap:5px;padding:4px 10px;background:var(--green3);border:1px solid rgba(0,230,118,.2);border-radius:20px;font-size:11px;font-weight:700;color:var(--green);font-family:var(--font-mono)}
.live-dot{width:5px;height:5px;background:var(--green);border-radius:50%;animation:pulse 1.5s ease-in-out infinite}
.btn{padding:8px 18px;border:none;border-radius:var(--r-md);font-size:13px;font-weight:600;cursor:pointer;transition:all .2s;font-family:var(--font-body);letter-spacing:.1px}
.btn-outline{background:transparent;color:var(--text2);border:1px solid var(--border2)}
.btn-outline:hover{color:var(--text1);border-color:rgba(255,255,255,.25)}
.btn-green{background:var(--green);color:#000;font-weight:700}
.btn-green:hover{background:var(--green2);transform:translateY(-1px);box-shadow:0 4px 16px rgba(0,230,118,.3)}

/* ── MARKET BAR ── */
.market-bar{background:var(--bg1);border-bottom:1px solid var(--border);padding:6px 0;overflow:hidden;mask-image:linear-gradient(to right,transparent,black 3%,black 97%,transparent)}
.market-bar-track{display:flex;gap:28px;animation:tickerMove 45s linear infinite;white-space:nowrap;padding:0 16px}
.mb-item{display:flex;align-items:center;gap:6px;font-size:11.5px;font-family:var(--font-mono)}
.mb-sym{color:var(--text2);font-weight:600}
.mb-price{color:var(--text1)}
.mb-chg{font-size:11px;padding:1px 5px;border-radius:3px}

/* ── TOAST ── */
#toast{position:fixed;top:70px;right:20px;max-width:360px;background:var(--bg2);border:1px solid var(--border2);border-radius:var(--r-lg);padding:16px 20px;box-shadow:0 16px 48px rgba(0,0,0,.6);z-index:9999;display:none;animation:slideDown .3s ease;font-size:13.5px;line-height:1.6;white-space:pre-line}
#toast.show{display:block}
#toast.toast-green{border-left:3px solid var(--green)}
#toast.toast-red{border-left:3px solid var(--red)}
#toast.toast-blue{border-left:3px solid var(--blue)}

/* ── REFERRAL BANNER ── */
#refBanner{display:none;position:fixed;top:0;left:0;right:0;background:linear-gradient(90deg,#003d1f,#006633,#003d1f);border-bottom:1px solid rgba(0,230,118,.3);padding:18px 24px;z-index:9998;text-align:center;animation:slideDown .4s ease}
#refBanner.show{display:block}
.ref-close{position:absolute;top:50%;right:20px;transform:translateY(-50%);background:rgba(255,255,255,.1);border:none;color:#fff;width:28px;height:28px;border-radius:50%;cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center}
.ref-bonus-amt{font-size:32px;font-weight:900;color:var(--yellow);font-family:var(--font-mono);display:block;line-height:1}

/* ── WELCOME / HERO ── */
#welcomeLayer{background:var(--bg0)}
.hero{position:relative;padding:80px 40px 60px;text-align:center;overflow:hidden}
.hero::before{content:'';position:absolute;top:-200px;left:50%;transform:translateX(-50%);width:900px;height:900px;background:radial-gradient(ellipse,rgba(0,230,118,.06) 0%,transparent 70%);pointer-events:none}
.hero-grid{position:absolute;inset:0;background-image:linear-gradient(var(--border) 1px,transparent 1px),linear-gradient(90deg,var(--border) 1px,transparent 1px);background-size:40px 40px;mask-image:radial-gradient(ellipse 80% 60% at 50% 0%,black,transparent);opacity:.4}
.hero-tag{display:inline-flex;align-items:center;gap:6px;background:var(--green3);border:1px solid rgba(0,230,118,.2);border-radius:20px;padding:6px 14px;font-size:12px;font-weight:600;color:var(--green);font-family:var(--font-mono);margin-bottom:24px;animation:countUp .5s ease .1s both}
.hero-title{font-family:var(--font-display);font-size:clamp(36px,6vw,68px);font-weight:800;line-height:1.05;letter-spacing:-1.5px;margin-bottom:20px;animation:countUp .5s ease .2s both}
.hero-title .accent{color:var(--green)}
.hero-title .dim{color:var(--text2)}
.hero-sub{font-size:17px;color:var(--text2);max-width:560px;margin:0 auto 36px;line-height:1.65;font-weight:400;animation:countUp .5s ease .3s both}
.hero-cta{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;animation:countUp .5s ease .4s both}
.btn-hero-primary{padding:14px 32px;background:var(--green);color:#000;border:none;border-radius:var(--r-md);font-size:15px;font-weight:700;cursor:pointer;transition:all .25s;font-family:var(--font-display)}
.btn-hero-primary:hover{background:var(--green2);transform:translateY(-2px);box-shadow:0 8px 28px rgba(0,230,118,.35)}
.btn-hero-secondary{padding:14px 32px;background:transparent;color:var(--text1);border:1px solid var(--border2);border-radius:var(--r-md);font-size:15px;font-weight:600;cursor:pointer;transition:all .25s;font-family:var(--font-body)}
.btn-hero-secondary:hover{border-color:rgba(255,255,255,.3);background:var(--bg2)}
.stats-bar{display:flex;justify-content:center;border-top:1px solid var(--border);border-bottom:1px solid var(--border);background:var(--bg1);animation:countUp .5s ease .5s both}
.stat-item{flex:1;max-width:220px;padding:24px 20px;text-align:center;border-right:1px solid var(--border);transition:background .2s}
.stat-item:last-child{border-right:none}
.stat-item:hover{background:var(--bg2)}
.stat-val{font-family:var(--font-mono);font-size:26px;font-weight:700;color:var(--green);display:block;margin-bottom:4px}
.stat-lbl{font-size:12px;color:var(--text3);text-transform:uppercase;letter-spacing:.8px}
.traders-section{padding:32px 24px;border-bottom:1px solid var(--border)}
.section-header{display:flex;align-items:center;gap:10px;margin-bottom:16px}
.section-title{font-family:var(--font-display);font-size:14px;font-weight:700;color:var(--text2);text-transform:uppercase;letter-spacing:1px}
.section-badge{font-size:10px;padding:2px 8px;background:var(--red2);color:var(--red);border-radius:10px;font-weight:700;font-family:var(--font-mono);animation:pulse 2s infinite}
.traders-track-wrap{overflow:hidden;mask-image:linear-gradient(to right,transparent,black 4%,black 96%,transparent)}
.traders-track{display:flex;gap:12px;animation:tickerMove 80s linear infinite;white-space:nowrap}
.trader-chip{display:inline-flex;align-items:center;gap:10px;background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-md);padding:10px 16px;min-width:200px;transition:border-color .2s}
.trader-chip:hover{border-color:var(--border2)}
.trader-avatar{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,var(--green),var(--blue));display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0}
.trader-name{font-size:13px;font-weight:600;color:var(--text1)}
.trader-profit{font-size:13px;font-weight:700;color:var(--green);font-family:var(--font-mono)}
.trader-time{font-size:10px;color:var(--text3)}
.winners-section{padding:40px 24px;border-bottom:1px solid var(--border)}
.winners-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px;margin-top:20px}
.winner-card{background:var(--bg1);border:1px solid var(--border);border-radius:var(--r-xl);padding:20px;transition:all .25s;position:relative;overflow:hidden}
.winner-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--green),var(--cyan));opacity:0;transition:opacity .25s}
.winner-card:hover{border-color:var(--border2);transform:translateY(-3px);box-shadow:0 12px 36px rgba(0,0,0,.4)}
.winner-card:hover::before{opacity:1}
.winner-rank{position:absolute;top:14px;right:14px;width:28px;height:28px;background:var(--bg3);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:800;font-family:var(--font-mono);color:var(--yellow)}
.winner-head{display:flex;align-items:center;gap:12px;margin-bottom:16px}
.winner-ava{width:48px;height:48px;border-radius:50%;background:linear-gradient(135deg,var(--green3),rgba(0,229,255,.1));border:1px solid var(--border2);display:flex;align-items:center;justify-content:center;font-size:22px}
.winner-name{font-weight:700;font-size:15px}
.winner-loc{font-size:12px;color:var(--text2);margin-top:2px}
.winner-stats{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.winner-stat{background:var(--bg2);border-radius:var(--r-md);padding:10px 12px;text-align:center}
.ws-val{font-family:var(--font-mono);font-size:17px;font-weight:700;color:var(--green)}
.ws-lbl{font-size:10px;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;margin-top:2px}
.features-section{padding:48px 24px;border-bottom:1px solid var(--border)}
.features-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:16px;margin-top:24px}
.feature-card{background:var(--bg1);border:1px solid var(--border);border-radius:var(--r-xl);padding:24px;transition:all .25s;cursor:pointer}
.feature-card:hover{border-color:var(--border2);background:var(--bg2)}
.feature-icon{width:44px;height:44px;border-radius:var(--r-md);display:flex;align-items:center;justify-content:center;font-size:20px;margin-bottom:16px}
.fi-green{background:var(--green3)}.fi-blue{background:rgba(68,138,255,.1)}.fi-yellow{background:rgba(255,215,64,.1)}.fi-purple{background:rgba(170,119,255,.1)}.fi-red{background:var(--red2)}.fi-cyan{background:rgba(0,229,255,.1)}
.feature-title{font-weight:700;font-size:15px;margin-bottom:6px;font-family:var(--font-display)}
.feature-desc{font-size:13px;color:var(--text2);line-height:1.55}
.reviews-section{padding:48px 24px}
.reviews-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px;margin-top:24px}
.review-card{background:var(--bg1);border:1px solid var(--border);border-radius:var(--r-xl);padding:20px;transition:all .2s}
.review-card:hover{border-color:var(--border2)}
.review-head{display:flex;align-items:center;gap:12px;margin-bottom:12px}
.review-ava{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,var(--bg3),var(--bg4));display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0}
.review-name{font-weight:600;font-size:14px}
.review-loc{font-size:11px;color:var(--text3)}
.review-stars{color:var(--yellow);font-size:12px;letter-spacing:1px;margin-top:3px}
.review-body{font-size:13px;color:var(--text2);line-height:1.6;font-style:italic}
.review-badge{display:inline-flex;align-items:center;gap:4px;margin-top:10px;padding:3px 8px;background:var(--green3);border-radius:4px;font-size:10px;font-weight:700;color:var(--green);font-family:var(--font-mono)}
.cta-section{padding:64px 24px;text-align:center;border-top:1px solid var(--border);background:radial-gradient(ellipse 60% 80% at 50% 100%,rgba(0,230,118,.04),transparent)}
.cta-title{font-family:var(--font-display);font-size:clamp(28px,4vw,44px);font-weight:800;letter-spacing:-.8px;margin-bottom:16px}
.cta-sub{font-size:16px;color:var(--text2);max-width:440px;margin:0 auto 32px;line-height:1.6}
.footer{background:var(--bg1);border-top:1px solid var(--border);padding:24px;text-align:center;font-size:12px;color:var(--text3)}

/* ── AI WIDGET ── */
#aiBtn{position:fixed;bottom:24px;right:24px;z-index:1000;width:54px;height:54px;background:linear-gradient(135deg,var(--blue),#2962FF);border:none;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:22px;box-shadow:0 6px 24px rgba(68,138,255,.45);transition:all .25s}
#aiBtn:hover{transform:scale(1.1);box-shadow:0 10px 32px rgba(68,138,255,.6)}
#aiBtn .ai-pulse{position:absolute;inset:-4px;border:2px solid rgba(68,138,255,.4);border-radius:50%;animation:pulse 2s ease-in-out infinite}
#aiPanel{position:fixed;bottom:90px;right:24px;width:340px;max-height:520px;background:var(--bg2);border:1px solid var(--border2);border-radius:var(--r-xl);box-shadow:0 24px 64px rgba(0,0,0,.7);z-index:999;display:none;flex-direction:column;overflow:hidden;animation:slideDown .3s ease}
#aiPanel.open{display:flex}
.ai-header{padding:14px 16px;background:var(--bg3);border-bottom:1px solid var(--border);display:flex;align-items:center;gap:10px}
.ai-header-icon{width:32px;height:32px;background:linear-gradient(135deg,var(--blue),#2962FF);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:16px}
.ai-header-title{font-weight:700;font-size:14px;font-family:var(--font-display)}
.ai-header-status{font-size:11px;color:var(--green)}
.ai-close{margin-left:auto;background:none;border:none;color:var(--text2);cursor:pointer;font-size:18px;transition:color .2s}
.ai-close:hover{color:var(--text1)}
.ai-messages{flex:1;overflow-y:auto;padding:14px;display:flex;flex-direction:column;gap:10px}
.ai-msg{max-width:88%;padding:10px 13px;border-radius:12px;font-size:13px;line-height:1.55;animation:countUp .2s ease}
.ai-msg.bot{background:var(--bg3);border:1px solid var(--border);border-radius:12px 12px 12px 2px;color:var(--text1);align-self:flex-start}
.ai-msg.user{background:linear-gradient(135deg,rgba(68,138,255,.25),rgba(41,98,255,.15));border:1px solid rgba(68,138,255,.25);border-radius:12px 12px 2px 12px;color:var(--text1);align-self:flex-end}
.ai-typing-dots{display:flex;gap:4px;padding:4px 0}
.ai-typing-dots span{width:6px;height:6px;background:var(--text3);border-radius:50%;animation:pulse 1.2s ease-in-out infinite}
.ai-typing-dots span:nth-child(2){animation-delay:.2s}
.ai-typing-dots span:nth-child(3){animation-delay:.4s}
.ai-quick-btns{padding:8px 14px;display:flex;gap:6px;flex-wrap:wrap;border-top:1px solid var(--border)}
.ai-quick{padding:5px 10px;background:var(--bg3);border:1px solid var(--border);border-radius:20px;font-size:11px;color:var(--text2);cursor:pointer;transition:all .2s;font-family:var(--font-body)}
.ai-quick:hover{border-color:var(--blue);color:var(--blue)}
.ai-input-row{padding:12px 14px;border-top:1px solid var(--border);display:flex;gap:8px}
.ai-input{flex:1;background:var(--bg3);border:1px solid var(--border);border-radius:8px;padding:9px 12px;color:var(--text1);font-size:13px;font-family:var(--font-body);outline:none;transition:border-color .2s}
.ai-input:focus{border-color:rgba(68,138,255,.5)}
.ai-input::placeholder{color:var(--text3)}
.ai-send{width:36px;height:36px;background:var(--blue);border:none;border-radius:8px;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:15px;transition:all .2s;flex-shrink:0}
.ai-send:hover{background:#2962FF;transform:scale(1.05)}

/* ── AUTH ── */
.auth-page{display:grid;grid-template-columns:1fr 1fr;min-height:100vh}
.auth-left{background:linear-gradient(160deg,var(--bg1) 0%,var(--bg2) 100%);border-right:1px solid var(--border);display:flex;align-items:center;justify-content:center;padding:48px;position:relative;overflow:hidden}
.auth-left::before{content:'';position:absolute;bottom:-160px;right:-160px;width:500px;height:500px;background:radial-gradient(circle,rgba(0,230,118,.06),transparent 65%);pointer-events:none}
.auth-left::after{content:'';position:absolute;inset:0;background-image:linear-gradient(var(--border) 1px,transparent 1px),linear-gradient(90deg,var(--border) 1px,transparent 1px);background-size:36px 36px;opacity:.35}
.auth-left-inner{position:relative;z-index:1;max-width:380px;width:100%}
.auth-big-title{font-family:var(--font-display);font-size:54px;font-weight:800;letter-spacing:-1.5px;line-height:1.05;margin-bottom:16px}
.auth-big-sub{font-size:15px;color:var(--text2);line-height:1.65;margin-bottom:32px}
.auth-trust-list{display:flex;flex-direction:column;gap:10px;margin-bottom:28px}
.auth-trust-item{display:flex;align-items:center;gap:10px;font-size:13px;color:var(--text2)}
.auth-trust-icon{font-size:16px}
.auth-live-card{background:var(--bg3);border:1px solid var(--border2);border-radius:var(--r-lg);padding:14px 16px}
.auth-live-row{display:flex;align-items:center;justify-content:space-between}
.signup-bonus-card{background:linear-gradient(135deg,rgba(0,230,118,.15),rgba(0,200,83,.06));border:1px solid rgba(0,230,118,.25);border-radius:var(--r-xl);padding:20px;margin-bottom:28px}
.sbc-top{display:flex;align-items:center;gap:14px}
.auth-steps{display:flex;flex-direction:column;gap:12px}
.auth-step{display:flex;align-items:center;gap:12px;font-size:13px;color:var(--text2)}
.step-num{width:24px;height:24px;border-radius:50%;background:var(--green3);border:1px solid rgba(0,230,118,.3);display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:var(--green);font-family:var(--font-mono);flex-shrink:0}
.auth-right{display:flex;align-items:center;justify-content:center;padding:40px 32px;background:var(--bg0);overflow-y:auto}
.auth-card{width:100%;max-width:420px;animation:layerFade .4s ease}
.auth-card-header{margin-bottom:28px}
.auth-form-title{font-family:var(--font-display);font-size:28px;font-weight:800;letter-spacing:-.5px;margin-bottom:6px}
.auth-form-sub{font-size:13px;color:var(--text2)}
.form-group{margin-bottom:18px}
.form-label{display:flex;justify-content:space-between;align-items:center;font-size:12px;font-weight:600;color:var(--text2);text-transform:uppercase;letter-spacing:.6px;margin-bottom:7px}
.form-label-link{color:var(--green);font-weight:600;cursor:pointer;text-transform:none;letter-spacing:0;font-size:12px}
.input-wrap{position:relative;display:flex;align-items:center}
.input-icon{position:absolute;left:13px;font-size:15px;pointer-events:none;z-index:1}
.form-input{width:100%;padding:12px 14px 12px 40px;background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-md);color:var(--text1);font-size:14px;font-family:var(--font-body);transition:all .2s}
.form-input:focus{outline:none;border-color:rgba(0,230,118,.5);box-shadow:0 0 0 3px rgba(0,230,118,.08)}
.form-input::placeholder{color:var(--text3)}
.form-input.error{border-color:var(--red)}
.input-eye{position:absolute;right:12px;background:none;border:none;cursor:pointer;font-size:14px;color:var(--text3);padding:4px;transition:color .2s}
.input-eye:hover{color:var(--text2)}
.btn-auth{width:100%;padding:13px;background:var(--green);color:#000;border:none;border-radius:var(--r-md);font-size:15px;font-weight:700;cursor:pointer;transition:all .2s;font-family:var(--font-display);display:flex;align-items:center;justify-content:center;gap:8px}
.btn-auth:hover{background:var(--green2);transform:translateY(-1px);box-shadow:0 6px 20px rgba(0,230,118,.3)}
.btn-auth-outline{padding:13px 20px;background:transparent;color:var(--text2);border:1px solid var(--border2);border-radius:var(--r-md);font-size:14px;font-weight:600;cursor:pointer;transition:all .2s;font-family:var(--font-body)}
.btn-auth-outline:hover{color:var(--text1)}
.btn-spinner{display:inline-block;animation:spin 1s linear infinite;font-size:16px}
.form-alert{padding:11px 14px;border-radius:var(--r-md);font-size:13px;margin-bottom:16px;border-left:3px solid}
.form-alert.error{background:var(--red2);border-color:var(--red);color:var(--red)}
.form-alert.success{background:var(--green3);border-color:var(--green);color:var(--green)}
.auth-divider{display:flex;align-items:center;gap:12px;margin:20px 0;color:var(--text3);font-size:12px}
.auth-divider::before,.auth-divider::after{content:'';flex:1;height:1px;background:var(--border)}
.social-row{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:20px}
.social-btn{padding:10px;background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-md);color:var(--text1);font-size:13px;font-weight:500;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:7px;transition:all .2s;font-family:var(--font-body)}
.social-btn:hover{border-color:var(--border2);background:var(--bg3)}
.auth-switch-text{text-align:center;font-size:13px;color:var(--text2);margin-top:16px}
.auth-switch-text a{color:var(--green);cursor:pointer;font-weight:600}
.signup-progress{margin-bottom:24px}
.sp-bar{height:3px;background:var(--bg3);border-radius:2px;margin-bottom:8px;overflow:hidden}
.sp-fill{height:100%;background:linear-gradient(90deg,var(--green),var(--cyan));border-radius:2px;transition:width .4s ease}
.sp-steps{display:flex;justify-content:space-between}
.sp-step{font-size:11px;color:var(--text3);font-weight:600;text-transform:uppercase;letter-spacing:.5px;transition:color .3s}
.sp-step.active{color:var(--green)}
.pwd-strength{display:flex;align-items:center;gap:8px;margin-top:6px}
.pwd-bar{flex:1;height:3px;background:var(--bg3);border-radius:2px;overflow:hidden}
.pwd-fill{height:100%;border-radius:2px;transition:all .3s;width:0%}
.pwd-label{font-size:11px;font-weight:600;min-width:50px}
.twofa-box{background:var(--bg2);border:1px solid var(--border2);border-radius:var(--r-xl);padding:24px;text-align:center;margin-bottom:16px}
.otp-row{display:flex;gap:8px;justify-content:center;margin-bottom:8px}
.otp-input{width:42px;height:50px;background:var(--bg3);border:1px solid var(--border2);border-radius:var(--r-md);text-align:center;font-size:20px;font-weight:700;font-family:var(--font-mono);color:var(--text1);transition:all .2s}
.otp-input:focus{outline:none;border-color:var(--green);box-shadow:0 0 0 3px rgba(0,230,118,.12)}
.confirm-box{background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-xl);padding:20px;margin-bottom:16px}
.confirm-row{display:flex;justify-content:space-between;align-items:center;padding:9px 0;border-bottom:1px solid var(--border);font-size:13px}
.confirm-row:last-child{border-bottom:none}
.confirm-row span{color:var(--text2)}
.checkbox-row{display:flex;align-items:flex-start;gap:10px;font-size:12px;color:var(--text2);line-height:1.5;cursor:pointer}
.checkbox-row input{margin-top:2px;accent-color:var(--green)}

/* ── CHARTS ── */
.pair-bar{background:var(--bg1);border-bottom:1px solid var(--border);overflow-x:auto}
.pair-bar::-webkit-scrollbar{height:3px}
.pair-bar-inner{display:flex;gap:2px;padding:6px 16px;white-space:nowrap}
.pair-btn{padding:6px 14px;background:transparent;border:none;border-radius:var(--r-sm);color:var(--text2);font-size:12px;font-weight:600;cursor:pointer;transition:all .2s;font-family:var(--font-mono)}
.pair-btn:hover{color:var(--text1);background:var(--bg3)}
.pair-btn.active{color:var(--green);background:var(--green3)}
.price-header{display:flex;align-items:center;gap:24px;padding:12px 20px;background:var(--bg1);border-bottom:1px solid var(--border);flex-wrap:wrap}
.ph-left{display:flex;align-items:baseline;gap:12px}
.ph-pair{font-family:var(--font-display);font-size:16px;font-weight:800}
.ph-price{font-family:var(--font-mono);font-size:26px;font-weight:700}
.ph-change{font-family:var(--font-mono);font-size:14px;font-weight:700;padding:3px 10px;border-radius:var(--r-sm)}
.ph-change.up{color:var(--green);background:var(--green3)}
.ph-change.down{color:var(--red);background:var(--red2)}
.ph-stats{display:flex;gap:20px;flex:1}
.ph-stat{display:flex;flex-direction:column;gap:2px}
.ph-stat-lbl{font-size:10px;color:var(--text3);text-transform:uppercase;letter-spacing:.5px}
.ph-stat-val{font-family:var(--font-mono);font-size:13px;font-weight:600}
.ph-right{margin-left:auto}
.interval-btns{display:flex;gap:2px}
.iv-btn{padding:5px 10px;background:transparent;border:1px solid transparent;border-radius:var(--r-sm);color:var(--text3);font-size:11px;font-weight:700;cursor:pointer;transition:all .2s;font-family:var(--font-mono)}
.iv-btn:hover{color:var(--text1)}
.iv-btn.active{color:var(--green);border-color:rgba(0,230,118,.3);background:var(--green3)}
.chart-layout{display:grid;grid-template-columns:1fr 200px 180px;height:calc(100vh - 200px);min-height:500px;border-bottom:1px solid var(--border)}
.chart-main{display:flex;flex-direction:column;border-right:1px solid var(--border);min-width:0;overflow:hidden}
.indicator-bar{display:flex;align-items:center;gap:8px;padding:8px 12px;background:var(--bg1);border-bottom:1px solid var(--border);flex-wrap:wrap}
.ind-btn{padding:4px 10px;background:var(--bg3);border:1px solid var(--border);border-radius:4px;color:var(--text2);font-size:11px;font-weight:600;cursor:pointer;transition:all .2s;font-family:var(--font-mono)}
.ind-btn:hover{color:var(--text1)}
.ind-btn.active{color:var(--green);border-color:rgba(0,230,118,.3);background:var(--green3)}
.canvas-wrap{flex:1;position:relative;background:var(--bg0);min-height:0;overflow:hidden;cursor:crosshair}
.canvas-wrap canvas{position:absolute;inset:0;width:100%;height:100%}
.vol-canvas-wrap{height:70px;position:relative;background:var(--bg0);border-top:1px solid var(--border);overflow:hidden}
.vol-canvas-wrap canvas{position:absolute;inset:0;width:100%;height:100%}
.rsi-canvas-wrap{height:80px;position:relative;background:var(--bg0);border-top:1px solid var(--border);overflow:hidden}
.rsi-canvas-wrap canvas{position:absolute;inset:0;width:100%;height:100%}
.crosshair-tooltip{position:absolute;background:var(--bg3);border:1px solid var(--border2);border-radius:var(--r-md);padding:10px 13px;font-size:12px;font-family:var(--font-mono);pointer-events:none;z-index:10;box-shadow:0 4px 16px rgba(0,0,0,.5);min-width:160px;line-height:1.8}
.y-axis{position:absolute;right:0;top:0;bottom:0;width:64px;display:flex;flex-direction:column;justify-content:space-between;padding:4px;pointer-events:none}
.y-label{font-family:var(--font-mono);font-size:9.5px;color:var(--text3);text-align:right}
.x-axis{position:absolute;bottom:0;left:0;right:64px;height:18px;display:flex;justify-content:space-between;padding:0 4px;pointer-events:none}
.x-label{font-family:var(--font-mono);font-size:9px;color:var(--text3);align-self:center}
.depth-section{padding:12px 16px;background:var(--bg1);border-top:1px solid var(--border)}
.depth-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
.depth-wrap{height:100px;position:relative;background:var(--bg0);border-radius:var(--r-md);overflow:hidden;border:1px solid var(--border)}
.depth-wrap canvas{position:absolute;inset:0;width:100%;height:100%}
.orderbook-panel{display:flex;flex-direction:column;background:var(--bg1);overflow:hidden}
.ob-header{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--border);flex-shrink:0}
.ob-title{font-size:13px;font-weight:700;font-family:var(--font-display)}
.ob-tabs{display:flex;gap:4px}
.ob-tab{padding:3px 7px;background:var(--bg3);border:1px solid var(--border);border-radius:4px;font-size:11px;cursor:pointer;transition:all .2s}
.ob-tab.active{border-color:var(--border2);background:var(--bg4)}
.ob-labels{display:grid;grid-template-columns:1fr 1fr 1fr;padding:6px 10px;font-size:9.5px;color:var(--text3);font-weight:600;text-transform:uppercase;letter-spacing:.4px;flex-shrink:0}
.ob-labels span:last-child{text-align:right}
.ob-asks{flex:1;overflow-y:auto;display:flex;flex-direction:column-reverse}
.ob-bids{flex:1;overflow-y:auto}
.ob-asks::-webkit-scrollbar,.ob-bids::-webkit-scrollbar{width:3px}
.ob-row{display:grid;grid-template-columns:1fr 1fr 1fr;padding:2px 10px;font-size:11px;font-family:var(--font-mono);position:relative;cursor:pointer;transition:background .15s}
.ob-row:hover{background:rgba(255,255,255,.04)}
.ob-row .ob-price{font-weight:600}
.ob-row .ob-price.ask{color:var(--red)}
.ob-row .ob-price.bid{color:var(--green)}
.ob-row .ob-amt{color:var(--text2);text-align:center}
.ob-row .ob-total{color:var(--text3);text-align:right}
.ob-spread{display:flex;align-items:center;justify-content:space-between;padding:6px 10px;background:var(--bg2);border-top:1px solid var(--border);border-bottom:1px solid var(--border);flex-shrink:0}
.ob-spread-price{font-family:var(--font-mono);font-size:14px;font-weight:700;color:var(--green)}
.ob-spread-pct{font-family:var(--font-mono);font-size:10px;color:var(--text3)}
.trades-panel{display:flex;flex-direction:column;background:var(--bg1);border-left:1px solid var(--border);overflow:hidden}
.tp-header{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--border);flex-shrink:0}
.tp-labels{display:grid;grid-template-columns:1fr 1fr 1fr;padding:6px 10px;font-size:9.5px;color:var(--text3);font-weight:600;text-transform:uppercase;letter-spacing:.4px;flex-shrink:0}
.tp-labels span:last-child{text-align:right}
.tp-feed{flex:1;overflow-y:auto}
.tp-feed::-webkit-scrollbar{width:3px}
.tp-row{display:grid;grid-template-columns:1fr 1fr 1fr;padding:3px 10px;font-size:11px;font-family:var(--font-mono);animation:tradeFlash .3s ease}
.tp-row .tp-price{font-weight:600}
.tp-row .tp-price.buy{color:var(--green)}
.tp-row .tp-price.sell{color:var(--red)}
.tp-row .tp-amt{color:var(--text2);text-align:center}
.tp-row .tp-time{color:var(--text3);text-align:right}
.market-overview-section{padding:24px 20px}
.market-cards-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px}
.market-card{background:var(--bg1);border:1px solid var(--border);border-radius:var(--r-lg);padding:16px;cursor:pointer;transition:all .2s}
.market-card:hover{border-color:var(--border2);transform:translateY(-2px)}
.mc-sym{font-family:var(--font-display);font-size:14px;font-weight:700;margin-bottom:8px}
.mc-price{font-family:var(--font-mono);font-size:20px;font-weight:700}
.mc-chg{font-family:var(--font-mono);font-size:12px;font-weight:700;margin-top:4px}
.mc-mini{height:40px;position:relative;margin-top:10px}
.mc-mini canvas{position:absolute;inset:0;width:100%;height:100%}

/* ── DASHBOARD ── */
.dash-user-chip{display:flex;align-items:center;gap:7px;padding:5px 12px;background:var(--bg2);border:1px solid var(--border);border-radius:20px;font-size:13px;font-weight:600;cursor:pointer}
.duc-avatar{font-size:16px}
.dash-body{display:grid;grid-template-columns:220px 1fr;min-height:calc(100vh - 92px)}
.dash-sidebar{background:var(--bg1);border-right:1px solid var(--border);display:flex;flex-direction:column;overflow-y:auto}
.sidebar-balance{padding:20px 16px;border-bottom:1px solid var(--border)}
.sbl-label{font-size:10px;color:var(--text3);text-transform:uppercase;letter-spacing:.8px;font-weight:600;margin-bottom:4px}
.sbl-amount{font-family:var(--font-mono);font-size:24px;font-weight:700;color:var(--green);margin-bottom:2px}
.sbl-sub{font-size:11px;color:var(--text3);margin-bottom:12px}
.mode-toggle{display:flex;gap:4px;background:var(--bg0);border-radius:var(--r-md);padding:3px}
.mt-btn{flex:1;padding:6px 4px;border:none;border-radius:var(--r-sm);font-size:11px;font-weight:700;cursor:pointer;transition:all .2s;font-family:var(--font-mono);background:transparent;color:var(--text3)}
.mt-btn.active{background:var(--green);color:#000}
.sidebar-nav{flex:1;padding:12px 0}
.snav-section{padding:8px 16px 4px;font-size:10px;color:var(--text3);font-weight:700;text-transform:uppercase;letter-spacing:1px}
.snav-item{display:flex;align-items:center;gap:9px;padding:9px 16px;font-size:13px;color:var(--text2);cursor:pointer;transition:all .2s;border-left:2px solid transparent;position:relative}
.snav-item:hover{color:var(--text1);background:var(--bg2)}
.snav-item.active{color:var(--green);background:var(--green3);border-left-color:var(--green)}
.snav-icon{font-size:15px;width:20px;text-align:center}
.snav-badge{margin-left:auto;font-size:10px;padding:2px 6px;background:var(--green3);color:var(--green);border-radius:10px;font-weight:700;font-family:var(--font-mono)}
.sidebar-ref-card{margin:12px;padding:12px;background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-lg)}
.src-link{font-size:10px;color:var(--text3);font-family:var(--font-mono);word-break:break-all;margin-bottom:8px;line-height:1.4}
.src-copy{width:100%;padding:6px;background:var(--bg3);border:1px solid var(--border);border-radius:var(--r-sm);color:var(--text2);font-size:11px;cursor:pointer;transition:all .2s;font-family:var(--font-body)}
.src-copy:hover{color:var(--text1);border-color:var(--border2)}
.dash-content{padding:20px;overflow-y:auto;display:flex;flex-direction:column;gap:16px;background:var(--bg0)}
.balance-cards{display:grid;grid-template-columns:2fr 1fr 1fr 1fr;gap:12px}
.bal-card{background:var(--bg1);border:1px solid var(--border);border-radius:var(--r-xl);padding:20px;position:relative;overflow:hidden;transition:all .2s}
.bal-card:hover{border-color:var(--border2)}
.bal-card.primary{background:linear-gradient(135deg,rgba(0,230,118,.1),rgba(0,200,83,.04));border-color:rgba(0,230,118,.2)}
.bc-label{font-size:11px;color:var(--text3);text-transform:uppercase;letter-spacing:.6px;font-weight:600;margin-bottom:8px}
.bc-amount{font-family:var(--font-mono);font-size:26px;font-weight:700}
.bc-change{font-size:12px;font-weight:700;padding:2px 7px;border-radius:4px;display:inline-block;margin-top:4px;font-family:var(--font-mono)}
.bc-change.up{color:var(--green);background:var(--green3)}
.bc-change.down{color:var(--red);background:var(--red2)}
.bc-sparkline{position:absolute;bottom:0;right:0;width:80px;height:36px;opacity:.4}
.bc-sparkline canvas{position:absolute;inset:0;width:100%;height:100%}
.quick-actions{display:grid;grid-template-columns:repeat(6,1fr);gap:10px}
.qa-btn{display:flex;flex-direction:column;align-items:center;gap:6px;padding:16px 8px;border:1px solid var(--border);border-radius:var(--r-xl);background:var(--bg1);cursor:pointer;transition:all .25s;font-size:12px;font-weight:600;color:var(--text2);font-family:var(--font-body)}
.qa-btn:hover{transform:translateY(-3px);border-color:var(--border2);color:var(--text1);box-shadow:0 6px 20px rgba(0,0,0,.3)}
.qa-icon{font-size:22px}
.qa-trade{border-color:rgba(255,215,64,.2);background:rgba(255,215,64,.04)}.qa-trade:hover{border-color:var(--yellow);box-shadow:0 6px 20px rgba(255,215,64,.15)}
.qa-deposit{border-color:rgba(0,230,118,.2);background:var(--green3)}.qa-deposit:hover{border-color:var(--green);box-shadow:0 6px 20px rgba(0,230,118,.15)}
.qa-withdraw{border-color:rgba(68,138,255,.2);background:rgba(68,138,255,.05)}.qa-withdraw:hover{border-color:var(--blue);box-shadow:0 6px 20px rgba(68,138,255,.15)}
.qa-bots{border-color:rgba(170,119,255,.2);background:rgba(170,119,255,.05)}.qa-bots:hover{border-color:var(--purple);box-shadow:0 6px 20px rgba(170,119,255,.15)}
.qa-ref{border-color:rgba(0,229,255,.2);background:rgba(0,229,255,.04)}.qa-ref:hover{border-color:var(--cyan);box-shadow:0 6px 20px rgba(0,229,255,.15)}
.qa-charts{border-color:rgba(255,61,87,.2);background:var(--red2)}.qa-charts:hover{border-color:var(--red);box-shadow:0 6px 20px rgba(255,61,87,.15)}
.dash-card{background:var(--bg1);border:1px solid var(--border);border-radius:var(--r-xl);padding:18px}
.dc-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
.dc-title{font-family:var(--font-display);font-size:14px;font-weight:700}
.dc-badge{font-size:11px;padding:3px 9px;background:var(--bg3);border-radius:20px;color:var(--text2);font-family:var(--font-mono)}
.dc-link{font-size:12px;color:var(--green);cursor:pointer;font-weight:600}
.dc-tabs{display:flex;gap:4px}
.dc-tab{padding:4px 10px;background:transparent;border:1px solid var(--border);border-radius:var(--r-sm);font-size:11px;font-weight:700;cursor:pointer;color:var(--text3);font-family:var(--font-mono);transition:all .2s}
.dc-tab.active{color:var(--green);border-color:rgba(0,230,118,.3);background:var(--green3)}
.dash-two-col{display:grid;grid-template-columns:1.5fr 1fr;gap:16px}
.dash-three-col{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px}
.dc-chart-wrap{height:180px;position:relative;margin-bottom:12px}
.dc-chart-wrap canvas{position:absolute;inset:0;width:100%;height:100%}
.perf-footer{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;padding-top:12px;border-top:1px solid var(--border)}
.pf-item{text-align:center}
.pf-lbl{font-size:10px;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;display:block;margin-bottom:3px}
.pf-val{font-family:var(--font-mono);font-size:14px;font-weight:700}
.position-row{background:var(--bg2);border-radius:var(--r-lg);padding:12px 14px;margin-bottom:8px;border:1px solid var(--border);transition:all .2s}
.position-row:hover{border-color:var(--border2)}
.pr-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.pr-pair{font-weight:700;font-size:13px;font-family:var(--font-display)}
.pr-type{font-size:11px;font-weight:700;padding:2px 8px;border-radius:4px;font-family:var(--font-mono)}
.pr-type.long{color:var(--green);background:var(--green3)}
.pr-type.short{color:var(--red);background:var(--red2)}
.pr-pnl{font-family:var(--font-mono);font-size:15px;font-weight:700}
.pr-stats{display:grid;grid-template-columns:repeat(4,1fr);gap:6px}
.pr-stat{font-size:10px}
.pr-stat-lbl{color:var(--text3);display:block;margin-bottom:2px}
.pr-stat-val{color:var(--text1);font-family:var(--font-mono);font-weight:600;font-size:11px}
.pr-close-btn{width:100%;margin-top:8px;padding:6px;background:var(--red2);border:1px solid rgba(255,61,87,.3);border-radius:var(--r-sm);color:var(--red);font-size:11px;font-weight:700;cursor:pointer;transition:all .2s;font-family:var(--font-body)}
.pr-close-btn:hover{background:var(--red);color:#fff}
.alloc-chart-wrap{position:relative;width:140px;height:140px;margin:0 auto 12px}
.alloc-chart-wrap canvas{position:absolute;inset:0;width:100%;height:100%}
.alloc-center{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center}
.ac-amount{font-family:var(--font-mono);font-size:15px;font-weight:700}
.ac-label{font-size:10px;color:var(--text3)}
.alloc-legend{display:flex;flex-direction:column;gap:6px}
.al-row{display:flex;align-items:center;justify-content:space-between;font-size:12px}
.al-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.al-name{color:var(--text2);margin-left:6px;flex:1}
.al-pct{color:var(--text1);font-weight:600;font-family:var(--font-mono)}
.rt-row{display:grid;grid-template-columns:auto 1fr auto auto;gap:8px;align-items:center;padding:8px 0;border-bottom:1px solid var(--border);font-size:12px}
.rt-row:last-child{border-bottom:none}
.rt-type{padding:2px 7px;border-radius:4px;font-size:10px;font-weight:700;font-family:var(--font-mono)}
.rt-type.win{color:var(--green);background:var(--green3)}
.rt-type.loss{color:var(--red);background:var(--red2)}
.rt-pair{font-weight:600;color:var(--text1)}
.rt-pnl{font-family:var(--font-mono);font-weight:700}
.rt-date{font-size:10px;color:var(--text3)}
.msnap-list{display:flex;flex-direction:column;gap:6px}
.ms-row{display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--border);cursor:pointer;transition:all .15s}
.ms-row:last-child{border-bottom:none}
.ms-row:hover{padding-left:4px}
.ms-sym{font-weight:700;font-size:13px;font-family:var(--font-display)}
.ms-price{font-family:var(--font-mono);font-size:12px}
.ms-chg{font-family:var(--font-mono);font-size:11px;font-weight:700;padding:2px 6px;border-radius:4px}
.kyc-notice{display:flex;align-items:center;justify-content:space-between;padding:16px 20px;background:linear-gradient(135deg,rgba(255,215,64,.12),rgba(245,158,11,.06));border:1px solid rgba(255,215,64,.25);border-radius:var(--r-xl);flex-wrap:wrap;gap:12px}
.kyc-btn{padding:9px 20px;background:var(--yellow);color:#000;border:none;border-radius:var(--r-md);font-size:13px;font-weight:700;cursor:pointer;font-family:var(--font-display);transition:all .2s}
.kyc-btn:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(255,215,64,.3)}
.empty-state{text-align:center;padding:28px 16px}

/* ── TRADING LAYER ── */
.trade-price-strip{display:flex;align-items:center;gap:20px;padding:10px 20px;background:var(--bg1);border-bottom:1px solid var(--border);flex-wrap:wrap}
.tps-left{display:flex;align-items:baseline;gap:10px}
.tps-pair{font-family:var(--font-display);font-size:15px;font-weight:800}
.tps-price{font-family:var(--font-mono);font-size:24px;font-weight:700}
.tps-chg{font-size:12px;font-weight:700;padding:2px 8px;border-radius:var(--r-sm);font-family:var(--font-mono)}
.tps-stats{display:flex;gap:20px;flex:1}
.tps-stat{display:flex;flex-direction:column;gap:1px}
.tps-lbl{font-size:10px;color:var(--text3);text-transform:uppercase;letter-spacing:.5px}
.tps-val{font-family:var(--font-mono);font-size:12px;font-weight:600}
.tps-bal{display:flex;flex-direction:column;gap:1px;margin-left:auto;text-align:right}
.trading-body{display:grid;grid-template-columns:1fr 260px 220px;height:calc(100vh - 168px);min-height:480px}
.trade-chart-col{display:flex;flex-direction:column;border-right:1px solid var(--border);min-width:0;overflow:hidden}
.order-panel{background:var(--bg1);border-right:1px solid var(--border);overflow-y:auto;display:flex;flex-direction:column}
.order-panel::-webkit-scrollbar{width:3px}
.order-tabs{display:grid;grid-template-columns:1fr 1fr;border-bottom:1px solid var(--border)}
.ot-btn{padding:14px 8px;border:none;font-size:13px;font-weight:800;cursor:pointer;transition:all .2s;font-family:var(--font-mono);background:var(--bg2);color:var(--text3)}
.ot-btn.buy.active{background:var(--green3);color:var(--green);border-bottom:2px solid var(--green)}
.ot-btn.sell.active{background:var(--red2);color:var(--red);border-bottom:2px solid var(--red)}
.order-type-row{display:flex;gap:4px;padding:10px 12px;border-bottom:1px solid var(--border)}
.order-type-btn{flex:1;padding:5px 4px;background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-sm);color:var(--text3);font-size:11px;font-weight:600;cursor:pointer;transition:all .2s;font-family:var(--font-mono)}
.order-type-btn.active{color:var(--text1);border-color:var(--border2);background:var(--bg3)}
.op-group{padding:10px 12px;border-bottom:1px solid var(--border)}
.op-label{display:flex;justify-content:space-between;font-size:11px;color:var(--text3);font-weight:600;text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px}
.op-leverage-val{color:var(--yellow);font-family:var(--font-mono);font-size:13px;font-weight:800}
.op-input-wrap{display:flex;align-items:center;background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-md);overflow:hidden}
.op-input{flex:1;padding:9px 10px;background:transparent;border:none;color:var(--text1);font-size:14px;font-family:var(--font-mono);outline:none}
.op-input::placeholder{color:var(--text3)}
.op-input-suffix{padding:0 10px;font-size:11px;color:var(--text3);font-family:var(--font-mono);font-weight:600;border-left:1px solid var(--border)}
.op-input-wrap:focus-within{border-color:rgba(0,230,118,.4)}
.quick-pct-row{display:flex;gap:4px;margin-top:8px}
.qp-btn{flex:1;padding:4px;background:var(--bg3);border:1px solid var(--border);border-radius:4px;color:var(--text3);font-size:11px;font-weight:700;cursor:pointer;transition:all .2s;font-family:var(--font-mono)}
.qp-btn:hover{color:var(--green);border-color:rgba(0,230,118,.3);background:var(--green3)}
.leverage-slider{width:100%;height:4px;margin:8px 0 4px;appearance:none;-webkit-appearance:none;background:linear-gradient(to right,var(--green) 0%,var(--green) 10%,var(--bg3) 10%,var(--bg3) 100%);border-radius:2px;outline:none;cursor:pointer}
.leverage-slider::-webkit-slider-thumb{appearance:none;width:14px;height:14px;background:var(--green);border-radius:50%;cursor:pointer;box-shadow:0 0 6px rgba(0,230,118,.5)}
.leverage-marks{display:flex;justify-content:space-between;font-size:10px;color:var(--text3);font-family:var(--font-mono)}
.leverage-marks span{cursor:pointer;transition:color .2s}
.leverage-marks span:hover{color:var(--green)}
.tp-sl-row{display:flex;gap:0}
.tp-sl-row .op-group:first-child{border-right:1px solid var(--border)}
.order-summary{padding:10px 12px;border-bottom:1px solid var(--border);background:var(--bg0)}
.os-row{display:flex;justify-content:space-between;font-size:11px;padding:3px 0}
.os-row span:first-child{color:var(--text3)}
.os-row span:last-child{font-family:var(--font-mono);font-weight:600;color:var(--text1)}
.risk-warning{display:flex;align-items:center;gap:8px;padding:8px 12px;background:rgba(255,215,64,.08);border-bottom:1px solid rgba(255,215,64,.15);font-size:11px;color:var(--yellow)}
.order-submit-btn{width:100%;padding:15px;border:none;font-size:15px;font-weight:800;cursor:pointer;transition:all .2s;font-family:var(--font-mono);letter-spacing:.5px}
.order-submit-btn.buy{background:linear-gradient(135deg,var(--green),var(--green2));color:#000}
.order-submit-btn.sell{background:linear-gradient(135deg,var(--red),#c92a40);color:#fff}
.order-submit-btn:hover{transform:translateY(-1px);box-shadow:0 6px 20px rgba(0,0,0,.3)}
.op-mode-row{display:flex;align-items:center;gap:8px;padding:10px 12px;margin-top:auto;border-top:1px solid var(--border)}
.op-mode-btn{padding:4px 12px;background:var(--bg2);border:1px solid var(--border);border-radius:20px;font-size:11px;font-weight:700;cursor:pointer;transition:all .2s;font-family:var(--font-mono);color:var(--text3)}
.op-mode-btn.active{background:var(--green);color:#000;border-color:var(--green)}
.trade-right-col{display:flex;flex-direction:column;overflow:hidden;background:var(--bg1)}
.mini-ob{border-bottom:1px solid var(--border);flex-shrink:0}
.mob-header{padding:8px 12px;font-size:12px;font-weight:700;font-family:var(--font-display);border-bottom:1px solid var(--border)}
.my-positions{flex:1;overflow-y:auto;display:flex;flex-direction:column;border-bottom:1px solid var(--border)}
.my-pos-row{padding:8px 10px;border-bottom:1px solid var(--border);font-size:11px}
.mpr-top{display:flex;justify-content:space-between;margin-bottom:4px}
.mpr-pair{font-weight:700;font-family:var(--font-display)}
.mpr-pnl{font-family:var(--font-mono);font-weight:700}
.mpr-stats{display:flex;gap:8px;font-size:10px;color:var(--text3);font-family:var(--font-mono)}
.mpr-close{background:var(--red2);border:1px solid rgba(255,61,87,.2);border-radius:3px;color:var(--red);font-size:10px;font-weight:700;cursor:pointer;padding:2px 6px;float:right;margin-top:4px;transition:all .2s;font-family:var(--font-body)}
.mpr-close:hover{background:var(--red);color:#fff}
.mini-hist-row{padding:6px 10px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;font-size:10px;font-family:var(--font-mono)}
.iv-group{display:flex;gap:2px}

/* ── DEPOSIT/WITHDRAW ── */
.dep-method-btn{display:flex;flex-direction:column;align-items:center;padding:14px 8px;background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-lg);cursor:pointer;transition:all .2s;color:var(--text2);font-family:var(--font-body)}
.dep-method-btn.active{border-color:var(--green);background:var(--green3);color:var(--text1)}
.dep-method-btn:hover{border-color:var(--border2);color:var(--text1)}

/* ── BOTS ── */
.bots-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px}
.bot-card{background:var(--bg1);border:1px solid var(--border);border-radius:var(--r-xl);padding:20px;transition:all .25s}
.bot-card.active{border-color:rgba(0,230,118,.35);background:rgba(0,230,118,.03)}
.bot-card:hover{border-color:var(--border2);transform:translateY(-2px);box-shadow:0 8px 28px rgba(0,0,0,.3)}
.bc-top{display:flex;align-items:center;gap:12px;margin-bottom:12px}
.bc-icon{width:44px;height:44px;border-radius:var(--r-md);display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0}
.bc-name{font-family:var(--font-display);font-size:15px;font-weight:700}
.bc-risk{font-size:11px;font-weight:600}
.bc-status{margin-left:auto;font-size:11px;font-weight:800;font-family:var(--font-mono)}
.bc-status.on{color:var(--green)}.bc-status.off{color:var(--text3)}
.bc-desc{font-size:12px;color:var(--text2);line-height:1.55;margin-bottom:14px}
.bc-stats{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin-bottom:12px}
.bc-stat{background:var(--bg2);border-radius:var(--r-sm);padding:8px 4px;text-align:center}
.bcs-val{font-family:var(--font-mono);font-size:13px;font-weight:700}
.bcs-lbl{font-size:9px;color:var(--text3);text-transform:uppercase;letter-spacing:.4px;margin-top:2px}
.bc-pairs{font-size:11px;color:var(--text3);margin-bottom:12px}
.bc-toggle-btn{width:100%;padding:10px;border:none;border-radius:var(--r-md);font-size:13px;font-weight:700;cursor:pointer;transition:all .2s;font-family:var(--font-mono)}
.bc-toggle-btn.start{background:var(--green);color:#000}
.bc-toggle-btn.stop{background:var(--red2);border:1px solid rgba(255,61,87,.3);color:var(--red)}
.bc-toggle-btn.start:hover{background:var(--green2)}
.bc-toggle-btn.stop:hover{background:var(--red);color:#fff}
.bc-running{display:flex;align-items:center;font-size:11px;color:var(--green);margin-top:8px;font-family:var(--font-mono)}

/* ── HISTORY ── */
.hist-row{border-bottom:1px solid var(--border);transition:background .15s}
.hist-row:hover{background:var(--bg2)}
.hist-row td{padding:10px 12px}

/* ── REFERRAL ── */
.ref-hist-row{display:flex;align-items:center;gap:12px;padding:12px 0;border-bottom:1px solid var(--border)}
.ref-hist-row:last-child{border-bottom:none}

/* ── UTILITIES ── */
.container{max-width:1440px;margin:0 auto;padding:0 24px}
.text-green{color:var(--green)}.text-red{color:var(--red)}.text-blue{color:var(--blue)}.text-yellow{color:var(--yellow)}.text-dim{color:var(--text2)}
.mono{font-family:var(--font-mono)}.fw-bold{font-weight:700}

/* ── RESPONSIVE ── */
@media(max-width:768px){
  .hero{padding:48px 20px 40px}.hero-title{font-size:34px}.stats-bar{flex-wrap:wrap}
  .stat-item{min-width:50%;border-bottom:1px solid var(--border)}.nav-ticker{display:none}
  .winners-grid,.features-grid,.reviews-grid{grid-template-columns:1fr}
  #aiPanel{width:calc(100vw - 32px);right:16px}
}
@media(max-width:860px){.auth-page{grid-template-columns:1fr}.auth-left{display:none}.auth-right{padding:24px 16px;min-height:100vh}}
@media(max-width:900px){
  .chart-layout{grid-template-columns:1fr;height:auto}.orderbook-panel,.trades-panel{display:none}.canvas-wrap{height:300px;flex:none}
  .dash-body{grid-template-columns:1fr}.dash-sidebar{display:none}
  .balance-cards{grid-template-columns:1fr 1fr}.quick-actions{grid-template-columns:repeat(3,1fr)}
  .dash-two-col,.dash-three-col{grid-template-columns:1fr}
}
@media(max-width:1100px){
  .dash-three-col{grid-template-columns:1fr 1fr}
  .trading-body{grid-template-columns:1fr 260px}.trade-right-col{display:none}
}
@media(max-width:480px){.balance-cards{grid-template-columns:1fr}.quick-actions{grid-template-columns:repeat(2,1fr)}}
@media(max-width:750px){.trading-body{grid-template-columns:1fr;height:auto}.trade-chart-col .canvas-wrap{height:260px}}
</style>
</head>
<body>

<!-- REFERRAL BANNER -->
<div id="refBanner">
  <button class="ref-close" onclick="closeRefBanner()">×</button>
  <div style="font-size:13px;color:rgba(255,255,255,.7);margin-bottom:4px;">🎉 <strong id="refName">Your friend</strong> invited you to CryptoPro!</div>
  <span class="ref-bonus-amt">$25 SIGNUP BONUS</span>
  <div style="font-size:12px;color:rgba(255,255,255,.6);margin-top:6px;">Sign up now — bonus credited instantly</div>
</div>

<!-- TOAST -->
<div id="toast"></div>

<!-- AI BUTTON + PANEL -->
<button id="aiBtn" onclick="toggleAI()"><div class="ai-pulse"></div>🤖</button>
<div id="aiPanel">
  <div class="ai-header">
    <div class="ai-header-icon">🤖</div>
    <div><div class="ai-header-title">CryptoPro AI</div><div class="ai-header-status">● Online — Ready to help</div></div>
    <button class="ai-close" onclick="toggleAI()">×</button>
  </div>
  <div class="ai-messages" id="aiMessages">
    <div class="ai-msg bot">👋 Hi! I'm your CryptoPro AI assistant.<br><br>I can help with trading strategies, market analysis, account questions, and more. What would you like to know?</div>
  </div>
  <div class="ai-quick-btns">
    <button class="ai-quick" onclick="aiQuick('How do I start trading?')">🚀 Start trading</button>
    <button class="ai-quick" onclick="aiQuick('What is leverage?')">📊 Leverage</button>
    <button class="ai-quick" onclick="aiQuick('How do I deposit?')">💰 Deposit</button>
    <button class="ai-quick" onclick="aiQuick('How do AI bots work?')">🤖 AI Bots</button>
    <button class="ai-quick" onclick="aiQuick('How do I withdraw?')">💸 Withdraw</button>
  </div>
  <div class="ai-input-row">
    <input class="ai-input" id="aiInput" placeholder="Ask anything…" onkeydown="if(event.key==='Enter')sendAI()">
    <button class="ai-send" onclick="sendAI()">➤</button>
  </div>
</div>

<!-- ══════════════════════════ WELCOME LAYER ══════════════════════════ -->
<div id="welcomeLayer" class="layer active">
  <nav class="navbar">
    <div class="nav-logo" onclick="showLayer('welcomeLayer')">
      <div class="nav-logo-mark">₿</div>
      <div class="nav-logo-text">Crypto<span>Pro</span></div>
    </div>
    <div class="nav-ticker"><div class="nav-ticker-track" id="navTickerTrack"></div></div>
    <div class="nav-right">
      <div class="live-badge"><div class="live-dot"></div>LIVE</div>
      <button class="btn btn-outline" onclick="showLayer('loginLayer')">Login</button>
      <button class="btn btn-green" onclick="showLayer('signupLayer')">Sign Up Free</button>
    </div>
  </nav>
  <div class="market-bar"><div class="market-bar-track" id="marketBarTrack"></div></div>
  <section class="hero">
    <div class="hero-grid"></div>
    <div class="hero-tag"><div class="live-dot"></div>50,000+ Active Traders Worldwide</div>
    <h1 class="hero-title">Trade Smarter<br><span class="accent">Earn Bigger</span><br><span class="dim">with AI Power</span></h1>
    <p class="hero-sub">Professional crypto trading platform with AI-powered bots, real-time charts, and automated strategies. Get your <strong style="color:var(--green)">$25 bonus</strong> when you sign up today.</p>
    <div class="hero-cta">
      <button class="btn-hero-primary" onclick="showLayer('signupLayer')">Start Trading — Free</button>
      <button class="btn-hero-secondary" onclick="showLayer('chartsLayer')">View Live Charts →</button>
    </div>
  </section>
  <div class="stats-bar">
    <div class="stat-item"><span class="stat-val">50,000+</span><span class="stat-lbl">Active Traders</span></div>
    <div class="stat-item"><span class="stat-val">$125M+</span><span class="stat-lbl">Total Volume</span></div>
    <div class="stat-item"><span class="stat-val">98.5%</span><span class="stat-lbl">Uptime</span></div>
    <div class="stat-item"><span class="stat-val">4.9★</span><span class="stat-lbl">User Rating</span></div>
    <div class="stat-item"><span class="stat-val">15,000+</span><span class="stat-lbl">Daily Trades</span></div>
  </div>
  <section class="traders-section">
    <div class="section-header"><span class="section-title">Live Active Traders</span><span class="section-badge">● LIVE</span></div>
    <div class="traders-track-wrap"><div class="traders-track" id="tradersTrack"></div></div>
  </section>
  <section class="winners-section">
    <div class="section-header"><span class="section-title">🏆 Top Traders This Week</span></div>
    <div class="winners-grid" id="winnersGrid"></div>
  </section>
  <section class="features-section">
    <div class="section-header"><span class="section-title">Why CryptoPro?</span></div>
    <div class="features-grid">
      <div class="feature-card" onclick="showLayer('chartsLayer')"><div class="feature-icon fi-green">📈</div><div class="feature-title">Real-Time Charts</div><div class="feature-desc">Professional charts with live candlesticks, order books, and depth analysis.</div></div>
      <div class="feature-card" onclick="showLayer('signupLayer')"><div class="feature-icon fi-blue">🤖</div><div class="feature-title">AI Trading Bots</div><div class="feature-desc">Set-and-forget automated bots with up to 91% win rate. Trade 24/7.</div></div>
      <div class="feature-card" onclick="showLayer('signupLayer')"><div class="feature-icon fi-yellow">⚡</div><div class="feature-title">100× Leverage</div><div class="feature-desc">Amplify your positions with up to 100x leverage on major crypto pairs.</div></div>
      <div class="feature-card" onclick="showLayer('signupLayer')"><div class="feature-icon fi-purple">💸</div><div class="feature-title">Fast Withdrawals</div><div class="feature-desc">Withdraw via M-Pesa, Bank Transfer, or USDT. Processed within 5–30 minutes.</div></div>
      <div class="feature-card" onclick="showLayer('signupLayer')"><div class="feature-icon fi-cyan">🎁</div><div class="feature-title">Referral Rewards</div><div class="feature-desc">Earn 10% lifetime commission on every deposit your referrals make.</div></div>
      <div class="feature-card"><div class="feature-icon fi-red">🔒</div><div class="feature-title">Bank-Grade Security</div><div class="feature-desc">256-bit SSL encryption, 2FA, and cold storage for all user funds.</div></div>
    </div>
  </section>
  <section class="reviews-section">
    <div class="section-header"><span class="section-title">⭐ What Traders Say</span></div>
    <div class="reviews-grid" id="reviewsGrid"></div>
  </section>
  <section class="cta-section">
    <h2 class="cta-title">Ready to Start<br><span style="color:var(--green)">Earning Today?</span></h2>
    <p class="cta-sub">Join 50,000+ traders already profiting. Get your free $25 bonus just for signing up.</p>
    <button class="btn-hero-primary" onclick="showLayer('signupLayer')">Create Free Account →</button>
  </section>
  <footer class="footer">🔒 SSL Secured &nbsp;|&nbsp; 🛡️ 2FA Protected &nbsp;|&nbsp; ✅ Funds Secured &nbsp;|&nbsp; © 2025 CryptoPro. All rights reserved.</footer>
</div>

<!-- ══════════════════════════ LOGIN LAYER ══════════════════════════ -->
<div id="loginLayer" class="layer">
  <div class="auth-page">
    <div class="auth-left">
      <div class="auth-left-inner">
        <div class="nav-logo" onclick="showLayer('welcomeLayer')" style="margin-bottom:48px;"><div class="nav-logo-mark">₿</div><div class="nav-logo-text">Crypto<span>Pro</span></div></div>
        <h1 class="auth-big-title">Welcome<br>Back<span style="color:var(--green)">.</span></h1>
        <p class="auth-big-sub">Log in to your account and continue building your portfolio.</p>
        <div class="auth-trust-list">
          <div class="auth-trust-item"><span class="auth-trust-icon">🔒</span>256-bit SSL encryption</div>
          <div class="auth-trust-item"><span class="auth-trust-icon">🛡️</span>Two-factor authentication</div>
          <div class="auth-trust-item"><span class="auth-trust-icon">⚡</span>Instant account access</div>
          <div class="auth-trust-item"><span class="auth-trust-icon">💎</span>50,000+ active traders</div>
        </div>
        <div class="auth-live-card">
          <div class="auth-live-row"><div class="live-badge"><div class="live-dot"></div>LIVE</div><span style="font-size:12px;color:var(--text3)">Right now</span></div>
          <div style="margin-top:10px;font-size:13px;color:var(--text2)" id="loginLiveMsg">🎉 <strong style="color:var(--text1)">James K.</strong> just withdrew <strong style="color:var(--green)">$1,240</strong></div>
        </div>
      </div>
    </div>
    <div class="auth-right">
      <div class="auth-card">
        <div class="auth-card-header"><h2 class="auth-form-title">Sign in</h2><p class="auth-form-sub">Enter your credentials to access your account</p></div>
        <div id="loginAlert" class="form-alert" style="display:none;"></div>
        <form onsubmit="return handleLogin(event)">
          <div class="form-group">
            <label class="form-label">Email Address</label>
            <div class="input-wrap"><span class="input-icon">✉️</span><input class="form-input" type="email" id="loginEmail" placeholder="you@email.com" required></div>
          </div>
          <div class="form-group">
            <label class="form-label">Password <a class="form-label-link" href="#">Forgot password?</a></label>
            <div class="input-wrap"><span class="input-icon">🔒</span><input class="form-input" type="password" id="loginPassword" placeholder="Enter your password" required><button type="button" class="input-eye" onclick="togglePwd('loginPassword',this)">👁</button></div>
          </div>
          <div id="twoFAStep" style="display:none;">
            <div class="twofa-box">
              <div style="font-size:28px;margin-bottom:8px;">🔐</div>
              <div style="font-weight:700;margin-bottom:4px;">Two-Factor Authentication</div>
              <div style="font-size:12px;color:var(--text2);margin-bottom:14px;">Enter the 6-digit code sent to your phone</div>
              <div class="otp-row" id="otpRow">
                <input class="otp-input" maxlength="1" oninput="otpNext(this,0)">
                <input class="otp-input" maxlength="1" oninput="otpNext(this,1)">
                <input class="otp-input" maxlength="1" oninput="otpNext(this,2)">
                <input class="otp-input" maxlength="1" oninput="otpNext(this,3)">
                <input class="otp-input" maxlength="1" oninput="otpNext(this,4)">
                <input class="otp-input" maxlength="1" oninput="otpNext(this,5)">
              </div>
              <div style="font-size:11px;color:var(--text3);margin-top:8px;">Demo code: <strong style="color:var(--green);font-family:var(--font-mono)">123456</strong></div>
            </div>
          </div>
          <button type="submit" class="btn-auth" id="loginBtn"><span id="loginBtnText">Sign In →</span><span id="loginBtnSpinner" style="display:none" class="btn-spinner">⟳</span></button>
        </form>
        <div class="auth-divider"><span>or continue with</span></div>
        <div class="social-row">
          <button class="social-btn" onclick="showToast('Google login coming soon!','blue')"><img src="https://www.google.com/favicon.ico" width="16" height="16" alt="G"> Google</button>
          <button class="social-btn" onclick="showToast('Apple login coming soon!','blue')">🍎 Apple</button>
        </div>
        <p class="auth-switch-text">Don't have an account? <a onclick="showLayer('signupLayer')">Create one free →</a></p>
      </div>
    </div>
  </div>
</div>

<!-- ══════════════════════════ SIGNUP LAYER ══════════════════════════ -->
<div id="signupLayer" class="layer">
  <div class="auth-page">
    <div class="auth-left">
      <div class="auth-left-inner">
        <div class="nav-logo" onclick="showLayer('welcomeLayer')" style="margin-bottom:48px;"><div class="nav-logo-mark">₿</div><div class="nav-logo-text">Crypto<span>Pro</span></div></div>
        <h1 class="auth-big-title">Start<br>Earning<span style="color:var(--green)">.</span></h1>
        <p class="auth-big-sub">Join 50,000+ traders already making daily profits with AI-powered automation.</p>
        <div class="signup-bonus-card">
          <div class="sbc-top"><span style="font-size:28px;">🎁</span><div><div style="font-size:12px;color:rgba(255,255,255,.6);margin-bottom:2px;">WELCOME BONUS</div><div style="font-size:32px;font-weight:900;font-family:var(--font-mono);color:var(--yellow);">$25.00</div></div></div>
          <div style="font-size:12px;color:rgba(255,255,255,.6);margin-top:8px;line-height:1.5;">✅ Credited instantly on signup<br>✅ 100% Welcome bonus on first deposit<br>✅ No hidden fees</div>
        </div>
        <div class="auth-steps">
          <div class="auth-step"><div class="step-num">1</div><span>Create your account</span></div>
          <div class="auth-step"><div class="step-num">2</div><span>Get $25 demo bonus</span></div>
          <div class="auth-step"><div class="step-num">3</div><span>Deposit &amp; start trading</span></div>
          <div class="auth-step"><div class="step-num">4</div><span>Withdraw your profits</span></div>
        </div>
      </div>
    </div>
    <div class="auth-right">
      <div class="auth-card">
        <div class="auth-card-header"><h2 class="auth-form-title">Create Account</h2><p class="auth-form-sub">Join free — takes less than 60 seconds</p></div>
        <div class="signup-progress">
          <div class="sp-bar"><div class="sp-fill" id="spFill" style="width:33%"></div></div>
          <div class="sp-steps"><span class="sp-step active" id="sp1">Personal</span><span class="sp-step" id="sp2">Security</span><span class="sp-step" id="sp3">Confirm</span></div>
        </div>
        <div id="signupAlert" class="form-alert" style="display:none;"></div>
        <form onsubmit="return handleSignup(event)" id="signupForm">
          <div id="signupStep1">
            <div class="form-group"><label class="form-label">Full Name</label><div class="input-wrap"><span class="input-icon">👤</span><input class="form-input" type="text" id="signupName" placeholder="Your full name" required></div></div>
            <div class="form-group"><label class="form-label">Email Address</label><div class="input-wrap"><span class="input-icon">✉️</span><input class="form-input" type="email" id="signupEmail" placeholder="you@email.com" required></div></div>
            <div class="form-group"><label class="form-label">Phone Number</label><div class="input-wrap"><span class="input-icon">📱</span><input class="form-input" type="tel" id="signupPhone" placeholder="+254 712 345 678" required></div></div>
            <button type="button" class="btn-auth" onclick="signupNext(1)">Continue →</button>
          </div>
          <div id="signupStep2" style="display:none;">
            <div class="form-group">
              <label class="form-label">Password</label>
              <div class="input-wrap"><span class="input-icon">🔒</span><input class="form-input" type="password" id="signupPassword" placeholder="Min. 8 characters" required oninput="checkPasswordStrength(this.value)"><button type="button" class="input-eye" onclick="togglePwd('signupPassword',this)">👁</button></div>
              <div class="pwd-strength"><div class="pwd-bar"><div class="pwd-fill" id="pwdFill"></div></div><span class="pwd-label" id="pwdLabel"></span></div>
            </div>
            <div class="form-group"><label class="form-label">Confirm Password</label><div class="input-wrap"><span class="input-icon">🔒</span><input class="form-input" type="password" id="signupConfirm" placeholder="Re-enter password" required><button type="button" class="input-eye" onclick="togglePwd('signupConfirm',this)">👁</button></div></div>
            <div class="form-group"><label class="form-label">Referral Code <span style="color:var(--text3);font-weight:400">(optional)</span></label><div class="input-wrap"><span class="input-icon">🎁</span><input class="form-input" type="text" id="signupReferralCode" placeholder="Enter referral code"></div></div>
            <div style="display:flex;gap:8px;"><button type="button" class="btn-auth-outline" onclick="signupBack(2)">← Back</button><button type="button" class="btn-auth" style="flex:1" onclick="signupNext(2)">Continue →</button></div>
          </div>
          <div id="signupStep3" style="display:none;">
            <div class="confirm-box">
              <div style="text-align:center;margin-bottom:20px;"><div style="font-size:48px;margin-bottom:8px;">🎉</div><div style="font-size:18px;font-weight:700;font-family:var(--font-display)">Almost there!</div><div style="font-size:13px;color:var(--text2);margin-top:4px">Review your details</div></div>
              <div class="confirm-row"><span>Name</span><strong id="confirmName">—</strong></div>
              <div class="confirm-row"><span>Email</span><strong id="confirmEmail">—</strong></div>
              <div class="confirm-row"><span>Phone</span><strong id="confirmPhone">—</strong></div>
              <div class="confirm-row"><span>Bonus</span><strong style="color:var(--green)">$25.00 Free</strong></div>
              <div class="confirm-row"><span>Referral</span><strong id="confirmRef">None</strong></div>
            </div>
            <label class="checkbox-row"><input type="checkbox" id="agreeTerms" required><span>I agree to the <a href="#" style="color:var(--green)">Terms of Service</a> and <a href="#" style="color:var(--green)">Privacy Policy</a></span></label>
            <div style="display:flex;gap:8px;margin-top:16px;"><button type="button" class="btn-auth-outline" onclick="signupBack(3)">← Back</button><button type="submit" class="btn-auth" style="flex:1" id="signupBtn"><span id="signupBtnText">🚀 Create Account</span><span id="signupBtnSpinner" style="display:none" class="btn-spinner">⟳</span></button></div>
          </div>
        </form>
        <p class="auth-switch-text" style="margin-top:20px;">Already have an account? <a onclick="showLayer('loginLayer')">Sign in →</a></p>
      </div>
    </div>
  </div>
</div>

<!-- ══════════════════════════ CHARTS LAYER ══════════════════════════ -->
<div id="chartsLayer" class="layer">
  <nav class="navbar">
    <div class="nav-logo" onclick="showLayer('welcomeLayer')"><div class="nav-logo-mark">₿</div><div class="nav-logo-text">Crypto<span>Pro</span></div></div>
    <div class="nav-ticker"><div class="nav-ticker-track" id="chartNavTicker"></div></div>
    <div class="nav-right">
      <div class="live-badge"><div class="live-dot"></div>LIVE</div>
      <button class="btn btn-outline" onclick="showLayer('loginLayer')">Login</button>
      <button class="btn btn-green" onclick="showLayer('signupLayer')">Sign Up</button>
    </div>
  </nav>
  <div class="pair-bar"><div class="pair-bar-inner">
    <button class="pair-btn active" onclick="selectPair('BTC','USDT',this)">BTC/USDT</button>
    <button class="pair-btn" onclick="selectPair('ETH','USDT',this)">ETH/USDT</button>
    <button class="pair-btn" onclick="selectPair('BNB','USDT',this)">BNB/USDT</button>
    <button class="pair-btn" onclick="selectPair('SOL','USDT',this)">SOL/USDT</button>
    <button class="pair-btn" onclick="selectPair('ADA','USDT',this)">ADA/USDT</button>
    <button class="pair-btn" onclick="selectPair('XRP','USDT',this)">XRP/USDT</button>
    <button class="pair-btn" onclick="selectPair('AVAX','USDT',this)">AVAX/USDT</button>
    <button class="pair-btn" onclick="selectPair('DOT','USDT',this)">DOT/USDT</button>
  </div></div>
  <div class="price-header">
    <div class="ph-left"><div class="ph-pair" id="phPairName">BTC / USDT</div><div class="ph-price" id="phPrice">$98,450.00</div><div class="ph-change up" id="phChange">+2.45%</div></div>
    <div class="ph-stats">
      <div class="ph-stat"><span class="ph-stat-lbl">24h High</span><span class="ph-stat-val" id="ph24hHigh">$99,120</span></div>
      <div class="ph-stat"><span class="ph-stat-lbl">24h Low</span><span class="ph-stat-val" id="ph24hLow">$96,800</span></div>
      <div class="ph-stat"><span class="ph-stat-lbl">24h Vol</span><span class="ph-stat-val" id="ph24hVol">28.5B</span></div>
      <div class="ph-stat"><span class="ph-stat-lbl">Open</span><span class="ph-stat-val" id="phOpen">$97,850</span></div>
      <div class="ph-stat"><span class="ph-stat-lbl">Close</span><span class="ph-stat-val" id="phClose">$98,450</span></div>
    </div>
    <div class="ph-right"><div class="interval-btns">
      <button class="iv-btn active" onclick="setInterval_('1m',this)">1m</button>
      <button class="iv-btn" onclick="setInterval_('5m',this)">5m</button>
      <button class="iv-btn" onclick="setInterval_('15m',this)">15m</button>
      <button class="iv-btn" onclick="setInterval_('1h',this)">1H</button>
      <button class="iv-btn" onclick="setInterval_('4h',this)">4H</button>
      <button class="iv-btn" onclick="setInterval_('1d',this)">1D</button>
    </div></div>
  </div>
  <div class="chart-layout">
    <div class="chart-main">
      <div class="indicator-bar">
        <span style="font-size:11px;color:var(--text3);font-weight:600;text-transform:uppercase;letter-spacing:.5px;">Indicators:</span>
        <button class="ind-btn active" onclick="toggleIndicator('ma',this)">MA</button>
        <button class="ind-btn active" onclick="toggleIndicator('bb',this)">BB</button>
        <button class="ind-btn" onclick="toggleIndicator('vol',this)">Volume</button>
        <button class="ind-btn" onclick="toggleIndicator('rsi',this)">RSI</button>
        <div style="margin-left:auto;display:flex;align-items:center;gap:8px;">
          <button class="ind-btn" onclick="toggleChartType()">🕯 Candles</button>
          <button class="ind-btn" onclick="showLayer('signupLayer')" style="background:var(--green);color:#000;border-color:var(--green);">Trade Now →</button>
        </div>
      </div>
      <div class="canvas-wrap" id="mainChartWrap">
        <canvas id="candleCanvas"></canvas>
        <div class="crosshair-tooltip" id="crosshairTip" style="display:none;"></div>
        <div class="y-axis" id="yAxis"></div>
        <div class="x-axis" id="xAxis"></div>
      </div>
      <div class="vol-canvas-wrap" id="volWrap">
        <canvas id="volCanvas"></canvas>
        <div style="position:absolute;top:4px;left:8px;font-size:10px;color:var(--text3);font-family:var(--font-mono);">VOLUME</div>
      </div>
      <div class="rsi-canvas-wrap" id="rsiWrap" style="display:none;">
        <canvas id="rsiCanvas"></canvas>
        <div style="position:absolute;top:4px;left:8px;font-size:10px;color:var(--text3);font-family:var(--font-mono);">RSI(14)</div>
      </div>
      <div class="depth-section">
        <div class="depth-header"><span class="section-title">📊 Market Depth</span><div style="display:flex;gap:12px;font-size:11px;"><span style="color:var(--green);">▬ Bids</span><span style="color:var(--red);">▬ Asks</span></div></div>
        <div class="depth-wrap"><canvas id="depthCanvas"></canvas></div>
      </div>
    </div>
    <div class="orderbook-panel">
      <div class="ob-header"><span class="ob-title">Order Book</span><div class="ob-tabs"><button class="ob-tab active" onclick="setOBView('both',this)">⬛</button><button class="ob-tab" onclick="setOBView('asks',this)">🔴</button><button class="ob-tab" onclick="setOBView('bids',this)">🟢</button></div></div>
      <div class="ob-labels"><span>Price (USDT)</span><span>Amount</span><span>Total</span></div>
      <div class="ob-asks" id="obAsks"></div>
      <div class="ob-spread"><span id="obSpreadPrice" class="ob-spread-price">$98,450.00</span><span id="obSpreadPct" class="ob-spread-pct">Spread: 0.01%</span></div>
      <div class="ob-bids" id="obBids"></div>
    </div>
    <div class="trades-panel">
      <div class="tp-header"><span class="ob-title">Recent Trades</span><div class="live-badge" style="font-size:10px;padding:3px 8px;"><div class="live-dot"></div>LIVE</div></div>
      <div class="tp-labels"><span>Price</span><span>Amount</span><span>Time</span></div>
      <div class="tp-feed" id="tradesFeed"></div>
    </div>
  </div>
  <div class="market-overview-section">
    <div class="section-header" style="padding:0 0 16px;"><span class="section-title">📈 Market Overview</span></div>
    <div class="market-cards-grid" id="marketCardsGrid"></div>
  </div>
  <div style="text-align:center;padding:32px;border-top:1px solid var(--border);">
    <p style="color:var(--text2);font-size:14px;margin-bottom:16px;">Ready to start trading these markets?</p>
    <button class="btn-hero-primary" onclick="showLayer('signupLayer')">Open Free Account →</button>
  </div>
</div>

<!-- ══════════════════════════ DASHBOARD LAYER ══════════════════════════ -->
<div id="dashboardLayer" class="layer">
  <nav class="navbar">
    <div class="nav-logo" onclick="showLayer('dashboardLayer')"><div class="nav-logo-mark">₿</div><div class="nav-logo-text">Crypto<span>Pro</span></div></div>
    <div class="nav-ticker"><div class="nav-ticker-track" id="dashNavTicker"></div></div>
    <div class="nav-right">
      <div class="live-badge"><div class="live-dot"></div>LIVE</div>
      <div class="dash-user-chip" id="dashUserChip"><div class="duc-avatar">👤</div><span id="duchName">User</span><span style="color:var(--text3)">▾</span></div>
      <button class="btn btn-outline" onclick="handleLogout()">Logout</button>
    </div>
  </nav>
  <div class="market-bar"><div class="market-bar-track" id="dashMarketBar"></div></div>
  <div class="dash-body">
    <aside class="dash-sidebar">
      <div class="sidebar-balance">
        <div class="sbl-label" id="sblLabel">DEMO BALANCE</div>
        <div class="sbl-amount" id="sblAmount">$25.00</div>
        <div class="sbl-sub">Available to trade</div>
        <div class="mode-toggle"><button class="mt-btn active" id="mtDemo" onclick="switchMode('demo')">📊 DEMO</button><button class="mt-btn" id="mtReal" onclick="switchMode('real')">💎 REAL</button></div>
      </div>
      <nav class="sidebar-nav">
        <div class="snav-section">MAIN</div>
        <div class="snav-item active" id="snavOverview" onclick="dashTab('overview')"><span class="snav-icon">📊</span>Overview</div>
        <div class="snav-item" onclick="showLayer('tradingLayer')"><span class="snav-icon">⚡</span>Trade</div>
        <div class="snav-item" onclick="showLayer('chartsLayer')"><span class="snav-icon">📈</span>Live Charts</div>
        <div class="snav-item" onclick="showLayer('botsLayer')"><span class="snav-icon">🤖</span>AI Bots</div>
        <div class="snav-section">ACCOUNT</div>
        <div class="snav-item" onclick="showLayer('depositLayer')"><span class="snav-icon">💰</span>Deposit</div>
        <div class="snav-item" onclick="showLayer('withdrawLayer')"><span class="snav-icon">💸</span>Withdraw</div>
        <div class="snav-item" onclick="showLayer('historyLayer')"><span class="snav-icon">📜</span>History</div>
        <div class="snav-item" onclick="showLayer('referralLayer')"><span class="snav-icon">🎁</span>Referrals<span class="snav-badge">10%</span></div>
        <div class="snav-item" onclick="showLayer('profileLayer')"><span class="snav-icon">⚙️</span>Profile</div>
      </nav>
      <div class="sidebar-ref-card">
        <div style="font-size:11px;color:var(--text3);margin-bottom:6px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;">Referral Link</div>
        <div class="src-link" id="sideRefLink">Loading…</div>
        <button class="src-copy" onclick="copySideRef()">📋 Copy</button>
      </div>
    </aside>
    <main class="dash-content" id="dashContent">
      <div class="balance-cards">
        <div class="bal-card primary"><div class="bc-label" id="bcLabel">Demo Balance</div><div class="bc-amount" id="bcAmount">$25.00</div><div class="bc-change up" id="bcChange">+0.00%</div><div class="bc-sparkline"><canvas id="balSparkline"></canvas></div></div>
        <div class="bal-card"><div class="bc-label">Total Profit</div><div class="bc-amount text-green" id="bcProfit">$0.00</div><div style="font-size:11px;color:var(--text3);margin-top:4px;">All time</div></div>
        <div class="bal-card"><div class="bc-label">Total Deposits</div><div class="bc-amount" id="bcDeposits">$0.00</div><div style="font-size:11px;color:var(--text3);margin-top:4px;">Cumulative</div></div>
        <div class="bal-card"><div class="bc-label">Win Rate</div><div class="bc-amount text-blue" id="bcWinRate">—</div><div style="font-size:11px;color:var(--text3);margin-top:4px;">Closed trades</div></div>
      </div>
      <div class="quick-actions">
        <button class="qa-btn qa-trade" onclick="showLayer('tradingLayer')"><span class="qa-icon">⚡</span><span>Trade</span></button>
        <button class="qa-btn qa-deposit" onclick="showLayer('depositLayer')"><span class="qa-icon">💰</span><span>Deposit</span></button>
        <button class="qa-btn qa-withdraw" onclick="showLayer('withdrawLayer')"><span class="qa-icon">💸</span><span>Withdraw</span></button>
        <button class="qa-btn qa-bots" onclick="showLayer('botsLayer')"><span class="qa-icon">🤖</span><span>AI Bots</span></button>
        <button class="qa-btn qa-ref" onclick="showLayer('referralLayer')"><span class="qa-icon">🎁</span><span>Refer</span></button>
        <button class="qa-btn qa-charts" onclick="showLayer('chartsLayer')"><span class="qa-icon">📈</span><span>Charts</span></button>
      </div>
      <div class="dash-two-col">
        <div class="dash-card">
          <div class="dc-header"><span class="dc-title">📈 Portfolio Performance</span><div class="dc-tabs"><button class="dc-tab active" onclick="setPerfPeriod('7d',this)">7D</button><button class="dc-tab" onclick="setPerfPeriod('30d',this)">30D</button><button class="dc-tab" onclick="setPerfPeriod('90d',this)">90D</button></div></div>
          <div class="dc-chart-wrap"><canvas id="perfCanvas"></canvas></div>
          <div class="perf-footer">
            <div class="pf-item"><span class="pf-lbl">Period Return</span><span class="pf-val text-green" id="pfReturn">+0.00%</span></div>
            <div class="pf-item"><span class="pf-lbl">Best Day</span><span class="pf-val text-green" id="pfBest">+0.00%</span></div>
            <div class="pf-item"><span class="pf-lbl">Worst Day</span><span class="pf-val text-red" id="pfWorst">-0.00%</span></div>
          </div>
        </div>
        <div class="dash-card">
          <div class="dc-header"><span class="dc-title">🔓 Open Positions</span><span class="dc-badge" id="openPosCount">0 Active</span></div>
          <div id="openPositionsContainer"><div class="empty-state"><div style="font-size:40px;margin-bottom:8px;">📊</div><div style="font-weight:600;color:var(--text2);">No open positions</div><div style="font-size:12px;color:var(--text3);margin-top:4px;">Start trading to see live P&L here</div><button class="btn btn-green" style="margin-top:16px;" onclick="showLayer('tradingLayer')">Open Trade →</button></div></div>
        </div>
      </div>
      <div class="dash-three-col">
        <div class="dash-card">
          <div class="dc-header"><span class="dc-title">💼 Asset Allocation</span></div>
          <div class="alloc-chart-wrap"><canvas id="allocCanvas"></canvas><div class="alloc-center"><div class="ac-amount" id="acAmount">$0</div><div class="ac-label">Total</div></div></div>
          <div class="alloc-legend" id="allocLegend"></div>
        </div>
        <div class="dash-card">
          <div class="dc-header"><span class="dc-title">📜 Recent Trades</span><a class="dc-link" onclick="showLayer('historyLayer')">View all →</a></div>
          <div id="recentTradesContainer"><div class="empty-state"><div style="font-size:36px;margin-bottom:8px;">📭</div><div style="font-size:13px;color:var(--text2);">No trades yet</div></div></div>
        </div>
        <div class="dash-card">
          <div class="dc-header"><span class="dc-title">🌐 Market Snapshot</span><div class="live-badge" style="font-size:10px;"><div class="live-dot"></div>LIVE</div></div>
          <div class="msnap-list" id="mSnapList"></div>
        </div>
      </div>
      <div class="kyc-notice" id="kycNotice">
        <div style="display:flex;align-items:center;gap:12px;"><span style="font-size:28px;">🔐</span><div><div style="font-weight:700;font-size:14px;margin-bottom:2px;">Complete KYC Verification</div><div style="font-size:12px;color:rgba(255,215,64,.8);">Verify your identity to unlock higher withdrawal limits.</div></div></div>
        <button class="kyc-btn" onclick="showToast('Contact support via AI assistant to begin KYC verification.','blue')">Verify Now →</button>
      </div>
    </main>
  </div>
</div>

<!-- ══════════════════════════ TRADING LAYER ══════════════════════════ -->
<div id="tradingLayer" class="layer">
  <nav class="navbar">
    <div class="nav-logo" onclick="showLayer('dashboardLayer')"><div class="nav-logo-mark">₿</div><div class="nav-logo-text">Crypto<span>Pro</span></div></div>
    <div class="nav-ticker"><div class="nav-ticker-track" id="tradeNavTicker"></div></div>
    <div class="nav-right">
      <div class="live-badge"><div class="live-dot"></div>LIVE</div>
      <button class="btn btn-outline" onclick="showLayer('dashboardLayer')">← Dashboard</button>
    </div>
  </nav>
  <div class="pair-bar"><div class="pair-bar-inner" id="tradePairBar">
    <button class="pair-btn active" onclick="tradingSelectPair('BTC','USDT',this)">BTC/USDT</button>
    <button class="pair-btn" onclick="tradingSelectPair('ETH','USDT',this)">ETH/USDT</button>
    <button class="pair-btn" onclick="tradingSelectPair('BNB','USDT',this)">BNB/USDT</button>
    <button class="pair-btn" onclick="tradingSelectPair('SOL','USDT',this)">SOL/USDT</button>
    <button class="pair-btn" onclick="tradingSelectPair('ADA','USDT',this)">ADA/USDT</button>
    <button class="pair-btn" onclick="tradingSelectPair('XRP','USDT',this)">XRP/USDT</button>
    <button class="pair-btn" onclick="tradingSelectPair('AVAX','USDT',this)">AVAX/USDT</button>
    <button class="pair-btn" onclick="tradingSelectPair('DOT','USDT',this)">DOT/USDT</button>
  </div></div>
  <div class="trade-price-strip">
    <div class="tps-left"><span class="tps-pair" id="tpsPair">BTC/USDT</span><span class="tps-price" id="tpsPrice">$98,450.00</span><span class="tps-chg up" id="tpsChg">+2.45%</span></div>
    <div class="tps-stats">
      <div class="tps-stat"><span class="tps-lbl">High</span><span class="tps-val" id="tpsHigh">—</span></div>
      <div class="tps-stat"><span class="tps-lbl">Low</span><span class="tps-val" id="tpsLow">—</span></div>
      <div class="tps-stat"><span class="tps-lbl">Volume</span><span class="tps-val" id="tpsVol">—</span></div>
      <div class="tps-stat"><span class="tps-lbl">Mode</span><span class="tps-val" id="tradeModeLabel" style="color:var(--yellow)">DEMO</span></div>
    </div>
    <div class="tps-bal"><span class="tps-lbl">Available</span><span class="tps-val text-green" id="tradeAvailBal">$0.00</span></div>
  </div>
  <div class="trading-body">
    <div class="trade-chart-col">
      <div class="indicator-bar">
        <span style="font-size:11px;color:var(--text3);font-weight:600;text-transform:uppercase;letter-spacing:.5px;">Chart:</span>
        <button class="ind-btn active" onclick="toggleTrdIndicator('ma',this)">MA</button>
        <button class="ind-btn active" onclick="toggleTrdIndicator('bb',this)">BB</button>
        <button class="ind-btn" onclick="toggleTrdIndicator('rsi',this)">RSI</button>
        <div class="iv-group" style="margin-left:8px;">
          <button class="iv-btn active" onclick="setTrdInterval('1m',this)">1m</button>
          <button class="iv-btn" onclick="setTrdInterval('5m',this)">5m</button>
          <button class="iv-btn" onclick="setTrdInterval('15m',this)">15m</button>
          <button class="iv-btn" onclick="setTrdInterval('1h',this)">1H</button>
          <button class="iv-btn" onclick="setTrdInterval('4h',this)">4H</button>
        </div>
        <div style="margin-left:auto;"><button class="ind-btn" style="background:var(--green);color:#000;border-color:var(--green);" onclick="showLayer('depositLayer')">💰 Deposit</button></div>
      </div>
      <div class="canvas-wrap" id="tradingChartWrap" style="flex:1;">
        <canvas id="tradingCanvas"></canvas>
        <div class="crosshair-tooltip" id="tradeCrosshair" style="display:none;"></div>
        <div class="y-axis" id="tradeYAxis"></div>
        <div class="x-axis" id="tradeXAxis"></div>
      </div>
      <div class="vol-canvas-wrap" id="tradeVolWrap"><canvas id="tradeVolCanvas"></canvas><div style="position:absolute;top:4px;left:8px;font-size:10px;color:var(--text3);font-family:var(--font-mono);">VOLUME</div></div>
      <div class="rsi-canvas-wrap" id="tradeRsiWrap" style="display:none;"><canvas id="tradeRsiCanvas"></canvas><div style="position:absolute;top:4px;left:8px;font-size:10px;color:var(--text3);font-family:var(--font-mono);">RSI(14)</div></div>
    </div>
    <div class="order-panel">
      <div class="order-tabs"><button class="ot-btn buy active" id="otBuy" onclick="setOrderSide('buy')">▲ LONG / BUY</button><button class="ot-btn sell" id="otSell" onclick="setOrderSide('sell')">▼ SHORT / SELL</button></div>
      <div class="order-type-row">
        <button class="order-type-btn active" onclick="setOrderType('market',this)">Market</button>
        <button class="order-type-btn" onclick="setOrderType('limit',this)">Limit</button>
        <button class="order-type-btn" onclick="setOrderType('stop',this)">Stop</button>
      </div>
      <div class="op-group" id="limitPriceGroup" style="display:none;"><label class="op-label">Limit Price (USDT)</label><div class="op-input-wrap"><input class="op-input" type="number" id="limitPrice" placeholder="0.00"><span class="op-input-suffix">USDT</span></div></div>
      <div class="op-group">
        <label class="op-label">Amount (USD)</label>
        <div class="op-input-wrap"><input class="op-input" type="number" id="tradeAmt" placeholder="0.00" oninput="calcOrderSummary()" min="1"><span class="op-input-suffix">USD</span></div>
        <div class="quick-pct-row"><button class="qp-btn" onclick="setTradePct(25)">25%</button><button class="qp-btn" onclick="setTradePct(50)">50%</button><button class="qp-btn" onclick="setTradePct(75)">75%</button><button class="qp-btn" onclick="setTradePct(100)">MAX</button></div>
      </div>
      <div class="op-group">
        <label class="op-label">Leverage <span class="op-leverage-val" id="leverageVal">10×</span></label>
        <input class="leverage-slider" type="range" id="leverageSlider" min="1" max="100" value="10" oninput="updateLeverage(this.value)">
        <div class="leverage-marks"><span onclick="document.getElementById('leverageSlider').value=1;updateLeverage(1)">1×</span><span onclick="document.getElementById('leverageSlider').value=5;updateLeverage(5)">5×</span><span onclick="document.getElementById('leverageSlider').value=10;updateLeverage(10)">10×</span><span onclick="document.getElementById('leverageSlider').value=25;updateLeverage(25)">25×</span><span onclick="document.getElementById('leverageSlider').value=50;updateLeverage(50)">50×</span><span onclick="document.getElementById('leverageSlider').value=100;updateLeverage(100)">100×</span></div>
      </div>
      <div class="tp-sl-row">
        <div class="op-group" style="flex:1;"><label class="op-label text-green">Take Profit</label><div class="op-input-wrap"><input class="op-input" type="number" id="takeProfit" placeholder="Optional" oninput="calcOrderSummary()"></div></div>
        <div class="op-group" style="flex:1;"><label class="op-label text-red">Stop Loss</label><div class="op-input-wrap"><input class="op-input" type="number" id="stopLoss" placeholder="Optional" oninput="calcOrderSummary()"></div></div>
      </div>
      <div class="order-summary">
        <div class="os-row"><span>Entry Price</span><span id="osEntry">—</span></div>
        <div class="os-row"><span>Position Size</span><span id="osPosition">—</span></div>
        <div class="os-row"><span>Margin Required</span><span id="osMargin">—</span></div>
        <div class="os-row"><span>Est. Profit (TP)</span><span id="osProfit" class="text-green">—</span></div>
        <div class="os-row"><span>Est. Loss (SL)</span><span id="osLoss" class="text-red">—</span></div>
        <div class="os-row"><span>Liquidation Price</span><span id="osLiq" style="color:var(--yellow)">—</span></div>
      </div>
      <div class="risk-warning" id="riskWarning" style="display:none;">⚠️ <span id="riskMsg">High leverage increases risk.</span></div>
      <button class="order-submit-btn buy" id="orderSubmitBtn" onclick="submitTrade()"><span id="orderSubmitText">▲ BUY / LONG</span></button>
      <div class="op-mode-row"><span style="font-size:11px;color:var(--text3);">Account:</span><button class="op-mode-btn active" id="opDemo" onclick="switchMode('demo');updateTradingPanel()">Demo</button><button class="op-mode-btn" id="opReal" onclick="switchMode('real');updateTradingPanel()">Real</button></div>
    </div>
    <div class="trade-right-col">
      <div class="mini-ob">
        <div class="mob-header">Order Book</div>
        <div class="ob-labels" style="font-size:9px;padding:4px 10px;"><span>Price</span><span style="text-align:center">Amt</span><span style="text-align:right">Total</span></div>
        <div id="miniObAsks" class="ob-asks" style="max-height:100px;"></div>
        <div class="ob-spread"><span id="miniSpreadPrice" class="ob-spread-price" style="font-size:12px;">—</span><span class="ob-spread-pct">Spread</span></div>
        <div id="miniObBids" class="ob-bids" style="max-height:100px;"></div>
      </div>
      <div class="my-positions">
        <div class="mob-header" style="display:flex;justify-content:space-between;align-items:center;">My Positions <span class="dc-badge" id="myPosCount">0</span></div>
        <div id="myPositionsList" style="overflow-y:auto;flex:1;"><div style="padding:16px;text-align:center;font-size:11px;color:var(--text3);">No open positions</div></div>
      </div>
      <div style="flex:1;overflow:hidden;display:flex;flex-direction:column;border-top:1px solid var(--border);">
        <div class="mob-header">Recent Closed</div>
        <div id="miniHistoryList" style="overflow-y:auto;flex:1;"><div style="padding:16px;text-align:center;font-size:11px;color:var(--text3);">No trades yet</div></div>
      </div>
    </div>
  </div>
</div>

<!-- ══════════════════════════ DEPOSIT LAYER ══════════════════════════ -->
<div id="depositLayer" class="layer">
  <nav class="navbar">
    <div class="nav-logo" onclick="showLayer('dashboardLayer')"><div class="nav-logo-mark">₿</div><div class="nav-logo-text">Crypto<span>Pro</span></div></div>
    <div class="nav-right"><button class="btn btn-outline" onclick="showLayer('dashboardLayer')">← Dashboard</button></div>
  </nav>
  <div style="max-width:600px;margin:40px auto;padding:0 20px;">
    <div class="dash-card">
      <div class="dc-header"><span class="dc-title">💰 Deposit Funds</span><span class="dc-badge" id="depositAvailBal">$0.00 available</span></div>
      <div style="background:linear-gradient(135deg,rgba(0,230,118,.12),rgba(0,200,83,.04));border:1px solid rgba(0,230,118,.25);border-radius:var(--r-xl);padding:16px;margin-bottom:20px;text-align:center;">
        <div style="font-size:12px;color:rgba(255,255,255,.7);margin-bottom:4px;">🎁 FIRST DEPOSIT BONUS</div>
        <div style="font-size:36px;font-weight:900;font-family:var(--font-mono);color:var(--yellow);">100% MATCH</div>
        <div style="font-size:12px;color:rgba(255,255,255,.6);margin-top:4px;">Deposit $100 → Trade with $200</div>
      </div>
      <div style="margin-bottom:20px;">
        <div class="op-label" style="margin-bottom:10px;">Payment Method</div>
        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;" id="depMethodGrid">
          <button class="dep-method-btn active" data-method="mpesa" onclick="selectDepMethod(this,'depMethodGrid')"><div style="font-size:24px;margin-bottom:4px;">📱</div><div style="font-size:12px;font-weight:700;">M-Pesa</div><div style="font-size:10px;color:var(--text3);">Instant</div></button>
          <button class="dep-method-btn" data-method="bank" onclick="selectDepMethod(this,'depMethodGrid')"><div style="font-size:24px;margin-bottom:4px;">🏦</div><div style="font-size:12px;font-weight:700;">Bank Transfer</div><div style="font-size:10px;color:var(--text3);">1–2 hrs</div></button>
          <button class="dep-method-btn" data-method="crypto" onclick="selectDepMethod(this,'depMethodGrid')"><div style="font-size:24px;margin-bottom:4px;">₿</div><div style="font-size:12px;font-weight:700;">USDT</div><div style="font-size:10px;color:var(--text3);">TRC-20</div></button>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Amount (USD)</label>
        <div class="input-wrap"><span class="input-icon">💵</span><input class="form-input" type="number" id="depositAmt" placeholder="Minimum $10" min="10" oninput="calcDepBonus()"></div>
        <div style="display:flex;gap:6px;margin-top:8px;">
          <button class="qp-btn" onclick="document.getElementById('depositAmt').value=50;calcDepBonus()">$50</button>
          <button class="qp-btn" onclick="document.getElementById('depositAmt').value=100;calcDepBonus()">$100</button>
          <button class="qp-btn" onclick="document.getElementById('depositAmt').value=250;calcDepBonus()">$250</button>
          <button class="qp-btn" onclick="document.getElementById('depositAmt').value=500;calcDepBonus()">$500</button>
          <button class="qp-btn" onclick="document.getElementById('depositAmt').value=1000;calcDepBonus()">$1,000</button>
        </div>
      </div>
      <div id="depBonusLine" style="display:none;background:var(--green3);border:1px solid rgba(0,230,118,.25);border-radius:var(--r-md);padding:10px 14px;margin-bottom:16px;font-size:13px;display:flex;justify-content:space-between;align-items:center;"><span>🎁 100% Welcome Bonus</span><span class="mono fw-bold text-green" id="depBonusAmt">+$0.00</span></div>
      <div id="depDetails" style="background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-lg);padding:16px;margin-bottom:16px;font-size:13px;color:var(--text2);line-height:1.9;">
        📱 <strong style="color:var(--text1)">M-Pesa Paybill:</strong> 123456<br>
        Account No: <strong style="color:var(--green)">Use your registered email</strong><br>
        <span style="font-size:11px;color:var(--text3);">Funds credited within 2 minutes</span>
      </div>
      <button class="btn-auth" id="depositBtn" onclick="submitDeposit()">💰 Deposit Now</button>
    </div>
  </div>
</div>

<!-- ══════════════════════════ WITHDRAW LAYER ══════════════════════════ -->
<div id="withdrawLayer" class="layer">
  <nav class="navbar">
    <div class="nav-logo" onclick="showLayer('dashboardLayer')"><div class="nav-logo-mark">₿</div><div class="nav-logo-text">Crypto<span>Pro</span></div></div>
    <div class="nav-right"><button class="btn btn-outline" onclick="showLayer('dashboardLayer')">← Dashboard</button></div>
  </nav>
  <div style="max-width:600px;margin:40px auto;padding:0 20px;">
    <div class="dash-card">
      <div class="dc-header"><span class="dc-title">💸 Withdraw Funds</span><span class="dc-badge" id="withdrawAvailBal">$0.00 available</span></div>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:20px;">
        <div style="background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-lg);padding:14px;text-align:center;"><div style="font-size:10px;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px;">Min Withdraw</div><div class="mono fw-bold text-green">$50.00</div></div>
        <div style="background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-lg);padding:14px;text-align:center;"><div style="font-size:10px;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px;">Fee</div><div class="mono fw-bold">2%</div></div>
        <div style="background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-lg);padding:14px;text-align:center;"><div style="font-size:10px;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px;">Processing</div><div class="mono fw-bold text-blue">5–30 min</div></div>
      </div>
      <div style="margin-bottom:20px;">
        <div class="op-label" style="margin-bottom:10px;">Withdrawal Method</div>
        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;" id="wdMethodGrid">
          <button class="dep-method-btn active" data-method="mpesa" onclick="selectDepMethod(this,'wdMethodGrid')"><div style="font-size:24px;margin-bottom:4px;">📱</div><div style="font-size:12px;font-weight:700;">M-Pesa</div><div style="font-size:10px;color:var(--text3);">5–15 min</div></button>
          <button class="dep-method-btn" data-method="bank" onclick="selectDepMethod(this,'wdMethodGrid')"><div style="font-size:24px;margin-bottom:4px;">🏦</div><div style="font-size:12px;font-weight:700;">Bank</div><div style="font-size:10px;color:var(--text3);">1–2 hrs</div></button>
          <button class="dep-method-btn" data-method="crypto" onclick="selectDepMethod(this,'wdMethodGrid')"><div style="font-size:24px;margin-bottom:4px;">₿</div><div style="font-size:12px;font-weight:700;">USDT</div><div style="font-size:10px;color:var(--text3);">10–30 min</div></button>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Amount (USD)</label>
        <div class="input-wrap"><span class="input-icon">💵</span><input class="form-input" type="number" id="withdrawAmt" placeholder="Minimum $50" min="50" oninput="calcWithdrawFee()"></div>
      </div>
      <div id="withdrawFeeBox" style="display:none;background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-md);padding:12px;margin-bottom:16px;font-size:12px;">
        <div style="display:flex;justify-content:space-between;padding:3px 0;"><span style="color:var(--text3)">Requested</span><span id="wfAmt" class="mono">—</span></div>
        <div style="display:flex;justify-content:space-between;padding:3px 0;"><span style="color:var(--text3)">Fee (2%)</span><span id="wfFee" class="mono text-red">—</span></div>
        <div style="display:flex;justify-content:space-between;padding:6px 0;border-top:1px solid var(--border);margin-top:4px;font-weight:700;"><span>You Receive</span><span id="wfNet" class="mono text-green">—</span></div>
      </div>
      <div class="form-group">
        <label class="form-label">Account / Phone Number</label>
        <div class="input-wrap"><span class="input-icon">📱</span><input class="form-input" type="text" id="withdrawAccount" placeholder="M-Pesa number / bank account / USDT address"></div>
      </div>
      <button class="btn-auth" id="withdrawBtn" onclick="submitWithdraw()">💸 Withdraw Now</button>
    </div>
  </div>
</div>

<!-- ══════════════════════════ BOTS LAYER ══════════════════════════ -->
<div id="botsLayer" class="layer">
  <nav class="navbar">
    <div class="nav-logo" onclick="showLayer('dashboardLayer')"><div class="nav-logo-mark">₿</div><div class="nav-logo-text">Crypto<span>Pro</span></div></div>
    <div class="nav-right"><div class="live-badge"><div class="live-dot"></div>LIVE</div><button class="btn btn-outline" onclick="showLayer('dashboardLayer')">← Dashboard</button></div>
  </nav>
  <div style="padding:24px;">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:24px;flex-wrap:wrap;gap:12px;">
      <div><h2 style="font-family:var(--font-display);font-size:24px;font-weight:800;margin-bottom:4px;">🤖 AI Trading Bots</h2><p style="color:var(--text2);font-size:13px;">Set-and-forget automation. Trade 24/7 while you sleep.</p></div>
      <div style="display:flex;gap:12px;">
        <div style="background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-lg);padding:12px 20px;text-align:center;"><div class="mono fw-bold text-green" style="font-size:20px;" id="botsActiveCount">0</div><div style="font-size:11px;color:var(--text3);">Active Bots</div></div>
        <div style="background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-lg);padding:12px 20px;text-align:center;"><div class="mono fw-bold text-yellow" style="font-size:20px;">91%</div><div style="font-size:11px;color:var(--text3);">Best Win Rate</div></div>
      </div>
    </div>
    <div class="bots-grid" id="botsGrid"></div>
  </div>
</div>

<!-- ══════════════════════════ HISTORY LAYER ══════════════════════════ -->
<div id="historyLayer" class="layer">
  <nav class="navbar">
    <div class="nav-logo" onclick="showLayer('dashboardLayer')"><div class="nav-logo-mark">₿</div><div class="nav-logo-text">Crypto<span>Pro</span></div></div>
    <div class="nav-right"><button class="btn btn-outline" onclick="showLayer('dashboardLayer')">← Dashboard</button></div>
  </nav>
  <div style="padding:24px;">
    <h2 style="font-family:var(--font-display);font-size:22px;font-weight:800;margin-bottom:20px;">📜 Trade History</h2>
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:24px;max-width:500px;">
      <div class="bal-card" style="padding:16px;text-align:center;"><div class="bc-label">Total P&L</div><div class="bc-amount" id="histTotalPnl" style="font-size:20px;">$0.00</div></div>
      <div class="bal-card" style="padding:16px;text-align:center;"><div class="bc-label">Win Rate</div><div class="bc-amount text-blue" id="histWinRate" style="font-size:20px;">—</div></div>
      <div class="bal-card" style="padding:16px;text-align:center;"><div class="bc-label">Total Trades</div><div class="bc-amount" id="histTotalTrades" style="font-size:20px;">0</div></div>
    </div>
    <div class="dash-card" style="overflow-x:auto;">
      <table style="width:100%;border-collapse:collapse;font-size:13px;">
        <thead><tr style="border-bottom:1px solid var(--border);">
          <th style="padding:8px 12px;text-align:left;color:var(--text3);font-size:10px;text-transform:uppercase;letter-spacing:.5px;">Result</th>
          <th style="padding:8px 12px;text-align:left;color:var(--text3);font-size:10px;text-transform:uppercase;letter-spacing:.5px;">Pair</th>
          <th style="padding:8px 12px;text-align:left;color:var(--text3);font-size:10px;text-transform:uppercase;letter-spacing:.5px;">Type</th>
          <th style="padding:8px 12px;text-align:left;color:var(--text3);font-size:10px;text-transform:uppercase;letter-spacing:.5px;">Amount</th>
          <th style="padding:8px 12px;text-align:left;color:var(--text3);font-size:10px;text-transform:uppercase;letter-spacing:.5px;">Leverage</th>
          <th style="padding:8px 12px;text-align:left;color:var(--text3);font-size:10px;text-transform:uppercase;letter-spacing:.5px;">P&L</th>
          <th style="padding:8px 12px;text-align:left;color:var(--text3);font-size:10px;text-transform:uppercase;letter-spacing:.5px;">Date</th>
        </tr></thead>
        <tbody id="historyTbody"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- ══════════════════════════ REFERRAL LAYER ══════════════════════════ -->
<div id="referralLayer" class="layer">
  <nav class="navbar">
    <div class="nav-logo" onclick="showLayer('dashboardLayer')"><div class="nav-logo-mark">₿</div><div class="nav-logo-text">Crypto<span>Pro</span></div></div>
    <div class="nav-right"><button class="btn btn-outline" onclick="showLayer('dashboardLayer')">← Dashboard</button></div>
  </nav>
  <div style="max-width:800px;margin:0 auto;padding:24px;">
    <h2 style="font-family:var(--font-display);font-size:22px;font-weight:800;margin-bottom:6px;">🎁 Referral Program</h2>
    <p style="color:var(--text2);margin-bottom:24px;">Earn <strong style="color:var(--green)">10% lifetime commission</strong> on every deposit your referrals make.</p>
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:24px;">
      <div class="bal-card primary" style="padding:18px;text-align:center;"><div class="bc-label">Total Earned</div><div class="bc-amount text-green" id="refTotalEarned" style="font-size:22px;">$0.00</div></div>
      <div class="bal-card" style="padding:18px;text-align:center;"><div class="bc-label">Referrals</div><div class="bc-amount text-blue" id="refTotalCount" style="font-size:22px;">0</div></div>
      <div class="bal-card" style="padding:18px;text-align:center;"><div class="bc-label">Commission Rate</div><div class="bc-amount text-yellow" style="font-size:22px;">10%</div></div>
    </div>
    <div class="dash-card" style="margin-bottom:16px;">
      <div class="dc-header"><span class="dc-title">Your Referral Link</span></div>
      <div style="background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-md);padding:12px 14px;font-family:var(--font-mono);font-size:12px;color:var(--green);word-break:break-all;margin-bottom:12px;" id="refLinkDisplay">Loading…</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;">
        <button class="btn btn-green" onclick="copyRefLink()">📋 Copy Link</button>
        <button class="btn btn-outline" onclick="shareRef('whatsapp')" style="color:#25D366;border-color:#25D36640;">💬 WhatsApp</button>
        <button class="btn btn-outline" onclick="shareRef('telegram')" style="color:#2CA5E0;border-color:#2CA5E040;">✈️ Telegram</button>
        <button class="btn btn-outline" onclick="shareRef('twitter')" style="color:#1DA1F2;border-color:#1DA1F240;">🐦 Twitter</button>
      </div>
    </div>
    <div class="dash-card" style="margin-bottom:16px;">
      <div class="dc-header"><span class="dc-title">How It Works</span></div>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;text-align:center;">
        <div style="padding:16px;background:var(--bg2);border-radius:var(--r-lg);"><div style="font-size:28px;margin-bottom:8px;">🔗</div><div style="font-weight:700;font-size:13px;margin-bottom:4px;">Share Your Link</div><div style="font-size:11px;color:var(--text2);">Send your unique referral link to friends</div></div>
        <div style="padding:16px;background:var(--bg2);border-radius:var(--r-lg);"><div style="font-size:28px;margin-bottom:8px;">👤</div><div style="font-weight:700;font-size:13px;margin-bottom:4px;">They Sign Up</div><div style="font-size:11px;color:var(--text2);">Friend gets $25 bonus, you earn $5</div></div>
        <div style="padding:16px;background:var(--bg2);border-radius:var(--r-lg);"><div style="font-size:28px;margin-bottom:8px;">💰</div><div style="font-weight:700;font-size:13px;margin-bottom:4px;">Earn Forever</div><div style="font-size:11px;color:var(--text2);">10% of every deposit they ever make</div></div>
      </div>
    </div>
    <div class="dash-card"><div class="dc-header"><span class="dc-title">Referral History</span></div><div id="refHistoryList"><div class="empty-state"><div style="font-size:40px;margin-bottom:8px;">👥</div><div style="color:var(--text2);font-weight:600;">No referrals yet</div><div style="font-size:12px;color:var(--text3);margin-top:4px;">Share your link to start earning</div></div></div></div>
  </div>
</div>

<!-- ══════════════════════════ PROFILE LAYER ══════════════════════════ -->
<div id="profileLayer" class="layer">
  <nav class="navbar">
    <div class="nav-logo" onclick="showLayer('dashboardLayer')"><div class="nav-logo-mark">₿</div><div class="nav-logo-text">Crypto<span>Pro</span></div></div>
    <div class="nav-right"><button class="btn btn-outline" onclick="showLayer('dashboardLayer')">← Dashboard</button></div>
  </nav>
  <div style="max-width:600px;margin:40px auto;padding:0 20px;display:flex;flex-direction:column;gap:16px;">
    <div class="dash-card">
      <div class="dc-header"><span class="dc-title">⚙️ Profile Settings</span></div>
      <div style="text-align:center;padding:20px 0;border-bottom:1px solid var(--border);margin-bottom:20px;">
        <div style="width:72px;height:72px;border-radius:50%;background:linear-gradient(135deg,var(--green),var(--blue));display:flex;align-items:center;justify-content:center;font-size:32px;margin:0 auto 12px;">👤</div>
        <div style="font-family:var(--font-display);font-size:18px;font-weight:800;" id="profDisplayName">—</div>
        <div style="font-size:12px;color:var(--text3);margin-top:2px;">Member since: <span id="profJoined">—</span></div>
        <div style="margin-top:10px;display:inline-flex;align-items:center;gap:6px;background:var(--green3);border:1px solid rgba(0,230,118,.2);border-radius:20px;padding:4px 14px;font-size:11px;font-weight:700;color:var(--green);">✅ ACTIVE ACCOUNT</div>
      </div>
      <div class="form-group"><label class="form-label">Full Name</label><div class="input-wrap"><span class="input-icon">👤</span><input class="form-input" type="text" id="profName" placeholder="Your full name"></div></div>
      <div class="form-group"><label class="form-label">Email Address</label><div class="input-wrap"><span class="input-icon">✉️</span><input class="form-input" type="email" id="profEmail" placeholder="you@email.com"></div></div>
      <div class="form-group"><label class="form-label">Phone Number</label><div class="input-wrap"><span class="input-icon">📱</span><input class="form-input" type="tel" id="profPhone" placeholder="+254 712 345 678"></div></div>
      <button class="btn-auth" onclick="saveProfile()">💾 Save Changes</button>
    </div>
    <div class="dash-card">
      <div class="dc-header"><span class="dc-title">🔐 Security</span></div>
      <div style="display:flex;flex-direction:column;gap:10px;">
        <div style="display:flex;justify-content:space-between;align-items:center;padding:12px;background:var(--bg2);border-radius:var(--r-md);"><div><div style="font-weight:600;font-size:13px;">Two-Factor Auth (2FA)</div><div style="font-size:11px;color:var(--text3);">Adds extra security to your account</div></div><div style="color:var(--green);font-size:12px;font-weight:700;">✅ ENABLED</div></div>
        <div style="display:flex;justify-content:space-between;align-items:center;padding:12px;background:var(--bg2);border-radius:var(--r-md);"><div><div style="font-weight:600;font-size:13px;">Change Password</div><div style="font-size:11px;color:var(--text3);">Last changed: Never</div></div><button class="btn btn-outline" style="font-size:12px;" onclick="showToast('Password reset link sent to your email','blue')">Reset</button></div>
        <div style="display:flex;justify-content:space-between;align-items:center;padding:12px;background:var(--bg2);border-radius:var(--r-md);"><div><div style="font-weight:600;font-size:13px;">Referral Code</div><div style="font-size:11px;font-family:var(--font-mono);color:var(--green);margin-top:2px;" id="profRefCode">—</div></div><button class="btn btn-outline" style="font-size:12px;" onclick="copyRefLink()">📋 Copy</button></div>
        <div style="display:flex;justify-content:space-between;align-items:center;padding:12px;background:var(--bg2);border-radius:var(--r-md);"><div><div style="font-weight:600;font-size:13px;">KYC Verification</div><div style="font-size:11px;color:var(--text3);">Required for withdrawals over $1,000</div></div><button class="btn btn-outline" style="font-size:12px;color:var(--yellow);border-color:rgba(255,215,64,.3);" onclick="showToast('Contact support via AI assistant to begin KYC','blue')">Verify</button></div>
      </div>
    </div>
    <div class="dash-card">
      <div class="dc-header"><span class="dc-title" style="color:var(--red);">🔴 Account</span></div>
      <button class="btn btn-outline" style="width:100%;color:var(--red);border-color:rgba(255,61,87,.3);" onclick="if(confirm('Log out of CryptoPro?'))handleLogout()">🚪 Logout</button>
    </div>
  </div>
</div>

<script>
// ============================================================
// GLOBAL STATE
// ============================================================
let currentUser  = null;
let currentLayer = 'welcomeLayer';
let aiOpen       = false;
let dashMode     = 'demo';
let perfPeriod   = '7d';

const PAIR_PRICES = {BTC:98450,ETH:3456,BNB:542,SOL:189,ADA:0.612,XRP:0.784,AVAX:38.6,DOT:8.34};

const COINS = [
  {sym:'BTC/USDT',price:98450,chg:+2.45},{sym:'ETH/USDT',price:3456,chg:+1.23},
  {sym:'BNB/USDT',price:542,chg:-0.45},{sym:'SOL/USDT',price:189,chg:+5.67},
  {sym:'ADA/USDT',price:0.612,chg:+3.21},{sym:'XRP/USDT',price:0.784,chg:-1.12},
  {sym:'DOT/USDT',price:8.34,chg:+2.88},{sym:'AVAX/USDT',price:38.6,chg:+4.15},
  {sym:'MATIC/USDT',price:0.923,chg:-0.78},{sym:'LINK/USDT',price:14.72,chg:+1.56},
];

const TRADER_NAMES=['Sarah K.','John M.','Michael O.','Emma W.','David L.','Lisa T.','James R.','Maria G.','Robert H.','Jennifer P.','William S.','Patricia B.','Richard M.','Linda C.','Charles N.','Grace W.','Peter K.','Lucy A.'];
const FLAGS=['🇰🇪','🇳🇬','🇬🇧','🇺🇸','🇦🇪','🇦🇺','🇫🇷','🇩🇪','🇨🇦','🇧🇷','🇿🇦','🇮🇳'];
const EMOJIS=['💎','🚀','⭐','🔥','✨','💫','⚡','🌟'];

// ============================================================
// LAYER NAVIGATION
// ============================================================
function showLayer(id){
  document.querySelectorAll('.layer').forEach(l=>l.classList.remove('active'));
  const el=document.getElementById(id);
  if(el){el.classList.add('active');currentLayer=id;}
  window.scrollTo(0,0);
  if(id==='chartsLayer')    setTimeout(initChartsLayer,80);
  if(id==='dashboardLayer') initDashboard();
  if(id==='tradingLayer')   initTradingLayer();
  if(id==='depositLayer')   initDepositLayer();
  if(id==='withdrawLayer')  initWithdrawLayer();
  if(id==='botsLayer')      buildBots();
  if(id==='historyLayer')   buildHistory();
  if(id==='referralLayer')  buildReferral();
  if(id==='profileLayer')   buildProfile();
}

// ============================================================
// TOAST
// ============================================================
function showToast(msg,type='green',dur=4500){
  const t=document.getElementById('toast');
  t.textContent=msg; t.className=`toast-${type} show`;
  clearTimeout(t._t); t._t=setTimeout(()=>t.classList.remove('show'),dur);
}

// ============================================================
// REFERRAL BANNER
// ============================================================
function checkReferral(){
  const p=new URLSearchParams(window.location.search);
  const ref=p.get('ref'),name=p.get('name');
  if(ref){
    const inp=document.getElementById('signupReferralCode'); if(inp) inp.value=ref;
    if(name){document.getElementById('refName').textContent=decodeURIComponent(name);document.getElementById('refBanner').classList.add('show');}
  }
}
function closeRefBanner(){document.getElementById('refBanner').classList.remove('show');}

// ============================================================
// TICKERS
// ============================================================
function fmtPrice(p){return p>=100?'$'+p.toFixed(2):p>=1?'$'+p.toFixed(3):'$'+p.toFixed(4);}

function buildTickers(){
  const doubled=[...COINS,...COINS];
  let html='';
  doubled.forEach(c=>{const cls=c.chg>=0?'nt-up':'nt-dn',sign=c.chg>=0?'+':'';html+=`<div class="nt-item"><span class="nt-sym">${c.sym}</span><span class="nt-price">${fmtPrice(c.price)}</span><span class="nt-chg ${cls}">${sign}${c.chg.toFixed(2)}%</span></div>`;});
  ['navTickerTrack','chartNavTicker','tradeNavTicker','dashNavTicker'].forEach(id=>{const el=document.getElementById(id);if(el)el.innerHTML=html;});
  let mb=''; doubled.forEach(c=>{const cls=c.chg>=0?'nt-up':'nt-dn',sign=c.chg>=0?'+':'';mb+=`<div class="mb-item"><span class="mb-sym">${c.sym}</span><span class="mb-price">${fmtPrice(c.price)}</span><span class="mb-chg ${cls}">${sign}${c.chg.toFixed(2)}%</span></div>`;});
  ['marketBarTrack','dashMarketBar'].forEach(id=>{const el=document.getElementById(id);if(el)el.innerHTML=mb;});
}

function updateTickerPrices(){
  COINS.forEach(c=>{c.price*=1+(Math.random()-0.499)*0.002;c.chg+=(Math.random()-0.5)*0.15;});
  buildTickers();
}

// ============================================================
// LIVE TRADERS
// ============================================================
function buildLiveTraders(){
  const track=document.getElementById('tradersTrack'); if(!track) return;
  let html='';
  for(let i=0;i<40;i++){
    const name=TRADER_NAMES[Math.floor(Math.random()*TRADER_NAMES.length)];
    const flag=FLAGS[Math.floor(Math.random()*FLAGS.length)];
    const emoji=EMOJIS[Math.floor(Math.random()*EMOJIS.length)];
    const profit=(Math.random()*600+50).toFixed(2);
    const mins=Math.floor(Math.random()*58)+1;
    html+=`<div class="trader-chip"><div class="trader-avatar">${emoji}</div><div><div class="trader-name">${name} ${flag}</div><div class="trader-profit">+$${profit}</div><div class="trader-time">${mins}m ago</div></div></div>`;
  }
  track.innerHTML=html;
}

// ============================================================
// TOP WINNERS
// ============================================================
const WINNERS=[
  {name:'Alex Thompson',loc:'Nairobi, Kenya',flag:'🇰🇪',emoji:'👑',profit:'12,450',trades:'847',rank:1},
  {name:'Sarah Johnson',loc:'Lagos, Nigeria',flag:'🇳🇬',emoji:'⭐',profit:'10,230',trades:'692',rank:2},
  {name:'David Chen',loc:'London, UK',flag:'🇬🇧',emoji:'💎',profit:'9,875',trades:'618',rank:3},
  {name:'Maria Garcia',loc:'Dubai, UAE',flag:'🇦🇪',emoji:'🚀',profit:'8,650',trades:'571',rank:4},
  {name:'James Wilson',loc:'New York, USA',flag:'🇺🇸',emoji:'✨',profit:'7,920',trades:'534',rank:5},
  {name:'Emma Brown',loc:'Sydney, Australia',flag:'🇦🇺',emoji:'🔥',profit:'7,340',trades:'489',rank:6},
];

function buildWinners(){
  const g=document.getElementById('winnersGrid'); if(!g) return;
  g.innerHTML=WINNERS.map(w=>`<div class="winner-card"><div class="winner-rank">#${w.rank}</div><div class="winner-head"><div class="winner-ava">${w.emoji}</div><div><div class="winner-name">${w.name}</div><div class="winner-loc">${w.flag} ${w.loc}</div></div></div><div class="winner-stats"><div class="winner-stat"><div class="ws-val">$${w.profit}</div><div class="ws-lbl">Profit</div></div><div class="winner-stat"><div class="ws-val">${w.trades}</div><div class="ws-lbl">Trades</div></div></div></div>`).join('');
}

// ============================================================
// REVIEWS
// ============================================================
const REVIEWS=[
  {name:'Michael Roberts',loc:'Nairobi, Kenya',flag:'🇰🇪',stars:5,text:"Best platform I've used! Made $5,000 in my first month.",date:'2 days ago'},
  {name:'Sarah Mitchell',loc:'Mombasa, Kenya',flag:'🇰🇪',stars:5,text:'Finally a platform that actually pays! Withdrew $3,500 yesterday — received within 15 minutes.',date:'5 days ago'},
  {name:'David Kimani',loc:'Kisumu, Kenya',flag:'🇰🇪',stars:5,text:'Started with $100, now at $2,800! The Scalper Pro bot is amazing!',date:'1 week ago'},
  {name:'Grace Wanjiku',loc:'Nakuru, Kenya',flag:'🇰🇪',stars:5,text:"Easiest money I've ever made. Withdrawals are super fast.",date:'1 week ago'},
  {name:'John Ochieng',loc:'Eldoret, Kenya',flag:'🇰🇪',stars:5,text:"Been trading 3 months, consistent profits every week. I've referred 5 friends.",date:'2 weeks ago'},
  {name:'Lucy Akinyi',loc:'Nairobi, Kenya',flag:'🇰🇪',stars:5,text:'Withdrew over $10,000 so far. No issues at all. Thank you CryptoPro!',date:'2 weeks ago'},
];

function buildReviews(){
  const g=document.getElementById('reviewsGrid'); if(!g) return;
  g.innerHTML=REVIEWS.map(r=>`<div class="review-card"><div class="review-head"><div class="review-ava">👤</div><div><div class="review-name">${r.name}</div><div class="review-loc">${r.flag} ${r.loc}</div><div class="review-stars">${'★'.repeat(r.stars)}</div></div></div><div class="review-body">"${r.text}"</div><div style="display:flex;align-items:center;justify-content:space-between;margin-top:10px;"><span class="review-badge">✓ VERIFIED</span><span style="font-size:11px;color:var(--text3)">${r.date}</span></div></div>`).join('');
}

// ============================================================
// AI ASSISTANT
// ============================================================
const AI_KB={
  'start trading':'To start trading:\n1️⃣ Create a free account\n2️⃣ Get $25 demo bonus\n3️⃣ Practice on DEMO mode\n4️⃣ Deposit to go REAL\n5️⃣ Execute your first trade!\n\nWould you like me to walk you through any step?',
  'leverage':'📊 Leverage lets you control a larger position with less capital.\n\nExample: $100 with 10x leverage = $1,000 position.\n\n⚠️ Higher leverage = higher profit AND higher risk. We recommend 5–10x for beginners.',
  'deposit':'💰 Depositing is easy:\n\n• M-Pesa (Paybill: 123456)\n• Bank Transfer (Equity Bank)\n• USDT Crypto (TRC-20)\n\nMinimum: $10 | First deposit gets 100% BONUS!',
  'withdraw':'💸 Withdrawals processed in 5–30 minutes.\n\n• Minimum: $50\n• Methods: M-Pesa, Bank Transfer, USDT\n• Fee: 2%\n\nGo to Dashboard → Withdraw.',
  'ai bots':'🤖 Our AI bots trade automatically 24/7!\n\n• Scalper Pro — 87% win rate, +3.2% daily\n• Trend Master — 82% win rate, +2.8% daily\n• Grid Trader — 79% win rate, +2.5% daily\n• Arbitrage AI — 91% win rate, +4.1% daily\n\nActivate from Dashboard → AI Bots.',
  'referral':'🎁 Referral Program:\n\n• Earn 10% on every deposit forever\n• $25 bonus per signup\n• $5 per share\n\nFind your link in Dashboard → Referrals.',
  'hello':'👋 Hello! I\'m your CryptoPro AI assistant. Ask me anything about trading, bots, deposits, or your account!',
  'default':'🤔 Great question! For the most accurate answer try:\n• Visiting our FAQ section\n• Using live chat with our support team\n\nIs there something specific I can help you with?'
};

function toggleAI(){
  aiOpen=!aiOpen;
  const p=document.getElementById('aiPanel');
  if(aiOpen)p.classList.add('open'); else p.classList.remove('open');
}

function addAIMsg(text,role='bot'){
  const msgs=document.getElementById('aiMessages');
  const div=document.createElement('div');
  div.className=`ai-msg ${role}`;
  div.textContent=text;
  msgs.appendChild(div);
  msgs.scrollTop=msgs.scrollHeight;
}

function sendAI(){
  const inp=document.getElementById('aiInput');
  const msg=inp.value.trim();
  if(!msg) return;
  addAIMsg(msg,'user');
  inp.value='';
  
  // Show typing indicator
  const msgs=document.getElementById('aiMessages');
  const typing=document.createElement('div');
  typing.className='ai-msg bot';
  typing.innerHTML='<div class="ai-typing-dots"><span></span><span></span><span></span></div>';
  msgs.appendChild(typing);
  msgs.scrollTop=msgs.scrollHeight;
  
  setTimeout(()=>{
    msgs.removeChild(typing);
    const lower=msg.toLowerCase();
    let reply=AI_KB.default;
    for(const key in AI_KB){
      if(lower.includes(key)){reply=AI_KB[key];break;}
    }
    addAIMsg(reply,'bot');
  },900+Math.random()*600);
}

function aiQuick(q){
  document.getElementById('aiInput').value=q;
  sendAI();
}

// ============================================================
// AUTH
// ============================================================
let signupStep=1;
let signupData={};

function signupNext(step){
  if(step===1){
    const name=document.getElementById('signupName').value.trim();
    const email=document.getElementById('signupEmail').value.trim();
    const phone=document.getElementById('signupPhone').value.trim();
    if(!name||!email||!phone){showSignupAlert('Please fill in all fields.','error');return;}
    signupData.name=name;signupData.email=email;signupData.phone=phone;
    document.getElementById('signupStep1').style.display='none';
    document.getElementById('signupStep2').style.display='block';
    document.getElementById('spFill').style.width='66%';
    document.getElementById('sp1').classList.remove('active');
    document.getElementById('sp2').classList.add('active');
    hideSignupAlert();
  } else if(step===2){
    const pwd=document.getElementById('signupPassword').value;
    const confirm=document.getElementById('signupConfirm').value;
    if(pwd.length<8){showSignupAlert('Password must be at least 8 characters.','error');return;}
    if(pwd!==confirm){showSignupAlert('Passwords do not match.','error');return;}
    signupData.password=pwd;
    signupData.referralCode=document.getElementById('signupReferralCode').value.trim();
    document.getElementById('confirmName').textContent=signupData.name;
    document.getElementById('confirmEmail').textContent=signupData.email;
    document.getElementById('confirmPhone').textContent=signupData.phone;
    document.getElementById('confirmRef').textContent=signupData.referralCode||'None';
    document.getElementById('signupStep2').style.display='none';
    document.getElementById('signupStep3').style.display='block';
    document.getElementById('spFill').style.width='100%';
    document.getElementById('sp2').classList.remove('active');
    document.getElementById('sp3').classList.add('active');
    hideSignupAlert();
  }
}

function signupBack(step){
  if(step===2){
    document.getElementById('signupStep2').style.display='none';
    document.getElementById('signupStep1').style.display='block';
    document.getElementById('spFill').style.width='33%';
    document.getElementById('sp2').classList.remove('active');
    document.getElementById('sp1').classList.add('active');
  } else if(step===3){
    document.getElementById('signupStep3').style.display='none';
    document.getElementById('signupStep2').style.display='block';
    document.getElementById('spFill').style.width='66%';
    document.getElementById('sp3').classList.remove('active');
    document.getElementById('sp2').classList.add('active');
  }
}

function showSignupAlert(msg,type){
  const a=document.getElementById('signupAlert');
  a.textContent=msg; a.className=`form-alert ${type}`; a.style.display='block';
}
function hideSignupAlert(){document.getElementById('signupAlert').style.display='none';}

function handleSignup(e){
  e.preventDefault();
  if(!document.getElementById('agreeTerms').checked){showSignupAlert('Please agree to the Terms of Service.','error');return;}
  const btn=document.getElementById('signupBtn');
  document.getElementById('signupBtnText').style.display='none';
  document.getElementById('signupBtnSpinner').style.display='inline-block';
  btn.disabled=true;
  setTimeout(()=>{
    const refCode='CP'+Math.random().toString(36).substr(2,6).toUpperCase();
    currentUser={
      name:signupData.name,email:signupData.email,phone:signupData.phone,
      refCode,demoBalance:25,realBalance:0,deposits:0,profit:0,
      trades:[],openPositions:[],joinDate:new Date().toLocaleDateString(),
      referrals:[],referralEarnings:0
    };
    showToast(`🎉 Welcome, ${currentUser.name}! Your $25 demo bonus has been credited!`,'green',5000);
    showLayer('dashboardLayer');
  },2200);
}

let loginStep=1;
function handleLogin(e){
  e.preventDefault();
  const email=document.getElementById('loginEmail').value.trim();
  const pwd=document.getElementById('loginPassword').value;
  if(!email||!pwd){showLoginAlert('Please fill in all fields.','error');return;}

  if(loginStep===1){
    document.getElementById('loginBtnText').style.display='none';
    document.getElementById('loginBtnSpinner').style.display='inline-block';
    setTimeout(()=>{
      document.getElementById('loginBtnText').style.display='inline';
      document.getElementById('loginBtnSpinner').style.display='none';
      document.getElementById('twoFAStep').style.display='block';
      document.getElementById('loginBtnText').textContent='Verify Code →';
      loginStep=2;
      hideLoginAlert();
    },1400);
    return false;
  }

  if(loginStep===2){
    const otp=Array.from(document.querySelectorAll('.otp-input')).map(i=>i.value).join('');
    if(otp!=='123456'){showLoginAlert('Invalid 2FA code. Demo code is 123456.','error');return false;}
    document.getElementById('loginBtnText').style.display='none';
    document.getElementById('loginBtnSpinner').style.display='inline-block';
    setTimeout(()=>{
      const refCode='CP'+Math.random().toString(36).substr(2,6).toUpperCase();
      currentUser={
        name:email.split('@')[0],email,phone:'+254 700 000 000',
        refCode,demoBalance:25,realBalance:0,deposits:0,profit:0,
        trades:[],openPositions:[],joinDate:new Date().toLocaleDateString(),
        referrals:[],referralEarnings:0
      };
      showToast(`Welcome back! Logged in as ${currentUser.name}`,'green');
      loginStep=1;
      showLayer('dashboardLayer');
    },1200);
  }
  return false;
}

function showLoginAlert(msg,type){
  const a=document.getElementById('loginAlert');
  a.textContent=msg; a.className=`form-alert ${type}`; a.style.display='block';
}
function hideLoginAlert(){document.getElementById('loginAlert').style.display='none';}

function handleLogout(){
  currentUser=null; dashMode='demo';
  showLayer('welcomeLayer');
  showToast('You have been logged out.','blue');
}

function togglePwd(id,btn){
  const inp=document.getElementById(id);
  if(inp.type==='password'){inp.type='text';btn.textContent='🙈';}
  else{inp.type='password';btn.textContent='👁';}
}

function otpNext(el,idx){
  if(el.value.length===1){
    const inputs=document.querySelectorAll('.otp-input');
    if(inputs[idx+1])inputs[idx+1].focus();
  }
}

function checkPasswordStrength(pwd){
  const fill=document.getElementById('pwdFill');
  const label=document.getElementById('pwdLabel');
  let score=0;
  if(pwd.length>=8)score++;
  if(/[A-Z]/.test(pwd))score++;
  if(/[0-9]/.test(pwd))score++;
  if(/[^A-Za-z0-9]/.test(pwd))score++;
  const levels=[
    {w:'0%',c:'transparent',t:''},
    {w:'25%',c:'var(--red)',t:'Weak'},
    {w:'50%',c:'var(--yellow)',t:'Fair'},
    {w:'75%',c:'var(--blue)',t:'Good'},
    {w:'100%',c:'var(--green)',t:'Strong'},
  ];
  const lv=levels[score]||levels[0];
  fill.style.width=lv.w; fill.style.background=lv.c;
  label.textContent=lv.t; label.style.color=lv.c;
}

// ============================================================
// DYNAMIC TRADERS — fully unique, never repeating
// ============================================================
const FIRST_NAMES=['James','Sarah','Michael','Emma','David','Lisa','Robert','Jennifer','William','Grace','Peter','Lucy','Daniel','Hannah','Samuel','Amina','Kevin','Aisha','Patrick','Fatima','Brian','Zoe','Eric','Chloe','Felix','Naomi','Victor','Diana','Oscar','Nina','George','Stella','Henry','Ivy','Charles','Jade','Arthur','Lena','Marcus','Vera','Jerome','Clara','Moses','Lydia','Isaac','Elena','Elijah','Maya','Caleb','Sofia'];
const LAST_NAMES=['Kimani','Ochieng','Wanjiku','Mwangi','Otieno','Njoroge','Kamau','Akinyi','Owino','Chebet','Mutua','Wambua','Karanja','Njenga','Gitau','Oduya','Adeyemi','Balogun','Chukwu','Nwosu','Thompson','Johnson','Williams','Brown','Jones','Garcia','Martinez','Davis','Wilson','Anderson','Taylor','Thomas','Moore','Harris','Jackson','White','Lee','Clark','Lewis','Walker','Hall','Allen','Young','King','Wright','Scott','Torres','Nguyen','Patel','Ahmed'];
const COUNTRIES=[
  {flag:'🇰🇪',loc:'Nairobi, Kenya'},{flag:'🇰🇪',loc:'Mombasa, Kenya'},{flag:'🇰🇪',loc:'Kisumu, Kenya'},
  {flag:'🇳🇬',loc:'Lagos, Nigeria'},{flag:'🇳🇬',loc:'Abuja, Nigeria'},{flag:'🇿🇦',loc:'Johannesburg, SA'},
  {flag:'🇬🇭',loc:'Accra, Ghana'},{flag:'🇺🇬',loc:'Kampala, Uganda'},{flag:'🇹🇿',loc:'Dar es Salaam, TZ'},
  {flag:'🇬🇧',loc:'London, UK'},{flag:'🇺🇸',loc:'New York, USA'},{flag:'🇺🇸',loc:'Miami, USA'},
  {flag:'🇦🇪',loc:'Dubai, UAE'},{flag:'🇦🇺',loc:'Sydney, Australia'},{flag:'🇨🇦',loc:'Toronto, Canada'},
  {flag:'🇮🇳',loc:'Mumbai, India'},{flag:'🇫🇷',loc:'Paris, France'},{flag:'🇩🇪',loc:'Berlin, Germany'},
];
const TRADE_TYPES=['BTC/USDT','ETH/USDT','SOL/USDT','BNB/USDT','XRP/USDT','ADA/USDT','AVAX/USDT','DOT/USDT'];
const TRADER_EMOJIS=['💎','🚀','⭐','🔥','✨','💫','⚡','🌟','👑','🎯','💪','🏆','🦁','🐉','🎪'];

// Seeded shuffle to ensure uniqueness
function shuffleArr(arr){
  const a=[...arr];
  for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}
  return a;
}

// Generate a large unique pool of traders
function generateTraderPool(count){
  const used=new Set();
  const pool=[];
  const fns=shuffleArr(FIRST_NAMES);
  const lns=shuffleArr(LAST_NAMES);
  let fi=0,li=0;
  while(pool.length<count){
    const fn=fns[fi%fns.length];
    const ln=lns[li%lns.length];
    fi++;li++;
    const key=fn+ln;
    if(used.has(key)){li++;continue;}
    used.add(key);
    const country=COUNTRIES[Math.floor(Math.random()*COUNTRIES.length)];
    const emoji=TRADER_EMOJIS[Math.floor(Math.random()*TRADER_EMOJIS.length)];
    const profit=(Math.random()*1800+30).toFixed(2);
    const pair=TRADE_TYPES[Math.floor(Math.random()*TRADE_TYPES.length)];
    const mins=Math.floor(Math.random()*58)+1;
    const leverage=([2,5,10,20,25,50][Math.floor(Math.random()*6)]);
    const pct=(Math.random()*18+1.5).toFixed(1);
    pool.push({name:`${fn} ${ln}`,flag:country.flag,loc:country.loc,emoji,profit,pair,mins,leverage,pct});
  }
  return pool;
}

let _traderPool=[];
let _winnerPool=[];

function buildLiveTradersPool(){
  _traderPool=generateTraderPool(80);
  const track=document.getElementById('tradersTrack');
  if(!track) return;
  // Use all 80 unique traders, duplicated once for seamless scroll
  let html='';
  [..._traderPool,..._traderPool].forEach(t=>{
    html+=`<div class="trader-chip">
      <div class="trader-avatar">${t.emoji}</div>
      <div>
        <div class="trader-name">${t.name} ${t.flag}</div>
        <div class="trader-profit">+$${t.profit} · ${t.pair} ${t.leverage}×</div>
        <div class="trader-time">${t.mins}m ago · +${t.pct}%</div>
      </div>
    </div>`;
  });
  track.innerHTML=html;
}

function buildWinnersPool(){
  // Generate unique winner set separate from live traders
  const pool=generateTraderPool(6);
  // Sort by profit desc
  pool.sort((a,b)=>parseFloat(b.profit)-parseFloat(a.profit));
  _winnerPool=pool;
  const RANK_EMOJIS=['👑','🥈','🥉','🎯','⭐','💫'];
  const g=document.getElementById('winnersGrid');
  if(!g) return;
  g.innerHTML=pool.map((w,i)=>{
    const totalProfit=(parseFloat(w.profit)*8+Math.random()*3000).toFixed(0);
    const trades=Math.floor(Math.random()*600+200);
    const winRate=Math.floor(Math.random()*15+75);
    return `<div class="winner-card">
      <div class="winner-rank">#${i+1}</div>
      <div class="winner-head">
        <div class="winner-ava">${RANK_EMOJIS[i]}</div>
        <div><div class="winner-name">${w.name}</div><div class="winner-loc">${w.flag} ${w.loc}</div></div>
      </div>
      <div class="winner-stats">
        <div class="winner-stat"><div class="ws-val">$${parseInt(totalProfit).toLocaleString()}</div><div class="ws-lbl">Profit</div></div>
        <div class="winner-stat"><div class="ws-val">${trades}</div><div class="ws-lbl">Trades</div></div>
        <div class="winner-stat"><div class="ws-val">${winRate}%</div><div class="ws-lbl">Win Rate</div></div>
        <div class="winner-stat"><div class="ws-val">${w.leverage}×</div><div class="ws-lbl">Top Lev</div></div>
      </div>
    </div>`;
  }).join('');
}

// Refresh traders every 45s with new unique set
function startTraderRefresh(){
  buildLiveTradersPool();
  buildWinnersPool();
  setInterval(()=>{
    buildLiveTradersPool();
  },45000);
  setInterval(()=>{
    buildWinnersPool();
  },90000);
}

// ============================================================
// LOGIN PAGE LIVE MESSAGES
// ============================================================
const LOGIN_LIVE_MSGS=[
  ()=>{const t=generateTraderPool(1)[0];return `🎉 <strong style="color:var(--text1)">${t.name}</strong> just withdrew <strong style="color:var(--green)">$${(Math.random()*3000+200).toFixed(0)}</strong>`;},
  ()=>{const t=generateTraderPool(1)[0];return `⚡ <strong style="color:var(--text1)">${t.name}</strong> made <strong style="color:var(--green)">+${(Math.random()*18+2).toFixed(1)}%</strong> on ${TRADE_TYPES[Math.floor(Math.random()*TRADE_TYPES.length)]}`;},
  ()=>{const t=generateTraderPool(1)[0];return `🤖 <strong style="color:var(--text1)">${t.name}</strong>'s AI bot earned <strong style="color:var(--green)">$${(Math.random()*800+50).toFixed(0)}</strong> today`;},
  ()=>{const t=generateTraderPool(1)[0];return `💰 <strong style="color:var(--text1)">${t.name}</strong> deposited <strong style="color:var(--blue)">$${[100,250,500,1000][Math.floor(Math.random()*4)]}</strong>`;},
  ()=>{const t=generateTraderPool(1)[0];return `🎯 <strong style="color:var(--text1)">${t.name}</strong> opened a ${['BTC','ETH','SOL'][Math.floor(Math.random()*3)]}/USDT trade at ${[10,20,50,100][Math.floor(Math.random()*4)]}× leverage`;},
];
let liveIdx=0;
function rotateLiveMsg(){
  const el=document.getElementById('loginLiveMsg');
  if(!el) return;
  const fn=LOGIN_LIVE_MSGS[liveIdx%LOGIN_LIVE_MSGS.length];
  el.innerHTML=fn(); liveIdx++;
}

// ============================================================
// CHARTS
// ============================================================
let currentPair='BTC';
let currentQuote='USDT';
let chartInterval='1m';
let indicators={ma:true,bb:true,vol:true,rsi:false};
let chartType='candle';
let candleData=[];
let obInterval=null;
let tradeInterval=null;
let priceInterval=null;

function generateCandles(base,count=80){
  const candles=[];
  let price=base*(0.97+Math.random()*0.06);
  const now=Date.now();
  const intervalMs={'1m':60000,'5m':300000,'15m':900000,'1h':3600000,'4h':14400000,'1d':86400000};
  const ms=intervalMs[chartInterval]||60000;
  for(let i=0;i<count;i++){
    const open=price;
    const change=(Math.random()-0.48)*base*0.008;
    const close=open+change;
    const high=Math.max(open,close)+(Math.random()*base*0.003);
    const low=Math.min(open,close)-(Math.random()*base*0.003);
    const vol=Math.random()*base*0.5+base*0.1;
    candles.push({open,high,low,close,vol,time:now-(count-i)*ms});
    price=close;
  }
  return candles;
}

function calcMA(data,period=20){
  return data.map((_,i)=>{
    if(i<period-1)return null;
    const slice=data.slice(i-period+1,i+1);
    return slice.reduce((s,c)=>s+c.close,0)/period;
  });
}

function calcBB(data,period=20){
  const ma=calcMA(data,period);
  return data.map((_,i)=>{
    if(ma[i]===null)return null;
    const slice=data.slice(i-period+1,i+1);
    const sd=Math.sqrt(slice.reduce((s,c)=>s+(c.close-ma[i])**2,0)/period);
    return{upper:ma[i]+2*sd,lower:ma[i]-2*sd,mid:ma[i]};
  });
}

function calcRSI(data,period=14){
  const rsi=[];
  for(let i=0;i<data.length;i++){
    if(i<period){rsi.push(null);continue;}
    let gains=0,losses=0;
    for(let j=i-period+1;j<=i;j++){
      const diff=data[j].close-data[j-1].close;
      if(diff>=0)gains+=diff;else losses-=diff;
    }
    const rs=losses===0?100:gains/losses;
    rsi.push(100-100/(1+rs));
  }
  return rsi;
}

function drawCandles(canvas,data,showMA,showBB){
  const ctx=canvas.getContext('2d');
  const W=canvas.width=canvas.parentElement.offsetWidth;
  const H=canvas.height=canvas.parentElement.offsetHeight;
  ctx.clearRect(0,0,W,H);

  const pad={t:20,b:20,l:10,r:64};
  const prices=data.flatMap(c=>[c.high,c.low]);
  let minP=Math.min(...prices),maxP=Math.max(...prices);
  const range=maxP-minP||minP*0.02;
  minP-=range*0.05; maxP+=range*0.05;

  const scaleY=v=>pad.t+(maxP-v)/(maxP-minP)*(H-pad.t-pad.b);
  const candleW=(W-pad.l-pad.r)/data.length;

  // Grid
  ctx.strokeStyle='rgba(255,255,255,0.04)';ctx.lineWidth=1;
  for(let i=0;i<=6;i++){
    const y=pad.t+i*(H-pad.t-pad.b)/6;
    ctx.beginPath();ctx.moveTo(pad.l,y);ctx.lineTo(W-pad.r,y);ctx.stroke();
  }

  // BB
  if(showBB){
    const bb=calcBB(data);
    ctx.strokeStyle='rgba(170,119,255,0.5)';ctx.lineWidth=1;
    ['upper','lower','mid'].forEach(k=>{
      ctx.beginPath();
      bb.forEach((b,i)=>{
        if(!b)return;
        const x=pad.l+(i+0.5)*candleW;
        const y=scaleY(b[k]);
        i===0||!bb[i-1]?ctx.moveTo(x,y):ctx.lineTo(x,y);
      });
      ctx.stroke();
    });
    // Fill
    ctx.beginPath();
    bb.forEach((b,i)=>{if(b){const x=pad.l+(i+0.5)*candleW;i===0?ctx.moveTo(x,scaleY(b.upper)):ctx.lineTo(x,scaleY(b.upper));}});
    bb.slice().reverse().forEach((b,i,a)=>{if(b){const ri=a.length-1-i;const x=pad.l+(ri+0.5)*candleW;ctx.lineTo(x,scaleY(b.lower));}});
    ctx.closePath();ctx.fillStyle='rgba(170,119,255,0.04)';ctx.fill();
  }

  // MA
  if(showMA){
    const ma=calcMA(data,20);
    ctx.strokeStyle='rgba(255,215,64,0.8)';ctx.lineWidth=1.5;ctx.setLineDash([]);
    ctx.beginPath();
    ma.forEach((v,i)=>{
      if(v===null)return;
      const x=pad.l+(i+0.5)*candleW;
      const y=scaleY(v);
      i===0||ma[i-1]===null?ctx.moveTo(x,y):ctx.lineTo(x,y);
    });
    ctx.stroke();
  }

  // Candles
  data.forEach((c,i)=>{
    const x=pad.l+i*candleW;
    const up=c.close>=c.open;
    const col=up?'#00E676':'#FF3D57';
    const openY=scaleY(c.open);
    const closeY=scaleY(c.close);
    const highY=scaleY(c.high);
    const lowY=scaleY(c.low);
    const cx=x+candleW/2;
    const bw=Math.max(candleW*0.65,2);

    if(chartType==='candle'){
      ctx.strokeStyle=col;ctx.lineWidth=1;
      ctx.beginPath();ctx.moveTo(cx,highY);ctx.lineTo(cx,lowY);ctx.stroke();
      ctx.fillStyle=col;
      ctx.fillRect(cx-bw/2,Math.min(openY,closeY),bw,Math.max(Math.abs(closeY-openY),1));
      if(!up){ctx.strokeStyle=col;ctx.strokeRect(cx-bw/2,Math.min(openY,closeY),bw,Math.max(Math.abs(closeY-openY),1));}
    } else {
      // Line chart
      if(i>0){
        ctx.strokeStyle='var(--green)';ctx.lineWidth=2;
        ctx.beginPath();
        ctx.moveTo(pad.l+(i-0.5)*candleW,scaleY(data[i-1].close));
        ctx.lineTo(cx,scaleY(c.close));ctx.stroke();
      }
    }
  });

  // Y axis labels
  const yEl=document.getElementById('yAxis')||document.getElementById('tradeYAxis');
  if(yEl){
    yEl.innerHTML='';
    for(let i=0;i<=5;i++){
      const v=minP+i*(maxP-minP)/5;
      const d=document.createElement('div');
      d.className='y-label';
      d.textContent='$'+(v>=1?v.toFixed(2):v.toFixed(4));
      yEl.appendChild(d);
    }
  }
}

function drawVolume(canvas,data){
  const ctx=canvas.getContext('2d');
  const W=canvas.width=canvas.parentElement.offsetWidth;
  const H=canvas.height=canvas.parentElement.offsetHeight;
  ctx.clearRect(0,0,W,H);
  const maxV=Math.max(...data.map(c=>c.vol));
  const bw=W/data.length;
  data.forEach((c,i)=>{
    const h=(c.vol/maxV)*(H-4);
    ctx.fillStyle=c.close>=c.open?'rgba(0,230,118,0.5)':'rgba(255,61,87,0.5)';
    ctx.fillRect(i*bw+1,H-h,bw-2,h);
  });
}

function drawRSI(canvas,data){
  const ctx=canvas.getContext('2d');
  const W=canvas.width=canvas.parentElement.offsetWidth;
  const H=canvas.height=canvas.parentElement.offsetHeight;
  ctx.clearRect(0,0,W,H);
  const rsi=calcRSI(data);
  // Zones
  ctx.fillStyle='rgba(255,61,87,0.06)';ctx.fillRect(0,0,W,H*(1-70/100));
  ctx.fillStyle='rgba(0,230,118,0.06)';ctx.fillRect(0,H*(1-30/100),W,H*(30/100));
  [70,30].forEach(lvl=>{
    ctx.strokeStyle='rgba(255,255,255,0.1)';ctx.lineWidth=1;ctx.setLineDash([4,4]);
    ctx.beginPath();const y=H*(1-lvl/100);ctx.moveTo(0,y);ctx.lineTo(W,y);ctx.stroke();
    ctx.setLineDash([]);
  });
  ctx.strokeStyle='var(--cyan)';ctx.lineWidth=1.5;
  ctx.beginPath();
  rsi.forEach((v,i)=>{
    if(v===null)return;
    const x=(i+0.5)*W/data.length;
    const y=H*(1-v/100);
    i===0||rsi[i-1]===null?ctx.moveTo(x,y):ctx.lineTo(x,y);
  });
  ctx.stroke();
}

function drawDepth(canvas){
  const ctx=canvas.getContext('2d');
  const W=canvas.width=canvas.parentElement.offsetWidth;
  const H=canvas.height=canvas.parentElement.offsetHeight;
  ctx.clearRect(0,0,W,H);
  const base=PAIR_PRICES[currentPair]||1;
  const bids=[],asks=[];
  for(let i=0;i<20;i++){
    bids.push({price:base*(1-0.0005*(i+1)),vol:Math.random()*10+1});
    asks.push({price:base*(1+0.0005*(i+1)),vol:Math.random()*10+1});
  }
  let cumB=0,cumA=0;
  const bidCum=bids.map(b=>{cumB+=b.vol;return cumB;});
  const askCum=asks.map(a=>{cumA+=a.vol;return cumA;});
  const maxCum=Math.max(cumB,cumA);
  const scaleX=v=>(W/2)*(v/maxCum);

  // Bids (left, green)
  ctx.beginPath();ctx.moveTo(W/2,H);
  bidCum.forEach((v,i)=>{ctx.lineTo(W/2-scaleX(v),(i/bidCum.length)*H);});
  ctx.lineTo(0,H);ctx.closePath();
  ctx.fillStyle='rgba(0,230,118,0.15)';ctx.fill();
  ctx.strokeStyle='var(--green)';ctx.lineWidth=1.5;
  ctx.beginPath();
  bidCum.forEach((v,i)=>{i===0?ctx.moveTo(W/2-scaleX(v),(i/bidCum.length)*H):ctx.lineTo(W/2-scaleX(v),(i/bidCum.length)*H);});
  ctx.stroke();

  // Asks (right, red)
  ctx.beginPath();ctx.moveTo(W/2,H);
  askCum.forEach((v,i)=>{ctx.lineTo(W/2+scaleX(v),(i/askCum.length)*H);});
  ctx.lineTo(W,H);ctx.closePath();
  ctx.fillStyle='rgba(255,61,87,0.15)';ctx.fill();
  ctx.strokeStyle='var(--red)';ctx.lineWidth=1.5;
  ctx.beginPath();
  askCum.forEach((v,i)=>{i===0?ctx.moveTo(W/2+scaleX(v),(i/askCum.length)*H):ctx.lineTo(W/2+scaleX(v),(i/askCum.length)*H);});
  ctx.stroke();

  // Mid line
  ctx.strokeStyle='rgba(255,255,255,0.2)';ctx.lineWidth=1;ctx.setLineDash([3,3]);
  ctx.beginPath();ctx.moveTo(W/2,0);ctx.lineTo(W/2,H);ctx.stroke();ctx.setLineDash([]);
}

function drawOrderBook(){
  const base=PAIR_PRICES[currentPair]||1;
  let html='';
  const asks=[];let total=0;
  for(let i=10;i>=1;i--){
    const price=base*(1+0.0002*i+(Math.random()-0.5)*0.00005);
    const amt=Math.random()*3+0.1;
    total+=amt*price;
    asks.push({price,amt,total});
  }
  asks.forEach(a=>{
    const pct=Math.min((a.total/(base*30))*100,100);
    html+=`<div class="ob-row" style="background:linear-gradient(to left,rgba(255,61,87,0.1) ${pct}%,transparent ${pct}%)"><span class="ob-price ask">$${a.price.toFixed(2)}</span><span class="ob-amt">${a.amt.toFixed(4)}</span><span class="ob-total">${(a.total).toFixed(0)}</span></div>`;
  });
  const oA=document.getElementById('obAsks');if(oA)oA.innerHTML=html;
  const mA=document.getElementById('miniObAsks');if(mA)mA.innerHTML=html;

  html='';total=0;
  const bids=[];
  for(let i=1;i<=10;i++){
    const price=base*(1-0.0002*i-(Math.random()-0.5)*0.00005);
    const amt=Math.random()*3+0.1;
    total+=amt*price;
    bids.push({price,amt,total});
  }
  bids.forEach(b=>{
    const pct=Math.min((b.total/(base*30))*100,100);
    html+=`<div class="ob-row" style="background:linear-gradient(to right,rgba(0,230,118,0.1) ${pct}%,transparent ${pct}%)"><span class="ob-price bid">$${b.price.toFixed(2)}</span><span class="ob-amt">${b.amt.toFixed(4)}</span><span class="ob-total">${b.total.toFixed(0)}</span></div>`;
  });
  const oB=document.getElementById('obBids');if(oB)oB.innerHTML=html;
  const mB=document.getElementById('miniObBids');if(mB)mB.innerHTML=html;

  const sp=document.getElementById('obSpreadPrice');if(sp)sp.textContent=fmtPrice(base);
  const ms=document.getElementById('miniSpreadPrice');if(ms)ms.textContent=fmtPrice(base);
}

let tradeFeedBuf=[];
function addTrade(){
  const base=PAIR_PRICES[currentPair]||1;
  const isBuy=Math.random()>0.48;
  const price=base*(1+(Math.random()-0.5)*0.001);
  const amt=Math.random()*2+0.01;
  const now=new Date();
  const time=`${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}:${now.getSeconds().toString().padStart(2,'0')}`;
  const row=`<div class="tp-row"><span class="tp-price ${isBuy?'buy':'sell'}">$${price.toFixed(2)}</span><span class="tp-amt">${amt.toFixed(4)}</span><span class="tp-time">${time}</span></div>`;
  tradeFeedBuf.unshift(row);
  if(tradeFeedBuf.length>40)tradeFeedBuf.pop();
  const tf=document.getElementById('tradesFeed');
  if(tf)tf.innerHTML=tradeFeedBuf.join('');
}

function updatePriceHeader(){
  const base=PAIR_PRICES[currentPair]||1;
  const chgPct=(Math.random()-0.48)*1.5;
  const el=document.getElementById('phPrice');if(el)el.textContent=fmtPrice(base);
  const ch=document.getElementById('phChange');
  if(ch){ch.textContent=(chgPct>=0?'+':'')+chgPct.toFixed(2)+'%';ch.className='ph-change '+(chgPct>=0?'up':'down');}
  document.getElementById('ph24hHigh').textContent=fmtPrice(base*1.02);
  document.getElementById('ph24hLow').textContent=fmtPrice(base*0.97);
  document.getElementById('phOpen').textContent=fmtPrice(base*0.995);
  document.getElementById('phClose').textContent=fmtPrice(base);
}

function redrawAll(){
  const base=PAIR_PRICES[currentPair]||1;
  candleData=generateCandles(base,80);
  const cc=document.getElementById('candleCanvas');
  if(cc)drawCandles(cc,candleData,indicators.ma,indicators.bb);
  const vc=document.getElementById('volCanvas');
  if(vc&&indicators.vol)drawVolume(vc,candleData);
  const rc=document.getElementById('rsiCanvas');
  if(rc&&indicators.rsi)drawRSI(rc,candleData);
  const dc=document.getElementById('depthCanvas');
  if(dc)drawDepth(dc);
  drawOrderBook();
}

function initChartsLayer(){
  clearInterval(obInterval);clearInterval(tradeInterval);clearInterval(priceInterval);
  candleData=[];tradeFeedBuf=[];
  redrawAll();
  updatePriceHeader();
  buildMarketCards();
  obInterval=setInterval(()=>{
    PAIR_PRICES[currentPair]*=1+(Math.random()-0.499)*0.001;
    drawOrderBook();
    redrawChart();
  },800);
  tradeInterval=setInterval(addTrade,400+Math.floor(Math.random()*600));
  priceInterval=setInterval(()=>{PAIR_PRICES[currentPair]*=1+(Math.random()-0.499)*0.002;updatePriceHeader();},1500);
}

function redrawChart(){
  const base=PAIR_PRICES[currentPair]||1;
  if(candleData.length){
    const last=candleData[candleData.length-1];
    last.close=base*(0.999+Math.random()*0.002);
    last.high=Math.max(last.high,last.close);
    last.low=Math.min(last.low,last.close);
  }
  const cc=document.getElementById('candleCanvas');if(cc)drawCandles(cc,candleData,indicators.ma,indicators.bb);
  const vc=document.getElementById('volCanvas');if(vc&&indicators.vol)drawVolume(vc,candleData);
  const rc=document.getElementById('rsiCanvas');if(rc&&indicators.rsi)drawRSI(rc,candleData);
  const dc=document.getElementById('depthCanvas');if(dc)drawDepth(dc);
}

function selectPair(base,quote,btn){
  currentPair=base;currentQuote=quote;
  document.querySelectorAll('.pair-btn').forEach(b=>b.classList.remove('active'));
  if(btn)btn.classList.add('active');
  document.getElementById('phPairName').textContent=`${base} / ${quote}`;
  tradeFeedBuf=[];
  redrawAll();updatePriceHeader();
}

function setInterval_(iv,btn){
  chartInterval=iv;
  document.querySelectorAll('.iv-btn').forEach(b=>b.classList.remove('active'));
  if(btn)btn.classList.add('active');
  redrawAll();
}

function toggleIndicator(ind,btn){
  indicators[ind]=!indicators[ind];
  btn.classList.toggle('active',indicators[ind]);
  if(ind==='vol'){document.getElementById('volWrap').style.display=indicators.vol?'block':'none';}
  if(ind==='rsi'){document.getElementById('rsiWrap').style.display=indicators.rsi?'block':'none';}
  redrawAll();
}

function toggleChartType(){
  chartType=chartType==='candle'?'line':'candle';
  redrawAll();
}

function setOBView(view,btn){
  document.querySelectorAll('.ob-tab').forEach(b=>b.classList.remove('active'));
  if(btn)btn.classList.add('active');
  document.getElementById('obAsks').style.display=(view==='bids')?'none':'flex';
  document.getElementById('obBids').style.display=(view==='asks')?'none':'block';
}

// Crosshair
(function(){
  let wrap,canvas,tip;
  function setupCrosshair(){
    wrap=document.getElementById('mainChartWrap');
    canvas=document.getElementById('candleCanvas');
    tip=document.getElementById('crosshairTip');
    if(!wrap||!canvas)return;
    wrap.addEventListener('mousemove',onMove);
    wrap.addEventListener('mouseleave',()=>{if(tip)tip.style.display='none';});
  }
  function onMove(e){
    if(!candleData.length||!tip)return;
    const r=wrap.getBoundingClientRect();
    const mx=e.clientX-r.left,my=e.clientY-r.top;
    const pad={l:10,r:64};
    const idx=Math.floor((mx-pad.l)/(wrap.offsetWidth-pad.l-pad.r)*candleData.length);
    const c=candleData[Math.min(Math.max(idx,0),candleData.length-1)];
    if(!c)return;
    tip.style.display='block';
    tip.style.left=(mx+16)+'px'; tip.style.top=Math.max(0,my-60)+'px';
    const up=c.close>=c.open;
    tip.innerHTML=`<div style="color:${up?'var(--green)':'var(--red)'};font-weight:700;margin-bottom:4px;">${currentPair}/${currentQuote}</div>O: $${c.open.toFixed(2)}<br>H: $${c.high.toFixed(2)}<br>L: $${c.low.toFixed(2)}<br>C: <strong style="color:${up?'var(--green)':'var(--red)'}">$${c.close.toFixed(2)}</strong><br>Vol: ${(c.vol/1000).toFixed(1)}K`;
    if(tip.offsetLeft+tip.offsetWidth>wrap.offsetWidth-10)tip.style.left=(mx-tip.offsetWidth-16)+'px';
  }
  window.addEventListener('load',setupCrosshair);
})();

// Market cards
function buildMarketCards(){
  const g=document.getElementById('marketCardsGrid'); if(!g) return;
  g.innerHTML=COINS.map(c=>{
    const up=c.chg>=0;
    return `<div class="market-card" onclick="selectPair('${c.sym.split('/')[0]}','USDT',null);window.scrollTo(0,0);">
      <div class="mc-sym">${c.sym}</div>
      <div class="mc-price">${fmtPrice(c.price)}</div>
      <div class="mc-chg" style="color:${up?'var(--green)':'var(--red)'}">${up?'+':''}${c.chg.toFixed(2)}%</div>
      <div class="mc-mini"><canvas id="mini_${c.sym.replace('/','_')}"></canvas></div>
    </div>`;
  }).join('');
  // Draw mini sparklines
  COINS.forEach(c=>{
    const cv=document.getElementById('mini_'+c.sym.replace('/','_'));
    if(!cv)return;
    const ctx=cv.getContext('2d');
    const W=cv.width=cv.parentElement.offsetWidth||180;
    const H=cv.height=40;
    const pts=[];let p=c.price*(0.97+Math.random()*0.04);
    for(let i=0;i<20;i++){p+=p*(Math.random()-0.48)*0.01;pts.push(p);}
    const mn=Math.min(...pts),mx=Math.max(...pts),rng=mx-mn||1;
    const up=pts[pts.length-1]>=pts[0];
    ctx.strokeStyle=up?'var(--green)':'var(--red)';ctx.lineWidth=1.5;
    ctx.beginPath();
    pts.forEach((v,i)=>{const x=i*W/(pts.length-1),y=H-(v-mn)/rng*(H-4)-2;i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);});
    ctx.stroke();
  });
}

// ============================================================
// MARKET SNAPSHOT (dashboard)
// ============================================================
function buildMarketSnapshot(){
  const el=document.getElementById('mSnapList'); if(!el) return;
  el.innerHTML=COINS.slice(0,7).map(c=>{
    const up=c.chg>=0;
    return `<div class="ms-row" onclick="showLayer('chartsLayer')"><span class="ms-sym">${c.sym.split('/')[0]}</span><span class="ms-price">${fmtPrice(c.price)}</span><span class="ms-chg" style="color:${up?'var(--green)':'var(--red)'};background:${up?'var(--green3)':'var(--red2)'}">${up?'+':''}${c.chg.toFixed(2)}%</span></div>`;
  }).join('');
}

// ============================================================
// DASHBOARD
// ============================================================
let perfCanvas=null;
function initDashboard(){
  if(!currentUser)return;
  const isDemo=dashMode==='demo';
  const bal=isDemo?currentUser.demoBalance:currentUser.realBalance;
  document.getElementById('sblLabel').textContent=isDemo?'DEMO BALANCE':'REAL BALANCE';
  document.getElementById('sblAmount').textContent='$'+bal.toFixed(2);
  document.getElementById('bcLabel').textContent=isDemo?'Demo Balance':'Real Balance';
  document.getElementById('bcAmount').textContent='$'+bal.toFixed(2);
  document.getElementById('duchName').textContent=currentUser.name.split(' ')[0];
  document.getElementById('bcDeposits').textContent='$'+currentUser.deposits.toFixed(2);
  document.getElementById('bcProfit').textContent='$'+currentUser.profit.toFixed(2);

  const trades=currentUser.trades;
  if(trades.length>0){
    const wins=trades.filter(t=>t.pnl>0).length;
    document.getElementById('bcWinRate').textContent=Math.round((wins/trades.length)*100)+'%';
    document.getElementById('histWinRate').textContent=Math.round((wins/trades.length)*100)+'%';
  }

  const refCode=currentUser.refCode||'CP000000';
  const refLink=`${window.location.origin}${window.location.pathname}?ref=${refCode}&name=${encodeURIComponent(currentUser.name)}`;
  const srl=document.getElementById('sideRefLink');if(srl)srl.textContent=refLink;

  buildMarketSnapshot();
  drawPerfChart();
  buildAllocChart();
  buildOpenPositions();
  buildRecentTrades();
  buildMarketSnapshot();
  setPerfPeriod(perfPeriod,null);
}

function switchMode(mode){
  dashMode=mode;
  document.getElementById('mtDemo').classList.toggle('active',mode==='demo');
  document.getElementById('mtReal').classList.toggle('active',mode==='real');
  const opD=document.getElementById('opDemo'),opR=document.getElementById('opReal');
  if(opD)opD.classList.toggle('active',mode==='demo');
  if(opR)opR.classList.toggle('active',mode==='real');
  const lbl=document.getElementById('tradeModeLabel');if(lbl)lbl.textContent=mode.toUpperCase();
  if(currentLayer==='dashboardLayer')initDashboard();
  if(currentLayer==='tradingLayer')updateTradingPanel();
}

function drawPerfChart(){
  const cv=document.getElementById('perfCanvas'); if(!cv) return;
  const ctx=cv.getContext('2d');
  const W=cv.width=cv.parentElement.offsetWidth;
  const H=cv.height=cv.parentElement.offsetHeight;
  ctx.clearRect(0,0,W,H);
  const pts=[];let v=25;
  const days={'7d':7,'30d':30,'90d':90}[perfPeriod]||7;
  for(let i=0;i<=days;i++){v+=v*(Math.random()-0.44)*0.06;pts.push(Math.max(v,5));}
  const mn=Math.min(...pts),mx=Math.max(...pts),rng=mx-mn||1;
  const pad=12;
  const scaleX=i=>(i/(pts.length-1))*(W-pad*2)+pad;
  const scaleY=v=>H-pad-(v-mn)/rng*(H-pad*2);

  // Gradient fill
  const grad=ctx.createLinearGradient(0,0,0,H);
  grad.addColorStop(0,'rgba(0,230,118,0.2)');grad.addColorStop(1,'rgba(0,230,118,0)');
  ctx.beginPath();
  pts.forEach((p,i)=>i===0?ctx.moveTo(scaleX(i),scaleY(p)):ctx.lineTo(scaleX(i),scaleY(p)));
  ctx.lineTo(scaleX(pts.length-1),H);ctx.lineTo(scaleX(0),H);ctx.closePath();
  ctx.fillStyle=grad;ctx.fill();

  ctx.strokeStyle='var(--green)';ctx.lineWidth=2;ctx.setLineDash([]);
  ctx.beginPath();
  pts.forEach((p,i)=>i===0?ctx.moveTo(scaleX(i),scaleY(p)):ctx.lineTo(scaleX(i),scaleY(p)));
  ctx.stroke();

  const ret=((pts[pts.length-1]-pts[0])/pts[0]*100).toFixed(2);
  const best=Math.max(...pts.map((p,i)=>i>0?(p-pts[i-1])/pts[i-1]*100:0)).toFixed(2);
  const worst=Math.min(...pts.map((p,i)=>i>0?(p-pts[i-1])/pts[i-1]*100:0)).toFixed(2);
  document.getElementById('pfReturn').textContent=(ret>=0?'+':'')+ret+'%';
  document.getElementById('pfBest').textContent='+'+best+'%';
  document.getElementById('pfWorst').textContent=worst+'%';
}

function setPerfPeriod(period,btn){
  perfPeriod=period;
  document.querySelectorAll('.dc-tab').forEach(b=>b.classList.remove('active'));
  if(btn)btn.classList.add('active');
  else{const tabs=document.querySelectorAll('.dc-tab');tabs.forEach(t=>{if(t.textContent===period.toUpperCase())t.classList.add('active');});}
  drawPerfChart();
}

function buildAllocChart(){
  const cv=document.getElementById('allocCanvas'); if(!cv) return;
  const ctx=cv.getContext('2d');
  const W=cv.width=cv.parentElement.offsetWidth;
  const H=cv.height=cv.parentElement.offsetHeight;
  ctx.clearRect(0,0,W,H);

  const isDemo=dashMode==='demo';
  const bal=isDemo?currentUser.demoBalance:currentUser.realBalance;
  const alloc=[
    {name:'USDT',pct:60,color:'#00E676'},{name:'BTC',pct:25,color:'#448AFF'},
    {name:'ETH',pct:10,color:'#AA77FF'},{name:'Other',pct:5,color:'#FFD740'}
  ];

  document.getElementById('acAmount').textContent='$'+bal.toFixed(0);

  const cx=W/2,cy=H/2,r=Math.min(W,H)/2-10,ir=r*0.62;
  let angle=-Math.PI/2;
  alloc.forEach(a=>{
    const sweep=(a.pct/100)*Math.PI*2;
    ctx.beginPath();ctx.moveTo(cx,cy);
    ctx.arc(cx,cy,r,angle,angle+sweep);
    ctx.closePath();ctx.fillStyle=a.color;ctx.fill();
    angle+=sweep;
  });
  ctx.beginPath();ctx.arc(cx,cy,ir,0,Math.PI*2);ctx.fillStyle='var(--bg1)';ctx.fill();

  const lg=document.getElementById('allocLegend');
  if(lg)lg.innerHTML=alloc.map(a=>`<div class="al-row"><div class="al-dot" style="background:${a.color}"></div><span class="al-name">${a.name}</span><span class="al-pct">${a.pct}%</span></div>`).join('');
}

function buildOpenPositions(){
  const cont=document.getElementById('openPositionsContainer');
  const count=document.getElementById('openPosCount');
  if(!currentUser||!cont)return;
  const pos=currentUser.openPositions;
  if(count)count.textContent=pos.length+' Active';
  if(!pos.length){cont.innerHTML='<div class="empty-state"><div style="font-size:40px;margin-bottom:8px;">📊</div><div style="font-weight:600;color:var(--text2);">No open positions</div><div style="font-size:12px;color:var(--text3);margin-top:4px;">Start trading to see live P&L here</div><button class="btn btn-green" style="margin-top:16px;" onclick="showLayer(\'tradingLayer\')">Open Trade →</button></div>';return;}
  cont.innerHTML=pos.map((p,i)=>{
    const curr=PAIR_PRICES[p.pair]||p.entry;
    const pnl=p.side==='buy'?(curr-p.entry)*p.size/p.entry*p.leverage:(p.entry-curr)*p.size/p.entry*p.leverage;
    const pnlPct=(pnl/p.size)*100;
    return `<div class="position-row">
      <div class="pr-top"><span class="pr-pair">${p.pair}/USDT</span><span class="pr-type ${p.side==='buy'?'long':'short'}">${p.side==='buy'?'▲ LONG':'▼ SHORT'}</span><span class="pr-pnl" style="color:${pnl>=0?'var(--green)':'var(--red)'}">${pnl>=0?'+':''}$${pnl.toFixed(2)} (${pnlPct.toFixed(1)}%)</span></div>
      <div class="pr-stats">
        <div class="pr-stat"><span class="pr-stat-lbl">Entry</span><span class="pr-stat-val">$${p.entry.toFixed(2)}</span></div>
        <div class="pr-stat"><span class="pr-stat-lbl">Size</span><span class="pr-stat-val">$${p.size.toFixed(0)}</span></div>
        <div class="pr-stat"><span class="pr-stat-lbl">Leverage</span><span class="pr-stat-val">${p.leverage}×</span></div>
        <div class="pr-stat"><span class="pr-stat-lbl">Liq.</span><span class="pr-stat-val" style="color:var(--yellow)">$${p.liq.toFixed(2)}</span></div>
      </div>
      <button class="pr-close-btn" onclick="closePosition(${i})">✕ Close Position</button>
    </div>`;
  }).join('');
}

function closePosition(idx){
  if(!currentUser)return;
  const p=currentUser.openPositions[idx];
  if(!p)return;
  const curr=PAIR_PRICES[p.pair]||p.entry;
  const pnl=p.side==='buy'?(curr-p.entry)*p.size/p.entry*p.leverage:(p.entry-curr)*p.size/p.entry*p.leverage;
  currentUser.openPositions.splice(idx,1);
  if(dashMode==='demo')currentUser.demoBalance+=p.size+pnl;
  else currentUser.realBalance+=p.size+pnl;
  currentUser.profit+=pnl;
  const trade={pair:p.pair,side:p.side,size:p.size,leverage:p.leverage,entry:p.entry,exit:curr,pnl,date:new Date().toLocaleDateString()};
  currentUser.trades.unshift(trade);
  showToast(`Position closed! P&L: ${pnl>=0?'+':''}$${pnl.toFixed(2)}`,(pnl>=0?'green':'red'));
  buildOpenPositions();
  buildRecentTrades();
  initDashboard();
}

function buildRecentTrades(){
  const cont=document.getElementById('recentTradesContainer'); if(!cont||!currentUser)return;
  const trades=currentUser.trades.slice(0,6);
  if(!trades.length){cont.innerHTML='<div class="empty-state"><div style="font-size:36px;margin-bottom:8px;">📭</div><div style="font-size:13px;color:var(--text2);">No trades yet</div></div>';return;}
  cont.innerHTML=trades.map(t=>`<div class="rt-row">
    <span class="rt-type ${t.pnl>=0?'win':'loss'}">${t.pnl>=0?'WIN':'LOSS'}</span>
    <span class="rt-pair">${t.pair}/USDT</span>
    <span class="rt-pnl" style="color:${t.pnl>=0?'var(--green)':'var(--red)'}">${t.pnl>=0?'+':''}$${t.pnl.toFixed(2)}</span>
    <span class="rt-date">${t.date}</span>
  </div>`).join('');
}

function dashTab(tab){
  document.querySelectorAll('.snav-item').forEach(i=>i.classList.remove('active'));
  document.getElementById('snav'+tab.charAt(0).toUpperCase()+tab.slice(1)).classList.add('active');
}

function copySideRef(){
  if(!currentUser)return;
  const refLink=`${window.location.origin}${window.location.pathname}?ref=${currentUser.refCode}&name=${encodeURIComponent(currentUser.name)}`;
  navigator.clipboard.writeText(refLink).then(()=>showToast('Referral link copied!','green'));
}

// Balance sparkline
function drawBalSparkline(){
  const cv=document.getElementById('balSparkline'); if(!cv)return;
  const ctx=cv.getContext('2d');
  const W=cv.width=cv.parentElement.offsetWidth||80;
  const H=cv.height=36;
  const pts=[];let v=20;
  for(let i=0;i<12;i++){v+=v*(Math.random()-0.4)*0.05;pts.push(Math.max(v,5));}
  const mn=Math.min(...pts),mx=Math.max(...pts),rng=mx-mn||1;
  ctx.strokeStyle='rgba(0,230,118,0.6)';ctx.lineWidth=1.5;
  ctx.beginPath();
  pts.forEach((p,i)=>{const x=i*W/(pts.length-1),y=H-(p-mn)/rng*(H-4)-2;i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);});
  ctx.stroke();
}

// ============================================================
// TRADING LAYER
// ============================================================
let tradingPair='BTC';
let orderSide='buy';
let orderType='market';
let trdIndicators={ma:true,bb:true,rsi:false};
let trdCandleData=[];
let trdInterval=null;

function initTradingLayer(){
  if(!currentUser)return;
  clearInterval(trdInterval);
  updateTradingPanel();
  trdCandleData=generateCandles(PAIR_PRICES[tradingPair]||98450,80);
  redrawTradingChart();
  drawOrderBook();
  buildMyPositions();
  buildMiniHistory();
  trdInterval=setInterval(()=>{
    PAIR_PRICES[tradingPair]*=1+(Math.random()-0.499)*0.001;
    updateTradingStrip();
    redrawTradingChart();
    drawOrderBook();
    calcOrderSummary();
  },800);
}

function updateTradingPanel(){
  if(!currentUser)return;
  const isDemo=dashMode==='demo';
  const bal=isDemo?currentUser.demoBalance:currentUser.realBalance;
  document.getElementById('tradeAvailBal').textContent='$'+bal.toFixed(2);
  document.getElementById('tradeModeLabel').textContent=isDemo?'DEMO':'REAL';
}

function updateTradingStrip(){
  const base=PAIR_PRICES[tradingPair]||1;
  const chg=(Math.random()-0.48)*1.5;
  document.getElementById('tpsPrice').textContent=fmtPrice(base);
  const ce=document.getElementById('tpsChg');
  ce.textContent=(chg>=0?'+':'')+chg.toFixed(2)+'%';
  ce.className='tps-chg '+(chg>=0?'up':'down');
  document.getElementById('tpsHigh').textContent=fmtPrice(base*1.018);
  document.getElementById('tpsLow').textContent=fmtPrice(base*0.972);
  document.getElementById('tpsVol').textContent=(Math.random()*20+5).toFixed(1)+'B';
}

function redrawTradingChart(){
  const base=PAIR_PRICES[tradingPair]||1;
  if(trdCandleData.length){
    const last=trdCandleData[trdCandleData.length-1];
    last.close=base*(0.999+Math.random()*0.002);
    last.high=Math.max(last.high,last.close);
    last.low=Math.min(last.low,last.close);
  }
  const cc=document.getElementById('tradingCanvas');if(cc)drawCandlesTrd(cc,trdCandleData);
  const vc=document.getElementById('tradeVolCanvas');if(vc)drawVolume(vc,trdCandleData);
  const rc=document.getElementById('tradeRsiCanvas');if(rc&&trdIndicators.rsi)drawRSI(rc,trdCandleData);
}

function drawCandlesTrd(canvas,data){
  const ctx=canvas.getContext('2d');
  const W=canvas.width=canvas.parentElement.offsetWidth;
  const H=canvas.height=canvas.parentElement.offsetHeight;
  ctx.clearRect(0,0,W,H);
  const pad={t:20,b:20,l:10,r:64};
  const prices=data.flatMap(c=>[c.high,c.low]);
  let minP=Math.min(...prices),maxP=Math.max(...prices);
  const range=maxP-minP||minP*0.02;
  minP-=range*0.05; maxP+=range*0.05;
  const scaleY=v=>pad.t+(maxP-v)/(maxP-minP)*(H-pad.t-pad.b);
  const candleW=(W-pad.l-pad.r)/data.length;

  // Grid
  ctx.strokeStyle='rgba(255,255,255,0.04)';ctx.lineWidth=1;
  for(let i=0;i<=6;i++){const y=pad.t+i*(H-pad.t-pad.b)/6;ctx.beginPath();ctx.moveTo(pad.l,y);ctx.lineTo(W-pad.r,y);ctx.stroke();}

  // Entry lines for open positions
  currentUser&&currentUser.openPositions.forEach(p=>{
    if(p.pair!==tradingPair)return;
    ctx.strokeStyle='rgba(255,215,64,0.5)';ctx.lineWidth=1;ctx.setLineDash([5,5]);
    const y=scaleY(p.entry);
    ctx.beginPath();ctx.moveTo(pad.l,y);ctx.lineTo(W-pad.r,y);ctx.stroke();
    ctx.setLineDash([]);
  });

  if(trdIndicators.bb){const bb=calcBB(data);ctx.strokeStyle='rgba(170,119,255,0.4)';ctx.lineWidth=1;['upper','lower','mid'].forEach(k=>{ctx.beginPath();bb.forEach((b,i)=>{if(!b)return;const x=pad.l+(i+0.5)*candleW;const y=scaleY(b[k]);i===0||!bb[i-1]?ctx.moveTo(x,y):ctx.lineTo(x,y);});ctx.stroke();});}
  if(trdIndicators.ma){const ma=calcMA(data,20);ctx.strokeStyle='rgba(255,215,64,0.7)';ctx.lineWidth=1.5;ctx.beginPath();ma.forEach((v,i)=>{if(v===null)return;const x=pad.l+(i+0.5)*candleW;const y=scaleY(v);i===0||ma[i-1]===null?ctx.moveTo(x,y):ctx.lineTo(x,y);});ctx.stroke();}

  data.forEach((c,i)=>{
    const x=pad.l+i*candleW;const up=c.close>=c.open;const col=up?'#00E676':'#FF3D57';
    const openY=scaleY(c.open),closeY=scaleY(c.close),highY=scaleY(c.high),lowY=scaleY(c.low);
    const cx=x+candleW/2,bw=Math.max(candleW*0.65,2);
    ctx.strokeStyle=col;ctx.lineWidth=1;ctx.beginPath();ctx.moveTo(cx,highY);ctx.lineTo(cx,lowY);ctx.stroke();
    ctx.fillStyle=col;ctx.fillRect(cx-bw/2,Math.min(openY,closeY),bw,Math.max(Math.abs(closeY-openY),1));
  });

  const ya=document.getElementById('tradeYAxis');
  if(ya){ya.innerHTML='';for(let i=0;i<=5;i++){const v=minP+i*(maxP-minP)/5;const d=document.createElement('div');d.className='y-label';d.textContent='$'+(v>=1?v.toFixed(2):v.toFixed(4));ya.appendChild(d);}}
}

function tradingSelectPair(base,quote,btn){
  tradingPair=base;
  document.getElementById('tpsPair').textContent=`${base}/${quote}`;
  document.querySelectorAll('#tradePairBar .pair-btn').forEach(b=>b.classList.remove('active'));
  if(btn)btn.classList.add('active');
  trdCandleData=generateCandles(PAIR_PRICES[base]||1,80);
  redrawTradingChart();calcOrderSummary();
}

function setOrderSide(side){
  orderSide=side;
  document.getElementById('otBuy').classList.toggle('active',side==='buy');
  document.getElementById('otSell').classList.toggle('active',side==='sell');
  const btn=document.getElementById('orderSubmitBtn');
  btn.className='order-submit-btn '+(side==='buy'?'buy':'sell');
  document.getElementById('orderSubmitText').textContent=side==='buy'?'▲ BUY / LONG':'▼ SELL / SHORT';
  calcOrderSummary();
}

function setOrderType(type,btn){
  orderType=type;
  document.querySelectorAll('.order-type-btn').forEach(b=>b.classList.remove('active'));
  if(btn)btn.classList.add('active');
  document.getElementById('limitPriceGroup').style.display=(type==='market')?'none':'block';
}

function setTrdInterval(iv,btn){
  chartInterval=iv;
  document.querySelectorAll('.trade-chart-col .iv-btn').forEach(b=>b.classList.remove('active'));
  if(btn)btn.classList.add('active');
  trdCandleData=generateCandles(PAIR_PRICES[tradingPair]||1,80);
  redrawTradingChart();
}

function toggleTrdIndicator(ind,btn){
  trdIndicators[ind]=!trdIndicators[ind];
  if(btn)btn.classList.toggle('active',trdIndicators[ind]);
  if(ind==='rsi'){document.getElementById('tradeRsiWrap').style.display=trdIndicators.rsi?'block':'none';}
  redrawTradingChart();
}

function updateLeverage(val){
  document.getElementById('leverageVal').textContent=val+'×';
  const slider=document.getElementById('leverageSlider');
  const pct=((val-1)/99)*100;
  slider.style.background=`linear-gradient(to right,var(--green) 0%,var(--green) ${pct}%,var(--bg3) ${pct}%,var(--bg3) 100%)`;
  const rw=document.getElementById('riskWarning');
  if(val>=50){rw.style.display='flex';document.getElementById('riskMsg').textContent=`${val}× leverage: High risk. Liq. can happen fast.`;}
  else rw.style.display='none';
  calcOrderSummary();
}

function setTradePct(pct){
  if(!currentUser)return;
  const bal=dashMode==='demo'?currentUser.demoBalance:currentUser.realBalance;
  document.getElementById('tradeAmt').value=(bal*(pct/100)).toFixed(2);
  calcOrderSummary();
}

function calcOrderSummary(){
  const base=PAIR_PRICES[tradingPair]||1;
  const amt=parseFloat(document.getElementById('tradeAmt').value)||0;
  const lev=parseInt(document.getElementById('leverageSlider').value)||10;
  const tp=parseFloat(document.getElementById('takeProfit').value)||0;
  const sl=parseFloat(document.getElementById('stopLoss').value)||0;
  const pos=amt*lev;
  const margin=amt;
  const liqDist=1/lev;
  const liq=orderSide==='buy'?base*(1-liqDist):base*(1+liqDist);

  document.getElementById('osEntry').textContent=fmtPrice(base);
  document.getElementById('osPosition').textContent=amt?'$'+pos.toFixed(2):'—';
  document.getElementById('osMargin').textContent=amt?'$'+margin.toFixed(2):'—';
  document.getElementById('osLiq').textContent=amt?fmtPrice(liq):'—';

  if(tp&&amt){const profit=(Math.abs(tp-base)/base)*pos;document.getElementById('osProfit').textContent='+$'+profit.toFixed(2);}
  else document.getElementById('osProfit').textContent='—';
  if(sl&&amt){const loss=(Math.abs(base-sl)/base)*pos;document.getElementById('osLoss').textContent='-$'+loss.toFixed(2);}
  else document.getElementById('osLoss').textContent='—';
}

function submitTrade(){
  if(!currentUser){showToast('Please log in first.','red');return;}
  const amt=parseFloat(document.getElementById('tradeAmt').value);
  if(!amt||amt<1){showToast('Enter a valid amount (min $1)','red');return;}
  const bal=dashMode==='demo'?currentUser.demoBalance:currentUser.realBalance;
  if(amt>bal){showToast(`Insufficient ${dashMode} balance. Need $${amt.toFixed(2)}, have $${bal.toFixed(2)}. Please deposit.`,'red',6000);return;}
  const lev=parseInt(document.getElementById('leverageSlider').value)||10;
  const base=PAIR_PRICES[tradingPair]||1;
  const liqDist=1/lev;
  const liq=orderSide==='buy'?base*(1-liqDist):base*(1+liqDist);

  if(dashMode==='demo')currentUser.demoBalance-=amt;
  else currentUser.realBalance-=amt;

  const pos={pair:tradingPair,side:orderSide,size:amt,leverage:lev,entry:base,liq,
    tp:parseFloat(document.getElementById('takeProfit').value)||0,
    sl:parseFloat(document.getElementById('stopLoss').value)||0,
    time:Date.now()};
  currentUser.openPositions.push(pos);

  showToast(`✅ ${orderSide==='buy'?'▲ LONG':'▼ SHORT'} ${tradingPair}/USDT\nSize: $${(amt*lev).toFixed(0)} | Margin: $${amt.toFixed(2)} | ${lev}× leverage`,'green',5000);
  document.getElementById('tradeAmt').value='';
  calcOrderSummary();
  buildMyPositions();
  updateTradingPanel();

  // Auto-close simulation
  const holdTime=8000+Math.random()*12000;
  setTimeout(()=>{
    const idx=currentUser.openPositions.indexOf(pos);
    if(idx===-1)return;
    const exitPrice=base*(1+(orderSide==='buy'?1:-1)*(Math.random()*0.05-0.015));
    const pnl=(Math.abs(exitPrice-pos.entry)/pos.entry)*amt*lev*(orderSide==='buy'?(exitPrice>=pos.entry?1:-1):(exitPrice<=pos.entry?1:-1));
    currentUser.openPositions.splice(idx,1);
    if(dashMode==='demo')currentUser.demoBalance+=amt+pnl;
    else currentUser.realBalance+=amt+pnl;
    currentUser.profit+=pnl;
    currentUser.trades.unshift({pair:tradingPair,side:orderSide,size:amt,leverage:lev,entry:pos.entry,exit:exitPrice,pnl,date:new Date().toLocaleDateString()});
    showToast(`Trade closed! P&L: ${pnl>=0?'+':''}$${pnl.toFixed(2)}`,(pnl>=0?'green':'red'),4000);
    buildMyPositions();buildMiniHistory();
    if(currentLayer==='dashboardLayer')initDashboard();
  },holdTime);
}

function buildMyPositions(){
  const cont=document.getElementById('myPositionsList');
  const cnt=document.getElementById('myPosCount');
  if(!currentUser||!cont)return;
  const pos=currentUser.openPositions;
  if(cnt)cnt.textContent=pos.length;
  if(!pos.length){cont.innerHTML='<div style="padding:16px;text-align:center;font-size:11px;color:var(--text3);">No open positions</div>';return;}
  cont.innerHTML=pos.map((p,i)=>{
    const curr=PAIR_PRICES[p.pair]||p.entry;
    const pnl=p.side==='buy'?(curr-p.entry)*p.size/p.entry*p.leverage:(p.entry-curr)*p.size/p.entry*p.leverage;
    return `<div class="my-pos-row">
      <div class="mpr-top"><span class="mpr-pair">${p.pair}/USDT</span><span class="mpr-pnl" style="color:${pnl>=0?'var(--green)':'var(--red)'}">${pnl>=0?'+':''}$${pnl.toFixed(2)}</span></div>
      <div class="mpr-stats"><span>${p.side==='buy'?'▲ LONG':'▼ SHORT'}</span><span>${p.leverage}×</span><span>$${p.entry.toFixed(2)}</span></div>
      <button class="mpr-close" onclick="closePosition(${i});buildMyPositions();buildMiniHistory();">✕ Close</button>
    </div>`;
  }).join('');
}

function buildMiniHistory(){
  const cont=document.getElementById('miniHistoryList'); if(!currentUser||!cont)return;
  const trades=currentUser.trades.slice(0,8);
  if(!trades.length){cont.innerHTML='<div style="padding:16px;text-align:center;font-size:11px;color:var(--text3);">No trades yet</div>';return;}
  cont.innerHTML=trades.map(t=>`<div class="mini-hist-row"><span style="color:${t.pnl>=0?'var(--green)':'var(--red)'}">${t.pnl>=0?'▲ WIN':'▼ LOSS'}</span><span style="color:var(--text2)">${t.pair}/USDT</span><span style="color:${t.pnl>=0?'var(--green)':'var(--red)'}">${t.pnl>=0?'+':''}$${t.pnl.toFixed(2)}</span></div>`).join('');
}

// ============================================================
// DEPOSIT
// ============================================================
function initDepositLayer(){
  if(!currentUser)return;
  const bal=(dashMode==='demo'?currentUser.demoBalance:currentUser.realBalance);
  document.getElementById('depositAvailBal').textContent='$'+bal.toFixed(2)+' available';
}

function selectDepMethod(btn,gridId){
  document.querySelectorAll('#'+gridId+' .dep-method-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  const method=btn.dataset.method;
  const det=document.getElementById('depDetails');
  if(det){
    if(method==='mpesa')det.innerHTML='📱 <strong style="color:var(--text1)">M-Pesa Paybill:</strong> 123456<br>Account No: <strong style="color:var(--green)">Use your registered email</strong><br><span style="font-size:11px;color:var(--text3);">Funds credited within 2 minutes</span>';
    else if(method==='bank')det.innerHTML='🏦 <strong style="color:var(--text1)">Bank:</strong> Equity Bank Kenya<br>Account: <strong style="color:var(--green)">0012345678901</strong><br>Name: CryptoPro Ltd<br><span style="font-size:11px;color:var(--text3);">Processing: 1–2 hours</span>';
    else det.innerHTML='₿ <strong style="color:var(--text1)">USDT TRC-20 Address:</strong><br><strong style="color:var(--green);font-family:var(--font-mono);font-size:11px;word-break:break-all;">TXYZk9mNpQ8rB2wA4eJ6vL1cH5sDfR3t7</strong><br><span style="font-size:11px;color:var(--text3);">Confirm: TRC-20 network only</span>';
  }
}

function calcDepBonus(){
  const amt=parseFloat(document.getElementById('depositAmt').value)||0;
  const box=document.getElementById('depBonusLine');
  if(amt>=10){
    if(box){box.style.display='flex';document.getElementById('depBonusAmt').textContent='+$'+amt.toFixed(2);}
  } else {if(box)box.style.display='none';}
}

function submitDeposit(){
  if(!currentUser){showToast('Please log in first','red');return;}
  const amt=parseFloat(document.getElementById('depositAmt').value);
  if(!amt||amt<10){showToast('Minimum deposit is $10','red');return;}
  const btn=document.getElementById('depositBtn');
  btn.textContent='⟳ Processing…';btn.disabled=true;
  setTimeout(()=>{
    const bonus=amt;
    const total=amt+bonus;
    if(dashMode==='demo')currentUser.demoBalance+=total;
    else currentUser.realBalance+=total;
    currentUser.deposits+=amt;
    showToast(`💰 Deposit successful!\n$${amt.toFixed(2)} + $${bonus.toFixed(2)} bonus = $${total.toFixed(2)} added to your ${dashMode} balance!`,'green',6000);
    btn.textContent='💰 Deposit Now';btn.disabled=false;
    document.getElementById('depositAmt').value='';
    const box=document.getElementById('depBonusLine');if(box)box.style.display='none';
    setTimeout(()=>showLayer('dashboardLayer'),1500);
  },2000);
}

// ============================================================
// WITHDRAW
// ============================================================
function initWithdrawLayer(){
  if(!currentUser)return;
  const bal=(dashMode==='demo'?currentUser.demoBalance:currentUser.realBalance);
  document.getElementById('withdrawAvailBal').textContent='$'+bal.toFixed(2)+' available';
}

function calcWithdrawFee(){
  const amt=parseFloat(document.getElementById('withdrawAmt').value)||0;
  const box=document.getElementById('withdrawFeeBox');
  if(amt>=50){
    box.style.display='block';
    const fee=amt*0.02;
    document.getElementById('wfAmt').textContent='$'+amt.toFixed(2);
    document.getElementById('wfFee').textContent='-$'+fee.toFixed(2);
    document.getElementById('wfNet').textContent='$'+(amt-fee).toFixed(2);
  } else box.style.display='none';
}

function submitWithdraw(){
  if(!currentUser){showToast('Please log in first','red');return;}
  const amt=parseFloat(document.getElementById('withdrawAmt').value);
  const acct=document.getElementById('withdrawAccount').value.trim();
  if(!amt||amt<50){showToast('Minimum withdrawal is $50','red');return;}
  if(!acct){showToast('Please enter your account/number','red');return;}
  const bal=dashMode==='demo'?currentUser.demoBalance:currentUser.realBalance;
  if(amt>bal){showToast(`Insufficient ${dashMode} balance. Deposit or earn more first.`,'red',5000);return;}
  const btn=document.getElementById('withdrawBtn');
  btn.textContent='⟳ Processing…';btn.disabled=true;
  setTimeout(()=>{
    const fee=amt*0.02;const net=amt-fee;
    if(dashMode==='demo')currentUser.demoBalance-=amt;
    else currentUser.realBalance-=amt;
    showToast(`✅ Withdrawal submitted!\n$${net.toFixed(2)} sent to ${acct}\nExpected: 5–30 minutes`,'green',6000);
    btn.textContent='💸 Withdraw Now';btn.disabled=false;
    document.getElementById('withdrawAmt').value='';
    document.getElementById('withdrawAccount').value='';
    document.getElementById('withdrawFeeBox').style.display='none';
    setTimeout(()=>showLayer('dashboardLayer'),1500);
  },2500);
}

// ============================================================
// BOTS
// ============================================================
const BOT_DEFS=[
  {name:'Scalper Pro',icon:'⚡',desc:'Ultra-fast scalping bot that capitalizes on micro price movements. Perfect for volatile markets.',risk:'Low-Med',winRate:'87%',daily:'+3.2%',monthly:'+96%',pairs:'BTC, ETH, SOL',color:'var(--green)',bg:'var(--green3)'},
  {name:'Trend Master',icon:'📈',desc:'Identifies and rides major market trends using advanced EMA crossover strategies.',risk:'Medium',winRate:'82%',daily:'+2.8%',monthly:'+84%',pairs:'BTC, ETH, BNB',color:'var(--blue)',bg:'rgba(68,138,255,0.1)'},
  {name:'Grid Trader',icon:'🔲',desc:'Places buy and sell orders at regular intervals to profit from sideways markets.',risk:'Low',winRate:'79%',daily:'+2.5%',monthly:'+75%',pairs:'All pairs',color:'var(--purple)',bg:'rgba(170,119,255,0.1)'},
  {name:'Arbitrage AI',icon:'🔄',desc:'Exploits price differences across multiple markets for near-risk-free profits.',risk:'Very Low',winRate:'91%',daily:'+4.1%',monthly:'+123%',pairs:'All pairs',color:'var(--yellow)',bg:'rgba(255,215,64,0.1)'},
  {name:'Momentum Bot',icon:'🚀',desc:'Detects strong momentum signals and rides the wave for maximum gains.',risk:'High',winRate:'74%',daily:'+5.8%',monthly:'+174%',pairs:'SOL, AVAX, DOT',color:'var(--red)',bg:'var(--red2)'},
  {name:'DCA Master',icon:'📊',desc:'Dollar-cost averaging bot that buys dips systematically to build positions.',risk:'Low',winRate:'88%',daily:'+1.9%',monthly:'+57%',pairs:'BTC, ETH',color:'var(--cyan)',bg:'rgba(0,229,255,0.1)'},
];

const botStates={};

function buildBots(){
  const g=document.getElementById('botsGrid'); if(!g)return;
  g.innerHTML=BOT_DEFS.map((b,i)=>{
    const on=botStates[i]===true;
    return `<div class="bot-card ${on?'active':''}" id="botCard${i}">
      <div class="bc-top">
        <div class="bc-icon" style="background:${b.bg};color:${b.color}">${b.icon}</div>
        <div><div class="bc-name">${b.name}</div><div class="bc-risk" style="color:${b.color}">Risk: ${b.risk}</div></div>
        <div class="bc-status ${on?'on':'off'}" id="botStatus${i}">${on?'● ON':'○ OFF'}</div>
      </div>
      <div class="bc-desc">${b.desc}</div>
      <div class="bc-stats">
        <div class="bc-stat"><div class="bcs-val" style="color:var(--green)">${b.winRate}</div><div class="bcs-lbl">Win Rate</div></div>
        <div class="bc-stat"><div class="bcs-val" style="color:${b.color}">${b.daily}</div><div class="bcs-lbl">Daily</div></div>
        <div class="bc-stat"><div class="bcs-val" style="color:var(--yellow)">${b.monthly}</div><div class="bcs-lbl">Monthly</div></div>
        <div class="bc-stat"><div class="bcs-val" style="color:var(--blue)">${on?'Active':'Ready'}</div><div class="bcs-lbl">Status</div></div>
      </div>
      <div class="bc-pairs" style="color:var(--text3)">Pairs: ${b.pairs}</div>
      <button class="bc-toggle-btn ${on?'stop':'start'}" onclick="toggleBot(${i})">${on?'⏹ Stop Bot':'▶ Start Bot'}</button>
      ${on?`<div class="bc-running">● Running · <span id="botEarnings${i}">Earning…</span></div>`:''}
    </div>`;
  }).join('');
  updateBotCounter();
}

function toggleBot(i){
  if(!currentUser){showToast('Please log in first','red');return;}
  const wasOn=botStates[i]===true;
  if(!wasOn){
    const bal=dashMode==='demo'?currentUser.demoBalance:currentUser.realBalance;
    if(bal<10){showToast('Minimum $10 balance required to run bots. Please deposit.','red',5000);return;}
  }
  botStates[i]=!wasOn;
  buildBots();
  const b=BOT_DEFS[i];
  if(botStates[i]){
    showToast(`🤖 ${b.name} activated!\nTrading on ${b.pairs}\nTarget: ${b.daily} daily return`,'green',5000);
    // Simulate bot earnings
    const earningInterval=setInterval(()=>{
      if(!botStates[i]){clearInterval(earningInterval);return;}
      const earn=Math.random()*2+0.5;
      if(dashMode==='demo')currentUser.demoBalance+=earn;
      else currentUser.realBalance+=earn;
      currentUser.profit+=earn;
      const el=document.getElementById('botEarnings'+i);
      if(el)el.textContent='+$'+earn.toFixed(2)+' just now';
    },5000+Math.floor(Math.random()*5000));
  } else {
    showToast(`⏹ ${b.name} stopped`,'blue');
  }
}

function updateBotCounter(){
  const cnt=Object.values(botStates).filter(Boolean).length;
  const el=document.getElementById('botsActiveCount');if(el)el.textContent=cnt;
}

// ============================================================
// HISTORY
// ============================================================
function buildHistory(){
  if(!currentUser)return;
  const tbody=document.getElementById('historyTbody');
  const trades=currentUser.trades;
  document.getElementById('histTotalTrades').textContent=trades.length;

  if(!trades.length){
    tbody.innerHTML=`<tr><td colspan="7" style="text-align:center;padding:40px;color:var(--text3)">No trades yet. Start trading!</td></tr>`;
    return;
  }

  const totalPnl=trades.reduce((s,t)=>s+t.pnl,0);
  const wins=trades.filter(t=>t.pnl>0).length;
  document.getElementById('histTotalPnl').textContent=(totalPnl>=0?'+':'')+'$'+Math.abs(totalPnl).toFixed(2);
  document.getElementById('histTotalPnl').style.color=totalPnl>=0?'var(--green)':'var(--red)';
  document.getElementById('histWinRate').textContent=trades.length?Math.round((wins/trades.length)*100)+'%':'—';

  tbody.innerHTML=trades.map(t=>`<tr class="hist-row">
    <td><span style="padding:3px 8px;border-radius:4px;font-size:11px;font-weight:700;font-family:var(--font-mono);color:${t.pnl>=0?'var(--green)':'var(--red)'};background:${t.pnl>=0?'var(--green3)':'var(--red2)'};">${t.pnl>=0?'WIN':'LOSS'}</span></td>
    <td style="font-weight:700">${t.pair}/USDT</td>
    <td><span style="padding:2px 7px;border-radius:4px;font-size:11px;font-weight:700;color:${t.side==='buy'?'var(--green)':'var(--red)'};background:${t.side==='buy'?'var(--green3)':'var(--red2)'};">${t.side==='buy'?'▲ LONG':'▼ SHORT'}</span></td>
    <td class="mono">$${t.size.toFixed(2)}</td>
    <td class="mono">${t.leverage}×</td>
    <td class="mono fw-bold" style="color:${t.pnl>=0?'var(--green)':'var(--red)'}">${t.pnl>=0?'+':''}$${t.pnl.toFixed(2)}</td>
    <td style="color:var(--text3);font-size:11px">${t.date}</td>
  </tr>`).join('');
}

// ============================================================
// REFERRAL
// ============================================================
function buildReferral(){
  if(!currentUser)return;
  const refCode=currentUser.refCode;
  const refLink=`${window.location.origin}${window.location.pathname}?ref=${refCode}&name=${encodeURIComponent(currentUser.name)}`;
  document.getElementById('refLinkDisplay').textContent=refLink;
  document.getElementById('refTotalEarned').textContent='$'+currentUser.referralEarnings.toFixed(2);
  document.getElementById('refTotalCount').textContent=currentUser.referrals.length;
  document.getElementById('profRefCode').textContent=refCode;
}

function copyRefLink(){
  if(!currentUser)return;
  const refCode=currentUser.refCode;
  const refLink=`${window.location.origin}${window.location.pathname}?ref=${refCode}&name=${encodeURIComponent(currentUser.name)}`;
  navigator.clipboard.writeText(refLink).then(()=>showToast('✅ Referral link copied to clipboard!','green'));
}

function shareRef(platform){
  if(!currentUser)return;
  const refLink=`${window.location.origin}${window.location.pathname}?ref=${currentUser.refCode}&name=${encodeURIComponent(currentUser.name)}`;
  const msg=`Join CryptoPro and get $25 FREE! I've been making great profits. Use my link: ${refLink}`;
  const urls={whatsapp:`https://wa.me/?text=${encodeURIComponent(msg)}`,telegram:`https://t.me/share/url?url=${encodeURIComponent(refLink)}&text=${encodeURIComponent('Join CryptoPro and get $25 FREE!')}`,twitter:`https://twitter.com/intent/tweet?text=${encodeURIComponent(msg)}`};
  window.open(urls[platform],'_blank');
}

// ============================================================
// PROFILE
// ============================================================
function buildProfile(){
  if(!currentUser)return;
  document.getElementById('profDisplayName').textContent=currentUser.name;
  document.getElementById('profJoined').textContent=currentUser.joinDate;
  document.getElementById('profName').value=currentUser.name;
  document.getElementById('profEmail').value=currentUser.email;
  document.getElementById('profPhone').value=currentUser.phone;
  document.getElementById('profRefCode').textContent=currentUser.refCode;
}

function saveProfile(){
  if(!currentUser)return;
  currentUser.name=document.getElementById('profName').value.trim()||currentUser.name;
  currentUser.email=document.getElementById('profEmail').value.trim()||currentUser.email;
  currentUser.phone=document.getElementById('profPhone').value.trim()||currentUser.phone;
  document.getElementById('duchName').textContent=currentUser.name.split(' ')[0];
  showToast('✅ Profile saved!','green');
}

// ============================================================
// INIT
// ============================================================
window.addEventListener('load',()=>{
  buildTickers();
  buildLiveTradersPool();
  buildWinnersPool();
  buildReviews();
  checkReferral();
  startTraderRefresh();
  setInterval(updateTickerPrices,3000);
  setInterval(rotateLiveMsg,4000);
  rotateLiveMsg();
  drawBalSparkline();
});

window.addEventListener('resize',()=>{
  if(currentLayer==='chartsLayer')redrawAll();
  if(currentLayer==='tradingLayer')redrawTradingChart();
});
</script>
</body>
</html>
