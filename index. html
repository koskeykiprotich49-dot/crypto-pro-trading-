<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CryptoPro - Professional Crypto Trading Platform</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700;900&family=JetBrains+Mono:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --bg-primary: #060B11;
            --bg-secondary: #0D1421;
            --bg-tertiary: #111927;
            --bg-card: #151E2D;
            --border-color: #1E2D42;
            --text-primary: #E8EDF5;
            --text-secondary: #6B7A99;
            --text-muted: #3D4F6B;
            --accent-green: #0ECB81;
            --accent-green-dim: rgba(14,203,129,0.12);
            --accent-red: #F6465D;
            --accent-red-dim: rgba(246,70,93,0.12);
            --accent-yellow: #FCD535;
            --accent-blue: #00B8FF;
            --accent-blue-dim: rgba(0,184,255,0.12);
            --accent-purple: #A855F7;
        }

        body {
            font-family: 'Space Grotesk', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background-image:
                linear-gradient(rgba(14,203,129,0.025) 1px, transparent 1px),
                linear-gradient(90deg, rgba(14,203,129,0.025) 1px, transparent 1px);
            background-size: 44px 44px;
            pointer-events: none;
            z-index: 0;
        }

        .layer { display: none; min-height: 100vh; position: relative; z-index: 1; animation: fadeUp 0.4s ease-out; }
        .layer.active { display: block; }

        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(16px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulse {
            0%,100% { opacity:1; transform:scale(1); }
            50% { opacity:0.7; transform:scale(1.08); }
        }
        @keyframes slideLeft {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }
        @keyframes slideDown {
            from { transform: translateY(-100%); opacity:0; }
            to { transform: translateY(0); opacity:1; }
        }
        @keyframes slideInRight {
            from { transform: translateX(120%); opacity:0; }
            to { transform: translateX(0); opacity:1; }
        }
        @keyframes slideOutRight {
            from { transform: translateX(0); opacity:1; }
            to { transform: translateX(120%); opacity:0; }
        }
        @keyframes flashGreen {
            0%,100% { color: var(--accent-green); }
            50% { color: #fff; text-shadow: 0 0 20px var(--accent-green); }
        }
        @keyframes flashRed {
            0%,100% { color: var(--accent-red); }
            50% { color: #fff; text-shadow: 0 0 20px var(--accent-red); }
        }
        @keyframes glow {
            0%,100% { box-shadow: 0 0 10px rgba(14,203,129,0.3); }
            50% { box-shadow: 0 0 25px rgba(14,203,129,0.7); }
        }
        @keyframes confettiFall {
            0% { transform: translateY(-20px) rotate(0deg); opacity:1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity:0; }
        }
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        @keyframes blink {
            0%,100% { opacity:1; }
            50% { opacity:0.3; }
        }
        @keyframes countUp {
            from { opacity:0; transform:translateY(8px); }
            to { opacity:1; transform:translateY(0); }
        }
        @keyframes fadeOut {
            from { opacity:1; transform:translateY(0); }
            to { opacity:0; transform:translateY(20px); }
        }

        .market-ticker-bar {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 8px 0;
            overflow: hidden;
            position: sticky;
            top: 0;
            z-index: 1001;
        }
        .ticker-track {
            display: flex;
            animation: slideLeft 50s linear infinite;
            white-space: nowrap;
            width: max-content;
        }
        .ticker-item {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 0 24px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            border-right: 1px solid var(--border-color);
        }
        .ticker-symbol { color: var(--text-secondary); font-weight: 600; }
        .ticker-price { color: var(--text-primary); font-weight: 700; }
        .ticker-change.pos { color: var(--accent-green); }
        .ticker-change.neg { color: var(--accent-red); }

        .navbar {
            background: rgba(13,20,33,0.97);
            backdrop-filter: blur(20px);
            padding: 14px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 33px;
            z-index: 1000;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 22px;
            font-weight: 900;
            color: var(--accent-green);
            cursor: pointer;
            letter-spacing: -0.5px;
        }
        .logo-icon {
            width: 36px; height: 36px;
            background: linear-gradient(135deg, var(--accent-green), #0B8F5F);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            animation: glow 3s ease-in-out infinite;
        }
        .nav-links { display: flex; gap: 12px; align-items: center; }
        .nav-btn {
            padding: 9px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 13px;
            font-family: 'Space Grotesk', sans-serif;
            transition: all 0.25s;
        }
        .btn-login { background: transparent; color: var(--accent-blue); border: 1.5px solid var(--accent-blue); }
        .btn-signup { background: linear-gradient(135deg, var(--accent-green), #08A566); color: #000; font-weight: 700; }
        .nav-btn:hover { transform: translateY(-2px); filter: brightness(1.1); }

        .status-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            background: var(--accent-green-dim);
            border: 1px solid rgba(14,203,129,0.3);
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            color: var(--accent-green);
            letter-spacing: 1px;
        }
        .status-dot {
            width: 6px; height: 6px;
            background: var(--accent-green);
            border-radius: 50%;
            animation: blink 1.5s ease-in-out infinite;
        }

        .notif-bell {
            position: relative;
            cursor: pointer;
            width: 38px; height: 38px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            font-size: 18px;
            transition: all 0.25s;
        }
        .notif-bell:hover { border-color: var(--accent-green); }
        .notif-count {
            position: absolute;
            top: -4px; right: -4px;
            background: var(--accent-red);
            color: #fff;
            font-size: 10px;
            font-weight: 700;
            width: 18px; height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .notif-dropdown {
            position: absolute;
            top: 50px; right: 0;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 14px;
            width: 320px;
            max-height: 420px;
            overflow-y: auto;
            z-index: 9999;
            display: none;
            box-shadow: 0 20px 60px rgba(0,0,0,0.6);
        }
        .notif-dropdown.open { display: block; animation: fadeUp 0.25s ease-out; }
        .notif-header {
            padding: 16px 20px;
            font-weight: 700;
            font-size: 14px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: var(--bg-card);
        }
        .notif-item {
            padding: 14px 20px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: background 0.2s;
        }
        .notif-item:hover { background: var(--bg-tertiary); }
        .notif-item-title { font-size: 13px; font-weight: 600; margin-bottom: 3px; }
        .notif-item-desc { font-size: 11px; color: var(--text-secondary); line-height: 1.4; }
        .notif-item-time { font-size: 10px; color: var(--text-muted); margin-top: 4px; }

        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }

        .hero-section {
            background: linear-gradient(135deg, rgba(14,203,129,0.08) 0%, rgba(0,184,255,0.05) 100%);
            border: 1px solid rgba(14,203,129,0.2);
            border-radius: 20px;
            padding: 48px 40px;
            margin-bottom: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        .hero-section::before {
            content: '';
            position: absolute;
            top: -50%; left: 50%;
            transform: translateX(-50%);
            width: 600px; height: 300px;
            background: radial-gradient(ellipse, rgba(14,203,129,0.1) 0%, transparent 70%);
            pointer-events: none;
        }
        .hero-section h1 {
            font-size: 52px;
            font-weight: 900;
            background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-blue) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 16px;
            letter-spacing: -1.5px;
            line-height: 1.1;
        }
        .hero-section p {
            font-size: 17px;
            color: var(--text-secondary);
            margin-bottom: 28px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.6;
        }
        .hero-cta { display: flex; gap: 14px; justify-content: center; flex-wrap: wrap; }
        .hero-btn {
            padding: 16px 34px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            font-family: 'Space Grotesk', sans-serif;
            transition: all 0.3s;
            letter-spacing: -0.3px;
        }
        .hero-btn-primary { background: linear-gradient(135deg, var(--accent-green), #08A566); color: #000; }
        .hero-btn-secondary { background: transparent; color: var(--accent-blue); border: 1.5px solid var(--accent-blue); }
        .hero-btn:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(14,203,129,0.3); }

        .bonus-countdown-bar {
            background: linear-gradient(135deg, rgba(252,213,53,0.1), rgba(252,213,53,0.04));
            border: 1px solid rgba(252,213,53,0.3);
            border-radius: 14px;
            padding: 16px 24px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 12px;
        }
        .bonus-countdown-text { font-size: 15px; font-weight: 700; color: var(--accent-yellow); }
        .countdown-timer { display: flex; gap: 8px; align-items: center; }
        .countdown-unit {
            background: rgba(0,0,0,0.4);
            border: 1px solid rgba(252,213,53,0.3);
            border-radius: 8px;
            padding: 8px 12px;
            text-align: center;
            min-width: 54px;
        }
        .countdown-num {
            font-family: 'JetBrains Mono', monospace;
            font-size: 24px;
            font-weight: 700;
            color: var(--accent-yellow);
            display: block;
            line-height: 1;
        }
        .countdown-label { font-size: 9px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; }
        .countdown-colon { font-size: 22px; color: var(--accent-yellow); font-weight: 700; animation: blink 1s infinite; }
        .viewing-count {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            background: var(--accent-red-dim);
            border: 1px solid rgba(246,70,93,0.2);
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            color: var(--accent-red);
        }

        .section-title {
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--accent-green);
            margin-bottom: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .live-traders-section {
            background: var(--bg-secondary);
            border-radius: 14px;
            padding: 18px 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }
        .ticker-wrapper { overflow: hidden; }
        .ticker-content {
            display: flex;
            animation: slideLeft 80s linear infinite;
            white-space: nowrap;
            width: max-content;
        }
        .trader-card {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 10px 16px;
            background: var(--bg-card);
            border-radius: 10px;
            margin-right: 12px;
            border: 1px solid var(--border-color);
            min-width: 220px;
        }
        .trader-avatar {
            width: 36px; height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-green), var(--accent-blue));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }
        .trader-name { font-size: 13px; font-weight: 600; color: var(--text-primary); }
        .trader-profit { font-size: 14px; font-weight: 700; color: var(--accent-green); font-family: 'JetBrains Mono', monospace; }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 14px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 14px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        .stat-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, var(--accent-green-dim), transparent);
            opacity: 0;
            transition: opacity 0.3s;
        }
        .stat-card:hover::before { opacity: 1; }
        .stat-card:hover { border-color: var(--accent-green); transform: translateY(-4px); box-shadow: 0 8px 30px rgba(14,203,129,0.15); }
        .stat-icon { font-size: 30px; margin-bottom: 10px; }
        .stat-value { font-size: 28px; font-weight: 900; color: var(--accent-green); margin-bottom: 4px; font-family: 'JetBrains Mono', monospace; letter-spacing: -1px; animation: countUp 0.6s ease-out; }
        .stat-label { font-size: 11px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; font-weight: 600; }

        .winners-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 14px;
            margin-bottom: 20px;
        }
        .winner-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 14px;
            padding: 20px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        .winner-card:hover { border-color: var(--accent-green); transform: translateY(-4px); box-shadow: 0 10px 30px rgba(14,203,129,0.15); }
        .winner-rank {
            position: absolute;
            top: 12px; right: 12px;
            width: 32px; height: 32px;
            background: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            color: #000;
            font-size: 14px;
        }
        .winner-header { display: flex; align-items: center; gap: 12px; margin-bottom: 14px; }
        .winner-avatar {
            width: 52px; height: 52px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-green), var(--accent-blue));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            flex-shrink: 0;
        }
        .winner-name { font-size: 16px; font-weight: 700; margin-bottom: 2px; }
        .winner-location { font-size: 11px; color: var(--text-secondary); }
        .winner-join { font-size: 10px; color: var(--text-muted); margin-top: 2px; }
        .winner-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .winner-stat {
            background: var(--accent-green-dim);
            border: 1px solid rgba(14,203,129,0.15);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }
        .winner-stat-label { font-size: 10px; color: var(--text-secondary); margin-bottom: 3px; text-transform: uppercase; letter-spacing: 0.5px; }
        .winner-stat-value { font-size: 18px; font-weight: 700; color: var(--accent-green); font-family: 'JetBrains Mono', monospace; }

        .orderbook-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; margin-bottom: 20px; }
        .orderbook-side { background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 14px; padding: 16px; font-family: 'JetBrains Mono', monospace; }
        .orderbook-title { font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px; padding-bottom: 10px; border-bottom: 1px solid var(--border-color); }
        .orderbook-header { display: grid; grid-template-columns: 1fr 1fr 1fr; font-size: 10px; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 8px; padding: 0 4px; }
        .orderbook-row { display: grid; grid-template-columns: 1fr 1fr 1fr; font-size: 12px; padding: 5px 4px; border-radius: 4px; cursor: pointer; position: relative; overflow: hidden; margin-bottom: 2px; transition: opacity 0.2s; }
        .orderbook-row:hover { opacity: 0.8; }
        .orderbook-bar { position: absolute; top: 0; bottom: 0; opacity: 0.1; border-radius: 3px; transition: width 0.5s ease; }
        .ask-row .orderbook-bar { background: var(--accent-red); right: 0; }
        .bid-row .orderbook-bar { background: var(--accent-green); left: 0; }
        .ask-price { color: var(--accent-red); font-weight: 600; }
        .bid-price { color: var(--accent-green); font-weight: 600; }
        .ob-amount { color: var(--text-secondary); }
        .ob-total { color: var(--text-muted); }

        .pairs-selector { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 16px; }
        .pair-btn {
            padding: 8px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            font-family: 'Space Grotesk', sans-serif;
            transition: all 0.2s;
        }
        .pair-btn.active, .pair-btn:hover { border-color: var(--accent-green); color: var(--accent-green); background: var(--accent-green-dim); }

        .price-info { display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; background: var(--bg-card); border-radius: 12px; margin-bottom: 14px; border: 1px solid var(--border-color); }
        .current-price { font-size: 34px; font-weight: 900; color: var(--accent-green); font-family: 'JetBrains Mono', monospace; letter-spacing: -1px; transition: all 0.3s; }
        .current-price.flash-up { animation: flashGreen 0.5s ease; }
        .current-price.flash-down { animation: flashRed 0.5s ease; color: var(--accent-red); }
        .price-change { font-size: 15px; font-weight: 700; padding: 8px 16px; border-radius: 8px; font-family: 'JetBrains Mono', monospace; }
        .price-change.positive { background: var(--accent-green-dim); color: var(--accent-green); }
        .price-change.negative { background: var(--accent-red-dim); color: var(--accent-red); }

        .price-stats-bar { display: grid; grid-template-columns: repeat(6,1fr); gap: 8px; margin-bottom: 14px; padding: 12px 16px; background: var(--bg-card); border-radius: 10px; border: 1px solid var(--border-color); }
        .price-stat-item { text-align: center; }
        .price-stat-label { font-size: 10px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 3px; }
        .price-stat-value { font-size: 13px; font-weight: 700; color: var(--text-primary); font-family: 'JetBrains Mono', monospace; }

        .chart-section { background: var(--bg-secondary); border-radius: 14px; padding: 20px; margin-bottom: 20px; border: 1px solid var(--border-color); }
        .chart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 14px; flex-wrap: wrap; gap: 10px; }
        .chart-title { font-size: 16px; font-weight: 700; color: var(--accent-green); }
        .tv-chart-container { width: 100%; border-radius: 10px; overflow: hidden; border: 1px solid var(--border-color); }

        .auth-container { max-width: 460px; margin: 60px auto; padding: 40px; background: var(--bg-secondary); border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.5); border: 1px solid var(--border-color); }
        .auth-logo { text-align: center; margin-bottom: 28px; }
        .auth-logo-icon { font-size: 56px; display: block; margin-bottom: 8px; animation: pulse 2.5s infinite; }
        .auth-logo-text { font-size: 28px; font-weight: 900; background: linear-gradient(135deg, var(--accent-green), var(--accent-blue)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; letter-spacing: -1px; }
        .auth-title { font-size: 22px; font-weight: 700; text-align: center; margin-bottom: 24px; }

        .form-group { margin-bottom: 18px; }
        .form-group label { display: block; margin-bottom: 7px; font-size: 12px; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.8px; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 13px 16px; border: 1.5px solid var(--border-color); border-radius: 10px; background: var(--bg-card); color: var(--text-primary); font-size: 15px; font-family: 'Space Grotesk', sans-serif; transition: all 0.25s; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: var(--accent-green); box-shadow: 0 0 0 3px rgba(14,203,129,0.1); }
        .form-group select option { background: var(--bg-card); }
        .btn-submit { width: 100%; padding: 15px; border: none; border-radius: 10px; background: linear-gradient(135deg, var(--accent-green), #08A566); color: #000; font-size: 16px; font-weight: 700; font-family: 'Space Grotesk', sans-serif; cursor: pointer; transition: all 0.3s; letter-spacing: -0.3px; }
        .btn-submit:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(14,203,129,0.4); }

        .balance-card { background: linear-gradient(135deg, rgba(14,203,129,0.12) 0%, rgba(0,184,255,0.06) 100%); border: 1px solid rgba(14,203,129,0.25); border-radius: 16px; padding: 24px; margin-bottom: 20px; text-align: center; position: relative; overflow: hidden; }
        .balance-card::before { content: ''; position: absolute; top: -60%; left: 50%; transform: translateX(-50%); width: 300px; height: 200px; background: radial-gradient(ellipse, rgba(14,203,129,0.12) 0%, transparent 70%); }
        .balance-label { font-size: 11px; text-transform: uppercase; letter-spacing: 2px; color: var(--text-secondary); margin-bottom: 8px; font-weight: 700; }
        .balance-amount { font-size: 52px; font-weight: 900; color: var(--accent-green); font-family: 'JetBrains Mono', monospace; letter-spacing: -2px; margin-bottom: 16px; }
        .balance-sub { display: grid; grid-template-columns: repeat(3,1fr); gap: 10px; }
        .balance-sub-item { background: rgba(0,0,0,0.3); padding: 12px; border-radius: 8px; }
        .balance-sub-label { font-size: 10px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px; }
        .balance-sub-value { font-size: 15px; font-weight: 700; color: var(--text-primary); font-family: 'JetBrains Mono', monospace; }

        .action-buttons { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; margin-bottom: 20px; }
        .action-btn { padding: 18px 16px; border: none; border-radius: 12px; font-size: 14px; font-weight: 700; cursor: pointer; font-family: 'Space Grotesk', sans-serif; transition: all 0.3s; text-align: center; letter-spacing: -0.3px; }
        .action-btn:hover { transform: translateY(-3px); filter: brightness(1.1); box-shadow: 0 8px 20px rgba(0,0,0,0.3); }

        .account-switcher { display: flex; gap: 6px; background: var(--bg-card); padding: 5px; border-radius: 10px; border: 1px solid var(--border-color); }
        .switch-btn { padding: 9px 20px; border: none; border-radius: 7px; font-weight: 700; font-size: 13px; cursor: pointer; font-family: 'Space Grotesk', sans-serif; background: transparent; color: var(--text-secondary); transition: all 0.25s; }
        .switch-btn.active { background: linear-gradient(135deg, var(--accent-green), #08A566); color: #000; }

        .payment-grid { display: grid; grid-template-columns: repeat(2,1fr); gap: 10px; margin-bottom: 18px; }
        .payment-btn { padding: 18px 14px; border: 1.5px solid var(--border-color); border-radius: 10px; background: var(--bg-card); color: var(--text-primary); cursor: pointer; font-family: 'Space Grotesk', sans-serif; font-size: 14px; font-weight: 600; text-align: center; transition: all 0.25s; }
        .payment-btn.active, .payment-btn:hover { border-color: var(--accent-green); background: var(--accent-green-dim); color: var(--accent-green); }
        .payment-details { background: var(--accent-green-dim); border: 1.5px solid rgba(14,203,129,0.25); border-radius: 12px; padding: 20px; margin: 14px 0; display: none; }
        .payment-details.active { display: block; animation: fadeUp 0.3s ease-out; }
        .payment-value { font-family: 'JetBrains Mono', monospace; font-size: 16px; font-weight: 700; color: var(--accent-green); word-break: break-all; background: rgba(0,0,0,0.3); padding: 12px 16px; border-radius: 8px; margin: 10px 0; }
        .copy-btn { width: 100%; background: linear-gradient(135deg, var(--accent-blue), #0088cc); color: #fff; border: none; padding: 11px 18px; border-radius: 8px; font-weight: 700; font-size: 13px; font-family: 'Space Grotesk', sans-serif; cursor: pointer; transition: all 0.25s; }
        .copy-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,184,255,0.4); }

        .how-to-pay { background: rgba(14,203,129,0.05); border-left: 3px solid var(--accent-green); padding: 14px 16px; border-radius: 0 8px 8px 0; margin-top: 14px; }
        .how-to-pay-title { font-size: 13px; font-weight: 700; color: var(--accent-green); margin-bottom: 8px; }
        .how-to-pay ol { margin-left: 18px; font-size: 12px; color: var(--text-primary); line-height: 2; }

        .progress-bar-container { background: var(--bg-card); border: 1px solid rgba(14,203,129,0.2); border-radius: 14px; padding: 20px; margin-bottom: 16px; display: none; }
        .progress-bar-container.show { display: block; animation: fadeUp 0.3s ease-out; }
        .progress-label { font-size: 14px; font-weight: 700; margin-bottom: 12px; color: var(--accent-green); }
        .progress-bar-track { background: var(--bg-tertiary); border-radius: 100px; height: 10px; overflow: hidden; margin-bottom: 8px; }
        .progress-bar-fill { height: 100%; background: linear-gradient(90deg, var(--accent-green), var(--accent-blue)); border-radius: 100px; width: 0%; transition: width 0.6s ease; }
        .progress-text { font-size: 12px; color: var(--text-secondary); font-family: 'JetBrains Mono', monospace; }

        .live-winner-toast { position: fixed; bottom: 90px; right: 20px; background: var(--bg-card); border: 1.5px solid var(--accent-green); border-radius: 14px; padding: 14px 18px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); z-index: 9997; max-width: 280px; display: flex; align-items: center; gap: 12px; animation: slideInRight 0.4s ease-out; }
        .live-winner-toast.hiding { animation: slideOutRight 0.4s ease-in forwards; }
        .winner-toast-avatar { font-size: 30px; flex-shrink: 0; }
        .winner-toast-name { font-size: 13px; font-weight: 700; color: var(--text-primary); }
        .winner-toast-amount { font-size: 16px; font-weight: 900; color: var(--accent-green); font-family: 'JetBrains Mono', monospace; }
        .winner-toast-action { font-size: 11px; color: var(--text-secondary); margin-top: 2px; }

        .toast-notification { position: fixed; top: 80px; right: 20px; background: var(--bg-card); border: 1px solid var(--accent-green); color: var(--text-primary); padding: 16px 22px; border-radius: 14px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); z-index: 10000; max-width: 380px; display: none; white-space: pre-line; font-size: 14px; line-height: 1.6; animation: slideInRight 0.4s ease-out; }
        .toast-notification.show { display: block; }
        .toast-notification.error { border-color: var(--accent-red); }

        .referral-banner { position: fixed; top: 0; left: 0; right: 0; background: linear-gradient(135deg, #0ECB81, #0B8F5F); padding: 20px; text-align: center; z-index: 9999; display: none; animation: slideDown 0.5s ease-out; }
        .referral-banner.show { display: block; }
        .referral-banner h2 { font-size: 24px; color: #fff; font-weight: 900; margin-bottom: 6px; }
        .referral-banner p { font-size: 15px; color: rgba(255,255,255,0.92); line-height: 1.6; }
        .bonus-big { display: inline-block; font-size: 40px; font-weight: 900; color: var(--accent-yellow); animation: pulse 2s infinite; margin: 8px 0; }
        .close-banner { position: absolute; top: 12px; right: 16px; background: rgba(255,255,255,0.2); border: none; color: #fff; font-size: 22px; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; transition: all 0.3s; }
        .close-banner:hover { background: rgba(255,255,255,0.35); transform: rotate(90deg); }

        .ai-assistant-btn { position: fixed; bottom: 90px; right: 20px; z-index: 1000; display: none; }
        .ai-btn-inner { width: 60px; height: 60px; background: linear-gradient(135deg, var(--accent-purple), #7c3aed); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 26px; cursor: pointer; box-shadow: 0 4px 20px rgba(168,85,247,0.5); transition: all 0.3s; border: none; animation: glow 3s ease-in-out infinite; }
        .ai-btn-inner:hover { transform: scale(1.1); }
        .ai-pulse-ring { position: absolute; inset: -4px; border-radius: 50%; border: 2px solid rgba(168,85,247,0.4); animation: rotate 3s linear infinite; pointer-events: none; }
        .ai-chat-panel { position: fixed; bottom: 170px; right: 20px; width: 340px; background: var(--bg-card); border: 1px solid rgba(168,85,247,0.4); border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.6); z-index: 1001; display: none; overflow: hidden; flex-direction: column; }
        .ai-chat-panel.open { display: flex; animation: fadeUp 0.3s ease-out; }
        .ai-chat-header { background: linear-gradient(135deg, rgba(168,85,247,0.2), rgba(168,85,247,0.05)); padding: 16px 20px; border-bottom: 1px solid rgba(168,85,247,0.2); display: flex; align-items: center; gap: 12px; }
        .ai-avatar { width: 40px; height: 40px; background: linear-gradient(135deg, var(--accent-purple), #7c3aed); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; flex-shrink: 0; }
        .ai-name { font-size: 15px; font-weight: 700; }
        .ai-status { font-size: 11px; color: var(--accent-green); display: flex; align-items: center; gap: 4px; margin-top: 2px; }
        .ai-chat-messages { flex: 1; padding: 16px; max-height: 280px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .ai-msg { max-width: 85%; padding: 10px 14px; border-radius: 12px; font-size: 13px; line-height: 1.5; }
        .ai-msg.bot { background: rgba(168,85,247,0.12); border: 1px solid rgba(168,85,247,0.2); align-self: flex-start; border-radius: 4px 12px 12px 12px; }
        .ai-msg.user { background: var(--accent-green-dim); border: 1px solid rgba(14,203,129,0.2); align-self: flex-end; border-radius: 12px 4px 12px 12px; color: var(--accent-green); }
        .ai-typing { display: flex; gap: 4px; padding: 10px 14px; background: rgba(168,85,247,0.12); border-radius: 4px 12px 12px 12px; align-self: flex-start; width: fit-content; }
        .ai-typing span { width: 6px; height: 6px; background: var(--accent-purple); border-radius: 50%; animation: blink 1s infinite; }
        .ai-typing span:nth-child(2) { animation-delay: 0.2s; }
        .ai-typing span:nth-child(3) { animation-delay: 0.4s; }
        .ai-quick-replies { padding: 10px 16px; display: flex; gap: 6px; flex-wrap: wrap; border-top: 1px solid rgba(168,85,247,0.15); }
        .ai-quick-btn { padding: 6px 12px; background: rgba(168,85,247,0.1); border: 1px solid rgba(168,85,247,0.25); border-radius: 20px; color: var(--accent-purple); font-size: 11px; font-weight: 600; cursor: pointer; font-family: 'Space Grotesk', sans-serif; transition: all 0.2s; }
        .ai-quick-btn:hover { background: rgba(168,85,247,0.2); }
        .ai-input-row { padding: 12px 16px; border-top: 1px solid rgba(168,85,247,0.15); display: flex; gap: 8px; }
        .ai-input { flex: 1; padding: 10px 14px; background: var(--bg-tertiary); border: 1px solid rgba(168,85,247,0.25); border-radius: 10px; color: var(--text-primary); font-size: 13px; font-family: 'Space Grotesk', sans-serif; outline: none; }
        .ai-send-btn { width: 38px; height: 38px; background: linear-gradient(135deg, var(--accent-purple), #7c3aed); border: none; border-radius: 10px; color: #fff; font-size: 16px; cursor: pointer; transition: all 0.2s; }
        .ai-send-btn:hover { transform: scale(1.1); }

        .bot-card { background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 14px; padding: 22px; transition: all 0.3s; }
        .bot-card:hover { border-color: var(--accent-green); transform: translateY(-4px); box-shadow: 0 10px 30px rgba(14,203,129,0.15); }

        .active-bot-item { background: rgba(0,0,0,0.3); border-radius: 12px; padding: 18px; margin-bottom: 12px; border: 1px solid var(--border-color); transition: border-color 0.3s; }
        .active-bot-item.running { border-color: rgba(14,203,129,0.3); }
        .active-bot-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 14px; }
        .active-bot-stats { display: grid; grid-template-columns: repeat(3,1fr); gap: 10px; }
        .active-bot-stat { text-align: center; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 8px; }
        .active-bot-stat-label { font-size: 10px; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 4px; }
        .active-bot-stat-value { font-size: 18px; font-weight: 900; font-family: 'JetBrains Mono', monospace; }

        .history-item { background: var(--bg-card); border-radius: 12px; padding: 18px; margin-bottom: 10px; border: 1px solid var(--border-color); transition: all 0.2s; }
        .history-item:hover { border-color: rgba(14,203,129,0.3); }

        .profile-info-box { background: var(--bg-card); border-radius: 12px; padding: 20px; border: 1px solid var(--border-color); }
        .profile-info-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border-color); }
        .profile-info-row:last-child { border-bottom: none; }
        .profile-info-label { font-size: 12px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600; }
        .profile-info-value { font-size: 15px; font-weight: 700; }
        .verified-badge { display: inline-flex; align-items: center; gap: 4px; padding: 3px 10px; background: var(--accent-green-dim); border: 1px solid rgba(14,203,129,0.3); border-radius: 20px; font-size: 11px; font-weight: 700; color: var(--accent-green); }

        .share-rewards-card { background: linear-gradient(135deg, rgba(252,213,53,0.12), rgba(252,213,53,0.04)); border: 1px solid rgba(252,213,53,0.3); border-radius: 14px; padding: 22px; margin-bottom: 20px; }
        .share-stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; background: rgba(0,0,0,0.3); padding: 18px; border-radius: 10px; margin: 14px 0; }
        .share-stat { text-align: center; }
        .share-stat-label { font-size: 11px; color: var(--text-secondary); margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px; }
        .share-stat-value { font-size: 30px; font-weight: 900; font-family: 'JetBrains Mono', monospace; }

        .whatsapp-support { position: fixed; bottom: 20px; left: 20px; z-index: 1000; }
        .whatsapp-btn { display: flex; align-items: center; gap: 10px; background: linear-gradient(135deg, #25D366, #128C7E); color: #fff; padding: 14px 22px; border-radius: 50px; text-decoration: none; font-weight: 700; font-size: 14px; font-family: 'Space Grotesk', sans-serif; box-shadow: 0 4px 20px rgba(37,211,102,0.4); transition: all 0.3s; }
        .whatsapp-btn:hover { transform: translateY(-3px); box-shadow: 0 8px 30px rgba(37,211,102,0.6); }

        .alert { padding: 11px 15px; border-radius: 8px; margin-bottom: 16px; font-size: 13px; display: none; }
        .alert.show { display: block; animation: fadeUp 0.3s ease-out; }
        .alert-success { background: var(--accent-green-dim); border: 1px solid rgba(14,203,129,0.3); color: var(--accent-green); }
        .alert-error { background: var(--accent-red-dim); border: 1px solid rgba(246,70,93,0.3); color: var(--accent-red); }

        .confetti-piece { position: fixed; z-index: 9999; pointer-events: none; border-radius: 2px; }

        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: var(--bg-primary); }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }

        .mobile-bottom-nav { display: none; position: fixed; bottom: 0; left: 0; right: 0; background: var(--bg-secondary); border-top: 1px solid var(--border-color); padding: 8px 0; z-index: 999; }
        @media (max-width: 768px) { .mobile-bottom-nav { display: flex; } }
        .mobile-nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 3px; cursor: pointer; padding: 6px 0; transition: all 0.2s; }
        .mobile-nav-item.active .mobile-nav-icon, .mobile-nav-item.active .mobile-nav-label { color: var(--accent-green); }
        .mobile-nav-icon { font-size: 20px; }
        .mobile-nav-label { font-size: 10px; color: var(--text-secondary); font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }

        @media (max-width: 768px) {
            .container { padding: 12px; }
            .hero-section h1 { font-size: 32px; }
            .hero-section { padding: 28px 20px; }
            .orderbook-grid { grid-template-columns: 1fr; }
            .price-stats-bar { grid-template-columns: repeat(3,1fr); }
            .balance-amount { font-size: 38px; }
            .ai-chat-panel { width: calc(100vw - 40px); right: 20px; }
            .market-ticker-bar { display: none; }
            .payment-grid { grid-template-columns: 1fr; }
            .navbar { top: 0; }
        }
    </style>
</head>
<body>

<!-- ===== REFERRAL BANNER ===== -->
<div id="referralSuccessBanner" class="referral-banner">
    <button class="close-banner" onclick="closeReferralBanner()">√ó</button>
    <h2>üéâ CONGRATULATIONS! üéâ</h2>
    <p><strong id="referrerName">Your friend</strong> is crushing it on CryptoPro!</p>
    <div class="bonus-big">GET $25 BONUS!</div>
    <p>‚úÖ Sign up now &nbsp;‚úÖ 100% withdrawable &nbsp;‚úÖ Start earning day one</p>
</div>

<!-- ===== TOAST ===== -->
<div id="toastNotification" class="toast-notification"></div>

<!-- ===== MARKET TICKER BAR ===== -->
<div class="market-ticker-bar">
    <div class="ticker-track" id="marketTickerTrack"></div>
</div>

<!-- ===== AI ASSISTANT BUTTON ===== -->
<div class="ai-assistant-btn" id="aiAssistantBtn">
    <button class="ai-btn-inner" onclick="toggleAIChat()">ü§ñ</button>
    <div class="ai-pulse-ring"></div>
</div>

<!-- ===== AI CHAT PANEL ===== -->
<div class="ai-chat-panel" id="aiChatPanel">
    <div class="ai-chat-header">
        <div class="ai-avatar">ü§ñ</div>
        <div>
            <div class="ai-name">ARIA ‚Äî CryptoPro AI</div>
            <div class="ai-status"><span class="status-dot"></span> Online ‚Ä¢ Always ready</div>
        </div>
        <button onclick="toggleAIChat()" style="margin-left:auto;background:none;border:none;color:var(--text-secondary);font-size:20px;cursor:pointer;line-height:1;">√ó</button>
    </div>
    <div class="ai-chat-messages" id="aiMessages">
        <div class="ai-msg bot">üëã Hi! I'm <strong>ARIA</strong>, your AI trading assistant.<br><br>I can help you with market insights, trading strategies, deposit guides and more. What would you like to know?</div>
    </div>
    <div class="ai-quick-replies">
        <button class="ai-quick-btn" onclick="sendAIQuickReply('Best bot for beginners?')">Best bot?</button>
        <button class="ai-quick-btn" onclick="sendAIQuickReply('How do I deposit?')">How to deposit?</button>
        <button class="ai-quick-btn" onclick="sendAIQuickReply('BTC price prediction?')">BTC outlook?</button>
        <button class="ai-quick-btn" onclick="sendAIQuickReply('How does withdrawal work?')">Withdraw?</button>
        <button class="ai-quick-btn" onclick="sendAIQuickReply('How does referral work?')">Referrals?</button>
    </div>
    <div class="ai-input-row">
        <input type="text" class="ai-input" id="aiInput" placeholder="Ask ARIA anything..." onkeydown="if(event.key==='Enter')sendAIMessage()">
        <button class="ai-send-btn" onclick="sendAIMessage()">‚û§</button>
    </div>
</div>

<!-- ===== WELCOME LAYER ===== -->
<div id="welcomeLayer" class="layer active">
    <nav class="navbar">
        <div class="logo" onclick="showLayer('welcomeLayer')">
            <div class="logo-icon">‚Çø</div>
            CryptoPro
        </div>
        <div class="nav-links">
            <button class="nav-btn btn-login" onclick="showLayer('loginLayer')">Login</button>
            <button class="nav-btn btn-signup" onclick="showLayer('signupLayer')">Sign Up Free</button>
        </div>
    </nav>
    <div class="container">
        <div class="bonus-countdown-bar">
            <div>
                <div class="bonus-countdown-text">üî• 100% Welcome Bonus ‚Äî First Deposit DOUBLED!</div>
                <div style="font-size:12px;color:var(--text-secondary);margin-top:3px;">Limited time offer ‚Äî Don't miss out!</div>
            </div>
            <div class="countdown-timer">
                <div class="countdown-unit"><span class="countdown-num" id="cdHours">23</span><span class="countdown-label">Hours</span></div>
                <span class="countdown-colon">:</span>
                <div class="countdown-unit"><span class="countdown-num" id="cdMins">47</span><span class="countdown-label">Mins</span></div>
                <span class="countdown-colon">:</span>
                <div class="countdown-unit"><span class="countdown-num" id="cdSecs">00</span><span class="countdown-label">Secs</span></div>
            </div>
            <div class="viewing-count">üî¥ <span id="viewingCount">47</span> people viewing</div>
        </div>
        <div class="hero-section">
            <h1>üöÄ The Future of<br>Crypto Trading</h1>
            <p>Join 50,000+ successful traders earning daily profits with AI-powered automation. Get started with a <strong style="color:var(--accent-green);">$25 signup bonus</strong> and experience professional trading today!</p>
            <div class="hero-cta">
                <button class="hero-btn hero-btn-primary" onclick="showLayer('signupLayer')">Get Started ‚Äî Free $25 Bonus</button>
                <button class="hero-btn hero-btn-secondary" onclick="showLayer('chartsLayer')">View Live Charts</button>
            </div>
        </div>
        <div class="live-traders-section">
            <div class="section-title">üî• Live Active Traders ‚Äî Real-Time Profits</div>
            <div class="ticker-wrapper">
                <div class="ticker-content" id="liveTradersTicker"></div>
            </div>
        </div>
        <div class="stats-grid">
            <div class="stat-card"><div class="stat-icon">üë•</div><div class="stat-value" id="statTraders">50,247</div><div class="stat-label">Active Traders</div></div>
            <div class="stat-card"><div class="stat-icon">üí∞</div><div class="stat-value" id="statProfits">$125M+</div><div class="stat-label">Total Profits Paid</div></div>
            <div class="stat-card"><div class="stat-icon">üìà</div><div class="stat-value">98.5%</div><div class="stat-label">Success Rate</div></div>
            <div class="stat-card"><div class="stat-icon">‚ö°</div><div class="stat-value" id="statTrades">15,892</div><div class="stat-label">Daily Trades</div></div>
        </div>
        <div class="chart-section">
            <div class="section-title">üèÜ Top Traders This Week</div>
            <div class="winners-grid" id="topWinnersGrid"></div>
        </div>
        <div class="action-buttons">
            <button class="action-btn" style="background:linear-gradient(135deg,#fbbf24,#f59e0b);color:#000;" onclick="showLayer('reviewsLayer')">‚≠ê See Reviews</button>
            <button class="action-btn" style="background:linear-gradient(135deg,var(--accent-green),#08A566);color:#000;" onclick="showLayer('signupLayer')">üìä Start Trading Now</button>
        </div>
    </div>
    <div class="whatsapp-support">
        <a href="https://wa.me/254759401893" class="whatsapp-btn" target="_blank"><span style="font-size:24px;">üí¨</span> Support</a>
    </div>
</div>

<!-- ===== CHARTS LAYER ===== -->
<div id="chartsLayer" class="layer">
    <nav class="navbar">
        <div class="logo" onclick="showLayer('welcomeLayer')"><div class="logo-icon">‚Çø</div>CryptoPro</div>
        <div class="nav-links">
            <div class="status-badge"><span class="status-dot"></span> LIVE</div>
            <button class="nav-btn btn-signup" onclick="showLayer('signupLayer')">Sign Up</button>
        </div>
    </nav>
    <div class="container">
        <div class="pairs-selector" id="chartPairsSelector">
            <button class="pair-btn active" onclick="selectChartPair(this,'BTCUSDT','BTC/USDT','Bitcoin / USDT')">BTC/USDT</button>
            <button class="pair-btn" onclick="selectChartPair(this,'ETHUSDT','ETH/USDT','Ethereum / USDT')">ETH/USDT</button>
            <button class="pair-btn" onclick="selectChartPair(this,'BNBUSDT','BNB/USDT','BNB / USDT')">BNB/USDT</button>
            <button class="pair-btn" onclick="selectChartPair(this,'SOLUSDT','SOL/USDT','Solana / USDT')">SOL/USDT</button>
            <button class="pair-btn" onclick="selectChartPair(this,'ADAUSDT','ADA/USDT','Cardano / USDT')">ADA/USDT</button>
            <button class="pair-btn" onclick="selectChartPair(this,'XRPUSDT','XRP/USDT','Ripple / USDT')">XRP/USDT</button>
        </div>
        <div class="chart-section">
            <div class="chart-header">
                <div class="chart-title">üìà <span id="chartPairLabel">BTC/USDT</span> Live Chart</div>
                <div class="status-badge"><span class="status-dot"></span> LIVE</div>
            </div>
            <div class="price-info">
                <div>
                    <div class="current-price" id="currentPrice">$98,245.50</div>
                    <div style="font-size:12px;color:var(--text-secondary);margin-top:4px;" id="currentPairSub">Bitcoin / USDT</div>
                </div>
                <div class="price-change positive" id="priceChange">+2.45%</div>
            </div>
            <div class="price-stats-bar">
                <div class="price-stat-item"><div class="price-stat-label">24h High</div><div class="price-stat-value" id="chartHigh">$99,120</div></div>
                <div class="price-stat-item"><div class="price-stat-label">24h Low</div><div class="price-stat-value" id="chartLow">$96,800</div></div>
                <div class="price-stat-item"><div class="price-stat-label">Volume</div><div class="price-stat-value" id="chartVolume">28.5B</div></div>
                <div class="price-stat-item"><div class="price-stat-label">Open</div><div class="price-stat-value" id="chartOpen">$97,850</div></div>
                <div class="price-stat-item"><div class="price-stat-label">Close</div><div class="price-stat-value" id="chartClose">$98,245</div></div>
                <div class="price-stat-item"><div class="price-stat-label">24h Change</div><div class="price-stat-value" id="chart24h" style="color:var(--accent-green);">+2.45%</div></div>
            </div>
            <div class="tv-chart-container">
                <div id="tv_chart_main" style="height:500px;"></div>
            </div>
        </div>
    </div>
    <div class="whatsapp-support">
        <a href="https://wa.me/254759401893" class="whatsapp-btn" target="_blank"><span style="font-size:24px;">üí¨</span> Support</a>
    </div>
</div>

<!-- ===== SIGNUP LAYER ===== -->
<div id="signupLayer" class="layer">
    <div class="auth-container">
        <div class="auth-logo">
            <span class="auth-logo-icon">üíé</span>
            <div class="auth-logo-text">CryptoPro</div>
        </div>
        <div class="auth-title">Start Your Trading Journey</div>
        <div style="background:var(--accent-green-dim);border:1px solid rgba(14,203,129,0.3);border-radius:10px;padding:12px 16px;margin-bottom:20px;text-align:center;">
            <div style="font-size:14px;font-weight:700;color:var(--accent-green);">üéÅ You'll receive $25 INSTANT BONUS on signup!</div>
        </div>
        <div id="signupAlert" class="alert"></div>
        <form onsubmit="return handleSignup(event)">
            <div class="form-group"><label>Full Name</label><input type="text" id="signupName" placeholder="Enter your full name" required></div>
            <div class="form-group"><label>Email Address</label><input type="email" id="signupEmail" placeholder="your@email.com" required></div>
            <div class="form-group"><label>Phone Number</label><input type="tel" id="signupPhone" placeholder="+254 712 345 678" required></div>
            <div class="form-group"><label>Password</label><input type="password" id="signupPassword" placeholder="Create strong password" required></div>
            <div class="form-group"><label>Confirm Password</label><input type="password" id="signupConfirm" placeholder="Re-enter password" required></div>
            <div class="form-group"><label>Referral Code (Optional)</label><input type="text" id="signupReferralCode" placeholder="Enter referral code if you have one"></div>
            <button type="submit" class="btn-submit">üöÄ Create Account & Get $25 Bonus</button>
        </form>
        <div style="text-align:center;margin-top:20px;font-size:14px;color:var(--text-secondary);">
            Already have an account? <a onclick="showLayer('loginLayer')" style="color:var(--accent-green);cursor:pointer;font-weight:700;">Login Here</a>
        </div>
    </div>
    <div class="whatsapp-support">
        <a href="https://wa.me/254759401893" class="whatsapp-btn" target="_blank"><span style="font-size:24px;">üí¨</span> Support</a>
    </div>
</div>

<!-- ===== LOGIN LAYER ===== -->
<div id="loginLayer" class="layer">
    <div class="auth-container">
        <div class="auth-logo">
            <span class="auth-logo-icon">üíé</span>
            <div class="auth-logo-text">CryptoPro</div>
        </div>
        <div class="auth-title">Welcome Back</div>
        <div id="loginAlert" class="alert"></div>
        <form onsubmit="return handleLogin(event)">
            <div class="form-group"><label>Email Address</label><input type="email" id="loginEmail" placeholder="your@email.com" required></div>
            <div class="form-group"><label>Password</label><input type="password" id="loginPassword" placeholder="Enter your password" required></div>
            <button type="submit" class="btn-submit">üîê Login to Account</button>
        </form>
        <div style="text-align:center;margin-top:20px;font-size:14px;color:var(--text-secondary);">
            Don't have an account? <a onclick="showLayer('signupLayer')" style="color:var(--accent-green);cursor:pointer;font-weight:700;">Create Account</a>
        </div>
    </div>
    <div class="whatsapp-support">
        <a href="https://wa.me/254759401893" class="whatsapp-btn" target="_blank"><span style="font-size:24px;">üí¨</span> Support</a>
    </div>
</div>

<!-- ===== DASHBOARD LAYER ===== -->
<div id="dashboardLayer" class="layer">
    <nav class="navbar">
        <div class="logo"><div class="logo-icon">‚Çø</div>CryptoPro</div>
        <div class="nav-links">
            <div class="status-badge"><span class="status-dot"></span> LIVE</div>
            <div style="position:relative;" id="notifBellWrapper">
                <div class="notif-bell" onclick="toggleNotifications()">üîî<div class="notif-count" id="notifCount">3</div></div>
                <div class="notif-dropdown" id="notifDropdown">
                    <div class="notif-header">Notifications<span style="font-size:11px;color:var(--accent-green);cursor:pointer;font-weight:600;" onclick="clearNotifications()">Mark all read</span></div>
                    <div id="notifList"></div>
                </div>
            </div>
            <button class="nav-btn btn-login" onclick="handleLogout()">Logout</button>
        </div>
    </nav>
    <div class="container">
        <div style="background:var(--bg-secondary);padding:18px 20px;border-radius:14px;margin-bottom:18px;border:1px solid var(--border-color);display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:14px;">
            <div style="display:flex;align-items:center;gap:12px;">
                <div style="width:50px;height:50px;border-radius:50%;background:linear-gradient(135deg,var(--accent-green),var(--accent-blue));display:flex;align-items:center;justify-content:center;font-size:24px;flex-shrink:0;">üë§</div>
                <div>
                    <div style="font-size:18px;font-weight:700;" id="userName">User</div>
                    <div style="font-size:12px;color:var(--text-secondary);" id="userEmail">email@example.com</div>
                    <div class="verified-badge" style="margin-top:5px;">‚úì Verified Trader</div>
                </div>
            </div>
            <div class="account-switcher">
                <button class="switch-btn active" id="switchToDemo" onclick="switchAccount('demo')">üìä DEMO</button>
                <button class="switch-btn" id="switchToReal" onclick="switchAccount('real')">üíé REAL</button>
            </div>
        </div>
        <div id="accountModeIndicator" style="margin-bottom:16px;"></div>
        <div class="balance-card">
            <div class="balance-label"><span id="accountTypeLabel">DEMO</span> Account Balance</div>
            <div class="balance-amount" id="dashBalance">$25.00</div>
            <div class="balance-sub">
                <div class="balance-sub-item"><div class="balance-sub-label">Available</div><div class="balance-sub-value" id="dashAvailable">$25.00</div></div>
                <div class="balance-sub-item"><div class="balance-sub-label">In Trades</div><div class="balance-sub-value" id="dashInTrades">$0.00</div></div>
                <div class="balance-sub-item"><div class="balance-sub-label">Total Profit</div><div class="balance-sub-value" style="color:var(--accent-green);" id="dashProfit">$0.00</div></div>
            </div>
        </div>
        <div class="action-buttons">
            <button class="action-btn" style="background:linear-gradient(135deg,#fbbf24,#f59e0b);color:#000;" onclick="showLayer('tradingLayer')">‚ö° Trade Now</button>
            <button class="action-btn" style="background:linear-gradient(135deg,var(--accent-green),#08A566);color:#000;" onclick="showLayer('depositLayer')">üí∞ Deposit</button>
            <button class="action-btn" style="background:linear-gradient(135deg,#10b981,#059669);color:#fff;" onclick="showLayer('botsLayer')">ü§ñ AI Bots</button>
        </div>
        <div class="chart-section">
            <div class="chart-header">
                <div class="chart-title">üìà Live Market Overview</div>
                <div class="status-badge"><span class="status-dot"></span> LIVE</div>
            </div>
            <div class="tv-chart-container">
                <div id="tv_chart_dash" style="height:280px;"></div>
            </div>
        </div>
        <div class="action-buttons">
            <button class="action-btn" style="background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff;" onclick="showLayer('historyLayer')">üìú Trade History</button>
            <button class="action-btn" style="background:linear-gradient(135deg,#8b5cf6,#7c3aed);color:#fff;" onclick="showLayer('withdrawalLayer')">üí∏ Withdraw</button>
            <button class="action-btn" style="background:linear-gradient(135deg,#ec4899,#db2777);color:#fff;" onclick="showLayer('referralLayer')">üéÅ Referrals</button>
            <button class="action-btn" style="background:linear-gradient(135deg,#06b6d4,#0891b2);color:#fff;" onclick="showLayer('profileLayer')">‚öôÔ∏è Profile</button>
        </div>
    </div>
    <div class="whatsapp-support">
        <a href="https://wa.me/254759401893" class="whatsapp-btn" target="_blank"><span style="font-size:24px;">üí¨</span> Support</a>
    </div>
    <div class="mobile-bottom-nav">
        <div class="mobile-nav-item active" onclick="showLayer('dashboardLayer')"><div class="mobile-nav-icon">üè†</div><div class="mobile-nav-label">Home</div></div>
        <div class="mobile-nav-item" onclick="showLayer('tradingLayer')"><div class="mobile-nav-icon">üìä</div><div class="mobile-nav-label">Trade</div></div>
        <div class="mobile-nav-item" onclick="showLayer('depositLayer')"><div class="mobile-nav-icon">üí∞</div><div class="mobile-nav-label">Deposit</div></div>
        <div class="mobile-nav-item" onclick="showLayer('withdrawalLayer')"><div class="mobile-nav-icon">üí∏</div><div class="mobile-nav-label">Withdraw</div></div>
        <div class="mobile-nav-item" onclick="showLayer('profileLayer')"><div class="mobile-nav-icon">üë§</div><div class="mobile-nav-label">Profile</div></div>
    </div>
</div>

<!-- ===== DEPOSIT LAYER ===== -->
<div id="depositLayer" class="layer">
    <nav class="navbar">
        <div class="logo" onclick="showLayer('dashboardLayer')"><div class="logo-icon">‚Çø</div>CryptoPro</div>
        <div class="nav-links"><button class="nav-btn btn-login" onclick="showLayer('dashboardLayer')">‚Üê Dashboard</button></div>
    </nav>
    <div class="container">
        <div class="hero-section" style="padding:28px 32px;">
            <h1 style="font-size:38px;">üí∞ Deposit Funds</h1>
            <p style="margin-bottom:0;">Fund your account instantly. Auto-credited within 5 minutes after verification.</p>
        </div>
        <div class="bonus-countdown-bar">
            <div>
                <div class="bonus-countdown-text">üéâ 100% WELCOME BONUS ‚Äî First Deposit Doubled!</div>
                <div style="font-size:12px;color:var(--text-secondary);margin-top:3px;">This offer expires in:</div>
            </div>
            <div class="countdown-timer">
                <div class="countdown-unit"><span class="countdown-num" id="cdHours2">23</span><span class="countdown-label">Hrs</span></div>
                <span class="countdown-colon">:</span>
                <div class="countdown-unit"><span class="countdown-num" id="cdMins2">47</span><span class="countdown-label">Min</span></div>
                <span class="countdown-colon">:</span>
                <div class="countdown-unit"><span class="countdown-num" id="cdSecs2">00</span><span class="countdown-label">Sec</span></div>
            </div>
            <div class="viewing-count">üëÅ <span id="depositViewers">23</span> people depositing now</div>
        </div>
        <div class="progress-bar-container" id="depositProgressBar">
            <div class="progress-label" id="progressLabel">‚è≥ Verifying payment...</div>
            <div class="progress-bar-track"><div class="progress-bar-fill" id="progressFill"></div></div>
            <div class="progress-text" id="progressText">0% complete</div>
        </div>
        <div class="chart-section">
            <form id="depositForm" onsubmit="return processDeposit(event)">
                <div class="form-group">
                    <label>Deposit Amount (USD)</label>
                    <input type="number" id="depositAmount" min="10" step="0.01" placeholder="Minimum $10" required oninput="updateCurrencyConversion()">
                </div>
                <div id="currencyConverterContainer"></div>
                <div class="form-group">
                    <label>Select Payment Method</label>
                    <div class="payment-grid">
                        <button type="button" class="payment-btn" onclick="selectPaymentMethod('mpesa-phone',this)">üì± M-Pesa<br><small style="font-size:11px;opacity:0.7;">+254759401893</small></button>
                        <button type="button" class="payment-btn" onclick="selectPaymentMethod('mpesa-till',this)">üè™ M-Pesa Till<br><small style="font-size:11px;opacity:0.7;">7500448</small></button>
                        <button type="button" class="payment-btn" onclick="selectPaymentMethod('bank',this)">üè¶ Bank Transfer<br><small style="font-size:11px;opacity:0.7;">Equity Bank</small></button>
                        <button type="button" class="payment-btn" onclick="selectPaymentMethod('crypto',this)">ü™ô USDT Crypto<br><small style="font-size:11px;opacity:0.7;">TRC-20</small></button>
                    </div>
                </div>
                <div id="mpesa-phone" class="payment-details">
                    <div style="text-align:center;font-size:17px;font-weight:700;color:var(--accent-green);margin-bottom:14px;">üì± M-Pesa Phone Number</div>
                    <div style="font-size:12px;color:var(--text-secondary);margin-bottom:4px;">Send Money To:</div>
                    <div class="payment-value">+254759401893</div>
                    <button type="button" class="copy-btn" onclick="copyToClipboard('+254759401893')">üìã Copy Phone Number</button>
                    <div class="how-to-pay">
                        <div class="how-to-pay-title">How to Pay via M-Pesa:</div>
                        <ol>
                            <li>Open M-Pesa on your phone</li>
                            <li>Select <strong>"Send Money"</strong></li>
                            <li>Enter number: <strong>+254759401893</strong></li>
                            <li>Enter the amount in KES (see converter above)</li>
                            <li>Enter your M-Pesa PIN and confirm</li>
                            <li>Wait for confirmation SMS</li>
                            <li>Submit the screenshot or M-Pesa code below</li>
                        </ol>
                    </div>
                </div>
                <div id="mpesa-till" class="payment-details">
                    <div style="text-align:center;font-size:17px;font-weight:700;color:var(--accent-green);margin-bottom:14px;">üè™ M-Pesa Till Number</div>
                    <div style="font-size:12px;color:var(--text-secondary);margin-bottom:4px;">Buy Goods Till Number:</div>
                    <div class="payment-value">7500448</div>
                    <button type="button" class="copy-btn" onclick="copyToClipboard('7500448')">üìã Copy Till Number</button>
                    <div class="how-to-pay">
                        <div class="how-to-pay-title">How to Pay via Till:</div>
                        <ol>
                            <li>Open M-Pesa on your phone</li>
                            <li>Select <strong>"Lipa na M-Pesa"</strong></li>
                            <li>Select <strong>"Buy Goods and Services"</strong></li>
                            <li>Enter Till Number: <strong>7500448</strong></li>
                            <li>Enter amount in KES and confirm</li>
                            <li>Enter your M-Pesa PIN</li>
                            <li>Submit confirmation code below</li>
                        </ol>
                    </div>
                </div>
                <div id="bank" class="payment-details">
                    <div style="text-align:center;font-size:17px;font-weight:700;color:var(--accent-green);margin-bottom:14px;">üè¶ Equity Bank Transfer</div>
                    <div style="background:rgba(0,0,0,0.3);padding:16px;border-radius:10px;">
                        <div style="margin-bottom:12px;"><div style="font-size:11px;color:var(--text-secondary);margin-bottom:3px;text-transform:uppercase;">Bank Name</div><div style="font-size:16px;font-weight:700;">Equity Bank Kenya</div></div>
                        <div style="margin-bottom:12px;"><div style="font-size:11px;color:var(--text-secondary);margin-bottom:3px;text-transform:uppercase;">Account Name</div><div style="font-size:16px;font-weight:700;">Felix Kiprotich Koskei</div></div>
                        <div style="margin-bottom:12px;"><div style="font-size:11px;color:var(--text-secondary);margin-bottom:3px;text-transform:uppercase;">Account Number</div><div class="payment-value" style="margin:0;">0310184912409</div></div>
                        <div><div style="font-size:11px;color:var(--text-secondary);margin-bottom:3px;text-transform:uppercase;">Branch</div><div style="font-size:16px;font-weight:700;">Any Equity Bank Branch</div></div>
                    </div>
                    <button type="button" class="copy-btn" style="margin-top:12px;" onclick="copyToClipboard('0310184912409')">üìã Copy Account Number</button>
                </div>
                <div id="crypto" class="payment-details">
                    <div style="text-align:center;font-size:17px;font-weight:700;color:var(--accent-green);margin-bottom:14px;">ü™ô USDT ‚Äî TRC-20 Network</div>
                    <div style="font-size:12px;color:var(--accent-yellow);font-weight:700;margin-bottom:8px;">Network: TRC-20 (Tron) ‚ö†Ô∏è</div>
                    <div style="font-size:12px;color:var(--text-secondary);margin-bottom:6px;">Wallet Address:</div>
                    <div class="payment-value" style="font-size:13px;">TK4rUz6TUEd7zCWeuiX5R47pSNdPswJnAc</div>
                    <button type="button" class="copy-btn" onclick="copyToClipboard('TK4rUz6TUEd7zCWeuiX5R47pSNdPswJnAc')">üìã Copy Wallet Address</button>
                    <div style="background:var(--accent-red-dim);border:1px solid rgba(246,70,93,0.3);border-radius:10px;padding:14px;margin-top:14px;">
                        <div style="font-size:12px;font-weight:700;color:var(--accent-red);margin-bottom:6px;">‚ö†Ô∏è CRITICAL WARNING</div>
                        <div style="font-size:12px;color:var(--text-primary);line-height:1.7;">‚Ä¢ Only send <strong>USDT on TRC-20 network</strong><br>‚Ä¢ Sending on wrong network = <strong>permanent loss of funds</strong><br>‚Ä¢ Double-check address before sending<br>‚Ä¢ Minimum deposit: $10 USDT</div>
                    </div>
                </div>
                <div style="background:var(--accent-green-dim);border:1px solid rgba(14,203,129,0.25);border-radius:12px;padding:18px;margin:18px 0;text-align:center;">
                    <div style="font-size:16px;font-weight:700;color:var(--accent-green);margin-bottom:8px;">‚úÖ AUTOMATIC DEPOSIT PROCESS</div>
                    <div style="font-size:13px;color:var(--text-primary);line-height:1.8;">Submit your payment screenshot below.<br>Your deposit will be <strong>automatically credited within 5 minutes</strong> after verification.</div>
                </div>
                <div class="form-group">
                    <label>Payment Proof / Transaction Code</label>
                    <textarea id="depositProof" rows="4" placeholder="Paste your M-Pesa code, transaction ID, or describe your payment here." required style="min-height:100px;resize:vertical;"></textarea>
                    <div style="font-size:11px;color:var(--text-secondary);margin-top:6px;">üì∏ Required for automatic verification and account credit</div>
                </div>
                <button type="submit" class="btn-submit">‚úÖ Submit Deposit Request</button>
            </form>
        </div>
    </div>
    <div class="whatsapp-support">
        <a href="https://wa.me/254759401893" class="whatsapp-btn" target="_blank"><span style="font-size:24px;">üí¨</span> Support</a>
    </div>
</div>

<!-- ===== TRADING LAYER ===== -->
<div id="tradingLayer" class="layer">
    <nav class="navbar">
        <div class="logo" onclick="showLayer('dashboardLayer')"><div class="logo-icon">‚Çø</div>CryptoPro</div>
        <div class="nav-links">
            <div class="status-badge"><span class="status-dot"></span> LIVE</div>
            <button class="nav-btn btn-login" onclick="showLayer('dashboardLayer')">‚Üê Dashboard</button>
        </div>
    </nav>
    <div class="container">
        <div class="hero-section" style="padding:22px 28px;">
            <h1 style="font-size:34px;">‚ö° Live Trading</h1>
            <p style="margin-bottom:0;font-size:15px;">Execute trades in real-time with advanced leverage and risk management</p>
        </div>
        <div class="pairs-selector">
            <button class="pair-btn active" onclick="selectTradePair(this,'BTCUSDT','BTC/USDT','Bitcoin / USDT')">BTC/USDT</button>
            <button class="pair-btn" onclick="selectTradePair(this,'ETHUSDT','ETH/USDT','Ethereum / USDT')">ETH/USDT</button>
            <button class="pair-btn" onclick="selectTradePair(this,'BNBUSDT','BNB/USDT','BNB / USDT')">BNB/USDT</button>
            <button class="pair-btn" onclick="selectTradePair(this,'SOLUSDT','SOL/USDT','Solana / USDT')">SOL/USDT</button>
            <button class="pair-btn" onclick="selectTradePair(this,'XRPUSDT','XRP/USDT','Ripple / USDT')">XRP/USDT</button>
        </div>
        <div class="price-info">
            <div>
                <div class="current-price" id="tradePrice">$98,245.50</div>
                <div style="font-size:12px;color:var(--text-secondary);margin-top:4px;" id="tradePairSub">Bitcoin / USDT</div>
            </div>
            <div class="price-change positive" id="tradePriceChange">+2.45%</div>
        </div>
        <div class="chart-section">
            <div class="chart-header">
                <div class="chart-title">üìà <span id="tradePairLabel">BTC/USDT</span></div>
                <div class="status-badge"><span class="status-dot"></span> LIVE</div>
            </div>
            <div class="tv-chart-container">
                <div id="tv_chart_trade" style="height:420px;"></div>
            </div>
        </div>
        <div class="orderbook-grid">
            <div class="orderbook-side">
                <div class="orderbook-title" style="color:var(--accent-red);">üî¥ Asks ‚Äî Sell Orders</div>
                <div class="orderbook-header"><span>Price (USDT)</span><span>Amount</span><span>Total</span></div>
                <div id="asksContainer"></div>
            </div>
            <div class="orderbook-side">
                <div class="orderbook-title" style="color:var(--accent-green);">üü¢ Bids ‚Äî Buy Orders</div>
                <div class="orderbook-header"><span>Price (USDT)</span><span>Amount</span><span>Total</span></div>
                <div id="bidsContainer"></div>
            </div>
        </div>
        <div class="chart-section">
            <div class="section-title" style="margin-bottom:16px;">üìã Place Order</div>
            <form id="tradeForm" onsubmit="return executeTrade(event)">
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:18px;">
                    <button type="button" class="payment-btn active" id="buyBtn" onclick="selectTradeType('buy')" style="background:var(--accent-green-dim);border-color:var(--accent-green);color:var(--accent-green);font-size:15px;padding:16px;">üìà BUY / LONG</button>
                    <button type="button" class="payment-btn" id="sellBtn" onclick="selectTradeType('sell')" style="font-size:15px;padding:16px;">üìâ SELL / SHORT</button>
                </div>
                <div class="form-group">
                    <label>Trade Amount (USD)</label>
                    <input type="number" id="tradeAmount" min="10" step="0.01" placeholder="Enter amount to trade" required oninput="updatePositionSize()">
                    <div style="font-size:12px;color:var(--text-secondary);margin-top:6px;">Available Balance: <span id="tradeAvailableBalance" style="font-weight:700;color:var(--text-primary);font-family:'JetBrains Mono',monospace;">$0.00</span></div>
                </div>
                <div class="form-group">
                    <label>Leverage</label>
                    <select id="tradeLeverage" onchange="updatePositionSize()">
                        <option value="1">1x ‚Äî No Leverage (Safe)</option>
                        <option value="2">2x ‚Äî 2 Times</option>
                        <option value="5">5x ‚Äî 5 Times</option>
                        <option value="10" selected>10x ‚Äî 10 Times</option>
                        <option value="20">20x ‚Äî 20 Times</option>
                        <option value="50">50x ‚Äî 50 Times</option>
                        <option value="100">100x ‚Äî 100 Times (High Risk)</option>
                    </select>
                </div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:18px;">
                    <div class="form-group" style="margin:0;"><label>Take Profit (USD) ‚Äî Optional</label><input type="number" id="takeProfitPrice" placeholder="e.g. 99000" step="0.01"></div>
                    <div class="form-group" style="margin:0;"><label>Stop Loss (USD) ‚Äî Optional</label><input type="number" id="stopLossPrice" placeholder="e.g. 97000" step="0.01"></div>
                </div>
                <div style="background:var(--bg-card);border:1px solid var(--border-color);border-radius:12px;padding:16px;margin-bottom:18px;">
                    <div style="font-size:12px;font-weight:700;color:var(--text-secondary);text-transform:uppercase;letter-spacing:1px;margin-bottom:12px;">Order Summary</div>
                    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;">
                        <div><div style="font-size:10px;color:var(--text-secondary);margin-bottom:4px;">Entry Price</div><div style="font-size:14px;font-weight:700;font-family:'JetBrains Mono',monospace;" id="entryPriceDisplay">$98,245.50</div></div>
                        <div><div style="font-size:10px;color:var(--text-secondary);margin-bottom:4px;">Position Size</div><div style="font-size:14px;font-weight:700;color:var(--accent-green);font-family:'JetBrains Mono',monospace;" id="positionSizeDisplay">$0.00</div></div>
                        <div><div style="font-size:10px;color:var(--text-secondary);margin-bottom:4px;">Liquidation Price</div><div style="font-size:14px;font-weight:700;color:var(--accent-red);font-family:'JetBrains Mono',monospace;" id="liquidationDisplay">‚Äî</div></div>
                    </div>
                </div>
                <button type="submit" class="btn-submit" id="tradeSubmitBtn" style="background:linear-gradient(135deg,var(--accent-green),#08A566);">üöÄ Execute Trade</button>
            </form>
        </div>
    </div>
    <div class="whatsapp-support">
        <a href="https://wa.me/254759401893" class="whatsapp-btn" target="_blank"><span style="font-size:24px;">üí¨</span> Support</a>
    </div>
</div>

<!-- ===== AI BOTS LAYER ===== -->
<div id="botsLayer" class="layer">
    <nav class="navbar">
        <div class="logo" onclick="showLayer('dashboardLayer')"><div class="logo-icon">‚Çø</div>CryptoPro</div>
        <div class="nav-links"><button class="nav-btn btn-login" onclick="showLayer('dashboardLayer')">‚Üê Dashboard</button></div>
    </nav>
    <div class="container">
        <div class="hero-section" style="padding:22px 28px;">
            <h1 style="font-size:34px;">ü§ñ AI Trading Bots</h1>
            <p style="margin-bottom:0;">Automate your trading 24/7 with AI-powered strategies. Set it and forget it!</p>
        </div>
        <div class="winners-grid" id="botsGrid"></div>
        <div class="chart-section" style="margin-top:8px;">
            <div class="section-title">‚ö° Active Bots ‚Äî Live Performance</div>
            <div id="activeBotsContainer"></div>
        </div>
        <div class="chart-section">
            <div class="section-title">üìä Bot Statistics ‚Äî Last 24 Hours</div>
            <div class="stats-grid" id="botStatsGrid"></div>
        </div>
    </div>
    <div class="whatsapp-support">
        <a href="https://wa.me/254759401893" class="whatsapp-btn" target="_blank"><span style="font-size:24px;">üí¨</span> Support</a>
    </div>
</div>

<!-- ===== TRADE HISTORY LAYER ===== -->
<div id="historyLayer" class="layer">
    <nav class="navbar">
        <div class="logo" onclick="showLayer('dashboardLayer')"><div class="logo-icon">‚Çø</div>CryptoPro</div>
        <div class="nav-links"><button class="nav-btn btn-login" onclick="showLayer('dashboardLayer')">‚Üê Dashboard</button></div>
    </nav>
    <div class="container">
        <div class="hero-section" style="padding:22px 28px;">
            <h1 style="font-size:34px;">üìú Trade History</h1>
            <p style="margin-bottom:0;">Complete record of all your trading activity and performance</p>
        </div>
        <div class="stats-grid" id="historyStatsGrid"></div>
        <div class="chart-section">
            <div id="tradeHistoryContainer" style="max-height:650px;overflow-y:auto;"></div>
        </div>
    </div>
    <div class="whatsapp-support">
        <a href="https://wa.me/254759401893" class="whatsapp-btn" target="_blank"><span style="font-size:24px;">üí¨</span> Support</a>
    </div>
</div>

<!-- ===== WITHDRAWAL LAYER ===== -->
<div id="withdrawalLayer" class="layer">
    <nav class="navbar">
        <div class="logo" onclick="showLayer('dashboardLayer')"><div class="logo-icon">‚Çø</div>CryptoPro</div>
        <div class="nav-links"><button class="nav-btn btn-login" onclick="showLayer('dashboardLayer')">‚Üê Dashboard</button></div>
    </nav>
    <div class="container">
        <div class="hero-section" style="padding:22px 28px;">
            <h1 style="font-size:34px;">üí∏ Withdraw Funds</h1>
            <p style="margin-bottom:0;">Fast and secure withdrawals processed within 5‚Äì30 minutes</p>
        </div>
        <div class="progress-bar-container" id="withdrawProgressBar">
            <div class="progress-label" id="withdrawProgressLabel">‚è≥ Processing withdrawal...</div>
            <div class="progress-bar-track"><div class="progress-bar-fill" id="withdrawProgressFill"></div></div>
            <div class="progress-text" id="withdrawProgressText">0% complete</div>
        </div>
        <div class="chart-section">
            <div style="background:var(--accent-green-dim);border:1px solid rgba(14,203,129,0.25);border-radius:12px;padding:20px;margin-bottom:20px;text-align:center;">
                <div style="font-size:12px;text-transform:uppercase;letter-spacing:2px;color:var(--text-secondary);margin-bottom:8px;font-weight:700;">Available for Withdrawal</div>
                <div style="font-size:44px;font-weight:900;color:var(--accent-green);font-family:'JetBrains Mono',monospace;letter-spacing:-2px;" id="withdrawAvailable">$0.00</div>
            </div>
            <form id="withdrawalForm" onsubmit="return processWithdrawal(event)">
                <div class="form-group">
                    <label>Withdrawal Amount (USD)</label>
                    <input type="number" id="withdrawAmount" min="50" step="0.01" placeholder="Minimum $50" required>
                    <div style="font-size:12px;color:var(--text-secondary);margin-top:6px;">Min: $50 &nbsp;|&nbsp; Max: <span id="maxWithdraw" style="font-weight:700;font-family:'JetBrains Mono',monospace;">$0.00</span> &nbsp;|&nbsp; Fee: 2%</div>
                </div>
                <div class="form-group">
                    <label>Withdrawal Method</label>
                    <div class="payment-grid" style="grid-template-columns:repeat(3,1fr);">
                        <button type="button" class="payment-btn" onclick="selectWithdrawMethod('mpesa',this)">üì± M-Pesa</button>
                        <button type="button" class="payment-btn" onclick="selectWithdrawMethod('bank',this)">üè¶ Bank</button>
                        <button type="button" class="payment-btn" onclick="selectWithdrawMethod('crypto',this)">ü™ô Crypto</button>
                    </div>
                </div>
                <div id="withdraw-mpesa" class="payment-details">
                    <div class="form-group"><label>M-Pesa Phone Number</label><input type="tel" id="withdrawMpesaPhone" placeholder="+254 712 345 678"></div>
                    <div class="form-group"><label>Full Name (as registered)</label><input type="text" id="withdrawMpesaName" placeholder="Your M-Pesa registered name"></div>
                </div>
                <div id="withdraw-bank" class="payment-details">
                    <div class="form-group"><label>Bank Name</label><input type="text" id="withdrawBankName" placeholder="e.g. Equity Bank, KCB, Co-op"></div>
                    <div class="form-group"><label>Account Number</label><input type="text" id="withdrawAccountNumber" placeholder="Your account number"></div>
                    <div class="form-group"><label>Account Holder Name</label><input type="text" id="withdrawAccountName" placeholder="Name as on bank account"></div>
                </div>
                <div id="withdraw-crypto" class="payment-details">
                    <div class="form-group"><label>USDT Wallet Address (TRC-20 Only)</label><input type="text" id="withdrawCryptoAddress" placeholder="Your TRC-20 USDT wallet address"></div>
                    <div style="background:var(--accent-red-dim);border:1px solid rgba(246,70,93,0.3);border-radius:10px;padding:12px;font-size:12px;color:var(--accent-red);line-height:1.7;">‚ö†Ô∏è <strong>Only provide TRC-20 network address.</strong><br>Wrong network address = permanent loss of funds.</div>
                </div>
                <div style="background:var(--accent-green-dim);border:1px solid rgba(14,203,129,0.25);border-radius:12px;padding:16px;margin:16px 0;font-size:13px;color:var(--text-primary);line-height:1.9;">
                    ‚ö° <strong>Processing Time:</strong> 5‚Äì30 minutes<br>
                    üí≥ <strong>Fee:</strong> 2% deducted from withdrawal amount<br>
                    üì± <strong>Confirmation:</strong> Sent via SMS and Email<br>
                    üîí <strong>Security:</strong> All withdrawals manually verified
                </div>
                <button type="submit" class="btn-submit" style="background:linear-gradient(135deg,#8b5cf6,#7c3aed);color:#fff;">üí∏ Request Withdrawal</button>
            </form>
        </div>
    </div>
    <div class="whatsapp-support">
        <a href="https://wa.me/254759401893" class="whatsapp-btn" target="_blank"><span style="font-size:24px;">üí¨</span> Support</a>
    </div>
</div>

<!-- ===== REFERRAL LAYER ===== -->
<div id="referralLayer" class="layer">
    <nav class="navbar">
        <div class="logo" onclick="showLayer('dashboardLayer')"><div class="logo-icon">‚Çø</div>CryptoPro</div>
        <div class="nav-links"><button class="nav-btn btn-login" onclick="showLayer('dashboardLayer')">‚Üê Dashboard</button></div>
    </nav>
    <div class="container">
        <div class="hero-section" style="padding:22px 28px;">
            <h1 style="font-size:34px;">üéÅ Referral Program</h1>
            <p style="margin-bottom:0;">Earn 10% commission on every deposit your referrals make ‚Äî for life!</p>
        </div>
        <div class="stats-grid">
            <div class="stat-card"><div class="stat-icon">üë•</div><div class="stat-value" id="totalReferrals">0</div><div class="stat-label">Total Referrals</div></div>
            <div class="stat-card"><div class="stat-icon">üí∞</div><div class="stat-value" id="totalCommission">$0.00</div><div class="stat-label">Total Earned</div></div>
            <div class="stat-card"><div class="stat-icon">üìä</div><div class="stat-value" id="activeReferrals">0</div><div class="stat-label">Active Traders</div></div>
            <div class="stat-card"><div class="stat-icon">üì¢</div><div class="stat-value" id="totalShares">0</div><div class="stat-label">Total Shares</div></div>
        </div>
        <div class="share-rewards-card">
            <div style="text-align:center;margin-bottom:14px;">
                <div style="font-size:44px;margin-bottom:8px;">üí∞</div>
                <div style="font-size:22px;font-weight:900;color:var(--accent-yellow);margin-bottom:4px;">EARN $5 PER SHARE!</div>
                <div style="font-size:13px;color:var(--text-secondary);">Get paid every time you share your referral link</div>
            </div>
            <div class="share-stats-grid">
                <div class="share-stat"><div class="share-stat-label">Total Shares</div><div class="share-stat-value" style="color:var(--accent-yellow);" id="shareCountDisplay">0</div></div>
                <div class="share-stat"><div class="share-stat-label">Earnings from Shares</div><div class="share-stat-value" style="color:var(--accent-green);" id="shareEarningsDisplay">$0.00</div></div>
            </div>
            <div style="background:rgba(14,203,129,0.06);border-left:3px solid var(--accent-green);padding:14px 16px;border-radius:0 8px 8px 0;font-size:13px;color:var(--text-primary);line-height:1.8;">
                üí° <strong>How it works:</strong> Click any share button below ‚Üí Share on social media ‚Üí Earn $5 instantly credited to your account!
            </div>
        </div>
        <div class="chart-section">
            <div style="margin-bottom:20px;">
                <div class="section-title">Your Referral Link</div>
                <div style="background:var(--accent-green-dim);border:1.5px solid rgba(14,203,129,0.25);border-radius:12px;padding:18px;">
                    <div class="payment-value" style="margin:0 0 12px 0;font-size:13px;" id="referralLink">https://cryptopro.vercel.app/ref/XXXXX</div>
                    <button class="copy-btn" onclick="copyReferralLink()">üìã Copy Referral Link</button>
                </div>
            </div>
            <div class="section-title">Share Via:</div>
            <div class="action-buttons">
                <button class="action-btn" style="background:linear-gradient(135deg,#25D366,#128C7E);color:#fff;" onclick="shareViaWhatsApp()">üí¨ WhatsApp (+$5)</button>
                <button class="action-btn" style="background:linear-gradient(135deg,#0088cc,#006699);color:#fff;" onclick="shareViaTelegram()">‚úàÔ∏è Telegram (+$5)</button>
                <button class="action-btn" style="background:linear-gradient(135deg,#1877f2,#0d5dbf);color:#fff;" onclick="shareViaFacebook()">üìò Facebook (+$5)</button>
                <button class="action-btn" style="background:linear-gradient(135deg,#1da1f2,#0c85d0);color:#fff;" onclick="shareViaTwitter()">üê¶ Twitter (+$5)</button>
            </div>
            <div style="background:rgba(252,213,53,0.08);border:1px solid rgba(252,213,53,0.25);border-radius:12px;padding:20px;margin-top:16px;">
                <div style="font-size:16px;font-weight:700;color:var(--accent-yellow);margin-bottom:14px;">üíé Referral Benefits</div>
                <div style="font-size:13px;color:var(--text-primary);line-height:2;">
                    ‚úÖ <strong>10% Commission</strong> on every deposit your referral makes<br>
                    ‚úÖ <strong>Lifetime Earnings</strong> ‚Äî earn as long as they trade<br>
                    ‚úÖ <strong>Instant Credits</strong> ‚Äî commission added immediately<br>
                    ‚úÖ <strong>No Limits</strong> ‚Äî refer unlimited people<br>
                    ‚úÖ <strong>$25 Bonus</strong> for each referral who signs up<br>
                    ‚úÖ <strong>$5 Per Share</strong> ‚Äî earn every time you share your link<br>
                    ‚úÖ <strong>Fully Withdrawable</strong> ‚Äî withdraw anytime, no minimum
                </div>
            </div>
        </div>
    </div>
    <div class="whatsapp-support">
        <a href="https://wa.me/254759401893" class="whatsapp-btn" target="_blank"><span style="font-size:24px;">üí¨</span> Support</a>
    </div>
</div>

<!-- ===== REVIEWS LAYER ===== -->
<div id="reviewsLayer" class="layer">
    <nav class="navbar">
        <div class="logo" onclick="showLayer('welcomeLayer')"><div class="logo-icon">‚Çø</div>CryptoPro</div>
        <div class="nav-links"><button class="nav-btn btn-signup" onclick="showLayer('signupLayer')">Sign Up Free</button></div>
    </nav>
    <div class="container">
        <div class="hero-section" style="padding:22px 28px;">
            <h1 style="font-size:34px;">‚≠ê User Reviews</h1>
            <p style="margin-bottom:0;">Real feedback from our verified traders across Kenya and beyond</p>
        </div>
        <div style="background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:14px;padding:24px;margin-bottom:20px;text-align:center;">
            <div style="font-size:64px;font-weight:900;color:var(--accent-yellow);font-family:'JetBrains Mono',monospace;line-height:1;">4.9</div>
            <div style="font-size:28px;margin:8px 0;">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
            <div style="font-size:14px;color:var(--text-secondary);">Based on 2,847 verified reviews</div>
            <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-top:20px;">
                <div style="background:var(--bg-card);padding:14px;border-radius:10px;border:1px solid var(--border-color);"><div style="font-size:22px;font-weight:900;color:var(--accent-green);font-family:'JetBrains Mono',monospace;">98%</div><div style="font-size:11px;color:var(--text-secondary);margin-top:3px;">Would Recommend</div></div>
                <div style="background:var(--bg-card);padding:14px;border-radius:10px;border:1px solid var(--border-color);"><div style="font-size:22px;font-weight:900;color:var(--accent-green);font-family:'JetBrains Mono',monospace;">5min</div><div style="font-size:11px;color:var(--text-secondary);margin-top:3px;">Avg Withdrawal Time</div></div>
                <div style="background:var(--bg-card);padding:14px;border-radius:10px;border:1px solid var(--border-color);"><div style="font-size:22px;font-weight:900;color:var(--accent-green);font-family:'JetBrains Mono',monospace;">24/7</div><div style="font-size:11px;color:var(--text-secondary);margin-top:3px;">Customer Support</div></div>
            </div>
        </div>
        <div class="winners-grid" id="reviewsGrid"></div>
    </div>
    <div class="whatsapp-support">
        <a href="https://wa.me/254759401893" class="whatsapp-btn" target="_blank"><span style="font-size:24px;">üí¨</span> Support</a>
    </div>
</div>

<!-- ===== PROFILE LAYER ===== -->
<div id="profileLayer" class="layer">
    <nav class="navbar">
        <div class="logo" onclick="showLayer('dashboardLayer')"><div class="logo-icon">‚Çø</div>CryptoPro</div>
        <div class="nav-links"><button class="nav-btn btn-login" onclick="showLayer('dashboardLayer')">‚Üê Dashboard</button></div>
    </nav>
    <div class="container">
        <div class="hero-section" style="padding:22px 28px;">
            <h1 style="font-size:34px;">‚öôÔ∏è Profile Settings</h1>
            <p style="margin-bottom:0;">Manage your account information and security settings</p>
        </div>
        <div class="chart-section">
            <form id="profileForm" onsubmit="return updateProfile(event)">
                <div class="form-group"><label>Full Name</label><input type="text" id="profileName" required></div>
                <div class="form-group"><label>Email Address</label><input type="email" id="profileEmail" required></div>
                <div class="form-group"><label>Phone Number</label><input type="tel" id="profilePhone" required></div>
                <div style="background:var(--bg-card);border:1px solid var(--border-color);border-radius:12px;padding:18px;margin-bottom:18px;">
                    <div style="font-size:13px;font-weight:700;color:var(--text-secondary);text-transform:uppercase;letter-spacing:1px;margin-bottom:14px;">üîí Change Password</div>
                    <div class="form-group" style="margin-bottom:12px;"><label>Current Password</label><input type="password" id="profileCurrentPassword" placeholder="Leave blank to keep unchanged"></div>
                    <div class="form-group" style="margin:0;"><label>New Password</label><input type="password" id="profileNewPassword" placeholder="Enter new password"></div>
                </div>
                <button type="submit" class="btn-submit">üíæ Save Profile Changes</button>
            </form>
            <div style="margin-top:28px;padding-top:24px;border-top:1px solid var(--border-color);">
                <div class="section-title">Account Information</div>
                <div class="profile-info-box">
                    <div class="profile-info-row"><div class="profile-info-label">Account ID</div><div class="profile-info-value" id="accountId" style="font-family:'JetBrains Mono',monospace;font-size:13px;">‚Äî</div></div>
                    <div class="profile-info-row"><div class="profile-info-label">Member Since</div><div class="profile-info-value" id="memberSince">‚Äî</div></div>
                    <div class="profile-info-row"><div class="profile-info-label">Verification Status</div><div class="verified-badge">‚úì Fully Verified</div></div>
                    <div class="profile-info-row"><div class="profile-info-label">Account Type</div><div class="profile-info-value">Standard Trader</div></div>
                    <div class="profile-info-row"><div class="profile-info-label">2FA Security</div><div style="display:inline-flex;align-items:center;gap:6px;padding:4px 12px;background:var(--accent-green-dim);border:1px solid rgba(14,203,129,0.3);border-radius:20px;font-size:12px;font-weight:700;color:var(--accent-green);">üîí Enabled</div></div>
                </div>
            </div>
        </div>
    </div>
    <div class="whatsapp-support">
        <a href="https://wa.me/254759401893" class="whatsapp-btn" target="_blank"><span style="font-size:24px;">üí¨</span> Support</a>
    </div>
</div>

<!-- ===== TRADINGVIEW SCRIPT ===== -->
<script src="https://s3.tradingview.com/tv.js"></script>
<script>
// ============================================
// API BASE URL ‚Äî CONNECT TO BACKEND
// ============================================
const API_BASE_URL = 'https://YOUR-VERCEL-APP.vercel.app'; // ‚Üê update after deploy

// ============================================
// GLOBAL STATE
// ============================================
let currentUser = null;
let currentLayer = 'welcomeLayer';
let selectedPaymentMethod = '';
let selectedWithdrawMethod = '';
let selectedTradeType = 'buy';
let currentAccountMode = 'demo';
let currentBTCPrice = 98245.50;
let currentTradePair = 'BTCUSDT';
let currentTradePairLabel = 'BTC/USDT';
let currentTradePairSub = 'Bitcoin / USDT';
let tvCharts = {};
let winnerQueue = [];
let winnerQueueIndex = 0;
let countdownEnd = null;
let userLocation = { country:'Kenya', countryCode:'KE', currency:'KES', rate:130, city:'Nairobi' };
let notifications = [
    { title:'üéâ Welcome Bonus Credited', desc:'$25 demo bonus has been added to your account', time:'Just now', unread:true },
    { title:'üìà Market Alert: BTC +3.2%', desc:'Bitcoin surged 3.2% in the last hour', time:'5 min ago', unread:true },
    { title:'ü§ñ Bot Trade Completed', desc:'Scalper Pro closed a profitable trade +$12.50', time:'12 min ago', unread:true }
];

// ============================================
// INIT
// ============================================
document.addEventListener('DOMContentLoaded', () => {
    generateLiveTraders();
    generateTopWinners();
    generateReviews();
    generateBots();
    generateActiveBotsPanel();
    generateBotStats();
    generateMarketTicker();
    startCountdown();
    startViewingCounterFlicker();
    detectUserLocation();
    buildWinnerQueue();
    renderNotifications();
    animateStats();
    checkReferralCode();
    setTimeout(startLiveWinnerToasts, 6000);
    setInterval(updatePricesSimulated, 3000);
    setInterval(updateOrderBook, 2000);
    setInterval(animateStats, 30000);
});

// ============================================
// TRADINGVIEW CHARTS
// ============================================
function loadTVChart(containerId, symbol, height, compact) {
    const el = document.getElementById(containerId);
    if(!el || tvCharts[containerId]) return;
    const config = {
        symbol: 'BINANCE:' + symbol,
        interval: compact ? '5' : '15',
        timezone: 'Etc/UTC',
        theme: 'dark',
        style: '1',
        locale: 'en',
        toolbar_bg: '#0D1421',
        backgroundColor: '#060B11',
        gridColor: '#1E2D42',
        enable_publishing: false,
        allow_symbol_change: false,
        save_image: false,
        container_id: containerId,
        width: '100%',
        height: height,
        hide_side_toolbar: compact,
        hide_top_toolbar: compact,
        hide_legend: compact,
        studies: compact ? [] : ['RSI@tv-basicstudies','MACD@tv-basicstudies']
    };
    try {
        tvCharts[containerId] = new TradingView.widget(config);
    } catch(e) {
        el.innerHTML = `<div style="display:flex;align-items:center;justify-content:center;height:${height}px;color:var(--text-secondary);flex-direction:column;gap:10px;"><div style="font-size:32px;">üìà</div><div>Chart loading...</div></div>`;
    }
}

function loadChartsForLayer(layer) {
    if(layer === 'chartsLayer') setTimeout(() => loadTVChart('tv_chart_main','BTCUSDT',500,false), 400);
    if(layer === 'tradingLayer') setTimeout(() => loadTVChart('tv_chart_trade',currentTradePair,420,false), 400);
    if(layer === 'dashboardLayer') setTimeout(() => loadTVChart('tv_chart_dash','BTCUSDT',280,true), 400);
}

// ============================================
// MARKET TICKER BAR
// ============================================
const TICKER_DATA = [
    { sym:'BTC/USDT', price:98245.50, chg:+2.45 },
    { sym:'ETH/USDT', price:3842.20, chg:+1.87 },
    { sym:'BNB/USDT', price:612.80, chg:+0.94 },
    { sym:'SOL/USDT', price:198.45, chg:+4.12 },
    { sym:'ADA/USDT', price:0.612, chg:-0.38 },
    { sym:'XRP/USDT', price:2.145, chg:+3.22 },
    { sym:'DOGE/USDT', price:0.389, chg:+5.11 },
    { sym:'DOT/USDT', price:8.94, chg:-1.05 },
    { sym:'AVAX/USDT', price:42.80, chg:+2.78 },
    { sym:'LINK/USDT', price:22.45, chg:+1.56 },
    { sym:'MATIC/USDT', price:1.12, chg:-0.82 },
    { sym:'UNI/USDT', price:14.30, chg:+2.10 }
];

function generateMarketTicker() {
    const track = document.getElementById('marketTickerTrack');
    if(!track) return;
    let html = '';
    const items = [...TICKER_DATA, ...TICKER_DATA];
    items.forEach(t => {
        const pos = t.chg >= 0;
        const price = t.price > 100
            ? t.price.toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2})
            : t.price.toFixed(t.price < 1 ? 4 : 2);
        html += `<div class="ticker-item">
            <span class="ticker-symbol">${t.sym}</span>
            <span class="ticker-price">$${price}</span>
            <span class="ticker-change ${pos?'pos':'neg'}">${pos?'+':''}${t.chg}%</span>
        </div>`;
    });
    track.innerHTML = html;
    setInterval(() => {
        TICKER_DATA.forEach(t => {
            t.price += (Math.random()-0.5) * t.price * 0.002;
            t.chg += (Math.random()-0.5) * 0.1;
        });
        generateMarketTicker();
    }, 4000);
}

// ============================================
// COUNTDOWN TIMER
// ============================================
function startCountdown() {
    const stored = localStorage.getItem('cryptoproCountdownEnd');
    if(stored) {
        countdownEnd = parseInt(stored);
    } else {
        countdownEnd = Date.now() + (23*3600 + 47*60) * 1000;
        localStorage.setItem('cryptoproCountdownEnd', countdownEnd);
    }
    updateCountdown();
    setInterval(updateCountdown, 1000);
}

function updateCountdown() {
    const remaining = Math.max(0, countdownEnd - Date.now());
    const h = Math.floor(remaining / 3600000);
    const m = Math.floor((remaining % 3600000) / 60000);
    const s = Math.floor((remaining % 60000) / 1000);
    const fmt = n => String(n).padStart(2,'0');
    ['cdHours','cdHours2'].forEach(id => { const e = document.getElementById(id); if(e) e.textContent = fmt(h); });
    ['cdMins','cdMins2'].forEach(id => { const e = document.getElementById(id); if(e) e.textContent = fmt(m); });
    ['cdSecs','cdSecs2'].forEach(id => { const e = document.getElementById(id); if(e) e.textContent = fmt(s); });
    if(h < 1) {
        document.querySelectorAll('.countdown-num').forEach(el => {
            el.style.color = 'var(--accent-red)';
            el.style.animation = 'blink 0.5s infinite';
        });
    }
}

// ============================================
// VIEWING COUNTER
// ============================================
function startViewingCounterFlicker() {
    function flicker(id, base) {
        const el = document.getElementById(id);
        if(!el) return;
        el.textContent = base;
        setInterval(() => {
            const delta = Math.floor(Math.random()*8) - 3;
            const current = parseInt(el.textContent);
            el.textContent = Math.max(10, current + delta);
        }, 3000 + Math.random()*2000);
    }
    flicker('viewingCount', 47);
    flicker('depositViewers', 23);
}

// ============================================
// ANIMATE STATS
// ============================================
function animateStats() {
    const traderEl = document.getElementById('statTraders');
    const tradesEl = document.getElementById('statTrades');
    if(traderEl) traderEl.textContent = (50000 + Math.floor(Math.random()*500)).toLocaleString() + '+';
    if(tradesEl) tradesEl.textContent = (15000 + Math.floor(Math.random()*500)).toLocaleString() + '+';
}

// ============================================
// LIVE TRADERS TICKER
// ============================================
const TRADER_NAMES = [
    ['Sarah K.','üá∞üá™'],['John M.','üá≥üá¨'],['Michael K.','üá∞üá™'],['Emma W.','üá¨üáß'],
    ['David L.','üá¶üá™'],['Lisa T.','üá∫üá∏'],['James R.','üá¶üá∫'],['Maria G.','üá™üá∏'],
    ['Robert H.','üá´üá∑'],['Jennifer P.','üá∞üá∑'],['William S.','üá®üá¶'],['Patricia B.','üá©üá™'],
    ['Richard M.','üáÆüáπ'],['Linda C.','üáßüá∑'],['Charles N.','üá≤üáΩ'],['Grace W.','üá∞üá™'],
    ['Brian O.','üá∞üá™'],['Mary A.','üá∫üá¨'],['Peter N.','üáπüáø'],['Lucy M.','üá∞üá™'],
    ['Hassan A.','üá™üá¨'],['Sophie L.','üá´üá∑'],['Carlos R.','üá™üá∏'],['Yuki T.','üáØüáµ'],
    ['Ivan P.','üá∑üá∫'],['Amara D.','üá∏üá≥'],['Kim P.','üá∞üá∑'],['Fatima A.','üá≥üá¨']
];
const EMOJIS = ['üí∞','üíé','üöÄ','‚≠ê','‚ú®','üî•','üí´','‚ö°','üèÜ','üéØ'];

function generateLiveTraders() {
    const container = document.getElementById('liveTradersTicker');
    if(!container) return;
    let html = '';
    for(let i = 0; i < 50; i++) {
        const [name, flag] = TRADER_NAMES[i % TRADER_NAMES.length];
        const profit = (Math.random()*900+50).toFixed(2);
        const emoji = EMOJIS[Math.floor(Math.random()*EMOJIS.length)];
        html += `<div class="trader-card">
            <div class="trader-avatar">${emoji}</div>
            <div>
                <div class="trader-name">${name} ${flag}</div>
                <div class="trader-profit">+$${profit}</div>
            </div>
        </div>`;
    }
    container.innerHTML = html + html;
}

// ============================================
// TOP WINNERS
// ============================================
const ALL_WINNERS = [
    { name:'Alex Thompson', loc:'Nairobi, Kenya', flag:'üá∞üá™', profit:12450, trades:847, join:'Jan 2024', emoji:'üëë', winRate:94 },
    { name:'Sarah Johnson', loc:'Lagos, Nigeria', flag:'üá≥üá¨', profit:10230, trades:692, join:'Feb 2024', emoji:'‚≠ê', winRate:91 },
    { name:'David Chen', loc:'London, UK', flag:'üá¨üáß', profit:9875, trades:618, join:'Mar 2024', emoji:'üíé', winRate:89 },
    { name:'Maria Garcia', loc:'Dubai, UAE', flag:'üá¶üá™', profit:8650, trades:571, join:'Mar 2024', emoji:'üöÄ', winRate:87 },
    { name:'James Wilson', loc:'New York, USA', flag:'üá∫üá∏', profit:7920, trades:534, join:'Apr 2024', emoji:'‚ú®', winRate:86 },
    { name:'Emma Brown', loc:'Sydney, Australia', flag:'üá¶üá∫', profit:7340, trades:489, join:'Apr 2024', emoji:'üî•', winRate:85 },
    { name:'Mohammed Ali', loc:'Cairo, Egypt', flag:'üá™üá¨', profit:6890, trades:456, join:'May 2024', emoji:'üí´', winRate:84 },
    { name:'Sophie Martin', loc:'Paris, France', flag:'üá´üá∑', profit:6450, trades:423, join:'May 2024', emoji:'‚ö°', winRate:83 },
    { name:'Carlos Rodriguez', loc:'Madrid, Spain', flag:'üá™üá∏', profit:6120, trades:398, join:'Jun 2024', emoji:'üåü', winRate:82 },
    { name:'Kim Park', loc:'Seoul, S. Korea', flag:'üá∞üá∑', profit:5890, trades:367, join:'Jun 2024', emoji:'üí•', winRate:81 },
    { name:'Grace Wanjiku', loc:'Nakuru, Kenya', flag:'üá∞üá™', profit:5640, trades:341, join:'Jul 2024', emoji:'üèÜ', winRate:80 },
    { name:'Brian Otieno', loc:'Kisumu, Kenya', flag:'üá∞üá™', profit:5380, trades:318, join:'Jul 2024', emoji:'üéØ', winRate:79 },
    { name:'Amara Diallo', loc:'Dakar, Senegal', flag:'üá∏üá≥', profit:5120, trades:294, join:'Aug 2024', emoji:'üí™', winRate:78 },
    { name:'Yuki Tanaka', loc:'Tokyo, Japan', flag:'üáØüáµ', profit:4960, trades:281, join:'Aug 2024', emoji:'üîÆ', winRate:77 },
    { name:'Ivan Petrov', loc:'Moscow, Russia', flag:'üá∑üá∫', profit:4780, trades:267, join:'Sep 2024', emoji:'‚ö°', winRate:76 },
    { name:'Fatima Abubakar', loc:'Abuja, Nigeria', flag:'üá≥üá¨', profit:4560, trades:251, join:'Sep 2024', emoji:'üåü', winRate:75 },
    { name:'Peter Mwangi', loc:'Thika, Kenya', flag:'üá∞üá™', profit:4340, trades:238, join:'Oct 2024', emoji:'üíé', winRate:74 },
    { name:'Lucy Akinyi', loc:'Mombasa, Kenya', flag:'üá∞üá™', profit:4120, trades:224, join:'Oct 2024', emoji:'üëë', winRate:73 }
];

let winnersShownSet = new Set();

function generateTopWinners() {
    const container = document.getElementById('topWinnersGrid');
    if(!container) return;
    let pool = ALL_WINNERS.filter((_,i) => !winnersShownSet.has(i));
    if(pool.length < 6) { winnersShownSet.clear(); pool = [...ALL_WINNERS]; }
    const picked = [];
    const poolCopy = [...pool];
    while(picked.length < 6 && poolCopy.length > 0) {
        const idx = Math.floor(Math.random() * poolCopy.length);
        const originalIdx = ALL_WINNERS.indexOf(poolCopy[idx]);
        picked.push(poolCopy[idx]);
        winnersShownSet.add(originalIdx);
        poolCopy.splice(idx, 1);
    }
    let html = '';
    picked.forEach((w, i) => {
        const displayProfit = Math.max(1000, w.profit + Math.floor(Math.random()*600) - 200);
        const displayTrades = w.trades + Math.floor(Math.random()*30);
        html += `<div class="winner-card">
            <div class="winner-rank">${i+1}</div>
            <div class="winner-header">
                <div class="winner-avatar">${w.emoji}</div>
                <div>
                    <div class="winner-name">${w.name}</div>
                    <div class="winner-location">${w.flag} ${w.loc}</div>
                    <div class="winner-join">Member since ${w.join}</div>
                </div>
            </div>
            <div class="winner-stats">
                <div class="winner-stat"><div class="winner-stat-label">Total Profit</div><div class="winner-stat-value">$${displayProfit.toLocaleString()}</div></div>
                <div class="winner-stat"><div class="winner-stat-label">Win Rate</div><div class="winner-stat-value">${w.winRate}%</div></div>
                <div class="winner-stat"><div class="winner-stat-label">Trades</div><div class="winner-stat-value">${displayTrades}</div></div>
                <div class="winner-stat"><div class="winner-stat-label">Status</div><div class="winner-stat-value" style="font-size:12px;color:var(--accent-green);">üü¢ Active</div></div>
            </div>
        </div>`;
    });
    container.innerHTML = html;
    setTimeout(generateTopWinners, 30000);
}

// ============================================
// LIVE WINNER TOASTS
// ============================================
const ALL_LIVE_WINNERS = [
    { name:'Sarah K.', flag:'üá∞üá™', amount:145.50, action:'won' },
    { name:'John M.', flag:'üá≥üá¨', amount:289.30, action:'won' },
    { name:'David L.', flag:'üá¨üáß', amount:420.80, action:'won' },
    { name:'Maria G.', flag:'üá¶üá™', amount:156.20, action:'won' },
    { name:'James W.', flag:'üá∫üá∏', amount:325.90, action:'won' },
    { name:'Emma B.', flag:'üá¶üá∫', amount:198.40, action:'won' },
    { name:'Peter K.', flag:'üá∞üá™', amount:500.00, action:'withdrew' },
    { name:'Lucy A.', flag:'üá∞üá™', amount:750.00, action:'withdrew' },
    { name:'Brian O.', flag:'üá∞üá™', amount:230.10, action:'won' },
    { name:'Grace W.', flag:'üá∞üá™', amount:410.60, action:'won' },
    { name:'Mohammed A.', flag:'üá™üá¨', amount:620.00, action:'withdrew' },
    { name:'Sophie M.', flag:'üá´üá∑', amount:315.75, action:'won' },
    { name:'Carlos R.', flag:'üá™üá∏', amount:488.20, action:'won' },
    { name:'Kim P.', flag:'üá∞üá∑', amount:890.50, action:'withdrew' },
    { name:'Yuki T.', flag:'üáØüáµ', amount:265.80, action:'won' },
    { name:'Ivan P.', flag:'üá∑üá∫', amount:730.00, action:'withdrew' },
    { name:'Amara D.', flag:'üá∏üá≥', amount:183.40, action:'won' },
    { name:'Michael K.', flag:'üá∞üá™', amount:540.00, action:'won' },
    { name:'Patricia B.', flag:'üá©üá™', amount:385.90, action:'withdrew' },
    { name:'Richard M.', flag:'üáÆüáπ', amount:217.60, action:'won' },
    { name:'Fatima A.', flag:'üá≥üá¨', amount:460.00, action:'won' },
    { name:'Hassan A.', flag:'üá™üá¨', amount:330.20, action:'won' },
    { name:'Linda C.', flag:'üáßüá∑', amount:595.70, action:'withdrew' },
    { name:'Charles N.', flag:'üá≤üáΩ', amount:278.40, action:'won' }
];

function buildWinnerQueue() {
    winnerQueue = [...ALL_LIVE_WINNERS];
    for(let i = winnerQueue.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [winnerQueue[i], winnerQueue[j]] = [winnerQueue[j], winnerQueue[i]];
    }
    winnerQueueIndex = 0;
}

function startLiveWinnerToasts() { showNextWinnerToast(); }

function showNextWinnerToast() {
    if(winnerQueueIndex >= winnerQueue.length) {
        const last = winnerQueue[winnerQueue.length - 1];
        buildWinnerQueue();
        if(winnerQueue[0].name === last.name) winnerQueue.push(winnerQueue.shift());
    }
    const winner = winnerQueue[winnerQueueIndex++];
    showLiveWinnerToast(winner);
    setTimeout(showNextWinnerToast, 10000 + Math.random() * 15000);
}

function showLiveWinnerToast(winner) {
    const existing = document.querySelector('.live-winner-toast');
    if(existing) { existing.classList.add('hiding'); setTimeout(() => existing.remove(), 400); }
    const isWin = winner.action === 'won';
    const variedAmount = winner.amount + (Math.random()-0.5) * 20;
    const toast = document.createElement('div');
    toast.className = 'live-winner-toast';
    toast.innerHTML = `
        <div class="winner-toast-avatar">${isWin ? 'üéâ' : 'üí∏'}</div>
        <div style="flex:1;">
            <div class="winner-toast-name">${winner.name} ${winner.flag}</div>
            <div class="winner-toast-amount">${isWin?'+':''}$${Math.abs(variedAmount).toFixed(2)}</div>
            <div class="winner-toast-action">${isWin ? '‚úÖ Just won from trading' : 'üí∏ Successfully withdrew'}</div>
        </div>
        <button onclick="this.parentElement.remove()" style="background:none;border:none;color:var(--text-muted);font-size:16px;cursor:pointer;padding:0 0 0 8px;align-self:flex-start;">√ó</button>
    `;
    document.body.appendChild(toast);
    setTimeout(() => {
        if(toast.parentNode) { toast.classList.add('hiding'); setTimeout(() => { if(toast.parentNode) toast.remove(); }, 400); }
    }, 7000);
}

// ============================================
// ORDER BOOK
// ============================================
function updateOrderBook() {
    const askEl = document.getElementById('asksContainer');
    const bidEl = document.getElementById('bidsContainer');
    if(!askEl || !bidEl) return;
    const base = currentBTCPrice;
    let askHtml = '', bidHtml = '';
    for(let i = 9; i >= 0; i--) {
        const price = base + (i+1) * (Math.random()*12+3);
        const amount = (Math.random()*3+0.05).toFixed(4);
        const total = (price * parseFloat(amount));
        const barW = Math.random()*85+10;
        askHtml += `<div class="orderbook-row ask-row">
            <div class="orderbook-bar" style="width:${barW}%"></div>
            <span class="ask-price">$${price.toFixed(1)}</span>
            <span class="ob-amount">${amount}</span>
            <span class="ob-total">$${total.toFixed(0)}</span>
        </div>`;
    }
    const spread = (Math.random()*5+1).toFixed(1);
    askHtml += `<div style="text-align:center;padding:8px;font-size:12px;font-family:'JetBrains Mono',monospace;background:rgba(252,213,53,0.08);border-radius:4px;margin:4px 0;color:var(--accent-yellow);">Spread: $${spread} | $${base.toFixed(2)}</div>`;
    for(let i = 0; i < 10; i++) {
        const price = base - (i+1) * (Math.random()*12+3);
        const amount = (Math.random()*3+0.05).toFixed(4);
        const total = (price * parseFloat(amount));
        const barW = Math.random()*85+10;
        bidHtml += `<div class="orderbook-row bid-row">
            <div class="orderbook-bar" style="width:${barW}%"></div>
            <span class="bid-price">$${price.toFixed(1)}</span>
            <span class="ob-amount">${amount}</span>
            <span class="ob-total">$${total.toFixed(0)}</span>
        </div>`;
    }
    askEl.innerHTML = askHtml;
    bidEl.innerHTML = bidHtml;
}

// ============================================
// PRICE SIMULATION
// ============================================
let prevBTCPrice = 98245.50;

function updatePricesSimulated() {
    prevBTCPrice = currentBTCPrice;
    currentBTCPrice += (Math.random()-0.48) * 150;
    currentBTCPrice = Math.max(90000, Math.min(105000, currentBTCPrice));
    const chgPct = ((currentBTCPrice - 96000) / 96000 * 100);
    const pos = currentBTCPrice >= prevBTCPrice;
    const fmt = n => '$' + n.toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2});
    ['currentPrice','tradePrice'].forEach(id => {
        const el = document.getElementById(id);
        if(!el) return;
        el.textContent = fmt(currentBTCPrice);
        el.classList.remove('flash-up','flash-down');
        void el.offsetWidth;
        el.classList.add(pos ? 'flash-up' : 'flash-down');
    });
    setEl('entryPriceDisplay', fmt(currentBTCPrice));
    ['priceChange','tradePriceChange'].forEach(id => {
        const el = document.getElementById(id);
        if(!el) return;
        el.textContent = `${chgPct >= 0?'+':''}${chgPct.toFixed(2)}%`;
        el.className = `price-change ${chgPct >= 0 ? 'positive' : 'negative'}`;
    });
    setEl('chartHigh', fmt(currentBTCPrice + Math.random()*600+100));
    setEl('chartLow', fmt(currentBTCPrice - Math.random()*600-100));
    setEl('chartVolume', `${(Math.random()*12+22).toFixed(1)}B`);
    setEl('chartOpen', fmt(currentBTCPrice - (Math.random()-0.5)*300));
    setEl('chartClose', fmt(currentBTCPrice));
    setEl('chart24h', `${chgPct >= 0?'+':''}${chgPct.toFixed(2)}%`);
    const h24 = document.getElementById('chart24h');
    if(h24) h24.style.color = chgPct >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';
    updatePositionSize();
}

function setEl(id, val) {
    const el = document.getElementById(id);
    if(el) el.textContent = val;
}

// ============================================
// TRADING PAIRS
// ============================================
function selectChartPair(btn, symbol, label, sub) {
    document.querySelectorAll('#chartPairsSelector .pair-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    setEl('chartPairLabel', label);
    setEl('currentPairSub', sub);
    const el = document.getElementById('tv_chart_main');
    if(el) { el.innerHTML = ''; delete tvCharts['tv_chart_main']; }
    loadTVChart('tv_chart_main', symbol, 500, false);
}

function selectTradePair(btn, symbol, label, sub) {
    document.querySelectorAll('#tradingLayer .pair-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    currentTradePair = symbol;
    currentTradePairLabel = label;
    currentTradePairSub = sub;
    setEl('tradePairLabel', label);
    setEl('tradePairSub', sub);
    const el = document.getElementById('tv_chart_trade');
    if(el) { el.innerHTML = ''; delete tvCharts['tv_chart_trade']; }
    loadTVChart('tv_chart_trade', symbol, 420, false);
}

// ============================================
// TRADE TYPE
// ============================================
function selectTradeType(type) {
    selectedTradeType = type;
    const buyBtn = document.getElementById('buyBtn');
    const sellBtn = document.getElementById('sellBtn');
    const submitBtn = document.getElementById('tradeSubmitBtn');
    if(type === 'buy') {
        buyBtn.style.background = 'var(--accent-green-dim)';
        buyBtn.style.borderColor = 'var(--accent-green)';
        buyBtn.style.color = 'var(--accent-green)';
        sellBtn.style.background = '';
        sellBtn.style.borderColor = 'var(--border-color)';
        sellBtn.style.color = 'var(--text-primary)';
        submitBtn.style.background = 'linear-gradient(135deg, var(--accent-green), #08A566)';
        submitBtn.style.color = '#000';
        submitBtn.textContent = 'üöÄ Execute Buy / Long';
    } else {
        sellBtn.style.background = 'var(--accent-red-dim)';
        sellBtn.style.borderColor = 'var(--accent-red)';
        sellBtn.style.color = 'var(--accent-red)';
        buyBtn.style.background = '';
        buyBtn.style.borderColor = 'var(--border-color)';
        buyBtn.style.color = 'var(--text-primary)';
        submitBtn.style.background = 'linear-gradient(135deg, var(--accent-red), #c92a40)';
        submitBtn.style.color = '#fff';
        submitBtn.textContent = 'üìâ Execute Sell / Short';
    }
}

// ============================================
// POSITION SIZE
// ============================================
function updatePositionSize() {
    const amount = parseFloat(document.getElementById('tradeAmount')?.value) || 0;
    const leverage = parseFloat(document.getElementById('tradeLeverage')?.value) || 1;
    const pos = amount * leverage;
    let liqPrice;
    if(leverage > 1) {
        const mm = 0.005;
        liqPrice = selectedTradeType === 'buy'
            ? currentBTCPrice * (1 - (1/leverage) + mm)
            : currentBTCPrice * (1 + (1/leverage) - mm);
    }
    setEl('positionSizeDisplay', '$' + pos.toFixed(2));
    setEl('liquidationDisplay', leverage > 1 ? '$' + liqPrice.toFixed(0) : '‚Äî');
    setEl('entryPriceDisplay', '$' + currentBTCPrice.toLocaleString('en-US',{minimumFractionDigits:2}));
}

// ============================================
// AI BOTS
// ============================================
const BOTS_DATA = [
    { name:'Scalper Pro', emoji:'üéØ', desc:'High-Frequency Trading ‚Äî 50+ trades/day', winRate:87, avgDaily:3.2, color:'var(--accent-green)', minBalance:10 },
    { name:'Trend Master', emoji:'üìä', desc:'Follow Market Trends ‚Äî Swing trading', winRate:82, avgDaily:2.8, color:'var(--accent-blue)', minBalance:50 },
    { name:'Grid Trader', emoji:'üíé', desc:'Range Trading Strategy ‚Äî Low risk', winRate:79, avgDaily:2.5, color:'var(--accent-yellow)', minBalance:100 },
    { name:'Arbitrage AI', emoji:'‚ö°', desc:'Cross-Exchange Profits ‚Äî Premium bot', winRate:91, avgDaily:4.1, color:'var(--accent-red)', minBalance:200 }
];

let activeBots = new Set();

function generateBots() {
    const container = document.getElementById('botsGrid');
    if(!container) return;
    let html = '';
    BOTS_DATA.forEach(bot => {
        html += `<div class="bot-card">
            <div style="text-align:center;margin-bottom:16px;">
                <div style="font-size:44px;margin-bottom:8px;">${bot.emoji}</div>
                <div style="font-size:18px;font-weight:700;color:${bot.color};">${bot.name}</div>
                <div style="font-size:12px;color:var(--text-secondary);margin-top:4px;">${bot.desc}</div>
                <div style="font-size:11px;color:var(--text-muted);margin-top:3px;">Min Balance: $${bot.minBalance}</div>
            </div>
            <div class="winner-stats" style="margin-bottom:16px;">
                <div class="winner-stat"><div class="winner-stat-label">Win Rate</div><div class="winner-stat-value">${bot.winRate}%</div></div>
                <div class="winner-stat"><div class="winner-stat-label">Avg Daily</div><div class="winner-stat-value">+${bot.avgDaily}%</div></div>
            </div>
            <button class="btn-submit" id="botBtn_${bot.name.replace(' ','_')}" onclick="activateBot('${bot.name}', this)">üöÄ Activate Bot</button>
        </div>`;
    });
    container.innerHTML = html;
}

function generateActiveBotsPanel() {
    const container = document.getElementById('activeBotsContainer');
    if(!container) return;
    const botsWithStats = [
        { name:'Scalper Pro', country:'üá∞üá™ Kenya', trades:47, profit:234.50, winRate:87 },
        { name:'Trend Master', country:'üá≥üá¨ Nigeria', trades:23, profit:189.30, winRate:82 },
        { name:'Grid Trader', country:'üá¨üáß UK', trades:31, profit:156.80, winRate:79 },
        { name:'Arbitrage AI', country:'üá¶üá™ UAE', trades:19, profit:298.40, winRate:91 }
    ];
    let html = '';
    botsWithStats.forEach(bot => {
        html += `<div class="active-bot-item running">
            <div class="active-bot-bar">
                <div>
                    <div style="font-size:15px;font-weight:700;">${bot.name}</div>
                    <div style="font-size:11px;color:var(--text-secondary);margin-top:3px;">üü¢ Running ‚Ä¢ ${bot.trades} trades today ‚Ä¢ ${bot.country}</div>
                </div>
                <button onclick="pauseBot('${bot.name}',this)" style="padding:7px 16px;border:1px solid var(--accent-red);border-radius:8px;background:var(--accent-red-dim);color:var(--accent-red);font-size:12px;font-weight:700;cursor:pointer;font-family:'Space Grotesk',sans-serif;">‚è∏ Pause</button>
            </div>
            <div class="active-bot-stats">
                <div class="active-bot-stat"><div class="active-bot-stat-label">Today's Profit</div><div class="active-bot-stat-value" style="color:var(--accent-green);">+$${bot.profit.toFixed(2)}</div></div>
                <div class="active-bot-stat"><div class="active-bot-stat-label">Win Rate</div><div class="active-bot-stat-value" style="color:var(--accent-blue);">${bot.winRate}%</div></div>
                <div class="active-bot-stat"><div class="active-bot-stat-label">Trades</div><div class="active-bot-stat-value">${bot.trades}</div></div>
            </div>
        </div>`;
    });
    container.innerHTML = html;
    setInterval(() => {
        botsWithStats.forEach(bot => { bot.profit += Math.random() * 5; bot.trades += Math.random() > 0.7 ? 1 : 0; });
        if(document.getElementById('activeBotsContainer')) generateActiveBotsPanel();
    }, 8000);
}

function generateBotStats() {
    const container = document.getElementById('botStatsGrid');
    if(!container) return;
    container.innerHTML = [
        { icon:'üìä', value:'120', label:'Total Trades' },
        { icon:'üí∞', value:'$878.60', label:'Total Profit' },
        { icon:'üéØ', value:'84.7%', label:'Avg Win Rate' },
        { icon:'ü§ñ', value:'4', label:'Active Bots' }
    ].map(s => `<div class="stat-card"><div class="stat-icon">${s.icon}</div><div class="stat-value" style="font-size:22px;">${s.value}</div><div class="stat-label">${s.label}</div></div>`).join('');
}

function activateBot(name, btn) {
    if(!currentUser) { showToast('Please login first!'); return; }
    const bal = currentAccountMode === 'demo' ? currentUser.demoBalance : currentUser.realBalance;
    const bot = BOTS_DATA.find(b => b.name === name);
    if(bot && bal < bot.minBalance) {
        showToast(`‚ö†Ô∏è Minimum $${bot.minBalance} balance required to activate ${name}!\n\nPlease deposit first.`);
        return;
    }
    activeBots.add(name);
    if(btn) { btn.textContent = '‚úÖ Bot Active'; btn.style.background = 'linear-gradient(135deg,#10b981,#059669)'; }
    showToast(`ü§ñ ${name} ACTIVATED!\n\n‚úÖ Bot is now trading automatically\nüìä You'll be notified for each trade\nüí∞ Profits added to your balance automatically\n\nRelax and let AI work for you! üöÄ`);
    addNotification(`ü§ñ ${name} Activated`, `Bot is now trading automatically on your account`);
    setTimeout(() => simulateBotTrade(name), Math.random()*30000+20000);
}

function pauseBot(name, btn) {
    activeBots.delete(name);
    if(btn) { btn.textContent = '‚ñ∂ Resume'; btn.style.background = 'var(--accent-green-dim)'; btn.style.borderColor = 'var(--accent-green)'; btn.style.color = 'var(--accent-green)'; }
    showToast(`‚è∏ ${name} paused!\n\nYou can resume anytime from the Bots page.`);
}

function simulateBotTrade(botName) {
    if(!currentUser || !activeBots.has(botName)) return;
    const bal = currentAccountMode === 'demo' ? currentUser.demoBalance : currentUser.realBalance;
    if(bal < 10) return;
    const amount = Math.min(Math.random()*30+10, bal*0.1);
    const leverage = Math.floor(Math.random()*5)+5;
    const type = Math.random() > 0.5 ? 'buy' : 'sell';
    const isWin = Math.random() < 0.72;
    const profitPct = (Math.random()*0.04+0.01) * (isWin ? 1 : -1);
    const profit = amount * profitPct * leverage;
    if(currentAccountMode === 'demo') currentUser.demoBalance += profit;
    else currentUser.realBalance += profit;
    currentUser.totalProfit = (currentUser.totalProfit || 0) + profit;
    localStorage.setItem('cryptoproUser', JSON.stringify(currentUser));
    if(profit > 0) launchConfetti();
    showToast(`ü§ñ ${botName} Trade!\n\n${type === 'buy' ? 'üìà LONG' : 'üìâ SHORT'} BTC/USDT\nüí∞ Amount: $${amount.toFixed(2)}\n‚ö° Leverage: ${leverage}x\n\n${profit > 0 ? 'üéâ PROFIT: +$' + profit.toFixed(2) : '‚ùå LOSS: -$' + Math.abs(profit).toFixed(2)}`);
    addNotification(`ü§ñ ${botName} Trade ${profit > 0 ? 'Profit!' : 'Closed'}`, `${profit > 0 ? '+' : ''}$${profit.toFixed(2)} ${type.toUpperCase()} BTC/USDT`);
    if(currentLayer === 'dashboardLayer') updateDashboard();
    if(activeBots.has(botName)) setTimeout(() => simulateBotTrade(botName), Math.random()*40000+20000);
}

// ============================================
// REVIEWS
// ============================================
const REVIEWS = [
    { name:'Michael Roberts', loc:'Nairobi, Kenya', flag:'üá∞üá™', rating:5, date:'2 days ago', text:'Best trading platform I\'ve ever used! Made $5,000 in my first month. The AI bots are incredible ‚Äî they run 24/7 and I wake up to profits every morning!', verified:true },
    { name:'Sarah Mitchell', loc:'Mombasa, Kenya', flag:'üá∞üá™', rating:5, date:'5 days ago', text:'Finally a platform that actually pays! I withdrew $3,500 yesterday and received my money within 15 minutes. Customer support is always there when I need them.', verified:true },
    { name:'David Kimani', loc:'Kisumu, Kenya', flag:'üá∞üá™', rating:5, date:'1 week ago', text:'Started with just $100, now my balance is $2,800! The Scalper Pro bot is absolutely amazing. I didn\'t know anything about trading but this made it so easy.', verified:true },
    { name:'Grace Wanjiku', loc:'Nakuru, Kenya', flag:'üá∞üá™', rating:5, date:'1 week ago', text:'Easiest money I\'ve ever made. The platform is super user-friendly and withdrawals are processed super fast. Already referred 3 friends who are also making profits!', verified:true },
    { name:'John Ochieng', loc:'Eldoret, Kenya', flag:'üá∞üá™', rating:5, date:'2 weeks ago', text:'3 months of consistent daily profits. This is 100% legit! I\'ve referred 5 friends already and earn 10% from all their deposits. The referral system is genius!', verified:true },
    { name:'Lucy Akinyi', loc:'Nairobi, Kenya', flag:'üá∞üá™', rating:5, date:'2 weeks ago', text:'I\'ve withdrawn over $10,000 so far with absolutely zero issues. The process is seamless and fast. CryptoPro has genuinely changed my financial situation!', verified:true },
    { name:'Peter Mwangi', loc:'Thika, Kenya', flag:'üá∞üá™', rating:5, date:'3 weeks ago', text:'Was very skeptical at first but my friend convinced me to try. Made $1,200 in my very first week! Now I\'m a full believer. The AI is incredibly accurate.', verified:true },
    { name:'Jane Njeri', loc:'Nyeri, Kenya', flag:'üá∞üá™', rating:5, date:'3 weeks ago', text:'The AI trading bots are absolute game-changers! I don\'t even need to watch the market. Everything is fully automated and the profits just keep coming every day!', verified:true },
    { name:'Brian Otieno', loc:'Kisii, Kenya', flag:'üá∞üá™', rating:5, date:'1 month ago', text:'CryptoPro literally changed my life! I went from struggling to pay bills to making $500 daily. The support team is always helpful and responsive too!', verified:true },
    { name:'Mary Wambui', loc:'Machakos, Kenya', flag:'üá∞üá™', rating:5, date:'1 month ago', text:'This is 100% genuine! I\'ve been paid consistently for 4 months now. No delays, no excuses. Just real money in my account whenever I request a withdrawal.', verified:true },
    { name:'Joseph Kariuki', loc:'Nairobi, Kenya', flag:'üá∞üá™', rating:5, date:'1 month ago', text:'The referral program alone has earned me over $500 this month! Plus my own trading profits on top. This is the best passive income I\'ve ever found!', verified:true },
    { name:'Elizabeth Chebet', loc:'Kericho, Kenya', flag:'üá∞üá™', rating:5, date:'1 month ago', text:'Started with the demo account to test it, was impressed, then deposited $200 real money. Made $800 profit in just 2 weeks! This platform is unbelievable!', verified:true }
];

function generateReviews() {
    const container = document.getElementById('reviewsGrid');
    if(!container) return;
    let html = '';
    REVIEWS.forEach(r => {
        const stars = '‚≠ê'.repeat(r.rating);
        html += `<div class="winner-card">
            <div class="winner-header">
                <div class="winner-avatar" style="font-size:20px;">üë§</div>
                <div>
                    <div class="winner-name">${r.name} ${r.verified ? '<span style="color:var(--accent-green);font-size:14px;">‚úì</span>' : ''}</div>
                    <div class="winner-location">${r.flag} ${r.loc}</div>
                    <div style="margin-top:6px;display:flex;align-items:center;gap:8px;"><span style="font-size:13px;">${stars}</span><span style="font-size:11px;color:var(--text-secondary);">${r.date}</span></div>
                </div>
            </div>
            <div style="background:var(--accent-green-dim);padding:14px;border-radius:10px;margin-top:14px;font-size:13px;color:var(--text-primary);line-height:1.7;font-style:italic;">"${r.text}"</div>
            ${r.verified ? `<div style="margin-top:10px;padding:7px 12px;background:var(--accent-green-dim);border-radius:6px;border-left:3px solid var(--accent-green);font-size:11px;color:var(--accent-green);font-weight:700;">‚úì VERIFIED TRADER</div>` : ''}
        </div>`;
    });
    container.innerHTML = html;
}

// ============================================
// NOTIFICATIONS
// ============================================
function renderNotifications() {
    const list = document.getElementById('notifList');
    if(!list) return;
    if(notifications.length === 0) {
        list.innerHTML = '<div style="padding:20px;text-align:center;color:var(--text-secondary);font-size:13px;">No new notifications</div>';
    } else {
        list.innerHTML = notifications.slice(0,10).map(n => `
            <div class="notif-item" style="${n.unread ? 'border-left:3px solid var(--accent-green);background:rgba(14,203,129,0.03);' : ''}">
                <div class="notif-item-title">${n.title}</div>
                <div class="notif-item-desc">${n.desc}</div>
                <div class="notif-item-time">${n.time}</div>
            </div>`).join('');
    }
    const unread = notifications.filter(n => n.unread).length;
    const badge = document.getElementById('notifCount');
    if(badge) { badge.textContent = unread; badge.style.display = unread > 0 ? 'flex' : 'none'; }
}

function toggleNotifications() {
    const dd = document.getElementById('notifDropdown');
    if(dd) dd.classList.toggle('open');
    setTimeout(() => { document.addEventListener('click', closeNotifOutside, { once:true }); }, 0);
}

function closeNotifOutside(e) {
    const wrapper = document.getElementById('notifBellWrapper');
    if(wrapper && !wrapper.contains(e.target)) document.getElementById('notifDropdown')?.classList.remove('open');
}

function clearNotifications() {
    notifications.forEach(n => n.unread = false);
    renderNotifications();
}

function addNotification(title, desc) {
    notifications.unshift({ title, desc, time:'Just now', unread:true });
    if(notifications.length > 20) notifications.pop();
    renderNotifications();
}

// ============================================
// LAYER NAVIGATION
// ============================================
function showLayer(id) {
    document.querySelectorAll('.layer').forEach(l => l.classList.remove('active'));
    const layer = document.getElementById(id);
    if(layer) layer.classList.add('active');
    currentLayer = id;
    const aiBtn = document.getElementById('aiAssistantBtn');
    if(aiBtn) {
        const showAI = ['dashboardLayer','tradingLayer','botsLayer','historyLayer','withdrawalLayer'].includes(id);
        aiBtn.style.display = showAI ? 'block' : 'none';
    }
    if(id === 'dashboardLayer' && currentUser) { updateDashboard(); switchAccount(currentAccountMode); }
    if(id === 'tradingLayer' && currentUser) updateTradingLayer();
    if(id === 'withdrawalLayer' && currentUser) updateWithdrawalLayer();
    if(id === 'referralLayer' && currentUser) updateReferralLayer();
    if(id === 'profileLayer' && currentUser) updateProfileLayer();
    if(id === 'historyLayer' && currentUser) { updateTradeHistory(); updateHistoryStats(); }
    if(id === 'depositLayer') { setTimeout(() => { const c = document.getElementById('currencyConverterContainer'); if(c && c.innerHTML.trim() === '') addCurrencyConverter(); }, 100); }
    if(id === 'botsLayer') setTimeout(restoreBotButtonStates, 150);
    loadChartsForLayer(id);
    syncMobileNav(id);
    window.scrollTo({ top:0, behavior:'smooth' });
}

// ============================================
// AUTH
// ============================================
function handleSignup(event) {
    event.preventDefault();
    const name = document.getElementById('signupName').value.trim();
    const email = document.getElementById('signupEmail').value.trim();
    const phone = document.getElementById('signupPhone').value.trim();
    const password = document.getElementById('signupPassword').value;
    const confirm = document.getElementById('signupConfirm').value;
    const refCode = document.getElementById('signupReferralCode').value.trim();
    if(password !== confirm) { showAlert('signupAlert','‚ùå Passwords do not match!','error'); return false; }
    if(password.length < 6) { showAlert('signupAlert','‚ùå Password must be at least 6 characters!','error'); return false; }
    const user = {
        id: 'USR_' + Date.now(), name, email, phone, password, referralCode: refCode,
        joinDate: new Date().toISOString(), demoBalance: 25.00, realBalance: 0.00, totalProfit: 0.00,
        referrals: [], trades: [], shareCount: 0,
        referralLink: `${location.origin}${location.pathname}?ref=${generateRefCode()}&name=${encodeURIComponent(name)}`
    };
    localStorage.setItem('cryptoproUser', JSON.stringify(user));
    currentUser = user;
    launchConfetti();
    showToast(`üéâ Welcome to CryptoPro, ${name}!\n\nüí∞ $25 DEMO BONUS has been credited!\nüöÄ Your trading journey starts now!\n\nRedirecting to dashboard...`);
    setTimeout(() => showLayer('dashboardLayer'), 2500);
    return false;
}

function handleLogin(event) {
    event.preventDefault();
    const email = document.getElementById('loginEmail').value.trim();
    const password = document.getElementById('loginPassword').value;
    const stored = JSON.parse(localStorage.getItem('cryptoproUser'));
    if(!stored || stored.email !== email || stored.password !== password) {
        showAlert('loginAlert','‚ùå Invalid email or password. Please try again.','error');
        return false;
    }
    currentUser = stored;
    showToast(`üëã Welcome back, ${currentUser.name}!\n\nLoading your dashboard...`);
    setTimeout(() => showLayer('dashboardLayer'), 1000);
    return false;
}

function handleLogout() {
    currentUser = null;
    document.getElementById('aiChatPanel')?.classList.remove('open');
    showToast('‚úÖ Logged out successfully!\n\nSee you next time!');
    setTimeout(() => showLayer('welcomeLayer'), 1000);
}

function generateRefCode() {
    return 'REF' + Math.random().toString(36).substring(2,8).toUpperCase();
}

function checkReferralCode() {
    const params = new URLSearchParams(location.search);
    const ref = params.get('ref');
    const name = params.get('name');
    if(ref) {
        const el = document.getElementById('signupReferralCode');
        if(el) el.value = ref;
        if(name) {
            document.getElementById('referrerName').textContent = decodeURIComponent(name);
            document.getElementById('referralSuccessBanner').classList.add('show');
        }
    }
}

function closeReferralBanner() {
    document.getElementById('referralSuccessBanner').classList.remove('show');
}

// ============================================
// DASHBOARD
// ============================================
function updateDashboard() {
    if(!currentUser) return;
    setEl('userName', currentUser.name);
    setEl('userEmail', currentUser.email);
    const bal = currentAccountMode === 'demo' ? currentUser.demoBalance : currentUser.realBalance;
    const openTradeAmount = (currentUser.trades||[]).filter(t => t.status === 'open' && t.accountMode === currentAccountMode).reduce((s,t) => s + t.amount, 0);
    setEl('dashBalance', '$' + bal.toFixed(2));
    setEl('dashAvailable', '$' + (bal - openTradeAmount).toFixed(2));
    setEl('dashInTrades', '$' + openTradeAmount.toFixed(2));
    setEl('dashProfit', '$' + (currentUser.totalProfit||0).toFixed(2));
    setEl('accountTypeLabel', currentAccountMode.toUpperCase());
}

function switchAccount(mode) {
    currentAccountMode = mode;
    const demoBtn = document.getElementById('switchToDemo');
    const realBtn = document.getElementById('switchToReal');
    if(demoBtn) demoBtn.classList.toggle('active', mode === 'demo');
    if(realBtn) realBtn.classList.toggle('active', mode === 'real');
    const indicator = document.getElementById('accountModeIndicator');
    if(indicator) {
        indicator.innerHTML = mode === 'demo'
            ? `<div style="background:rgba(252,213,53,0.08);border:1px solid rgba(252,213,53,0.25);border-radius:10px;padding:12px 16px;font-size:14px;font-weight:700;color:var(--accent-yellow);">üìä DEMO ACCOUNT MODE ‚Äî Practice with $25 virtual funds. No real money at risk.</div>`
            : `<div style="background:var(--accent-green-dim);border:1px solid rgba(14,203,129,0.25);border-radius:10px;padding:12px 16px;font-size:14px;font-weight:700;color:var(--accent-green);">üíé REAL ACCOUNT MODE ‚Äî Trading with real funds. Profits are fully withdrawable.</div>`;
    }
    if(currentUser) updateDashboard();
}

// ============================================
// DEPOSIT ‚Äî BACKEND CONNECTED
// ============================================
function selectPaymentMethod(method, btn) {
    selectedPaymentMethod = method;
    document.querySelectorAll('#depositForm .payment-btn').forEach(b => b.classList.remove('active'));
    if(btn) btn.classList.add('active');
    document.querySelectorAll('#depositForm .payment-details').forEach(d => d.classList.remove('active'));
    const details = document.getElementById(method);
    if(details) details.classList.add('active');
}

async function processDeposit(event) {
    event.preventDefault();
    if(!currentUser) { showToast('Please login first!'); return false; }
    if(!selectedPaymentMethod) { showToast('‚ö†Ô∏è Please select a payment method first!'); return false; }

    const amount = parseFloat(document.getElementById('depositAmount').value);
    const proof = document.getElementById('depositProof').value.trim();

    if(amount < 10) { showToast('‚ö†Ô∏è Minimum deposit is $10!'); return false; }

    const pb = document.getElementById('depositProgressBar');
    if(pb) pb.classList.add('show');

    // ‚îÄ‚îÄ M-PESA PHONE ‚Äî STK PUSH ‚îÄ‚îÄ
    if(selectedPaymentMethod === 'mpesa-phone') {
        if(!currentUser.phone) {
            showToast('‚ö†Ô∏è No phone number on your account!\nPlease update your profile first.');
            if(pb) pb.classList.remove('show');
            return false;
        }
        const steps = [
            { pct:20, label:'üì± Connecting to M-Pesa...' },
            { pct:45, label:'üîê Authenticating with Safaricom...' },
            { pct:70, label:'üì≤ Sending STK Push to your phone...' },
            { pct:90, label:'‚è≥ Waiting for your confirmation...' },
            { pct:100, label:'‚úÖ Request sent!' }
        ];
        animateProgress('progressFill','progressText','progressLabel', steps, async () => {
            try {
                const response = await fetch(`${API_BASE_URL}/api/mpesa-payment`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ phoneNumber: currentUser.phone, amount, email: currentUser.email, userName: currentUser.name })
                });
                const data = await response.json();
                if(data.success) {
                    if(pb) pb.classList.remove('show');
                    showToast(`üì± STK PUSH SENT!\n\n‚úÖ Check your phone: ${currentUser.phone}\nüí∞ Amount: KES ${Math.ceil(amount * 130)}\n\nüìå Enter your M-Pesa PIN to confirm.\n‚è± Expires in 60 seconds!`);
                    pollPaymentStatus(data.checkoutRequestID, amount);
                } else {
                    if(pb) pb.classList.remove('show');
                    showToast(`‚ùå M-Pesa Error:\n\n${data.message || 'Failed to send STK Push'}\n\nPlease try again or use a different payment method.`);
                }
            } catch(error) {
                if(pb) pb.classList.remove('show');
                showToast('‚ùå Could not connect to payment server.\n\nPlease check your connection or contact support.');
            }
        });

    // ‚îÄ‚îÄ M-PESA TILL ‚îÄ‚îÄ
    } else if(selectedPaymentMethod === 'mpesa-till') {
        if(!proof) { showToast('‚ö†Ô∏è Please enter your M-Pesa confirmation code!'); if(pb) pb.classList.remove('show'); return false; }
        const steps = [
            { pct:20, label:'üîç Validating M-Pesa code...' },
            { pct:55, label:'‚úÖ Code verified...' },
            { pct:80, label:'üí∞ Crediting your account...' },
            { pct:100, label:'üéâ Deposit complete!' }
        ];
        animateProgress('progressFill','progressText','progressLabel', steps, () => {
            creditUserAccount(amount);
            if(pb) pb.classList.remove('show');
        });

    // ‚îÄ‚îÄ BANK TRANSFER ‚îÄ‚îÄ
    } else if(selectedPaymentMethod === 'bank') {
        if(!proof) { showToast('‚ö†Ô∏è Please enter your bank reference number!'); if(pb) pb.classList.remove('show'); return false; }
        const steps = [
            { pct:25, label:'üè¶ Submitting bank transfer...' },
            { pct:60, label:'üìß Notifying verification team...' },
            { pct:100, label:'‚úÖ Submitted for verification!' }
        ];
        animateProgress('progressFill','progressText','progressLabel', steps, async () => {
            try {
                await fetch(`${API_BASE_URL}/api/bank-payment`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: currentUser.email, userName: currentUser.name, amount, reference: proof })
                });
            } catch(e) { console.warn('Bank API error:', e.message); }
            if(pb) pb.classList.remove('show');
            showToast(`üè¶ BANK TRANSFER SUBMITTED!\n\nüí∞ Amount: $${amount.toFixed(2)}\nüìã Reference: ${proof}\n\n‚è± Verification: 5‚Äì30 minutes\nüìß You'll receive email confirmation once verified.`);
            addNotification('üè¶ Bank Transfer Submitted', `$${amount.toFixed(2)} pending verification`);
            resetDepositForm();
        });

    // ‚îÄ‚îÄ CRYPTO ‚îÄ‚îÄ
    } else if(selectedPaymentMethod === 'crypto') {
        if(!proof) { showToast('‚ö†Ô∏è Please enter your transaction hash / TXID!'); if(pb) pb.classList.remove('show'); return false; }
        const steps = [
            { pct:25, label:'ü™ô Submitting crypto transaction...' },
            { pct:60, label:'üîç Logging for blockchain verification...' },
            { pct:100, label:'‚úÖ Submitted for verification!' }
        ];
        animateProgress('progressFill','progressText','progressLabel', steps, async () => {
            try {
                await fetch(`${API_BASE_URL}/api/crypto-payment`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: currentUser.email, userName: currentUser.name, amount, cryptoType: 'USDT-TRC20', txHash: proof })
                });
            } catch(e) { console.warn('Crypto API error:', e.message); }
            if(pb) pb.classList.remove('show');
            showToast(`ü™ô CRYPTO PAYMENT SUBMITTED!\n\nüí∞ Amount: $${amount.toFixed(2)} USDT\nüîó TX Hash: ${proof.substring(0,20)}...\n\n‚è± Blockchain confirmations: 10‚Äì30 mins\nüìß You'll be notified once confirmed.`);
            addNotification('ü™ô Crypto Payment Submitted', `$${amount.toFixed(2)} USDT pending blockchain confirmation`);
            resetDepositForm();
        });
    }
    return false;
}

// ============================================
// POLL M-PESA PAYMENT STATUS
// ============================================
function pollPaymentStatus(checkoutRequestID, amount) {
    let attempts = 0;
    const maxAttempts = 24;
    showToast(`‚è≥ Waiting for M-Pesa confirmation...\n\nEnter your PIN on your phone.\nThis window will update automatically.`);
    const interval = setInterval(async () => {
        attempts++;
        try {
            const response = await fetch(`${API_BASE_URL}/api/check-payment/${checkoutRequestID}`);
            const data = await response.json();
            if(data.status === 'completed') {
                clearInterval(interval);
                creditUserAccount(amount, data.transaction?.mpesaReceiptNumber);
            } else if(data.status === 'failed') {
                clearInterval(interval);
                showToast(`‚ùå M-Pesa payment failed.\n\nPlease try again or use a different payment method.\n\nContact support if funds were deducted.`);
            } else if(attempts >= maxAttempts) {
                clearInterval(interval);
                showToast(`‚è± Payment timeout.\n\nIf you completed the payment, it will be credited manually within 30 minutes.\n\nContact support: wa.me/254759401893`);
            }
        } catch(error) {
            if(attempts >= maxAttempts) clearInterval(interval);
        }
    }, 5000);
}

// ============================================
// CREDIT USER ACCOUNT
// ============================================
function creditUserAccount(amount, receiptNumber) {
    const isFirstDeposit = currentUser.realBalance === 0;
    const bonus = isFirstDeposit ? amount : 0;
    currentUser.realBalance += (amount + bonus);
    localStorage.setItem('cryptoproUser', JSON.stringify(currentUser));
    launchConfetti();
    if(bonus > 0) {
        showToast(`üéâ DEPOSIT CONFIRMED!\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüí∞ Deposit: $${amount.toFixed(2)}\nüéÅ Welcome Bonus: +$${bonus.toFixed(2)}\n‚úÖ Total Credited: $${(amount+bonus).toFixed(2)}\n${receiptNumber ? 'üßæ Receipt: '+receiptNumber : ''}\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\nSwitch to REAL mode to start trading! üöÄ`);
    } else {
        showToast(`‚úÖ DEPOSIT CONFIRMED!\n\nüí∞ $${amount.toFixed(2)} credited to your REAL account!\n${receiptNumber ? 'üßæ Receipt: '+receiptNumber : ''}\n\nSwitch to REAL mode to trade! üöÄ`);
    }
    addNotification('üí∞ Deposit Confirmed', `$${amount.toFixed(2)}${bonus > 0 ? ' + $'+bonus.toFixed(2)+' bonus' : ''} added to your account`);
    resetDepositForm();
    setTimeout(() => showLayer('dashboardLayer'), 3000);
}

// ============================================
// RESET DEPOSIT FORM
// ============================================
function resetDepositForm() {
    const form = document.getElementById('depositForm');
    if(form) form.reset();
    selectedPaymentMethod = '';
    document.querySelectorAll('#depositForm .payment-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('#depositForm .payment-details').forEach(d => d.classList.remove('active'));
    updateCurrencyConversion();
}

// ============================================
// WITHDRAWAL
// ============================================
function selectWithdrawMethod(method, btn) {
    selectedWithdrawMethod = method;
    document.querySelectorAll('#withdrawalForm .payment-btn').forEach(b => b.classList.remove('active'));
    if(btn) btn.classList.add('active');
    document.querySelectorAll('#withdrawalForm .payment-details').forEach(d => d.classList.remove('active'));
    document.getElementById('withdraw-' + method)?.classList.add('active');
}

function updateWithdrawalLayer() {
    if(!currentUser) return;
    const bal = currentAccountMode === 'demo' ? currentUser.demoBalance : currentUser.realBalance;
    setEl('withdrawAvailable', '$' + bal.toFixed(2));
    setEl('maxWithdraw', '$' + bal.toFixed(2));
}

function processWithdrawal(event) {
    event.preventDefault();
    if(!currentUser) { showToast('Please login first!'); return false; }
    if(currentAccountMode === 'demo') {
        showToast('‚ö†Ô∏è Cannot withdraw from DEMO account!\n\nPlease switch to REAL account mode first.\nDeposit real funds to enable withdrawals.');
        return false;
    }
    if(!selectedWithdrawMethod) { showToast('‚ö†Ô∏è Please select a withdrawal method!'); return false; }
    const amount = parseFloat(document.getElementById('withdrawAmount').value);
    const bal = currentUser.realBalance;
    if(amount > bal) { showToast('‚ùå Insufficient balance!'); return false; }
    if(amount < 50) { showToast('‚ö†Ô∏è Minimum withdrawal is $50!'); return false; }
    const fee = amount * 0.02;
    const finalAmount = amount - fee;
    const localEquiv = convertUSDToLocal(finalAmount);
    const pb = document.getElementById('withdrawProgressBar');
    if(pb) pb.classList.add('show');
    const steps = [
        { pct:20, label:'üîç Validating withdrawal request...' },
        { pct:45, label:'üîí Security verification...' },
        { pct:70, label:'üè¶ Processing payment...' },
        { pct:90, label:'‚úÖ Approving transfer...' },
        { pct:100, label:'üí∏ Withdrawal sent!' }
    ];
    animateProgress('withdrawProgressFill','withdrawProgressText','withdrawProgressLabel', steps, () => {
        currentUser.realBalance -= amount;
        localStorage.setItem('cryptoproUser', JSON.stringify(currentUser));
        if(pb) setTimeout(() => pb.classList.remove('show'), 1500);
        showToast(`üí∏ WITHDRAWAL SENT!\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüí∞ Requested: $${amount.toFixed(2)}\nüí≥ Fee (2%): -$${fee.toFixed(2)}\n‚úÖ You Receive: $${finalAmount.toFixed(2)}\nüí± Local: ${localEquiv}\nüè¶ Method: ${selectedWithdrawMethod.toUpperCase()}\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n‚è± Processing: 5‚Äì30 minutes\nüì± You'll receive a confirmation SMS`);
        addNotification('üí∏ Withdrawal Processing', `$${finalAmount.toFixed(2)} sent to your ${selectedWithdrawMethod} account`);
        document.getElementById('withdrawalForm').reset();
        selectedWithdrawMethod = '';
        document.querySelectorAll('#withdrawalForm .payment-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('#withdrawalForm .payment-details').forEach(d => d.classList.remove('active'));
        updateWithdrawalLayer();
    });
    return false;
}

// ============================================
// TRADING
// ============================================
function updateTradingLayer() {
    if(!currentUser) return;
    const bal = currentAccountMode === 'demo' ? currentUser.demoBalance : currentUser.realBalance;
    setEl('tradeAvailableBalance', '$' + bal.toFixed(2));
    setEl('entryPriceDisplay', '$' + currentBTCPrice.toLocaleString('en-US',{minimumFractionDigits:2}));
}

function executeTrade(event) {
    event.preventDefault();
    if(!currentUser) { showToast('Please login first!'); return false; }
    const amount = parseFloat(document.getElementById('tradeAmount').value);
    const leverage = parseFloat(document.getElementById('tradeLeverage').value);
    const tp = parseFloat(document.getElementById('takeProfitPrice').value) || null;
    const sl = parseFloat(document.getElementById('stopLossPrice').value) || null;
    const bal = currentAccountMode === 'demo' ? currentUser.demoBalance : currentUser.realBalance;
    if(amount > bal) { showToast('‚ùå Insufficient balance!\n\nPlease deposit funds first.'); return false; }
    if(amount < 10) { showToast('‚ö†Ô∏è Minimum trade amount is $10!'); return false; }
    const pos = amount * leverage;
    const trade = {
        id: 'TRADE_' + Date.now(), type: selectedTradeType, pair: currentTradePairLabel,
        amount, leverage, positionSize: pos, entryPrice: currentBTCPrice,
        takeProfit: tp, stopLoss: sl, exitPrice: null, profit: null,
        status: 'open', timestamp: new Date().toISOString(), accountMode: currentAccountMode
    };
    if(!currentUser.trades) currentUser.trades = [];
    currentUser.trades.push(trade);
    if(currentAccountMode === 'demo') currentUser.demoBalance -= amount;
    else currentUser.realBalance -= amount;
    localStorage.setItem('cryptoproUser', JSON.stringify(currentUser));
    showToast(`üöÄ TRADE OPENED!\n\n${selectedTradeType==='buy'?'üìà LONG':'üìâ SHORT'} ‚Äî ${currentTradePairLabel}\nüí∞ Amount: $${amount.toFixed(2)}\n‚ö° Leverage: ${leverage}x\nüìä Position: $${pos.toFixed(2)}\nüíµ Entry: $${currentBTCPrice.toFixed(2)}\n${tp?'‚úÖ Take Profit: $'+tp:''}${sl?'\nüõë Stop Loss: $'+sl:''}\n\n‚è± Trade is now live!`);
    addNotification(`‚ö° Trade Opened`, `${selectedTradeType.toUpperCase()} ${currentTradePairLabel} ‚Äî $${amount.toFixed(2)} @ ${leverage}x`);
    setTimeout(() => simulateTradeResult(trade), Math.random()*25000+10000);
    document.getElementById('tradeForm').reset();
    selectTradeType('buy');
    updateTradingLayer();
    return false;
}

function simulateTradeResult(trade) {
    const isWin = Math.random() < 0.65;
    const priceMovePct = (Math.random()*0.035+0.008);
    const exitPrice = trade.entryPrice * (1 + (isWin ? priceMovePct : -priceMovePct) * (trade.type === 'sell' ? -1 : 1));
    let profitPct = ((exitPrice - trade.entryPrice) / trade.entryPrice) * 100;
    if(trade.type === 'sell') profitPct = -profitPct;
    const profit = trade.amount * (profitPct / 100) * trade.leverage;
    const returned = trade.amount + profit;
    trade.exitPrice = exitPrice; trade.profit = profit; trade.status = 'closed';
    if(trade.accountMode === 'demo') currentUser.demoBalance += returned;
    else currentUser.realBalance += returned;
    currentUser.totalProfit = (currentUser.totalProfit || 0) + profit;
    localStorage.setItem('cryptoproUser', JSON.stringify(currentUser));
    if(profit > 0) launchConfetti();
    showToast(profit > 0
        ? `üéâ TRADE CLOSED ‚Äî PROFIT!\n\n‚úÖ ${trade.type.toUpperCase()} ${trade.pair}\nüí∞ Investment: $${trade.amount.toFixed(2)}\n‚ö° Leverage: ${trade.leverage}x\nüìà Entry: $${trade.entryPrice.toFixed(2)}\nüìâ Exit: $${exitPrice.toFixed(2)}\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüíö PROFIT: +$${profit.toFixed(2)}\nüí∞ Returned: $${returned.toFixed(2)}\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`
        : `üìâ TRADE CLOSED ‚Äî LOSS\n\n‚ùå ${trade.type.toUpperCase()} ${trade.pair}\nüí∞ Investment: $${trade.amount.toFixed(2)}\n‚ö° Leverage: ${trade.leverage}x\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n‚ù§Ô∏è LOSS: -$${Math.abs(profit).toFixed(2)}\nüí∞ Returned: $${returned.toFixed(2)}\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`);
    addNotification(profit > 0 ? 'üéâ Trade Profit!' : 'üìâ Trade Closed', `${trade.type.toUpperCase()} ${trade.pair}: ${profit >= 0?'+':'-'}$${Math.abs(profit).toFixed(2)}`);
    if(currentLayer === 'dashboardLayer') updateDashboard();
    if(currentLayer === 'historyLayer') { updateTradeHistory(); updateHistoryStats(); }
}

// ============================================
// TRADE HISTORY
// ============================================
function updateTradeHistory() {
    if(!currentUser) return;
    const container = document.getElementById('tradeHistoryContainer');
    if(!container) return;
    const trades = (currentUser.trades||[]).filter(t => t.accountMode === currentAccountMode).reverse();
    if(trades.length === 0) {
        container.innerHTML = `<div style="text-align:center;padding:60px 20px;"><div style="font-size:54px;margin-bottom:14px;">üìä</div><div style="font-size:18px;font-weight:700;color:var(--text-secondary);">No trades yet</div><div style="font-size:13px;color:var(--text-muted);margin-top:6px;">Start trading to see your history here</div><button class="btn-submit" style="margin-top:20px;width:auto;padding:12px 28px;" onclick="showLayer('tradingLayer')">‚ö° Start Trading</button></div>`;
        return;
    }
    container.innerHTML = trades.map(t => {
        const isProfit = (t.profit||0) >= 0;
        const statusColor = t.status === 'open' ? 'var(--accent-blue)' : (isProfit ? 'var(--accent-green)' : 'var(--accent-red)');
        return `<div class="history-item" style="border-color:${statusColor}22;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;flex-wrap:wrap;gap:8px;">
                <div>
                    <div style="font-size:15px;font-weight:700;">${t.type==='buy'?'üìà':'üìâ'} ${t.type.toUpperCase()} ‚Äî ${t.pair||'BTC/USDT'}</div>
                    <div style="font-size:11px;color:var(--text-secondary);margin-top:3px;">${new Date(t.timestamp).toLocaleString()}</div>
                </div>
                <div style="text-align:right;">
                    <div style="font-size:12px;font-weight:700;color:${statusColor};">${t.status.toUpperCase()}</div>
                    ${t.profit !== null ? `<div style="font-size:20px;font-weight:900;color:${isProfit?'var(--accent-green)':'var(--accent-red)'};font-family:'JetBrains Mono',monospace;">${isProfit?'+':'-'}$${Math.abs(t.profit).toFixed(2)}</div>` : ''}
                </div>
            </div>
            <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;">
                <div style="background:rgba(0,0,0,0.3);padding:10px;border-radius:8px;"><div style="font-size:10px;color:var(--text-secondary);margin-bottom:3px;">Amount</div><div style="font-size:13px;font-weight:700;font-family:'JetBrains Mono',monospace;">$${t.amount.toFixed(2)}</div></div>
                <div style="background:rgba(0,0,0,0.3);padding:10px;border-radius:8px;"><div style="font-size:10px;color:var(--text-secondary);margin-bottom:3px;">Leverage</div><div style="font-size:13px;font-weight:700;color:var(--accent-yellow);font-family:'JetBrains Mono',monospace;">${t.leverage}x</div></div>
                <div style="background:rgba(0,0,0,0.3);padding:10px;border-radius:8px;"><div style="font-size:10px;color:var(--text-secondary);margin-bottom:3px;">Entry</div><div style="font-size:13px;font-weight:700;font-family:'JetBrains Mono',monospace;">$${t.entryPrice.toFixed(0)}</div></div>
                <div style="background:rgba(0,0,0,0.3);padding:10px;border-radius:8px;"><div style="font-size:10px;color:var(--text-secondary);margin-bottom:3px;">Exit</div><div style="font-size:13px;font-weight:700;font-family:'JetBrains Mono',monospace;">${t.exitPrice ? '$'+t.exitPrice.toFixed(0) : '‚Äî'}</div></div>
            </div>
        </div>`;
    }).join('');
}

function updateHistoryStats() {
    const container = document.getElementById('historyStatsGrid');
    if(!container || !currentUser) return;
    const trades = (currentUser.trades||[]).filter(t => t.accountMode === currentAccountMode && t.status === 'closed');
    const wins = trades.filter(t => (t.profit||0) > 0).length;
    const totalPnL = trades.reduce((s,t) => s + (t.profit||0), 0);
    const winRate = trades.length > 0 ? ((wins/trades.length)*100).toFixed(1) : 0;
    container.innerHTML = `
        <div class="stat-card"><div class="stat-icon">üìä</div><div class="stat-value" style="font-size:22px;">${trades.length}</div><div class="stat-label">Total Trades</div></div>
        <div class="stat-card"><div class="stat-icon">üéØ</div><div class="stat-value" style="font-size:22px;">${winRate}%</div><div class="stat-label">Win Rate</div></div>
        <div class="stat-card"><div class="stat-icon">üí∞</div><div class="stat-value" style="font-size:22px;color:${totalPnL>=0?'var(--accent-green)':'var(--accent-red)'};">${totalPnL>=0?'+':'-'}$${Math.abs(totalPnL).toFixed(2)}</div><div class="stat-label">Total P&L</div></div>
        <div class="stat-card"><div class="stat-icon">üèÜ</div><div class="stat-value" style="font-size:22px;">${wins}</div><div class="stat-label">Winning Trades</div></div>`;
}

// ============================================
// REFERRAL
// ============================================
function updateReferralLayer() {
    if(!currentUser) return;
    const referrals = currentUser.referrals || [];
    const shares = currentUser.shareCount || 0;
    const commission = referrals.reduce((s,r) => s+(r.commission||0), 0);
    setEl('totalReferrals', referrals.length);
    setEl('activeReferrals', referrals.filter(r=>r.active).length);
    setEl('totalCommission', '$' + commission.toFixed(2));
    setEl('totalShares', shares);
    setEl('shareCountDisplay', shares);
    setEl('shareEarningsDisplay', '$' + (shares * 5).toFixed(2));
    setEl('referralLink', currentUser.referralLink || location.href + '?ref=YOUR_CODE');
}

function copyReferralLink() {
    copyToClipboard(currentUser.referralLink);
    showToast('‚úÖ Referral link copied!\n\nShare it to earn 10% commission + $5 per share!');
}

function shareViaWhatsApp() {
    recordShare('whatsapp');
    const msg = `üöÄ JOIN CRYPTOPRO ‚Äî Make Daily Profits!\n\nI'm making consistent profits with AI trading bots! üí∞\n\n‚úÖ Get $25 signup bonus\n‚úÖ AI bots trade for you 24/7\n‚úÖ Fast withdrawals\n\nJoin here: ${currentUser.referralLink}`;
    window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
}

function shareViaTelegram() {
    recordShare('telegram');
    const msg = `üöÄ Join CryptoPro and earn daily profits with AI trading! Get $25 bonus: ${currentUser.referralLink}`;
    window.open(`https://t.me/share/url?url=${encodeURIComponent(currentUser.referralLink)}&text=${encodeURIComponent(msg)}`, '_blank');
}

function shareViaFacebook() {
    recordShare('facebook');
    window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(currentUser.referralLink)}`, '_blank');
}

function shareViaTwitter() {
    recordShare('twitter');
    const msg = `üöÄ Making daily profits with @CryptoPro AI trading! Get $25 signup bonus:`;
    window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(msg)}&url=${encodeURIComponent(currentUser.referralLink)}`, '_blank');
}

function recordShare(platform) {
    if(!currentUser.shareCount) currentUser.shareCount = 0;
    currentUser.shareCount++;
    const earn = 5;
    if(currentAccountMode === 'demo') currentUser.demoBalance += earn;
    else currentUser.realBalance += earn;
    localStorage.setItem('cryptoproUser', JSON.stringify(currentUser));
    showToast(`üéâ Share Recorded ‚Äî ${platform.toUpperCase()}!\n\nüí∞ +$5.00 added to your account!\nüì¢ Total shares: ${currentUser.shareCount}\nüíµ Total from shares: $${(currentUser.shareCount*5).toFixed(2)}\n\nKeep sharing to earn more!`);
    addNotification('üí∞ Share Reward!', `+$5.00 earned from ${platform} share`);
    updateReferralLayer();
    if(currentLayer === 'dashboardLayer') updateDashboard();
}

// ============================================
// PROFILE
// ============================================
function updateProfileLayer() {
    if(!currentUser) return;
    const nameEl = document.getElementById('profileName');
    const emailEl = document.getElementById('profileEmail');
    const phoneEl = document.getElementById('profilePhone');
    if(nameEl) nameEl.value = currentUser.name;
    if(emailEl) emailEl.value = currentUser.email;
    if(phoneEl) phoneEl.value = currentUser.phone;
    setEl('accountId', currentUser.id);
    setEl('memberSince', new Date(currentUser.joinDate).toLocaleDateString('en-US',{year:'numeric',month:'long',day:'numeric'}));
}

function updateProfile(event) {
    event.preventDefault();
    currentUser.name = document.getElementById('profileName').value.trim();
    currentUser.email = document.getElementById('profileEmail').value.trim();
    currentUser.phone = document.getElementById('profilePhone').value.trim();
    const cp = document.getElementById('profileCurrentPassword').value;
    const np = document.getElementById('profileNewPassword').value;
    if(np && cp) {
        if(cp !== currentUser.password) { showToast('‚ùå Current password is incorrect!'); return false; }
        if(np.length < 6) { showToast('‚ùå New password must be at least 6 characters!'); return false; }
        currentUser.password = np;
    }
    localStorage.setItem('cryptoproUser', JSON.stringify(currentUser));
    setEl('userName', currentUser.name);
    setEl('userEmail', currentUser.email);
    document.getElementById('profileCurrentPassword').value = '';
    document.getElementById('profileNewPassword').value = '';
    showToast('‚úÖ Profile updated successfully!\n\nYour changes have been saved.');
    return false;
}

// ============================================
// CURRENCY CONVERTER
// ============================================
async function detectUserLocation() {
    try {
        const r = await fetch('https://ipapi.co/json/');
        const d = await r.json();
        userLocation.country = d.country_name || 'Kenya';
        userLocation.currency = d.currency || 'KES';
        userLocation.city = d.city || '';
        if(userLocation.currency !== 'USD') {
            try {
                const rr = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
                const dd = await rr.json();
                userLocation.rate = dd.rates[userLocation.currency] || 130;
            } catch {
                const fallback = { KES:130, NGN:750, GHS:12, ZAR:18, EUR:0.92, GBP:0.79, CAD:1.35, AUD:1.52, EGP:31 };
                userLocation.rate = fallback[userLocation.currency] || 130;
            }
        } else { userLocation.rate = 1; }
    } catch { }
    addCurrencyConverter();
}

function addCurrencyConverter() {
    const c = document.getElementById('currencyConverterContainer');
    if(!c) return;
    c.innerHTML = `
        <div style="background:linear-gradient(135deg,rgba(14,203,129,0.08),rgba(0,184,255,0.04));border:1px solid rgba(14,203,129,0.2);border-radius:12px;padding:18px;margin-bottom:18px;">
            <div style="text-align:center;margin-bottom:14px;">
                <div style="font-size:15px;font-weight:700;color:var(--accent-green);">üí± Live Currency Converter</div>
                <div style="font-size:12px;color:var(--text-secondary);margin-top:3px;">üìç ${userLocation.city ? userLocation.city+', ' : ''}${userLocation.country}</div>
            </div>
            <div style="display:grid;grid-template-columns:1fr auto 1fr;gap:14px;align-items:center;background:rgba(0,0,0,0.3);padding:16px;border-radius:10px;">
                <div style="text-align:center;">
                    <div style="font-size:11px;color:var(--text-secondary);margin-bottom:6px;text-transform:uppercase;letter-spacing:0.5px;">USD Amount</div>
                    <div style="font-size:26px;font-weight:900;color:var(--accent-blue);font-family:'JetBrains Mono',monospace;" id="usdDisplay">$0.00</div>
                </div>
                <div style="font-size:22px;color:var(--accent-green);">‚áÑ</div>
                <div style="text-align:center;">
                    <div style="font-size:11px;color:var(--text-secondary);margin-bottom:6px;text-transform:uppercase;letter-spacing:0.5px;">${userLocation.currency} Equivalent</div>
                    <div style="font-size:26px;font-weight:900;color:var(--accent-green);font-family:'JetBrains Mono',monospace;" id="localDisplay">${userLocation.currency} 0.00</div>
                </div>
            </div>
            <div style="text-align:center;margin-top:12px;font-size:13px;font-weight:700;color:var(--accent-yellow);">1 USD = ${userLocation.rate.toFixed(2)} ${userLocation.currency}</div>
            <div style="background:rgba(14,203,129,0.05);border-left:3px solid var(--accent-green);padding:12px 14px;border-radius:0 8px 8px 0;margin-top:12px;font-size:12px;color:var(--text-primary);line-height:1.6;">
                üí° Enter your USD amount above. Pay the equivalent <strong>${userLocation.currency}</strong> amount and we'll credit the USD value to your account.
            </div>
        </div>`;
}

function updateCurrencyConversion() {
    const amt = parseFloat(document.getElementById('depositAmount')?.value) || 0;
    const usd = document.getElementById('usdDisplay');
    const loc = document.getElementById('localDisplay');
    if(usd) usd.textContent = '$' + amt.toFixed(2);
    if(loc) loc.textContent = userLocation.currency + ' ' + (amt * userLocation.rate).toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2});
}

function convertUSDToLocal(usdAmount) {
    return userLocation.currency + ' ' + (usdAmount * userLocation.rate).toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2});
}

// ============================================
// AI ASSISTANT
// ============================================
const AI_RESPONSES = {
    'best bot': 'üéØ For beginners I recommend <strong>Scalper Pro</strong> ‚Äî 87% win rate, runs 50+ trades/day, minimum $10 balance.\n\nFor maximum profits, <strong>Arbitrage AI</strong> has 91% win rate but needs $200 minimum balance.\n\nAll bots run 24/7 automatically! ü§ñ',
    'deposit': 'üí∞ To deposit:\n1. Dashboard ‚Üí Deposit\n2. Enter amount (min $10)\n3. Choose M-Pesa, Bank, or Crypto\n4. Make payment\n5. Submit proof screenshot\n6. Credited in 5 minutes!\n\nüéÅ First deposit gets 100% BONUS!',
    'withdraw': 'üí∏ To withdraw:\n1. Dashboard ‚Üí Withdraw\n2. Enter amount (min $50)\n3. Choose M-Pesa, Bank, or Crypto\n4. Enter payment details\n5. Click Request Withdrawal\n6. Processed in 5‚Äì30 minutes!\n\nFee is only 2%. You need to be on REAL account mode. üöÄ',
    'btc': 'üìà BTC is currently showing strong momentum. Our AI signals suggest a bullish trend in the short term.\n\n‚ö†Ô∏è Always use Stop Loss to manage risk!',
    'referral': 'üéÅ Referral Program:\n\n‚úÖ Get your unique link from Dashboard ‚Üí Referrals\n‚úÖ Share it with friends\n‚úÖ Earn <strong>10% commission</strong> on every deposit they make\n‚úÖ Earn <strong>$5 per share</strong> on social media\n‚úÖ Earnings are instant and withdrawable!\n\nNo limit on referrals or earnings! üí∞',
    'bonus': 'üéâ Bonuses Available:\n\n1. <strong>$25 Signup Bonus</strong> ‚Äî Auto-credited on registration\n2. <strong>100% Welcome Bonus</strong> ‚Äî First deposit doubled!\n3. <strong>$5 Per Share</strong> ‚Äî Share your referral link\n4. <strong>10% Referral</strong> ‚Äî From friends\' deposits\n\nAll bonuses are 100% withdrawable! üöÄ',
    'default': 'ü§î Great question! I\'m here to help.\n\nAsk me about: deposits, withdrawals, best bots, BTC outlook, referrals, or bonuses! üí™'
};

function toggleAIChat() {
    const panel = document.getElementById('aiChatPanel');
    if(panel) panel.classList.toggle('open');
}

function sendAIQuickReply(text) { addUserMessage(text); processAIResponse(text); }

function sendAIMessage() {
    const input = document.getElementById('aiInput');
    const text = input?.value.trim();
    if(!text) return;
    input.value = '';
    addUserMessage(text);
    processAIResponse(text);
}

function addUserMessage(text) {
    const msgs = document.getElementById('aiMessages');
    if(!msgs) return;
    const msg = document.createElement('div');
    msg.className = 'ai-msg user';
    msg.textContent = text;
    msgs.appendChild(msg);
    msgs.scrollTop = msgs.scrollHeight;
}

function processAIResponse(text) {
    const msgs = document.getElementById('aiMessages');
    if(!msgs) return;
    const typing = document.createElement('div');
    typing.className = 'ai-typing';
    typing.innerHTML = '<span></span><span></span><span></span>';
    msgs.appendChild(typing);
    msgs.scrollTop = msgs.scrollHeight;
    const lower = text.toLowerCase();
    let response = AI_RESPONSES.default;
    for(const [key, val] of Object.entries(AI_RESPONSES)) {
        if(key !== 'default' && lower.includes(key)) { response = val; break; }
    }
    setTimeout(() => {
        typing.remove();
        const msg = document.createElement('div');
        msg.className = 'ai-msg bot';
        msg.innerHTML = response.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
        msgs.appendChild(msg);
        msgs.scrollTop = msgs.scrollHeight;
    }, 1000 + Math.random()*1000);
}

// ============================================
// CONFETTI
// ============================================
function launchConfetti() {
    const colors = ['#0ECB81','#FCD535','#00B8FF','#A855F7','#F6465D','#fff'];
    for(let i = 0; i < 70; i++) {
        const piece = document.createElement('div');
        piece.className = 'confetti-piece';
        const size = Math.random()*10+5;
        piece.style.cssText = `left:${Math.random()*100}vw;top:-20px;background:${colors[Math.floor(Math.random()*colors.length)]};width:${size}px;height:${size}px;border-radius:${Math.random()>0.5?'50%':'2px'};animation:confettiFall ${Math.random()*2+2}s linear ${Math.random()*0.8}s forwards;`;
        document.body.appendChild(piece);
        setTimeout(() => { if(piece.parentNode) piece.remove(); }, 4500);
    }
}

// ============================================
// UTILITIES
// ============================================
function copyToClipboard(text) {
    if(navigator.clipboard?.writeText) {
        navigator.clipboard.writeText(text).then(() => showToast('‚úÖ Copied to clipboard!\n\n' + text)).catch(() => fallbackCopy(text));
    } else { fallbackCopy(text); }
}

function fallbackCopy(text) {
    const ta = document.createElement('textarea');
    ta.value = text;
    ta.style.cssText = 'position:fixed;opacity:0;top:0;left:0;';
    document.body.appendChild(ta);
    ta.select();
    try { document.execCommand('copy'); showToast('‚úÖ Copied: ' + text); }
    catch { showToast('‚ùå Copy failed. Please copy manually:\n' + text); }
    document.body.removeChild(ta);
}

function showAlert(id, msg, type) {
    const el = document.getElementById(id);
    if(!el) return;
    el.textContent = msg;
    el.className = `alert alert-${type} show`;
    setTimeout(() => el?.classList.remove('show'), 6000);
}

let toastTimer;
function showToast(msg, type) {
    const t = document.getElementById('toastNotification');
    if(!t) return;
    t.textContent = msg;
    t.className = `toast-notification show${type?' '+type:''}`;
    clearTimeout(toastTimer);
    toastTimer = setTimeout(() => t?.classList.remove('show'), 7000);
}

function animateProgress(fillId, textId, labelId, steps, onDone) {
    const fill = document.getElementById(fillId);
    const text = document.getElementById(textId);
    const label = document.getElementById(labelId);
    let i = 0;
    const next = () => {
        if(i >= steps.length) { setTimeout(() => { if(onDone) onDone(); }, 500); return; }
        const step = steps[i++];
        if(fill) fill.style.width = step.pct + '%';
        if(text) text.textContent = step.pct + '% complete';
        if(label) label.textContent = step.label;
        setTimeout(next, 900 + Math.random()*400);
    };
    next();
}

// ============================================
// MOBILE NAV SYNC
// ============================================
function syncMobileNav(layerId) {
    const map = { 'dashboardLayer':0, 'tradingLayer':1, 'depositLayer':2, 'withdrawalLayer':3, 'profileLayer':4 };
    document.querySelectorAll('.mobile-nav-item').forEach((item, i) => {
        item.classList.toggle('active', i === (map[layerId] ?? -1));
    });
}

// ============================================
// BOT BUTTON STATE RESTORE
// ============================================
function restoreBotButtonStates() {
    activeBots.forEach(name => {
        const btn = document.getElementById('botBtn_' + name.replace(' ', '_'));
        if(btn) { btn.textContent = '‚úÖ Bot Active'; btn.style.background = 'linear-gradient(135deg,#10b981,#059669)'; }
    });
}

// ============================================
// AUTO NOTIFICATIONS
// ============================================
const AUTO_NOTIFS = [
    ['üìà BTC Rally!', 'Bitcoin up 2.1% in the last 30 minutes'],
    ['‚ö° High Volume Alert', 'ETH/USDT volume 3x above average'],
    ['üéØ Trade Opportunity', 'SOL showing strong bullish divergence'],
    ['ü§ñ Bot Update', 'Scalper Pro completed 10 trades this hour'],
    ['üî• Market Move', 'BNB/USDT up 4.5% ‚Äî strong momentum'],
    ['üìä Daily Summary', 'Platform profit rate: 94.2% today']
];
let autoNotifIndex = 0;
setInterval(() => {
    if(!currentUser) return;
    const notif = AUTO_NOTIFS[autoNotifIndex % AUTO_NOTIFS.length];
    addNotification(notif[0], notif[1]);
    autoNotifIndex++;
}, 90000);

// ============================================
// BOT DRIP EARNINGS
// ============================================
setInterval(() => {
    if(!currentUser || activeBots.size === 0) return;
    const drip = activeBots.size * (Math.random() * 0.8 + 0.2);
    if(currentAccountMode === 'demo') currentUser.demoBalance += drip;
    else currentUser.realBalance += drip;
    currentUser.totalProfit = (currentUser.totalProfit || 0) + drip;
    localStorage.setItem('cryptoproUser', JSON.stringify(currentUser));
    if(currentLayer === 'dashboardLayer') updateDashboard();
}, 15000);

// ============================================
// SYNC BALANCE DISPLAYS
// ============================================
setInterval(() => {
    if(currentLayer === 'tradingLayer' && currentUser) updateTradingLayer();
    if(currentLayer === 'withdrawalLayer' && currentUser) updateWithdrawalLayer();
}, 5000);

// ============================================
// KEYBOARD SHORTCUTS
// ============================================
document.addEventListener('keydown', e => {
    if(e.key === 'Escape') {
        document.getElementById('aiChatPanel')?.classList.remove('open');
        document.getElementById('notifDropdown')?.classList.remove('open');
        if(['loginLayer','signupLayer'].includes(currentLayer)) showLayer('welcomeLayer');
    }
});

</script>
</body>
</html>
